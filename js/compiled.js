(()=>{"use strict";var e={311:(e,t)=>{t.Z=(e,t)=>{const o=e.__vccOpts||e;for(const[e,s]of t)o[e]=s;return o}}},t={};function o(s){var n=t[s];if(void 0!==n)return n.exports;var l=t[s]={exports:{}};return e[s](l,l.exports,o),l.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=Vue,t=ElementPlus;var s=o.n(t);const n=ElementPlusLocaleEn;var l=o.n(n);const i={class:"app"},a={key:0},r=[(0,e.createElementVNode)("span",null,"Loading...",-1)],c={key:1},d=(0,e.createTextVNode)("Log out"),m={key:2},u=(0,e.createTextVNode)("Log in"),p=(0,e.createTextVNode)("Sign up"),h=(0,e.createTextVNode)(" Visit the CrowdSpec spec to read about this platform. "),g={class:"dialog-footer"},k=(0,e.createTextVNode)(" Close "),b={class:"username"},f=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,y=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,C=/^#[0-9a-f]{6}$/i;function w(e){if(e&&"object"==typeof e){if(e.hsl)return V(e);if(e.rgb)return e}else if("string"==typeof e){if(f.test(e)){let t=f.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(C.test(e)){function t(e){e=e.toLowerCase();let t=0;for(let o=0;o<e.length;o++){let s=e.charCodeAt(e.length-1-o);s>=48&&s<=57?t+=(s-48)*Math.pow(16,o):s>=97&&s<=122&&(t+=(s-97+10)*Math.pow(16,o))}return t}return{r:t(e.substr(1,2)),g:t(e.substr(3,2)),b:t(e.substr(5,2)),rgb:!0}}if(y.test(e))return V(e)}return{r:0,g:0,b:0,rgb:!0}}function v(e){if(e&&"object"==typeof e){if(e.hsl)return e;if(e.rgb)return B(e)}else if("string"==typeof e){if(y.test(e)){let t=y.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(f.test(e)||C.test(e))return B(e)}return{h:0,s:0,l:0,hsl:!0}}function V(e){if(e&&"object"==typeof e&&e.rgb)return e;let t,o,s,n=(e=v(e)).h,l=e.s/100,i=e.l/100,a=(1-Math.abs(2*i-1))*l,r=a*(1-Math.abs(n/60%2-1)),c=i-a/2;return 0<=n&&n<60?(t=a,o=r,s=0):60<=n&&n<120?(t=r,o=a,s=0):120<=n&&n<180?(t=0,o=a,s=r):180<=n&&n<240?(t=0,o=r,s=a):240<=n&&n<300?(t=r,o=0,s=a):300<=n&&n<360&&(t=a,o=0,s=r),{r:Math.round(255*(t+c)),g:Math.round(255*(o+c)),b:Math.round(255*(s+c)),rgb:!0}}function B(e){if(e&&"object"==typeof e&&e.hsl)return e;let t,o=(e=w(e)).r/255,s=e.g/255,n=e.b/255,l=Math.min(o,s,n),i=Math.max(o,s,n),a=i-l;t=0==a?0:i==o?(s-n)/a%6:i==s?(n-o)/a+2:(o-s)/a+4,t=Math.round(60*t);let r=(i+l)/2;return{h:t<0?t+360:t,s:+(100*(0==a?0:a/(1-Math.abs(2*r-1)))).toFixed(1),l:+(100*r).toFixed(1),hsl:!0}}function N(e){let t=w(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}const E={name:"username",props:{username:{type:String,required:!0},highlight:String},computed:{style(){let e=this.username===this.$store.getters.username?this.$store.getters.userSettings.userProfile.highlightUsername:this.highlight;if(!e)return null;let t=N(e),o=N(function(e){let t=v(e);return t.l<=25?t.l=75:t.l<=50?t.l=90:t.l<=75?t.l=10:t.l=25,t}(e));return{color:t,"text-shadow":"-1px -1px 0 "+o+", 1px -1px 0 "+o+", -1px 1px 0 "+o+", 1px 1px 0 "+o}}}};var S=o(311);const x=(0,S.Z)(E,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",b,[(0,e.createElementVNode)("i",{class:"material-icons",style:(0,e.normalizeStyle)(i.style)},"person",4),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(s.username),1)])}]]),T=(0,e.createTextVNode)(" Account options for "),I=(0,e.createElementVNode)("strong",{class:"section-heading"},"Profile",-1),P={class:"flex-input"},U=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),R=(0,e.createElementVNode)("strong",{class:"section-heading"},"Homepage",-1),_=(0,e.createElementVNode)("strong",{class:"section-heading"},"Block editing",-1),M=(0,e.createElementVNode)("strong",{class:"section-heading"},"Community",-1),O=(0,e.createTextVNode)(" Show only unread comments by default "),j=(0,e.createTextVNode)(" Update "),D=(0,e.createTextVNode)(" Cancel "),A=(0,e.createElementVNode)("p",null,[(0,e.createTextVNode)("Your password is sent through HTTPS to Google Cloud Platform in MontrÃ©al and encrypted server-side using "),(0,e.createElementVNode)("a",{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"},"bcrypt"),(0,e.createTextVNode)(".")],-1),L=(0,e.createElementVNode)("p",null,"Please use a good password so your account is less likely to be hijacked and used to cause trouble.",-1),F=(0,e.createElementVNode)("p",null," For your security, you should not use the same passwords that you use for important services such as email and online banking on other websites. If one website gets hacked, you can lose access to every other site where you use the same password. Is is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service. ",-1),q=(0,e.createTextVNode)(" Update "),z=(0,e.createTextVNode)(" Cancel "),Y={key:2,class:"options"},H=(0,e.createTextVNode)("Your email address on file is "),Z={class:"email"},W=(0,e.createTextVNode)("."),K=(0,e.createTextVNode)(" Update settings "),G=(0,e.createTextVNode)(" Change password "),X={class:"dialog-footer"},Q=(0,e.createTextVNode)("Close"),J=jQuery;var ee=o.n(J);const te=moment;var oe=o.n(te);const se=/^VersionStamp: (.+)$/m;function ne(e){console.error(e);let o=null;e&&(0===e.readyState?o="Could not connect to server.":e.readyState&&e.status?o=503===e.status?"CrowdSpec is currently offline for database upgrades. Please try again in a bit.":"Request failed with HTTP error code "+e.status+".":e.message?o=e.message:"string"==typeof e&&(o=e)),o||(o="An error occurred."),e&&e.responseText&&se.test(e.responseText)&&se.exec(e.responseText)[1]!==window.const.appVersion&&(o+=" (A new update is available. Reload this page to use the latest client code.)"),t.ElMessageBox.alert(o,"Error",{confirmButtonText:"Ok",type:"error"})}function le(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;t.ElMessage.success({message:e,duration:o})}function ie(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;t.ElMessage.info({message:e,duration:o})}function ae(e,t){return null===e&&null===t||parseInt(e,10)===parseInt(t,10)}function re(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;var o;function s(){o=null,e.apply(this,arguments)}return function(){return o&&clearTimeout(o),o=setTimeout(s.bind(this,...arguments),t)}}function ce(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;document.title="CrowdSpec"+(e?" | "+e:"")}function de(e){if(window.URL)try{return new URL(e),!0}catch{return!1}return!(!e||!e.trim())}const me=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function ue(e){return me.test(e)}function pe(e){return e?"url"===e?"URL":e.charAt(0).toUpperCase()+e.slice(1):""}const he={components:{Username:x},data:()=>({showing:!1,mode:null,settingsForm:{userProfile:{highlightUsername:null},homepage:{specsLayout:"list"},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},changePasswordForm:{oldPass:"",newPass:"",newPass2:""},waiting:!1}),computed:{username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername},updateSettingsMode(){return 1===this.mode},changePasswordMode(){return 2===this.mode},predefinedUsernameHighlights:()=>["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"],changePasswordRules(){return{oldPass:[{validator:(e,t,o)=>{t.trim()?o():o(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:(e,t,o)=>{t.trim().length<window.const.passwordMinLength?o(new Error("Password minimum length is "+window.const.passwordMinLength+" digits")):(this.changePasswordForm.newPass2.trim()&&this.$refs.changePasswordForm.validateField("newPass2"),o())},trigger:"blur"}],newPass2:[{validator:(e,t,o)=>{t.trim()?t!==this.changePasswordForm.newPass?o(new Error("Passwords do not match")):o():o(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show(){this.showing=!0},enterUpdateSettingsMode(){this.mode=1,this.waiting=!0,ee().get("/ajax/settings").then((e=>{this.settingsForm=ee().extend(!0,{userProfile:{highlightUsername:null},homepage:{specsLayout:"list"},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e),this.waiting=!1})).fail((e=>{this.waiting=!1,this.clearMode(),ne(e)}))},enterChangePasswordMode(){this.mode=2,this.selectOldPassword()},submitSettings(){this.waiting=!0,ee().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((e=>{this.waiting=!1,this.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),this.clearMode(),this.$store.commit("setUserSettings",e)})).fail((e=>{this.waiting=!1,ne(e)}))},handleChangePasswordReturn(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():ee()("input",this.$refs.newPass2.$el).focus().select():ee()("input",this.$refs.newPass.$el).focus().select():ee()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword(){this.$refs.changePasswordForm.validate((e=>{e&&(this.waiting=!0,ee().post("/ajax/user/change-password",{old:this.changePasswordForm.oldPass,new:this.changePasswordForm.newPass,new2:this.changePasswordForm.newPass2}).then((()=>{this.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),this.clearMode()})).fail((e=>{if(e&&e.readyState)switch(e.status){case 400:this.$message({message:"New password rejected",type:"error",showClose:!0,duration:4e3});break;case 403:this.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:4e3}),this.selectOldPassword();break;default:ne(e)}else ne(e)})).always((()=>{this.waiting=!1})))}))},selectOldPassword(){this.$nextTick((()=>{this.$refs.oldPass&&ee()("input",this.$refs.oldPass.$el).focus().select()}))},clearMode(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},ge={components:{Username:x,EditProfileModal:(0,S.Z)(he,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("username"),r=(0,e.resolveComponent)("el-color-picker"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-form-item"),m=(0,e.resolveComponent)("el-option"),u=(0,e.resolveComponent)("el-select"),p=(0,e.resolveComponent)("el-checkbox"),h=(0,e.resolveComponent)("el-form"),g=(0,e.resolveComponent)("el-input"),k=(0,e.resolveComponent)("el-alert"),b=(0,e.resolveComponent)("el-dialog"),f=(0,e.resolveDirective)("loading");return(0,e.openBlock)(),(0,e.createBlock)(b,{modelValue:l.showing,"onUpdate:modelValue":o[18]||(o[18]=e=>l.showing=e),width:t.$store.getters.dialogTinyWidth,"close-on-click-modal":null===l.mode,onClosed:o[19]||(o[19]=e=>i.clearMode()),"custom-class":"edit-profile-modal"},{title:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",null,[T,(0,e.createVNode)(a,{username:i.username,highlight:i.highlight},null,8,["username","highlight"])])])),footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",X,[(0,e.createVNode)(c,{onClick:o[17]||(o[17]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Q])),_:1})])])),default:(0,e.withCtx)((()=>[i.updateSettingsMode?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,ref:"changePasswordForm",model:l.settingsForm,"label-position":"top"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[I])),default:(0,e.withCtx)((()=>[(0,e.createElementVNode)("div",P,[(0,e.createVNode)(r,{modelValue:l.settingsForm.userProfile.highlightUsername,"onUpdate:modelValue":o[0]||(o[0]=e=>l.settingsForm.userProfile.highlightUsername=e),predefine:i.predefinedUsernameHighlights,"color-format":"rgb"},null,8,["modelValue","predefine"]),l.settingsForm.userProfile.highlightUsername?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[1]||(o[1]=e=>l.settingsForm.userProfile.highlightUsername=null),size:"small"},{default:(0,e.withCtx)((()=>[U])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{username:"Username colour",highlight:l.settingsForm.userProfile.highlightUsername},null,8,["highlight"])])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[R])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(u,{modelValue:l.settingsForm.homepage.specsLayout,"onUpdate:modelValue":o[2]||(o[2]=e=>l.settingsForm.homepage.specsLayout=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(m,{label:"Display specs in a list",value:"list"}),(0,e.createVNode)(m,{label:"Display specs in a grid",value:"grid"})])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[_])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(u,{modelValue:l.settingsForm.blockEditing.deleteButton,"onUpdate:modelValue":o[3]||(o[3]=e=>l.settingsForm.blockEditing.deleteButton=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(m,{label:"Show delete button only in edit block modal",value:"modal"}),(0,e.createVNode)(m,{label:"Show delete button on newly added blocks",value:"recent"}),(0,e.createVNode)(m,{label:"Show delete button on all blocks",value:"all"})])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[M])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(p,{modelValue:l.settingsForm.community.unreadOnly,"onUpdate:modelValue":o[4]||(o[4]=e=>l.settingsForm.community.unreadOnly=e)},{default:(0,e.withCtx)((()=>[O])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{type:"primary",onClick:o[5]||(o[5]=e=>i.submitSettings())},{default:(0,e.withCtx)((()=>[j])),_:1}),(0,e.createVNode)(c,{onClick:o[6]||(o[6]=e=>i.clearMode())},{default:(0,e.withCtx)((()=>[D])),_:1})])),_:1})])),_:1},8,["model"])),[[f,l.waiting]]):i.changePasswordMode?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createBlock)(h,{key:1,ref:"changePasswordForm",model:l.changePasswordForm,rules:i.changePasswordRules,"label-position":"top"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(d,{label:"Current password",prop:"oldPass"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"oldPass",type:"password",name:"old_password",modelValue:l.changePasswordForm.oldPass,"onUpdate:modelValue":o[7]||(o[7]=e=>l.changePasswordForm.oldPass=e),autocomplete:"current-password",onKeyup:o[8]||(o[8]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.oldPass)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,{label:"New password",prop:"newPass"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"newPass",type:"password",name:"new_password",modelValue:l.changePasswordForm.newPass,"onUpdate:modelValue":o[9]||(o[9]=e=>l.changePasswordForm.newPass=e),autocomplete:"new-password",onKeyup:o[10]||(o[10]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.newPass)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,{label:"Confirm new password",prop:"newPass2"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"newPass2",type:"password",name:"verify_password",modelValue:l.changePasswordForm.newPass2,"onUpdate:modelValue":o[11]||(o[11]=e=>l.changePasswordForm.newPass2=e),autocomplete:"new-password",onKeyup:o[12]||(o[12]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.newPass2)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(k,{type:"info",closable:!1},{default:(0,e.withCtx)((()=>[A,L,F])),_:1})])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{type:"primary",onClick:o[13]||(o[13]=e=>i.submitChangePassword())},{default:(0,e.withCtx)((()=>[q])),_:1}),(0,e.createVNode)(c,{onClick:o[14]||(o[14]=e=>i.clearMode())},{default:(0,e.withCtx)((()=>[z])),_:1})])),_:1})])),_:1},8,["model","rules"])),[[f,l.waiting]]):((0,e.openBlock)(),(0,e.createElementBlock)("div",Y,[(0,e.createElementVNode)("p",null,[H,(0,e.createElementVNode)("span",Z,(0,e.toDisplayString)(t.$store.getters.emailAddress),1),W]),(0,e.createVNode)(c,{onClick:o[15]||(o[15]=e=>i.enterUpdateSettingsMode())},{default:(0,e.withCtx)((()=>[K])),_:1}),(0,e.createVNode)(c,{onClick:o[16]||(o[16]=e=>i.enterChangePasswordMode())},{default:(0,e.withCtx)((()=>[G])),_:1})]))])),_:1},8,["modelValue","width","close-on-click-modal"])}]])},data:()=>({showingAbout:!1}),computed:{loadingUser(){return this.$store.getters.loadingUser},loggedIn(){return this.$store.getters.loggedIn},username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername},aboutSpecRoute:()=>({name:"spec",params:{specId:1}})},watch:{$route(){this.showingAbout=!1}},mounted(){this.$store.dispatch("loadAuth")},methods:{gotoLogin(){window.location.href="/login"},gotoSignup(){window.location.href="/signup"},gotoIndex(){"index"===this.$route.name?this.showingAbout=!0:this.$router.push({name:"index"})},logout(){(function(e,o,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"warning";return t.ElMessageBox.confirm(o,e,{confirmButtonText:s,cancelButtonText:"Cancel",type:n})})(null,"Please confirm that you wish to log out.","Log out").then((()=>{this.$store.dispatch("logOut")})).catch((()=>{}))},openEditProfile(){this.$refs.editProfileModal.show()}}},ke=(0,S.Z)(ge,[["render",function(t,o,s,n,l,b){const f=(0,e.resolveComponent)("username"),y=(0,e.resolveComponent)("el-button"),C=(0,e.resolveComponent)("router-view"),w=(0,e.resolveComponent)("edit-profile-modal"),v=(0,e.resolveComponent)("router-link"),V=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createElementBlock)("div",i,[(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h1",{onClick:o[0]||(o[0]=e=>b.gotoIndex())},"CrowdSpec"),b.loadingUser?((0,e.openBlock)(),(0,e.createElementBlock)("div",a,r)):b.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)("div",c,[(0,e.createVNode)(y,{onClick:o[1]||(o[1]=e=>b.openEditProfile()),type:"text",class:"username-button"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(f,{username:b.username,highlight:b.highlight},null,8,["username","highlight"])])),_:1}),(0,e.createVNode)(y,{onClick:o[2]||(o[2]=e=>b.logout())},{default:(0,e.withCtx)((()=>[d])),_:1})])):((0,e.openBlock)(),(0,e.createElementBlock)("div",m,[(0,e.createVNode)(y,{onClick:o[3]||(o[3]=e=>b.gotoLogin())},{default:(0,e.withCtx)((()=>[u])),_:1}),(0,e.createVNode)(y,{onClick:o[4]||(o[4]=e=>b.gotoSignup())},{default:(0,e.withCtx)((()=>[p])),_:1})]))]),(0,e.createVNode)(C,{class:"page-area"}),b.loggedIn?((0,e.openBlock)(),(0,e.createBlock)(w,{key:0,ref:"editProfileModal"},null,512)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(V,{title:"About",modelValue:l.showingAbout,"onUpdate:modelValue":o[6]||(o[6]=e=>l.showingAbout=e),width:t.$store.getters.dialogTinyWidth},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",g,[(0,e.createVNode)(y,{onClick:o[5]||(o[5]=e=>l.showingAbout=!1)},{default:(0,e.withCtx)((()=>[k])),_:1})])])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(v,{to:b.aboutSpecRoute},{default:(0,e.withCtx)((()=>[h])),_:1},8,["to"])])),_:1},8,["modelValue","width"])])}]]),be=VueRouter,fe=Vuex,ye="spec",Ce="subspec",we="block",ve="comment",Ve="bullet",Be="plaintext",Ne="markdown",Ee="url",Se="subspec",xe="user",Te=ee()(window);let Ie=null;const Pe=(0,fe.createStore)({state:()=>({currentTime:Date.now(),windowWidth:Te.width(),windowHeight:Te.height(),currentSpec:null,savedScrollPosition:null,currentSpecScrollTop:null,dragging:!1,movingBlockIds:[],movingBlocksSourceSubspecId:null,user:null,userSettings:null}),getters:{loggedIn:e=>!!e.user,loadingUser:e=>!1===e.user,currentUserId:e=>e.user?e.user.id:null,username:e=>e.user?e.user.username:null,emailAddress:e=>e.user?e.user.email:null,userSettings:e=>e.user?ee().extend(!0,{userProfile:{highlightUsername:null},homepage:{specsLayout:"list"},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e.userSettings):{userProfile:{highlightUsername:null},homepage:{specsLayout:"list"},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},userIsAdmin:e=>!!e.user&&e.user.admin,specsLayoutList:(e,t)=>!t.loggedIn||"list"===t.userSettings.homepage.specsLayout,defaultShowUnreadCommentsOnly:(e,t)=>t.loggedIn&&t.userSettings.community.unreadOnly,mobileViewport:e=>e.windowWidth<=767,dialogTinyWidth:e=>e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%",dialogSmallWidth:e=>e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%",dialogLargeWidth:e=>e.windowWidth<=991?"95%":"90%",currentSpecId:e=>e.currentSpec?e.currentSpec.id:null,currentSpecOwnedByUser:(e,t)=>!!e.currentSpec&&e.currentSpec.ownerType===xe&&ae(e.currentSpec.ownerId,t.currentUserId),currentlyMovingBlocks:e=>e.movingBlockIds.length>0,currentlyMovingBlock:e=>t=>e.movingBlockIds.indexOf(t)>=0},mutations:{updateWindowDimensions(e){e.windowWidth=Te.width(),e.windowHeight=Te.height()},updateCurrentTime(e){e.currentTime=Date.now()},setUser(e,t){e.user=t},setUserSettings(e,t){e.userSettings=t},saveCurrentSpec(e,t){console.debug("saveCurrentSpec"),e.currentSpec&&!ae(e.currentSpec.id,t.id)&&(console.debug("saveCurrentSpec clear currentSpecScrollTop"),e.currentSpecScrollTop=null),e.currentSpec=t},startDragging(e){e.dragging=!0},endDragging(e){e.dragging=!1},setMovingBlocks(e,t){e.movingBlocksSourceSubspecId=t.subspecId,e.movingBlockIds=t.blockIds},endMovingBlocks(e){e.movingBlocksSourceSubspecId=null,e.movingBlockIds=[]},setSavedScrollPosition(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpecScrollTop(e){console.debug("saveCurrentSpecScrollTop"),e.currentSpecScrollTop=Te.scrollTop()},clearCurrentSpec(e){e.currentSpec=null,e.currentSpecScrollTop=null}},actions:{loadAuth(e){let{commit:t}=e;t("setUser",!1),ee().get("/ajax/auth").then((e=>{t("setUser",e)})).fail((e=>{t("setUser",null),e&&e.readyState&&e.status&&403===e.status||ne(e)}))},logOut(e){let{commit:t}=e;ee().get("/ajax/logout").then((e=>{t("setUser",null)})).fail(ne)}}}),Ue=Pe;Te.on("resize",(()=>{Pe.commit("updateWindowDimensions")})),setTimeout((function e(){Pe.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const Re={class:"index-page"},_e={key:0,class:"actions"},Me=(0,e.createTextVNode)(" New spec "),$e=(0,e.createTextVNode)(" Community review "),Oe=(0,e.createTextVNode)(" Admin "),je={key:1,class:"user-specs"},De=(0,e.createElementVNode)("h2",null,"Your specs",-1),Ae={key:0},Le=["onClick"],Fe={class:"info"},qe=(0,e.createElementVNode)("i",{class:"material-icons"},"beach_access",-1),ze=(0,e.createTextVNode)(" Public"),Ye=(0,e.createElementVNode)("i",{class:"material-icons"},"lock",-1),He=(0,e.createTextVNode)(" Private"),Ze=["href","onClick"],We={class:"info"},Ke={class:"updated"},Ge=(0,e.createTextVNode)("Last modified "),Xe={key:0,class:"desc"},Qe={key:2},Je=(0,e.createElementVNode)("h2",null,"Public specs",-1),et={key:0},tt=["onClick"],ot={class:"info"},st=["href","onClick"],nt={class:"info"},lt={class:"updated"},it=(0,e.createTextVNode)("Last modified "),at={key:0,class:"desc"},rt={key:2},ct={props:{datetime:String,offset:Boolean},data:()=>({timeout:null}),computed:{moment(){return oe().parseZone(this.datetime).local()},currentTime(){return this.$store.state.currentTime},output(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},dt=(0,S.Z)(ct,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",null,(0,e.toDisplayString)(i.output),1)}]]),mt={key:0},ut=(0,e.createTextVNode)(" Created "),pt=(0,e.createTextVNode)("; last modified "),ht=(0,e.createElementVNode)("div",null,"Name",-1),gt=(0,e.createElementVNode)("div",null,"Description",-1),kt=(0,e.createTextVNode)("Allow public access and community features"),bt={class:"dialog-footer"},ft=(0,e.createTextVNode)("Cancel"),yt=(0,e.createTextVNode)("Delete");function Ct(e,t,o){return ee().post("/ajax/spec/create-subspec",{specId:e,name:t,desc:o}).fail(ne)}function wt(e,t,o,s){for(var n=0;n<e.length;n++)e[n]=parseInt(e[n],10);return e=JSON.stringify(e),ee().post("/ajax/spec/move-blocks",{blockIds:e,subspecId:t,parentId:o,insertBeforeId:s}).fail(ne)}function vt(e,t){return ee().post("/ajax/spec/create-url",{specId:e,url:t}).fail(ne)}function Vt(e,t,o,s,n){return ee().get("/ajax/spec/community/page",{specId:e,targetType:t,targetId:o,updatedBefore:s,unreadOnly:n}).fail(ne)}const Bt={components:{Moment:dt},data:()=>({name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{ee()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((()=>{ee()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;var t,o,s;(t=this.name,o=this.desc,s=this.isPublic,ee().post("/ajax/spec/create-spec",{name:t,desc:o,isPublic:s}).fail(ne)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,o,s,n;(t=this.spec.id,o=this.name,s=this.desc,n=this.isPublic,ee().post("/ajax/spec/save-spec",{specId:t,name:o,desc:s,isPublic:n}).fail(ne)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSpec(){this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.spec.id,ee().post("/ajax/spec/delete-spec",{specId:e}).fail(ne)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"index"})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},Nt=(0,S.Z)(Bt,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-checkbox"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(m,{title:l.spec?"Manage spec":"Create spec",modelValue:l.showing,"onUpdate:modelValue":o[6]||(o[6]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[7]||(o[7]=e=>i.closed()),"custom-class":"spec-edit-spec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",bt,[(0,e.createVNode)(d,{onClick:o[3]||(o[3]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[ft])),_:1}),l.spec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[4]||(o[4]=e=>i.promptDeleteSpec()),type:"danger"},{default:(0,e.withCtx)((()=>[yt])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{onClick:o[5]||(o[5]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.spec?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.spec?((0,e.openBlock)(),(0,e.createElementBlock)("p",mt,[ut,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.spec.created},null,8,["datetime"])]),pt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.spec.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[ht,(0,e.createVNode)(r,{ref:"nameInput",modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.name=e),maxlength:i.nameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[gt,(0,e.createVNode)(r,{type:"textarea",modelValue:l.desc,"onUpdate:modelValue":o[1]||(o[1]=e=>l.desc=e),autosize:{minRows:2}},null,8,["modelValue"])]),(0,e.createVNode)(c,{modelValue:l.isPublic,"onUpdate:modelValue":o[2]||(o[2]=e=>l.isPublic=e)},{default:(0,e.withCtx)((()=>[kt])),_:1},8,["modelValue"])])),_:1},8,["title","modelValue","width"])}]]),Et={class:"loading-message"},St=(0,e.createElementVNode)("i",{class:"material-icons spin"},"loop",-1),xt={key:0},Tt={props:{message:String}},It=(0,S.Z)(Tt,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",Et,[St,s.message?((0,e.openBlock)(),(0,e.createElementBlock)("span",xt,(0,e.toDisplayString)(s.message),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Pt={components:{Moment:dt,Username:x,EditSpecModal:Nt,LoadingMessage:It},data:()=>({unreadCommunity:0,userSpecs:[],publicSpecs:[],loading:!0}),computed:{loggedIn(){return this.$store.getters.loggedIn},specsLayoutList(){return this.$store.getters.specsLayoutList}},mounted(){this.reloadSpecs()},beforeRouteUpdate(e,t,o){this.reloadSpecs(),o()},methods:{reloadSpecs(){this.loading=!0,ee().get("/ajax/home").then((e=>{this.unreadCommunity=e.unread,this.userSpecs=e.userSpecs,this.publicSpecs=e.publicSpecs,this.loading=!1})).fail((e=>{this.loading=!1,ne(e)}))},promptCreateSpec(){this.$store.state.loggedIn&&this.$refs.editSpecModal.showCreate((e=>{this.$router.push({name:"spec",params:{specId:e}})}))}}},Ut=(0,S.Z)(Pt,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("loading-message"),c=(0,e.resolveComponent)("moment"),d=(0,e.resolveComponent)("router-link"),m=(0,e.resolveComponent)("username"),u=(0,e.resolveComponent)("edit-spec-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Re,[i.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)("div",_e,[(0,e.createVNode)(a,{onClick:o[0]||(o[0]=e=>i.promptCreateSpec()),type:"primary"},{default:(0,e.withCtx)((()=>[Me])),_:1}),(0,e.createVNode)(a,{onClick:o[1]||(o[1]=e=>t.$router.push({name:"community-review"})),type:l.unreadCommunity?"primary":"default"},{default:(0,e.withCtx)((()=>[$e,l.unreadCommunity?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)("("+(0,e.toDisplayString)(l.unreadCommunity)+" unread)",1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"]),t.$store.getters.userIsAdmin?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[2]||(o[2]=e=>t.$router.push({name:"admin"})),class:"admin-access"},{default:(0,e.withCtx)((()=>[Oe])),_:1})):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),i.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)("div",je,[De,l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ae,[(0,e.createVNode)(r,{message:"Loading..."})])):l.userSpecs&&l.userSpecs.length?((0,e.openBlock)(),(0,e.createElementBlock)("ul",{key:1,class:(0,e.normalizeClass)(["specs-list",i.specsLayoutList?"list":"grid"])},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.userSpecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(d,{key:t.id,to:{name:"spec",params:{specId:t.id}},custom:""},{default:(0,e.withCtx)((o=>{let{navigate:s,href:n}=o;return[(0,e.createElementVNode)("li",{onClick:s},[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("div",Fe,[(0,e.createElementVNode)("span",{class:(0,e.normalizeClass)(["status",{public:t.public}])},[t.public?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[qe,ze],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[Ye,He],64))],2)]),(0,e.createElementVNode)("a",{href:n,onClick:s,class:"name"},(0,e.toDisplayString)(t.name),9,Ze),(0,e.createElementVNode)("div",We,[(0,e.createElementVNode)("span",Ke,[Ge,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:t.updated,offset:!0},null,8,["datetime"])])])]),t.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Xe,(0,e.toDisplayString)(t.desc),1)):(0,e.createCommentVNode)("v-if",!0)])],8,Le)]})),_:2},1032,["to"])))),128))],2)):((0,e.openBlock)(),(0,e.createElementBlock)("p",Qe,"You do not have any specs."))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["public-specs",{"adjust-margin":!!l.userSpecs.length}])},[Je,l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",et,[(0,e.createVNode)(r,{message:"Loading..."})])):l.publicSpecs&&l.publicSpecs.length?((0,e.openBlock)(),(0,e.createElementBlock)("ul",{key:1,class:(0,e.normalizeClass)(["specs-list",i.specsLayoutList?"list":"grid"])},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.publicSpecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(d,{key:t.id,to:{name:"spec",params:{specId:t.id}},custom:""},{default:(0,e.withCtx)((o=>{let{navigate:s,href:n}=o;return[(0,e.createElementVNode)("li",{onClick:s},[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("div",ot,[(0,e.createVNode)(m,{username:t.username,highlight:t.highlight},null,8,["username","highlight"])]),(0,e.createElementVNode)("a",{href:n,onClick:s,class:"name"},(0,e.toDisplayString)(t.name),9,st),(0,e.createElementVNode)("div",nt,[(0,e.createElementVNode)("span",lt,[it,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:t.updated,offset:!0},null,8,["datetime"])])])]),(0,e.createCommentVNode)('<div class="tags">\n\t\t\t\t\t\t\t<el-tag size="mini" :closable="false" type="success">dsf</el-tag>\n\t\t\t\t\t\t\t<el-tag size="mini" :closable="false" type="primary">d</el-tag>\n\t\t\t\t\t\t\t<el-tag size="mini" :closable="false">asdfsadf</el-tag>\n\t\t\t\t\t\t\t<el-tag size="mini" :closable="false">asd</el-tag>\n\t\t\t\t\t\t\t<el-tag size="mini" :closable="false">fghfdghsdfg</el-tag>\n\t\t\t\t\t\t\t<el-tag size="mini" :closable="false">rtrgegrae</el-tag>\n\t\t\t\t\t\t</div>'),t.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",at,(0,e.toDisplayString)(t.desc),1)):(0,e.createCommentVNode)("v-if",!0)])],8,tt)]})),_:2},1032,["to"])))),128))],2)):((0,e.openBlock)(),(0,e.createElementBlock)("p",rt,"There are no public specs......"))],2),i.loggedIn?((0,e.openBlock)(),(0,e.createBlock)(u,{key:2,ref:"editSpecModal"},null,512)):(0,e.createCommentVNode)("v-if",!0)])}]]),Rt={class:"spec-page"},_t={key:0},Mt={key:0,class:"right"},$t={key:0},Ot={key:1},jt=(0,e.createTextVNode)(" Owned by "),Dt={key:0},At={key:1},Lt=(0,e.createElementVNode)("i",{class:"material-icons"},"lock",-1),Ft=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),qt={key:0},zt={key:1},Yt=(0,e.createElementVNode)("i",{class:"material-icons"},"settings",-1),Ht=(0,e.createTextVNode)(" Last modified "),Zt=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Wt={key:0},Kt={key:1},Gt=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),Xt={key:1,class:"desc"},Qt={key:0},Jt=(0,e.createTextVNode)(" Created "),eo=(0,e.createTextVNode)("; last modified "),to=(0,e.createElementVNode)("div",null,"Name",-1),oo=(0,e.createElementVNode)("div",null,"Description",-1),so={class:"dialog-footer"},no=(0,e.createTextVNode)("Cancel"),lo=(0,e.createTextVNode)("Delete"),io={components:{Moment:dt},props:{specId:Number},data:()=>({name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{ee()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((()=>{ee()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;Ct(this.specId,this.name,this.desc).then((t=>{e(t.id),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,o,s;(t=this.subspec.id,o=this.name,s=this.desc,ee().post("/ajax/spec/save-subspec",{subspecId:t,name:o,desc:s}).fail(ne)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSubspec(){this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.subspec.id,ee().post("/ajax/spec/delete-subspec",{subspecId:e}).fail(ne)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"spec",params:{specId:this.specId}})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.subspec=null,this.name="",this.desc=""}}},ao=(0,S.Z)(io,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(d,{title:l.subspec?"Manage subspec":"Create subspec",modelValue:l.showing,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[6]||(o[6]=e=>i.closed()),"custom-class":"spec-edit-subspec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",so,[(0,e.createVNode)(c,{onClick:o[2]||(o[2]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[no])),_:1}),l.subspec?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[3]||(o[3]=e=>i.promptDeleteSubspec()),type:"danger"},{default:(0,e.withCtx)((()=>[lo])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{onClick:o[4]||(o[4]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.subspec?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("p",Qt,[Jt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.subspec.created},null,8,["datetime"])]),eo,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.subspec.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[to,(0,e.createVNode)(r,{ref:"nameInput",modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.name=e),maxlength:i.nameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[oo,(0,e.createVNode)(r,{type:"textarea",modelValue:l.desc,"onUpdate:modelValue":o[1]||(o[1]=e=>l.desc=e),autosize:{minRows:2}},null,8,["modelValue"])])])),_:1},8,["title","modelValue","width"])}]]),ro={key:0},co={key:2},mo=(0,e.createTextVNode)(" New subspec "),uo={class:"dialog-footer"},po=(0,e.createTextVNode)("Close"),ho=(0,e.createTextVNode)(" Go to spec "),go={class:"ref-subspec ref-item"},ko={class:"title"},bo=(0,e.createElementVNode)("span",null,[(0,e.createElementVNode)("i",{class:"material-icons"},"subdirectory_arrow_right"),(0,e.createTextVNode)(" Subspec")],-1),fo={key:0,class:"desc"},yo={props:{item:Object}},Co=(0,S.Z)(yo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("router-link");return(0,e.openBlock)(),(0,e.createElementBlock)("div",go,[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("div",ko,[bo,(0,e.createVNode)(a,{to:{name:"subspec",params:{specId:s.item.specId,subspecId:s.item.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(s.item.name.trim()),1)])),_:1},8,["to"])]),s.item.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",fo,(0,e.toDisplayString)(s.item.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0)])])}]]),wo={components:{RefSubspec:Co,LoadingMessage:It},props:{specId:Number,subspecId:Number,enableEditing:Boolean},emits:["open-create-subspec"],data:()=>({subspecs:[],loading:!1,showing:!1}),watch:{$route:{deep:!0,handler(){this.showing=!1}}},methods:{show(){this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((e=>{this.subspecs=e,this.loading=!1})).fail((e=>{this.loading=!1,this.showing=!1,ne(e)}))},openCreateSubspec(){this.$emit("open-create-subspec"),this.showing=!1},goToSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},closed(){this.loading=!1,this.subspecs=[]}}},vo=(0,S.Z)(wo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("ref-subspec"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(d,{title:"Navigate spec",modelValue:l.showing,"onUpdate:modelValue":o[3]||(o[3]=e=>l.showing=e),width:t.$store.getters.dialogTinyWidth,onClosed:o[4]||(o[4]=e=>i.closed()),"custom-class":"nav-spec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",uo,[(0,e.createVNode)(c,{onClick:o[1]||(o[1]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[po])),_:1}),s.subspecId?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[2]||(o[2]=e=>i.goToSpec()),type:"primary"},{default:(0,e.withCtx)((()=>[ho])),_:1})):(0,e.createCommentVNode)("v-if",!0)])])),default:(0,e.withCtx)((()=>[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",ro,[(0,e.createVNode)(a,{message:"Loading..."})])):l.subspecs.length?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:1},(0,e.renderList)(l.subspecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(r,{key:t.id,item:t},null,8,["item"])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",co,"No subspecs.")),s.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,onClick:o[0]||(o[0]=e=>i.openCreateSubspec()),class:"new-subspec-button"},{default:(0,e.withCtx)((()=>[mo])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["modelValue","width"])}]]),Vo={key:0},Bo={key:1},No={key:0,class:"updated"},Eo=(0,e.createTextVNode)(" Last modified "),So={key:5,class:"new-comment-area"},xo={key:0},To=(0,e.createTextVNode)(" Cancel "),Io=(0,e.createTextVNode)(" Post "),Po={class:"controls-area flex-row wrap-reverse"},Uo={class:"fill nowraptext comments-count"},Ro={key:2},_o=(0,e.createTextVNode)(" Show only unread comments "),Mo={key:6},$o={key:0},Oo=(0,e.createTextVNode)(" Load more "),jo={class:"dialog-footer"},Do=(0,e.createTextVNode)("Close"),Ao=(0,e.createElementVNode)("i",{class:"material-icons"},"north_west",-1),Lo={class:"bar"},Fo={class:"label"},qo=["textContent"],zo={props:{target:Object,targetType:String},computed:{label(){let e=pe(this.targetType);return this.targetType===we&&this.target.refType&&(e+=" ("+pe(this.target.refType)+")"),e},content(){switch(this.targetType){case ye:case Ce:return this.target.name;case we:let e;if(e=(this.target.title||"").trim())return e;if(e=(this.target.body||"").trim())return e;if(this.target.refItem)switch(this.target.refType){case Se:return this.target.refItem.name;case Ee:return this.target.refItem.title||this.target.refItem.url}return"";case ve:return this.target.body}}}},Yo={emits:["pop-stack"],components:{StackBar:(0,S.Z)(zo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["community-context-stack-bar",s.targetType])},[(0,e.createVNode)(a,{size:"small",type:"primary",circle:""},{default:(0,e.withCtx)((()=>[Ao])),_:1}),(0,e.createElementVNode)("span",Lo,[(0,e.createElementVNode)("span",Fo,(0,e.toDisplayString)(i.label||"..."),1),(0,e.createElementVNode)("span",{class:"content",textContent:(0,e.toDisplayString)(i.content||"...")},null,8,qo)])],2)}]])},data:()=>({stack:[],empty:!0,cachedContext:[]}),computed:{available(){return this.stack.length}},methods:{replaceStack(e){this.stack=e,this.cachedContext=[],this.checkEmpty()},pushStack(e,t,o,s){this.empty=!1,this.stack.push({targetType:e,target:t,onAdjustUnread:o,onAdjustComments:s})},popStack(){if(this.stack.length){let e=this.stack.splice(this.stack.length-1,1)[0];return this.$emit("pop-stack",e.targetType,e.target.id,e.onAdjustUnread,e.onAdjustComments),this.cacheItemHandlers(e),this.checkEmpty(),e}return null},jumpStack(e){let t=this.stack.splice(e,this.stack.length-e),o=t[0];for(this.$emit("pop-stack",o.targetType,o.target.id,o.onAdjustUnread,o.onAdjustComments),e=0;e<t.length;e++)this.cacheItemHandlers(t[e]);return this.checkEmpty(),o},cacheItemHandlers(e){for(var t=0;t<this.cachedContext.length;t++){let o=this.cachedContext[t];if(o.targetType===e.targetType&&ae(o.target.id,e.target.id)){this.cachedContext.splice(t,1);break}}(e.onAdjustUnread||e.onAdjustComments)&&this.cachedContext.push(e)},retrieveCachedHandlers(e,t){for(var o=0;o<this.cachedContext.length;o++){let s=this.cachedContext[o];if(s.targetType===e&&ae(s.target.id,t))return this.cachedContext.splice(o,1)[0]}return null},getParentContext(){return this.stack.length?this.stack[this.stack.length-1]:null},clearStack(){this.stack=[],this.cachedContext=[],this.empty=!0},checkEmpty(){return this.empty=!this.stack.length}}},Ho=(0,S.Z)(Yo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("stack-bar");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["community-context-stack",{empty:l.empty}])},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.stack,((t,o)=>((0,e.openBlock)(),(0,e.createBlock)(e.Transition,{key:t.targetType+"-"+t.target.id,name:"fade",appear:""},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(a,{target:t.target,"target-type":t.targetType,onClick:e=>i.jumpStack(o)},null,8,["target","target-type","onClick"])])),_:2},1024)))),128))],2)}]]),Zo={class:"spec-preview community-target-preview"},Wo={class:"name"},Ko={key:0,class:"desc"},Go={props:{spec:Object}},Xo=(0,S.Z)(Go,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Zo,[(0,e.createElementVNode)("div",Wo,(0,e.toDisplayString)(s.spec.name),1),s.spec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ko,(0,e.toDisplayString)(s.spec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Qo={class:"spec-subspec-preview community-target-preview"},Jo={class:"name"},es={key:0,class:"desc"},ts={props:{subspec:Object}},os=(0,S.Z)(ts,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Qo,[(0,e.createElementVNode)("div",Jo,(0,e.toDisplayString)(s.subspec.name),1),s.subspec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",es,(0,e.toDisplayString)(s.subspec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),ss=["data-block-preview-id"],ns={key:0,class:"title"},ls=["textContent"],is=["innerHTML"],as={class:"ref-url ref-item"},rs=["src"],cs={key:0,class:"right"},ds=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),ms=(0,e.createTextVNode)("Play"),us={class:"title"},ps=(0,e.createElementVNode)("i",{class:"material-icons"},"link",-1),hs=["href"],gs={key:1,class:"desc"},ks={props:{item:Object,showEdit:Boolean},emits:["edit","play"],computed:{showPlay(){return ue(this.item.url)}}},bs=(0,S.Z)(ks,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",as,[s.item.imageData?((0,e.openBlock)(),(0,e.createElementBlock)("img",{key:0,src:s.item.imageData},null,8,rs)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[s.showEdit||i.showPlay?((0,e.openBlock)(),(0,e.createElementBlock)("div",cs,[s.showEdit?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>t.$emit("edit")),size:"small",circle:""},{default:(0,e.withCtx)((()=>[ds])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.showPlay?((0,e.openBlock)(),(0,e.createBlock)(a,{key:1,onClick:o[1]||(o[1]=e=>t.$emit("play")),size:"small",type:"primary",class:"play-button"},{default:(0,e.withCtx)((()=>[ms])),_:1})):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",us,[(0,e.createElementVNode)("span",null,[ps,(0,e.createTextVNode)(" "+(0,e.toDisplayString)(i.showPlay?"Video":"URL"),1)]),(0,e.createElementVNode)("a",{href:s.item.url,target:"_blank",onClick:o[2]||(o[2]=(0,e.withModifiers)((()=>{}),["stop"]))},(0,e.toDisplayString)(s.item.title&&s.item.title.trim()||s.item.url),9,hs)]),s.item.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",gs,(0,e.toDisplayString)(s.item.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0)])])}]]),fs={class:"dynamic-stylesheet",style:{display:"none"}},ys=/^\/\*(?:[^\*]|\*(?!\/))+\*\/$/;function Cs(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!t||"object"!=typeof t)return 0;let n=0,l=[];const i=()=>{let t=o.join("").trim();if(t){for(let e=0;e<l.length;e++){let t=l[e].trim();t&&!ys.test(t)&&";"!==t.charAt(t.length-1)&&(l[e]=t+";")}l=l.join(""),l&&((e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+l+"}",s+n):(e.styleSheet||e.sheet).addRule(t,l,s+n),n++),l=[]}else l=[]};if(Array.isArray(t))for(let a=0;a<t.length;a++){let r=t[a];r&&("string"==typeof r?l.push(r):"object"==typeof r&&(i(),n+=Cs(e,r,o,s+n)))}else for(let a in t)if(t.hasOwnProperty(a)){let r=t[a];r&&("string"==typeof r?l.push(a+":"+r+";"):"object"==typeof r&&(i(),"&"===a.charAt(0)?a=a.substr(1):[">",":","+","~"," "].indexOf(a.charAt(0))<0&&(a=" "+a),n+=Cs(e,r,o.concat([a]),s+n)))}return i(),n}function ws(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||"object"!=typeof e)return"";let o="",s=[];const n=()=>{let e=t.join("").trim();if(e){let t=[];for(let e=0;e<s.length;e++){let o=s[e].trim();o?";"===o.charAt(o.length-1)||ys.test(o)?t.push(o):t.push(o+";"):t.push("")}t.length&&(t=t.join("\n\t"),o+="\n"+e+" {\n\t"+t+"\n}")}else for(let e=0;e<s.length;e++){let t=s[e].trim();t&&!ys.test(t)||(o+="\n"+t)}s=[]};if(Array.isArray(e))for(let l=0;l<e.length;l++){let i=e[l];"string"==typeof i?s.push(i):i&&"object"==typeof i&&(n(),o+=ws(i,t.concat([""])))}else for(let l in e)if(e.hasOwnProperty(l)){let i=e[l];if(i)switch(typeof i){case"string":s.push(l+": "+i+";");break;case"object":n(),"&"===l.charAt(0)?l=l.substr(1):[">",":","+","~"," "].indexOf(l.charAt(0))<0&&(l=" "+l),o+=ws(i,t.concat([l]));break;case"boolean":s.push(l)}}return n(),o+(t.length?"":"\n")}const vs={props:{rules:[Object,Array],innerMarkupOutput:Boolean},watch:{rules:{deep:!0,handler(){this.recreateSheet()}},innerMarkupOutput(){this.recreateSheet()}},mounted(){this.recreateSheet()},beforeDestroy(){this.removeSheet()},methods:{recreateSheet(){this.removeSheet(),this.rules&&(this.$stylesheet=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=document.createElement("style");return s.type="text/css",e.appendChild(s),!s.styleSheet&&!s.sheet||o?s.innerHTML=ws(t):Cs(s,t),s}(this.$el,this.rules,this.innerMarkupOutput))},removeSheet(){this.$stylesheet&&(this.$stylesheet.parentNode.removeChild(this.$stylesheet),this.$stylesheet=null)}}},Vs={components:{RefUrl:bs,RefSubspec:Co,DynamicStylesheet:(0,S.Z)(vs,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",fs)}]])},props:{block:Object},emits:["play-video"],computed:{CONTENT_TYPE_PLAIN:()=>Be,CONTENT_TYPE_MARKDOWN:()=>Ne,REF_TYPE_URL:()=>Ee,REF_TYPE_SUBSPEC:()=>Se,blockId(){return parseInt(this.block.id,10)||0},blockNumber(){return"numbered"===this.block.styleType&&parseInt(this.block.number,10)||0},blockPreviewRules(){let e;switch(this.block.styleType){case"bullet":e="'\\2022'";break;case"numbered":e="'"+this.blockNumber+".'";break;default:return null}return{['[data-block-preview-id="'+this.blockId+'"]']:{">li:before":{content:e}}}},hasTitle(){return!(!this.block.title||!this.block.title.trim())},hasRefItem(){return!(!this.block.refType||!this.block.refItem)},hasBody(){return!!(this.block.body&&this.block.body.trim()||this.block.html&&this.block.html.trim())},refItemMissing(){return!!this.block.refType&&!this.block.refItem}},methods:{raisePlayVideo(e){this.$emit("play-video",e)}}},Bs=(0,S.Z)(Vs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("ref-url"),r=(0,e.resolveComponent)("ref-subspec"),c=(0,e.resolveComponent)("el-alert"),d=(0,e.resolveComponent)("dynamic-stylesheet");return(0,e.openBlock)(),(0,e.createElementBlock)("ul",{"data-block-preview-id":i.blockId,class:"spec-block-preview community-target-preview"},[(0,e.createElementVNode)("li",null,[i.hasTitle?((0,e.openBlock)(),(0,e.createElementBlock)("div",ns,(0,e.toDisplayString)(s.block.title),1)):(0,e.createCommentVNode)("v-if",!0),i.hasRefItem?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[s.block.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,item:s.block.refItem,onPlay:o[0]||(o[0]=e=>i.raisePlayVideo(s.block.refItem)),class:"ref-item"},null,8,["item"])):s.block.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,item:s.block.refItem,class:"ref-item"},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],2112)):i.refItemMissing?((0,e.openBlock)(),(0,e.createBlock)(c,{key:2,title:"Content unavailable",closable:!1,type:"warning"})):(0,e.createCommentVNode)("v-if",!0),i.hasBody?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:3},[s.block.contentType===i.CONTENT_TYPE_PLAIN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"body plain",textContent:(0,e.toDisplayString)(s.block.body)},null,8,ls)):s.block.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,class:"body markdown",innerHTML:s.block.html},null,8,is)):(0,e.createCommentVNode)("v-if",!0)],2112)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{rules:i.blockPreviewRules},null,8,["rules"])])],8,ss)}]]),Ns={class:"info"},Es={class:"right"},Ss=(0,e.createTextVNode)(" Read "),xs=(0,e.createTextVNode)(" Unread "),Ts=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Is={key:0},Ps={key:1},Us=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),Rs=(0,e.createElementVNode)("i",{class:"material-icons"},"delete",-1),_s=(0,e.createTextVNode)(" posted "),Ms=(0,e.createTextVNode)(" (updated "),$s=(0,e.createTextVNode)(") "),Os={key:0},js={key:1},Ds={key:2,class:"edit-comment-area"},As=(0,e.createTextVNode)(" Cancel "),Ls=(0,e.createTextVNode)(" Save "),Fs=(0,e.createTextVNode)(" Delete "),qs={key:3,class:"body"},zs={components:{Username:x,Moment:dt,LoadingMessage:It},props:{specId:Number,comment:Object,showCommunity:Boolean,showUnreadOnly:Boolean},emits:["update-unread","open-comments","deleted"],data(){return{userRead:this.comment.userRead||!1,sendingRead:!1,editing:!1,updated:this.comment.updated,body:this.comment.body,editingBody:"",sendingEdit:!1,sendingDelete:!1}},computed:{loggedIn(){return this.$store.getters.loggedIn},userCanEdit(){return this.$store.getters.currentUserId===this.comment.userId},userCanDelete(){return this.userCanEdit||this.$store.getters.currentSpecOwnedByUser},disableSaveEdit(){return!this.editingBody.trim()||this.sendingEdit},unreadCount(){return this.comment.unreadCount||0},commentsCount(){return this.comment.commentsCount||0},showUnread(){return this.$store.getters.loggedIn&&this.unreadCount>0},showCommentsCount(){return!this.showUnreadOnly&&this.commentsCount>0}},watch:{editing(e){e&&this.$nextTick((()=>{this.$refs.editCommentInput&&ee()("textarea",this.$refs.editCommentInput.$el).focus()}))}},methods:{setUserRead(e){this.sendingRead=!0,function(e,t,o,s){return ee().post("/ajax/spec/community/mark-read",{specId:e,targetType:"comment",targetId:o,read:s}).fail(ne)}(this.specId,0,this.comment.id,e).then((()=>{this.sendingRead=!1,this.userRead=e,this.$emit("update-unread",e?-1:1)})).fail((()=>{this.sendingRead=!1}))},openComments(){this.$emit("open-comments",this.comment.id)},edit(){this.editingBody.trim()||(this.editingBody=this.body),this.editing=!0},cancelEdit(){this.editing=!1},saveEdit(){var e,t,o;this.disableSaveEdit||(this.sendingEdit=!0,(e=this.specId,t=this.comment.id,o=this.editingBody,ee().post("/ajax/spec/community/update-comment",{specId:e,commentId:t,body:o}).fail(ne)).then((e=>{this.sendingEdit=!1,this.editing=!1,this.updated=e.updated,this.body=e.body,this.editingBody=""})).fail((()=>{this.sendingEdit=!1})))},promptDelete(){this.$confirm("Permanently delete this comment?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e,t;this.sendingDelete=!0,(e=this.specId,t=this.comment.id,ee().post("/ajax/spec/community/delete-comment",{specId:e,commentId:t}).fail(ne)).then((()=>{this.sendingDelete=!1,this.$emit("deleted",this.comment.id)})).fail((()=>{this.sendingDelete=!1}))})).catch((function(){}))},isUnread(){return!this.userRead}}},Ys={components:{ContextStack:Ho,Moment:dt,PreviewSpec:Xo,PreviewSubspec:os,PreviewBlock:Bs,PreviewComment:(0,S.Z)(zs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-checkbox"),r=(0,e.resolveComponent)("el-tag"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("username"),m=(0,e.resolveComponent)("moment"),u=(0,e.resolveComponent)("loading-message"),p=(0,e.resolveComponent)("el-input");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["spec-comment-preview community-target-preview",{community:s.showCommunity}])},[(0,e.createElementVNode)("div",Ns,[(0,e.createElementVNode)("div",Es,[i.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{modelValue:l.userRead,disabled:l.sendingRead,onChange:i.setUserRead,size:"small"},null,8,["modelValue","disabled","onChange"]),l.userRead?((0,e.openBlock)(),(0,e.createBlock)(r,{key:0,size:"small",type:"success",onClick:o[0]||(o[0]=e=>i.setUserRead(!1))},{default:(0,e.withCtx)((()=>[Ss])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,size:"small",type:"info",onClick:o[1]||(o[1]=e=>i.setUserRead(!0))},{default:(0,e.withCtx)((()=>[xs])),_:1}))],64)):(0,e.createCommentVNode)("v-if",!0),s.showCommunity?((0,e.openBlock)(),(0,e.createBlock)(c,{key:1,onClick:o[2]||(o[2]=e=>i.openComments()),type:i.showUnread?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[Ts,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Is,(0,e.toDisplayString)(i.unreadCount)+" unread",1)):i.showCommentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ps,(0,e.toDisplayString)(i.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])):(0,e.createCommentVNode)("v-if",!0),i.userCanEdit?((0,e.openBlock)(),(0,e.createBlock)(c,{key:2,onClick:o[3]||(o[3]=e=>i.edit()),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Us])),_:1})):i.userCanDelete?((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,onClick:o[4]||(o[4]=e=>i.promptDelete()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Rs])),_:1})):(0,e.createCommentVNode)("v-if",!0)]),(0,e.createVNode)(d,{username:s.comment.username,highlight:s.comment.highlight},null,8,["username","highlight"]),_s,(0,e.createVNode)(m,{datetime:s.comment.created,offset:!0},null,8,["datetime"]),l.updated!==s.comment.created?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[Ms,(0,e.createVNode)(m,{datetime:l.updated,offset:!0},null,8,["datetime"]),$s],64)):(0,e.createCommentVNode)("v-if",!0)]),l.sendingDelete?((0,e.openBlock)(),(0,e.createElementBlock)("div",Os,[(0,e.createVNode)(u,{message:"Deleting..."})])):l.sendingEdit?((0,e.openBlock)(),(0,e.createElementBlock)("div",js,[(0,e.createVNode)(u,{message:"Saving..."})])):l.editing?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ds,[(0,e.createVNode)(p,{ref:"editCommentInput",type:"textarea",modelValue:l.editingBody,"onUpdate:modelValue":o[5]||(o[5]=e=>l.editingBody=e),autosize:{minRows:2}},null,8,["modelValue"]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(c,{onClick:o[6]||(o[6]=e=>i.cancelEdit()),disabled:i.disableSaveEdit,type:"warning",size:"small"},{default:(0,e.withCtx)((()=>[As])),_:1},8,["disabled"]),(0,e.createVNode)(c,{onClick:o[7]||(o[7]=e=>i.saveEdit()),disabled:i.disableSaveEdit,type:"primary",size:"small"},{default:(0,e.withCtx)((()=>[Ls])),_:1},8,["disabled"]),(0,e.createVNode)(c,{onClick:o[8]||(o[8]=e=>i.promptDelete()),disabled:i.disableSaveEdit,type:"danger",size:"small"},{default:(0,e.withCtx)((()=>[Fs])),_:1},8,["disabled"])])])):((0,e.openBlock)(),(0,e.createElementBlock)("div",qs,(0,e.toDisplayString)(l.body),1))],2)}]]),LoadingMessage:It},props:{specId:Number,enableWrite:Boolean},emits:["play-video"],data:()=>({showing:!1,loading:!1,error:null,targetType:null,target:null,comments:[],unreadCount:0,filterUnreadOnly:!1,commentsCount:0,hasMoreComments:!1,loadingPage:!1,addingComment:!1,newCommentBody:"",sendingComment:!1,onAdjustUnread:null,onAdjustComments:null,reloadingComments:!1}),computed:{loggedIn(){return this.$store.getters.loggedIn},TARGET_TYPE_SPEC:()=>ye,TARGET_TYPE_SUBSPEC:()=>Ce,TARGET_TYPE_BLOCK:()=>we,TARGET_TYPE_COMMENT:()=>ve,modalTitle(){switch(this.targetType){case ye:return"Spec community";case Ce:return"Subspec community";case we:return"Block community";case ve:return"Comment community"}return"Community space"},targetUpdated(){return this.target&&this.targetType!==ve?this.target.updated:null},disablePostComment(){return!this.newCommentBody.trim()},showUnreadOnly(){return this.$store.getters.loggedIn&&this.filterUnreadOnly}},watch:{addingComment(e){e&&this.$nextTick((()=>{this.$refs.newCommentInput&&ee()("textarea",this.$refs.newCommentInput.$el).focus().select()}))}},methods:{openCommunity(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t),this.showing=!0},openCommunityReview(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t,!0),this.showing=!0},loadCommunity(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.loading=!0,this.error=null,function(e,t,o,s,n){return ee().get("/ajax/spec/community",{specId:e,targetType:t,targetId:o,unreadOnly:s,loadStack:n}).fail(ne)}(this.specId,e,t,this.showUnreadOnly,o).then((s=>{switch(this.loading=!1,this.targetType=e,e){case ye:this.target=s.spec;break;case Ce:this.target=s.subspec;break;case we:this.target=s.block;break;case ve:this.target=s.comment}o&&s.stack&&this.$refs.contextStack.replaceStack(s.stack),this.comments=s.comments,this.unreadCount=s.unreadCount,this.commentsCount=s.commentsCount,this.hasMoreComments=s.commentsCount>s.comments.length,this.newCommentBody="";let n=this.$refs.contextStack.retrieveCachedHandlers(e,t);n&&(this.onAdjustUnread=n.onAdjustUnread,this.onAdjustComments=n.onAdjustComments)})).fail((()=>{this.loading=!1,this.error="Failed to load community.",this.$refs.contextStack.checkEmpty()&&(this.showing=!1)}))},reloadCommunity(){this.reloadingComments=!0,Vt(this.specId,this.targetType,this.target.id,null,this.showUnreadOnly).then((e=>{this.reloadingComments=!1,this.comments=e.comments,this.unreadCount=e.unreadCount,this.commentsCount=e.commentsCount,this.hasMoreComments=e.hasMore})).fail((()=>{this.reloadingComments=!1}))},loadMoreComments(){this.loadingPage=!0;let e=this.comments[this.comments.length-1].updated;Vt(this.specId,this.targetType,this.target.id,e,this.showUnreadOnly).then((e=>{this.loadingPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMore})).fail((()=>{this.loadingPage=!1}))},addComment(){var e,t,o,s;this.addingComment?this.disablePostComment||(this.sendingComment=!0,(e=this.specId,t=this.targetType,o=this.target.id,s=this.newCommentBody,ee().post("/ajax/spec/community/add-comment",{specId:e,targetType:t,targetId:o,body:s}).fail(ne)).then((e=>{this.sendingComment=!1,this.comments.unshift(e),this.adjustComments(1),this.addingComment=!1,this.newCommentBody=""})).fail((()=>{this.sendingComment=!1}))):this.addingComment=!0},cancelAddComment(){this.addingComment=!1},openComments(e){this.$refs.contextStack.pushStack(this.targetType,this.target,this.onAdjustUnread,this.onAdjustComments),this.onAdjustUnread=null,this.onAdjustComments=null,this.loadCommunity("comment",e)},adjustUnread(e){this.unreadCount+=e,this.onAdjustUnread&&this.onAdjustUnread(e)},adjustComments(e){this.commentsCount+=e,this.onAdjustComments&&this.onAdjustComments(e)},commentDeleted(e){if(this.targetType===ve&&this.target.id===e){let e=this.$refs.previewComment.isUnread(),t=this.$refs.contextStack.popStack();e&&t.onAdjustUnread&&t.onAdjustUnread(-1),t.onAdjustComments&&t.onAdjustComments(-1)}else for(var t=0;t<this.comments.length;t++)if(ae(this.comments[t].id,e)){let e=!this.$refs.comments[t].userRead;this.comments.splice(t,1),e&&this.adjustUnread(-1),this.adjustComments(-1);break}},contextUpdateUnread(e){let t=this.$refs.contextStack.getParentContext();t&&t.onAdjustUnread&&t.onAdjustUnread(e)},popStack(e,t,o,s){this.$refs.contextStack.cacheItemHandlers({targetType:this.targetType,target:this.target,onAdjustUnread:this.onAdjustUnread,onAdjustComments:this.onAdjustComments}),this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t)},raisePlayVideo(e){this.$emit("play-video",e)},closed(){this.targetType=null,this.target=null,this.error=null,this.addingComment=!1,this.newCommentBody="",this.onAdjustUnread=null,this.onAdjustComments=null,this.$refs.contextStack.clearStack()}}},Hs=(0,S.Z)(Ys,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("context-stack"),r=(0,e.resolveComponent)("loading-message"),c=(0,e.resolveComponent)("moment"),d=(0,e.resolveComponent)("preview-spec"),m=(0,e.resolveComponent)("preview-subspec"),u=(0,e.resolveComponent)("preview-block"),p=(0,e.resolveComponent)("preview-comment"),h=(0,e.resolveComponent)("el-input"),g=(0,e.resolveComponent)("el-button"),k=(0,e.resolveComponent)("el-checkbox"),b=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(b,{title:i.modalTitle,modelValue:l.showing,"onUpdate:modelValue":o[8]||(o[8]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[9]||(o[9]=e=>i.closed()),"custom-class":"spec-block-community-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",jo,[(0,e.createVNode)(g,{onClick:o[7]||(o[7]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Do])),_:1})])])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(a,{ref:"contextStack",onPopStack:i.popStack},null,8,["onPopStack"]),l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Vo,[(0,e.createVNode)(r,{message:"Loading..."})])):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",Bo,(0,e.toDisplayString)(l.error),1)):l.target?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.targetType!==i.TARGET_TYPE_COMMENT?((0,e.openBlock)(),(0,e.createElementBlock)("div",No,[Eo,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:i.targetUpdated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),l.targetType===i.TARGET_TYPE_SPEC?((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,spec:l.target},null,8,["spec"])):l.targetType===i.TARGET_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(m,{key:2,subspec:l.target},null,8,["subspec"])):l.targetType===i.TARGET_TYPE_BLOCK?((0,e.openBlock)(),(0,e.createBlock)(u,{key:3,block:l.target,onPlayVideo:i.raisePlayVideo},null,8,["block","onPlayVideo"])):l.targetType===i.TARGET_TYPE_COMMENT?((0,e.openBlock)(),(0,e.createBlock)(p,{key:4,ref:"previewComment","spec-id":s.specId,comment:l.target,onDeleted:i.commentDeleted,onUpdateUnread:i.contextUpdateUnread},null,8,["spec-id","comment","onDeleted","onUpdateUnread"])):(0,e.createCommentVNode)("v-if",!0),s.enableWrite?((0,e.openBlock)(),(0,e.createElementBlock)("div",So,[l.sendingComment?((0,e.openBlock)(),(0,e.createElementBlock)("p",xo,[(0,e.createVNode)(r,{message:"Posting comment..."})])):l.addingComment?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.addingComment?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,ref:"newCommentInput",type:"textarea",modelValue:l.newCommentBody,"onUpdate:modelValue":o[0]||(o[0]=e=>l.newCommentBody=e),autosize:{minRows:2},placeholder:"Type comment here"},null,8,["modelValue"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(g,{onClick:o[1]||(o[1]=e=>i.cancelAddComment()),type:"warning"},{default:(0,e.withCtx)((()=>[To])),_:1}),(0,e.createVNode)(g,{onClick:o[2]||(o[2]=e=>i.addComment()),disabled:i.disablePostComment,type:"primary"},{default:(0,e.withCtx)((()=>[Io])),_:1},8,["disabled"])])],64)):((0,e.openBlock)(),(0,e.createBlock)(g,{key:2,onClick:o[3]||(o[3]=e=>i.addComment()),type:"primary"},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)(" Comment on this "+(0,e.toDisplayString)(l.targetType),1)])),_:1}))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Po,[(0,e.createElementVNode)("div",Uo,[i.showUnreadOnly?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount)+" comments",1)],2112)):((0,e.openBlock)(),(0,e.createElementBlock)("em",Ro,"No comments"))]),i.loggedIn?((0,e.openBlock)(),(0,e.createBlock)(k,{key:0,modelValue:l.filterUnreadOnly,"onUpdate:modelValue":o[4]||(o[4]=e=>l.filterUnreadOnly=e),onChange:o[5]||(o[5]=e=>i.reloadCommunity())},{default:(0,e.withCtx)((()=>[_o])),_:1},8,["modelValue"])):(0,e.createCommentVNode)("v-if",!0)]),l.reloadingComments?((0,e.openBlock)(),(0,e.createElementBlock)("p",Mo,[(0,e.createVNode)(r,{message:"Reloading..."})])):l.comments.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:7},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.comments,(t=>((0,e.openBlock)(),(0,e.createBlock)(p,{ref_for:!0,ref:"comments",key:t.id,"spec-id":s.specId,comment:t,"show-community":!0,"show-unread-only":i.showUnreadOnly,onOpenComments:i.openComments,onUpdateUnread:i.adjustUnread,onDeleted:i.commentDeleted},null,8,["spec-id","comment","show-unread-only","onOpenComments","onUpdateUnread","onDeleted"])))),128)),l.loadingPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",$o,[(0,e.createVNode)(r,{message:"Loading more comments..."})])):l.hasMoreComments?((0,e.openBlock)(),(0,e.createBlock)(g,{key:1,onClick:o[6]||(o[6]=e=>i.loadMoreComments())},{default:(0,e.withCtx)((()=>[Oo])),_:1})):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]]),Zs={key:0,class:"embed-responsive"},Ws=["src"],Ks=["src"],Gs={data:()=>({vid:null,showing:!1}),methods:{show(e){let t=function(e){let t=me.exec(e);return t?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:t[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:t[1]}:null:null}(e.url);t&&(this.vid=t,this.showing=!0)},closed(){this.vid=null}}},Xs=(0,S.Z)(Gs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(a,{modelValue:l.showing,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,onClosed:o[1]||(o[1]=e=>i.closed()),"custom-class":"play-video-modal"},{default:(0,e.withCtx)((()=>[l.vid?((0,e.openBlock)(),(0,e.createElementBlock)("div",Zs,["youtube"===l.vid.type?((0,e.openBlock)(),(0,e.createElementBlock)("iframe",{key:0,src:"https://www.youtube.com/embed/"+l.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""},null,8,Ws)):"vimeo"===l.vid.type?((0,e.openBlock)(),(0,e.createElementBlock)("iframe",{key:1,src:"https://player.vimeo.com/video/"+l.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""},null,8,Ks)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["modelValue","width"])}]]),Qs={components:{Username:x,Moment:dt,EditSpecModal:Nt,EditSubspecModal:ao,NavSpecModal:vo,CommunityModal:Hs,PlayVideoModal:Xs},data:()=>({loading:!0,scrollOnRender:!0,spec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute(){return"spec"===this.$route.name},currentUserOwns(){return this.$store.getters.loggedIn&&this.spec&&this.spec.ownerType===xe&&this.$store.getters.currentUserId===this.spec.ownerId},enableEditing(){return this.currentUserOwns},enableWriteComments(){return this.$store.getters.loggedIn},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnread(){return this.$store.getters.loggedIn&&this.unreadCount>0}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter spec",e),o((t=>{t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave spec"),this.spec=null,this.unreadCount=0,this.commentsCount=0,ce(),o()},methods:{loadSpec(e,t){console.debug("load spec"),this.loading=!0,function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ee().get("/ajax/spec",{specId:e,loadBlocks:t})}(e,t).then((e=>{console.debug("spec loaded",e),this.spec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,ce(e.name),this.loading=!1,this.scrollOnRendered(),this.$store.commit("saveCurrentSpec",e)})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{e:"spec",url:encodeURIComponent(this.$route.fullPath)}})}))},scrollOnRendered(){this.scrollOnRender=!0},handleViewRendered(){this.scrollOnRender&&(this.scrollOnRender=!1,this.restoreScroll())},gotoSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec(){this.$refs.editSpecModal.showEdit(this.spec,(e=>{this.spec.updated=e.updated,this.spec.name=e.name,this.spec.desc=e.desc,this.spec.public=e.public,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,ce(e.name)}))},openManageSubspec(e,t){this.$refs.editSubspecModal.showEdit(e,t)},openSpecCommunity(){this.$refs.communityModal.openCommunity(ye,this.spec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,o,s){this.$refs.communityModal.openCommunity(e,t,o,s)},playVideo(e){this.$refs.playVideoModal.show(e)},promptNavSpec(){this.$refs.navSpecModal.show()},openCreateSubspec(){this.$refs.editSubspecModal.showCreate((e=>{this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:e}})}))},restoreScroll(){if(this.onSpecRoute){let e=this.$store.state.savedScrollPosition;e?(console.debug("restoreScroll spec"),ee()(window).scrollTop(e.top).scrollLeft(e.left)):ae(this.$store.getters.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),ee()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},Js=(0,S.Z)(Qs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("username"),r=(0,e.resolveComponent)("el-tooltip"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("moment"),m=(0,e.resolveComponent)("router-view"),u=(0,e.resolveComponent)("edit-spec-modal"),p=(0,e.resolveComponent)("edit-subspec-modal"),h=(0,e.resolveComponent)("nav-spec-modal"),g=(0,e.resolveComponent)("community-modal"),k=(0,e.resolveComponent)("play-video-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("section",Rt,[l.spec?((0,e.openBlock)(),(0,e.createElementBlock)("header",_t,[l.loading?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createElementBlock)("div",Mt,[i.currentUserOwns?((0,e.openBlock)(),(0,e.createElementBlock)("span",$t,"You own this")):((0,e.openBlock)(),(0,e.createElementBlock)("span",Ot,[jt,l.spec.username?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,username:l.spec.username,highlight:l.spec.highlight},null,8,["username","highlight"])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.spec.ownerType)+" "+(0,e.toDisplayString)(l.spec.ownerId),1)],2112))])),i.onSpecRoute?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.spec.public?((0,e.openBlock)(),(0,e.createElementBlock)("span",Dt," Public ")):((0,e.openBlock)(),(0,e.createElementBlock)("span",At,[(0,e.createVNode)(r,{content:"Unpublished",placement:"left"},{default:(0,e.withCtx)((()=>[Lt])),_:1})])),(0,e.createVNode)(c,{onClick:o[0]||(o[0]=e=>i.openSpecCommunity()),type:i.showUnread?"primary":"default",disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Ft,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",qt,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",zt,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type","disabled"]),(0,e.createVNode)(c,{onClick:o[1]||(o[1]=e=>i.openManageSpec()),disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Yt])),_:1},8,["disabled"])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("span",null,[Ht,(0,e.createVNode)(d,{datetime:l.spec.updated,offset:!0},null,8,["datetime"])]),(0,e.createVNode)(c,{onClick:o[2]||(o[2]=e=>i.openSpecCommunity()),type:i.showUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Zt,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Wt,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Kt,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])],64))],2112)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{onClick:o[3]||(o[3]=e=>i.promptNavSpec())},{default:(0,e.withCtx)((()=>[Gt])),_:1})])),(0,e.createElementVNode)("h2",{onClick:o[4]||(o[4]=e=>i.gotoSpec()),class:"name"},(0,e.toDisplayString)(l.spec.name),1),l.spec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Xt,(0,e.toDisplayString)(l.spec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(m,null,{default:(0,e.withCtx)((t=>{let{Component:o}=t;return[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(o),{loading:l.loading,spec:l.spec,"enable-editing":i.enableEditing,onRendered:i.handleViewRendered,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onOpenManageSubspec:i.openManageSubspec},null,8,["loading","spec","enable-editing","onRendered","onPromptNavSpec","onOpenCommunity","onPlayVideo","onOpenManageSubspec"]))]})),_:1}),i.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(u,{key:1,ref:"editSpecModal"},null,512)):(0,e.createCommentVNode)("v-if",!0),i.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(p,{key:2,ref:"editSubspecModal","spec-id":i.specId},null,8,["spec-id"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(h,{ref:"navSpecModal","spec-id":i.specId,"subspec-id":i.subspecId,"enable-editing":i.enableEditing,onOpenCreateSubspec:o[5]||(o[5]=e=>i.openCreateSubspec())},null,8,["spec-id","subspec-id","enable-editing"]),(0,e.createVNode)(g,{ref:"communityModal","spec-id":i.specId,"enable-write":i.enableWriteComments,onPlayVideo:i.playVideo},null,8,["spec-id","enable-write","onPlayVideo"]),(0,e.createVNode)(k,{ref:"playVideoModal"},null,512)])}]]),en={key:0},tn={key:2},on={key:0,class:"spec-view"},sn=(0,e.createElementVNode)("p",{class:"empty-message"},"No content.",-1),nn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),ln=(0,e.createElementVNode)("span",null,"Move block here",-1),an=(0,e.createTextVNode)(" Add block "),rn={ref:"mirrorList",class:"mirror-list"},cn=["data-spec-block"],dn=(0,e.createElementVNode)("div",{class:"bg"},null,-1),mn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),un=(0,e.createElementVNode)("i",{class:"material-icons"},"more_horiz",-1),pn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),hn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),gn=(0,e.createElementVNode)("i",{class:"material-icons"},"south_east",-1),kn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_downward",-1),bn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),fn=(0,e.createTextVNode)("Cancel"),yn=(0,e.createTextVNode)("Cancel move"),Cn=(0,e.createElementVNode)("i",{class:"material-icons"},"input",-1),wn=(0,e.createTextVNode)("Context"),vn=(0,e.createTextVNode)("Change context"),Vn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),Bn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),Nn=(0,e.createElementVNode)("i",{class:"material-icons"},"south_east",-1),En=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_downward",-1),Sn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),xn={key:0},Tn={key:1},In=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),Pn=(0,e.createElementVNode)("i",{class:"material-icons"},"delete",-1),Un=(0,e.createElementVNode)("i",{class:"material-icons"},"add",-1),Rn=(0,e.createElementVNode)("i",{class:"material-icons"},"drag_handle",-1),_n={key:1,class:"visitor-actions"},Mn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),$n={key:0},On={key:1},jn={key:0,class:"layover parent-moving-layover"},Dn={key:1,class:"title"},An=["textContent"],Ln=["innerHTML"],Fn="highlight",qn="dragula";let zn={};function Yn(e){let t=[];for(var o=0;o<e.length;o++){let s=e[o];if(/\.js$/.test(s.src)){let e=document.createElement("script");e.type="text/javascript",e.crossOrigin="anonymous",s.integrity&&(e.integrity=s.integrity);let o=ee().Deferred();e.addEventListener("load",(function(){o.resolve()})),e.addEventListener("error",(function(){o.reject()})),t.push(o),e.src=s.src,document.body.appendChild(e)}else if(/\.css$/.test(s.src)){let e=document.createElement("link");e.rel="stylesheet",e.crossOrigin="anonymous",s.integrity&&(e.integrity=s.integrity);let o=ee().Deferred();e.addEventListener("load",(function(){o.resolve()})),e.addEventListener("error",(function(){o.reject()})),t.push(o),e.href=s.src,document.body.appendChild(e)}}return ee().when.apply(ee(),t)}function Hn(e){if(zn[e])return zn[e];switch(e){case Fn:return zn[e]=Yn([{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/default.min.css",integrity:"sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js",integrity:"sha512-zol3kFQ5tnYhL7PzGt0LnllHHVWRGt2bTCIywDiScVvLIlaDOVJ6sPdJTVi0m3rA660RT+yZxkkRzMbb1L8Zkw=="}]).then((function(){return console.debug("highlight.js loaded"),window.hljs})).fail((function(){ne("Failed to load highlight.js code highlighting library")}));case qn:return zn[e]=Yn([{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.css",integrity:"sha512-zlYhSecphd+kwRzeCOyj7/u3HZIQ3Q0NP7AN7ZEKhYTdi0AQOGGbc7eA3I/mUffqjdr8G1/9xoS478h+I0MQGg=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js",integrity:"sha512-NgXVRE+Mxxf647SqmbB9wPS5SEpWiLFp5G7ItUNFi+GVUyQeP+7w4vnKtc2O/Dm74TpTFKXNjakd40pfSKNulg=="}]).then((function(){return console.debug("dragula.js loaded"),window.dragula})).fail((function(){ne("Failed to load dragula.js drag and drop library")}))}}const Zn={components:{RefUrl:bs,RefSubspec:Co},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,renderedHtml:this.block.html,refItem:this.block.refItem,unreadCount:this.block.unreadCount||0,commentsCount:this.block.commentsCount||0,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{CONTENT_TYPE_PLAIN:()=>Be,CONTENT_TYPE_MARKDOWN:()=>Ne,REF_TYPE_URL:()=>Ee,REF_TYPE_SUBSPEC:()=>Se,enableEditingDynamic(){return this.$store.getters.loggedIn&&this.enableEditing},showDeleteButton(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle(){return!(!this.title||!this.title.trim())},hasBody(){return!!(this.body&&this.body.trim()||this.renderedHtml&&this.renderedHtml.trim())},hasRefItem(){return!(!this.refType||!this.refItem)},refItemMissing(){return!!this.refType&&!this.refItem},classes(){return{[this.styleType]:!0,"title-only":this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks,"ref-item-only":this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks}},currentlyMovingBlocks(){return this.$store.getters.currentlyMovingBlocks},movingThis(){return this.$store.getters.currentlyMovingBlock(this.block.id)},movingOtherBlocks(){return this.currentlyMovingBlocks&&!this.movingThis},showAddToMoving(){return this.movingOtherBlocks&&ae(this.$store.state.movingBlocksSourceSubspecId,this.subspecId)},showActions(){return this.focusActions||this.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.loggedIn&&this.$store.getters.userSettings.community.unreadOnly},showUnreadCount(){return this.$store.getters.loggedIn&&!!this.unreadCount},clearRef(){return!!this.unreadCount},mobileAdjust(){return this.showActions||!!this.unreadCount||!this.showUnreadOnly&&!!this.commentsCount}},watch:{renderedHtml(){this.addCodeHighlighting()}},mounted(){this.eventBus.on("url-updated",this.urlUpdated),this.eventBus.on("url-deleted",this.urlDeleted),this.addCodeHighlighting()},beforeDestroy(){this.eventBus.off("url-updated",this.urlUpdated),this.eventBus.off("url-deleted",this.urlDeleted)},methods:{getBlockId(){return this.block.id},getStyleType(){return this.styleType},addCodeHighlighting(){this.contentType===Ne&&this.renderedHtml&&this.$nextTick((()=>{let e=ee()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&Hn(Fn).then((t=>{e.each(((e,o)=>{t.highlightBlock(o)}))}))}))},getParentId(){let e=ee()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId(){let e=ee()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock(){this.raiseOpenEdit(this.block.id,(e=>{this.updated=e.updated,this.styleType=e.styleType,this.contentType=e.contentType,this.refType=e.refType,this.refId=e.refId,this.refItem=e.refItem,this.title=e.title,this.body=e.body,this.renderedHtml=e.html,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0}))},raiseOpenEdit(e,t){this.eventBus.emit("open-edit",{blockId:e,callback:t})},promptDeleteBlock(){this.eventBus.emit("prompt-delete",this.block.id)},enterChooseAddPosition(){this.choosingAddPosition=!0},cancelChooseAddPosition(){this.choosingAddPosition=!1},addBeforeThis(){let e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t,this.styleType)},addIntoThis(){let e=this.block.id;this.raisePromptAddSubblock(e,null,!0)},addAfterThis(){let e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t,this.styleType)},raisePromptAddSubblock(e,t,o){this.eventBus.emit("prompt-add-subblock",{parentId:e,insertBeforeId:t,defaultStyleType:o})},startMoving(){this.eventBus.emit("start-moving",this.block.id),this.focusActions=!1},addThisToMovingBlocks(){this.eventBus.emit("add-to-moving",this.block.id)},removeThisFromMovingBlocks(){this.eventBus.emit("remove-from-moving",this.block.id)},promptNavSpec(){this.eventBus.emit("prompt-nav-spec")},cancelMoving(){this.eventBus.emit("cancel-moving",this.block.id)},moveBeforeThis(){this.eventBus.emit("move-before",this.block.id)},moveIntoThis(){this.eventBus.emit("move-into",this.block.id)},moveAfterThis(){this.eventBus.emit("move-after",this.block.id)},mouseLeaveLayover(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated(e){this.refType===Ee&&e.id===this.refId&&(this.refItem=e)},urlDeleted(e){this.refType===Ee&&e===this.refId&&(this.refItem=null)},raisePlayVideo(e){this.eventBus.emit("play-video",e)},openCommunity(){this.eventBus.emit("open-community",{blockId:this.block.id,onAdjustUnread:e=>{this.unreadCount+=e},onAdjustComments:e=>{this.commentsCount+=e}})},updateHasSubblocks(){this.hasSubblocks=this.$refs.sublist.childElementCount>0},touchstart(e){this.lastTouchStartTime=Date.now()},selectstart(e){this.lastTouchStartTime&&Date.now()-this.lastTouchStartTime<200&&(e.preventDefault(),e.stopPropagation())}}},Wn=(0,S.Z)(Zn,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("el-checkbox"),c=(0,e.resolveComponent)("ref-url"),d=(0,e.resolveComponent)("ref-subspec"),m=(0,e.resolveComponent)("el-alert");return(0,e.openBlock)(),(0,e.createElementBlock)("li",{"data-spec-block":s.block.id,class:(0,e.normalizeClass)(["spec-block",i.classes]),onTouchstart:o[23]||(o[23]=function(){return i.touchstart&&i.touchstart(...arguments)}),onSelectstart:o[24]||(o[24]=function(){return i.selectstart&&i.selectstart(...arguments)})},[(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["content",{"clear-ref":i.clearRef,"mobile-adjust":i.mobileAdjust}])},[dn,(0,e.createElementVNode)("div",{class:"layover",onMouseleave:o[21]||(o[21]=e=>i.mouseLeaveLayover())},[i.enableEditingDynamic?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["expand-control",{hide:i.showActions}])},[(0,e.createCommentVNode)(" only show community button to admins in collapsed mobile menu when there are unread submissions "),(0,e.createCommentVNode)(" always show community button to guests, who only make community interactions "),i.showUnreadCount?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>i.openCommunity()),type:"primary",size:"small",round:""},{default:(0,e.withCtx)((()=>[mn,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(l.unreadCount)+" unread",1)])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{onClick:o[1]||(o[1]=e=>l.focusActions=!0),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[un])),_:1})],2),(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["actions",{show:i.showActions}])},[l.choosingAddPosition?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{onClick:o[2]||(o[2]=e=>i.cancelChooseAddPosition()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[pn])),_:1}),(0,e.createVNode)(a,{onClick:o[3]||(o[3]=e=>i.addBeforeThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[hn])),_:1}),(0,e.createVNode)(a,{onClick:o[4]||(o[4]=e=>i.addIntoThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[gn])),_:1}),(0,e.createVNode)(a,{onClick:o[5]||(o[5]=e=>i.addAfterThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[kn])),_:1})],64)):i.movingThis?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(a,{onClick:o[6]||(o[6]=e=>i.cancelMoving()),type:"warning",size:"small"},{default:(0,e.withCtx)((()=>[bn,(0,e.createElementVNode)("span",null,[t.$store.getters.mobileViewport?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[fn],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[yn],2112))])])),_:1}),(0,e.createVNode)(a,{onClick:o[7]||(o[7]=e=>i.promptNavSpec()),size:"small"},{default:(0,e.withCtx)((()=>[Cn,(0,e.createElementVNode)("span",null,[t.$store.getters.mobileViewport?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[wn],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[vn],2112))])])),_:1}),(0,e.createVNode)(r,{key:"removeFromMoving","data-moving-block-id":s.block.id,modelValue:!0,onClick:o[8]||(o[8]=e=>i.removeThisFromMovingBlocks())},null,8,["data-moving-block-id"])],64)):i.movingOtherBlocks?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[(0,e.createVNode)(a,{onClick:o[9]||(o[9]=e=>i.cancelMoving()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Vn])),_:1}),(0,e.createVNode)(a,{onClick:o[10]||(o[10]=e=>i.moveBeforeThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Bn])),_:1}),(0,e.createVNode)(a,{onClick:o[11]||(o[11]=e=>i.moveIntoThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Nn])),_:1}),(0,e.createVNode)(a,{onClick:o[12]||(o[12]=e=>i.moveAfterThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[En])),_:1}),i.showAddToMoving?((0,e.openBlock)(),(0,e.createBlock)(r,{key:"addToMoving",modelValue:!1,onClick:o[13]||(o[13]=e=>i.addThisToMovingBlocks())})):(0,e.createCommentVNode)("v-if",!0)],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:3},[(0,e.createVNode)(a,{onClick:o[14]||(o[14]=e=>i.openCommunity()),type:i.showUnreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[Sn,i.showUnreadCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",xn,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Tn,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"]),(0,e.createVNode)(a,{onClick:o[15]||(o[15]=e=>i.editBlock()),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[In])),_:1}),i.showDeleteButton?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[16]||(o[16]=e=>i.promptDeleteBlock()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Pn])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{onClick:o[17]||(o[17]=e=>i.enterChooseAddPosition()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Un])),_:1}),(0,e.createVNode)(a,{onClick:o[18]||(o[18]=e=>i.startMoving()),class:"move-action",type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Rn])),_:1}),(0,e.createElementVNode)("i",{onClick:o[19]||(o[19]=e=>i.startMoving()),class:"material-icons drag-handle"},"drag_handle")],64))],2)],64)):((0,e.openBlock)(),(0,e.createElementBlock)("div",_n,[(0,e.createVNode)(a,{onClick:o[20]||(o[20]=e=>i.openCommunity()),type:i.showUnreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[Mn,i.showUnreadCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",$n,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",On,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])]))],32),i.currentlyMovingBlocks?((0,e.openBlock)(),(0,e.createElementBlock)("div",jn,[(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{modelValue:!0,disabled:""})])])):(0,e.createCommentVNode)("v-if",!0),i.hasTitle?((0,e.openBlock)(),(0,e.createElementBlock)("div",Dn,(0,e.toDisplayString)(l.title),1)):(0,e.createCommentVNode)("v-if",!0),i.hasRefItem?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,item:l.refItem,class:"ref-item",onPlay:o[22]||(o[22]=e=>i.raisePlayVideo(l.refItem))},null,8,["item"])):l.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,item:l.refItem,class:"ref-item"},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],2112)):i.refItemMissing?((0,e.openBlock)(),(0,e.createBlock)(m,{key:3,title:"Content unavailable",closable:!1,type:"warning"})):(0,e.createCommentVNode)("v-if",!0),i.hasBody?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:4},[l.contentType===i.CONTENT_TYPE_PLAIN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"body plain",textContent:(0,e.toDisplayString)(l.body)},null,8,An)):l.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,ref:"renderedHtml",class:"body markdown",innerHTML:l.renderedHtml},null,8,Ln)):(0,e.createCommentVNode)("v-if",!0)],2112)):(0,e.createCommentVNode)("v-if",!0)],2),(0,e.createElementVNode)("ul",{ref:"sublist",class:(0,e.normalizeClass)(["spec-block-list",{moving:i.movingThis}])},[(0,e.createCommentVNode)(" managed programatically ")],2)],42,cn)}]]),Kn={key:0},Gn={key:1},Xn={key:0},Qn=(0,e.createTextVNode)(" Created "),Jn=(0,e.createTextVNode)("; last modified "),el={class:"field"},tl=(0,e.createTextVNode)("Bullet point"),ol=(0,e.createTextVNode)("Numbered point"),sl=(0,e.createTextVNode)("Indented block"),nl=(0,e.createElementVNode)("div",null,"Title",-1),ll={class:"field"},il=(0,e.createTextVNode)("No media"),al=(0,e.createTextVNode)("Subspec"),rl=(0,e.createTextVNode)("URL"),cl={class:"field"},dl=(0,e.createTextVNode)("Plain text"),ml=(0,e.createTextVNode)("Markdown"),ul={key:0,class:"split-even"},pl=(0,e.createElementVNode)("div",null,"Body",-1),hl=(0,e.createElementVNode)("div",null,"Preview",-1),gl={key:0,class:"error"},kl=["innerHTML"],bl={key:1},fl=(0,e.createElementVNode)("div",null,"Body",-1),yl={key:0,class:"dialog-footer"},Cl=(0,e.createTextVNode)("Close"),wl={key:1,class:"dialog-footer"},vl=(0,e.createTextVNode)("Cancel"),Vl=(0,e.createTextVNode)("Delete"),Bl={class:"ref-form"},Nl={key:0},El={key:1},Sl=(0,e.createElementVNode)("div",null,"New link URL",-1),xl=(0,e.createTextVNode)(" Create "),Tl=(0,e.createTextVNode)(" Select an existing link "),Il=(0,e.createTextVNode)(" Cancel "),Pl={key:0},Ul={key:"url-select-actions"},Rl=(0,e.createTextVNode)(" Create new link "),_l=(0,e.createTextVNode)(" Cancel "),Ml={key:"url-keep-actions"},$l=(0,e.createTextVNode)(" Create new link "),Ol=(0,e.createTextVNode)(" Select a different link "),jl={key:0},Dl=(0,e.createElementVNode)("div",null,"New subspec name",-1),Al=(0,e.createElementVNode)("div",null,"Description",-1),Ll=(0,e.createTextVNode)(" Create "),Fl=(0,e.createTextVNode)(" Select an existing subspec "),ql=(0,e.createTextVNode)(" Cancel "),zl={key:0},Yl={key:"subspec-select-actions"},Hl=(0,e.createTextVNode)(" Create new subspec "),Zl=(0,e.createTextVNode)(" Cancel "),Wl={key:"subspec-keep-actions"},Kl=(0,e.createTextVNode)(" Create new subspec "),Gl=(0,e.createTextVNode)(" Select a different subspec "),Xl="keep",Ql="create",Jl="select",ei={components:{RefUrl:bs,RefSubspec:Co,LoadingMessage:It},props:{specId:{type:Number,required:!0},refType:String,existingRefType:String,existingRefItem:Object,valid:Boolean,fields:Object},emits:["update:valid","update:fields","open-edit-url","play-video"],data(){return{newUrl:"",urlId:this.existingRefType===Ee&&this.existingRefItem&&this.existingRefItem.id||null,urlFilter:"",urlMode:this.existingRefType===Ee&&this.existingRefItem?Xl:Ql,urlObjects:null,urlObjectsLoaded:!1,loadingUrlObjects:!1,creatingUrlObject:!1,newSubspecName:"",newSubspecDesc:"",subspecId:this.existingRefType===Se&&this.existingRefItem&&this.existingRefItem.id||null,subspecFilter:"",subspecMode:this.existingRefType===Se&&this.existingRefItem?Xl:Ql,subspecs:null,subspecsLoaded:!1,loadingSubspecs:!1,creatingSubspec:!1}},computed:{REF_TYPE_URL:()=>Ee,REF_TYPE_SUBSPEC:()=>Se,MODE_KEEP:()=>Xl,MODE_CREATE:()=>Ql,MODE_SELECT:()=>Jl,initialUrlObject(){return this.existingRefType===Ee&&this.existingRefItem},urlSelectModeAvailable(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},filteredUrlObjects(){if(this.urlFilter&&this.urlObjects){let t=this.urlFilter.toLowerCase(),o=[];for(var e=0;e<this.urlObjects.length;e++){let s=this.urlObjects[e];(s.url.toLowerCase().indexOf(t)>=0||s.title&&s.title.toLowerCase().indexOf(t)>=0)&&o.push(s)}return o}return this.urlObjects},selectedUrlObject(){if(this.urlObjects&&this.urlId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.urlId)return this.urlObjects[e];return null},newUrlIsVideo(){return de(this.newUrl)&&ue(this.newUrl)},disableCreateUrl(){return!de(this.newUrl)||this.creatingUrlObject},urlMaxLength:()=>window.const.urlMaxLength,initialSubspec(){return this.existingRefType===Se&&this.existingRefItem},subspecSelectModeAvailable(){return null===this.subspecs||this.subspecs.length>1||this.subspecs.length&&!this.initialSubspec||1===this.subspecs.length&&this.subspecs[0].id!==this.initialSubspec.id},filteredSubspecs(){if(this.subspecFilter&&this.subspecs){let t=this.subspecFilter.toLowerCase(),o=[];for(var e=0;e<this.subspecs.length;e++){let s=this.subspecs[e];(s.name.toLowerCase().indexOf(t)>=0||s.desc&&s.desc.toLowerCase().indexOf(t)>=0)&&o.push(s)}return o}return this.subspecs},selectedSubspec(){if(this.subspecs&&this.subspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.subspecId)return this.subspecs[e];return null},disableCreateSubspec(){return!this.newSubspecName.trim()||this.creatingSubspec},subspecNameMaxLength:()=>window.const.specNameMaxLength,isValid(){switch(this.refType){case Ee:switch(this.urlMode){case Xl:return!!this.initialUrlObject;case Ql:return de(this.newUrl);case Jl:return!!this.urlId}break;case Se:switch(this.subspecMode){case Xl:return!!this.initialSubspec;case Ql:return!!this.newSubspecName.trim();case Jl:return!!this.subspecId}}return!1},refFields(){switch(this.refType){case Ee:switch(this.urlMode){case Xl:return this.initialUrlObject?{refId:this.initialUrlObject.id}:null;case Ql:return{refUrl:this.newUrl};case Jl:return{refId:this.urlId}}break;case Se:switch(this.subspecMode){case Xl:return this.initialSubspec?{refId:this.initialSubspec.id}:null;case Ql:return{refName:this.newSubspecName,refDesc:this.newSubspecDesc};case Jl:return{refId:this.subspecId}}}return null}},watch:{urlMode(e){e!==Jl||this.urlObjectsLoaded||this.loadUrlObjects()},subspecMode(e){e!==Jl||this.subspecsLoaded||this.loadSubspecs()},isValid:{immediate:!0,handler(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,deep:!0,handler(e){this.$emit("update:fields",e)}}},methods:{loadUrlObjects(){var e;this.loadingUrlObjects||(this.loadingUrlObjects=!0,(e=this.specId,ee().get("/ajax/spec/urls",{specId:e}).fail(ne)).then((e=>{this.urlObjects=e,e.length||(this.urlMode=Ql,ie("No URLs available.")),this.urlObjectsLoaded=!0,this.loadingUrlObjects=!1})).fail((()=>{this.urlObjects||(this.initialUrlObject?this.urlMode=Xl:this.urlMode=Ql),this.urlObjectsLoaded=!0,this.loadingUrlObjects=!1})))},filterUrlObjects(e){e?(this.debouncedFilterURLs||(this.debouncedFilterURLs=re((e=>{this.urlFilter=e}))),this.debouncedFilterURLs(e)):this.urlFilter=""},openEditUrl(e){this.$emit("open-edit-url",e,(t=>{if(this.urlObjects)for(var o=0;o<this.urlObjects.length;o++)if(this.urlObjects[o].id===e.id){this.urlObjects.splice(o,1,t);break}}),(()=>{if(this.urlObjects)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects.splice(t,1);break}this.urlId===e.id&&(this.urlId=null)}))},raisePlayVideo(e){this.$emit("play-video",e)},createUrl(){this.creatingUrlObject=!0,vt(this.specId,this.newUrl).then((e=>{if(this.urlId=e.id,this.urlMode=Jl,this.newUrl="",this.creatingUrlObject=!1,this.urlObjects){for(let t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id)return;this.urlObjects.push(e)}else this.urlObjects=[e];le("URL created.")})).fail((()=>{this.creatingUrlObject=!1}))},loadSubspecs(){var e;this.loadingSubspecs||(this.loadingSubspecs=!0,(e=this.specId,ee().get("/ajax/spec/subspecs",{specId:e}).fail(ne)).then((e=>{this.subspecs=e,e.length||(this.subspecMode=Ql,ie("No subspecs available.")),this.subspecsLoaded=!0,this.loadingSubspecs=!1})).fail((()=>{this.subspecs||(this.initialSubspec?this.subspecMode=Xl:this.subspecMode=Ql),this.subspecsLoaded=!0,this.loadingSubspecs=!1})))},createSubspec(){this.creatingSubspec=!0,Ct(this.specId,this.newSubspecName,this.newSubspecDesc).then((e=>{this.subspecId=e.id,this.subspecMode=Jl,this.newSubspecName="",this.newSubspecDesc="",this.creatingSubspec=!1,this.subspecs?this.subspecs.push(e):this.subspecs=[e],le("Subspec created.")})).fail((()=>{this.creatingSubspec=!1}))},urlUpdated(e){if(this.urlObjects)for(let t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects[t]=e;break}}}},ti={components:{Moment:dt,RefForm:(0,S.Z)(ei,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-alert"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-card"),u=(0,e.resolveComponent)("el-option"),p=(0,e.resolveComponent)("el-select"),h=(0,e.resolveComponent)("ref-url"),g=(0,e.resolveComponent)("ref-subspec");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Bl,[s.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.urlMode===i.MODE_CREATE?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0},{default:(0,e.withCtx)((()=>[l.creatingUrlObject?((0,e.openBlock)(),(0,e.createElementBlock)("p",Nl,[(0,e.createVNode)(a,{message:"Creating..."})])):((0,e.openBlock)(),(0,e.createElementBlock)("label",El,[Sl,(0,e.createVNode)(r,{modelValue:l.newUrl,"onUpdate:modelValue":o[0]||(o[0]=e=>l.newUrl=e),maxlength:i.urlMaxLength,clearable:""},null,8,["modelValue","maxlength"]),l.newUrl&&!i.isValid?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,title:"Invalid URL",type:"error",closable:!1})):i.newUrlIsVideo?((0,e.openBlock)(),(0,e.createBlock)(c,{key:1,title:"Embeddable video detected",type:"info",closable:!1})):(0,e.createCommentVNode)("v-if",!0)])),(0,e.createVNode)(d,{onClick:o[1]||(o[1]=e=>i.createUrl()),disabled:i.disableCreateUrl,type:"primary"},{default:(0,e.withCtx)((()=>[xl])),_:1},8,["disabled"]),i.urlSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:2,onClick:o[2]||(o[2]=e=>l.urlMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Tl])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:3,onClick:o[3]||(o[3]=e=>l.urlMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[Il])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1})):l.urlMode===i.MODE_SELECT?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.loadingUrlObjects?((0,e.openBlock)(),(0,e.createElementBlock)("p",Pl,[(0,e.createVNode)(a,{message:"Loading links..."})])):l.urlObjects&&l.urlObjects.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(p,{modelValue:l.urlId,"onUpdate:modelValue":o[4]||(o[4]=e=>l.urlId=e),filterable:"","filter-method":i.filterUrlObjects,placeholder:"Select link"},{default:(0,e.withCtx)((()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(i.filteredUrlObjects,(t=>((0,e.openBlock)(),(0,e.createBlock)(u,{key:t.id,value:t.id,label:t.title||t.url},null,8,["value","label"])))),128))])),_:1},8,["modelValue","filter-method"]),i.selectedUrlObject?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,item:i.selectedUrlObject,"show-edit":"",onEdit:o[5]||(o[5]=e=>i.openEditUrl(i.selectedUrlObject)),onPlay:o[6]||(o[6]=e=>i.raisePlayVideo(i.selectedUrlObject))},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Ul,[(0,e.createVNode)(d,{onClick:o[7]||(o[7]=e=>l.urlMode=i.MODE_CREATE)},{default:(0,e.withCtx)((()=>[Rl])),_:1}),i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[8]||(o[8]=e=>l.urlMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[_l])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,item:i.initialUrlObject,"show-edit":"",onEdit:o[9]||(o[9]=e=>i.openEditUrl(i.initialUrlObject)),onPlay:o[10]||(o[10]=e=>i.raisePlayVideo(i.initialUrlObject))},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Ml,[(0,e.createVNode)(d,{onClick:o[11]||(o[11]=e=>l.urlMode=i.MODE_CREATE)},{default:(0,e.withCtx)((()=>[$l])),_:1}),i.urlSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[12]||(o[12]=e=>l.urlMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Ol])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64))],2112)):s.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.subspecMode===i.MODE_CREATE?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0},{default:(0,e.withCtx)((()=>[l.creatingSubspec?((0,e.openBlock)(),(0,e.createElementBlock)("p",jl,[(0,e.createVNode)(a,{message:"Creating..."})])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("label",null,[Dl,(0,e.createVNode)(r,{ref:"newSubspecNameInput",modelValue:l.newSubspecName,"onUpdate:modelValue":o[13]||(o[13]=e=>l.newSubspecName=e),maxlength:i.subspecNameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[Al,(0,e.createVNode)(r,{type:"textarea",modelValue:l.newSubspecDesc,"onUpdate:modelValue":o[14]||(o[14]=e=>l.newSubspecDesc=e),autosize:{minRows:2}},null,8,["modelValue"])])],64)),(0,e.createVNode)(d,{onClick:o[15]||(o[15]=e=>i.createSubspec()),disabled:i.disableCreateSubspec,type:"primary"},{default:(0,e.withCtx)((()=>[Ll])),_:1},8,["disabled"]),i.subspecSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:2,onClick:o[16]||(o[16]=e=>l.subspecMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Fl])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:3,onClick:o[17]||(o[17]=e=>l.subspecMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[ql])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1})):l.subspecMode===i.MODE_SELECT?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.loadingSubspecs?((0,e.openBlock)(),(0,e.createElementBlock)("p",zl,[(0,e.createVNode)(a,{message:"Loading subspecs..."})])):l.subspecs&&l.subspecs.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(p,{modelValue:l.subspecId,"onUpdate:modelValue":o[18]||(o[18]=e=>l.subspecId=e),filterable:"",placeholder:"Select subspec"},{default:(0,e.withCtx)((()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.subspecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(u,{key:t.id,value:t.id,label:t.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),i.selectedSubspec?((0,e.openBlock)(),(0,e.createBlock)(g,{key:0,item:i.selectedSubspec},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Yl,[(0,e.createVNode)(d,{onClick:o[19]||(o[19]=e=>l.subspecMode=i.MODE_CREATE),size:"small"},{default:(0,e.withCtx)((()=>[Hl])),_:1}),i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[20]||(o[20]=e=>l.subspecMode=i.MODE_KEEP),size:"small"},{default:(0,e.withCtx)((()=>[Zl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(g,{key:0,item:i.initialSubspec},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Wl,[(0,e.createVNode)(d,{onClick:o[21]||(o[21]=e=>l.subspecMode=i.MODE_CREATE),size:"small"},{default:(0,e.withCtx)((()=>[Kl])),_:1}),i.subspecSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[22]||(o[22]=e=>l.subspecMode=i.MODE_SELECT),size:"small"},{default:(0,e.withCtx)((()=>[Gl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64))],2112)):(0,e.createCommentVNode)("v-if",!0)])}]]),LoadingMessage:It},props:{specId:{type:Number,required:!0},subspecId:Number},emits:["open-edit-url","play-video","prompt-delete"],data:()=>({styleType:Ve,contentType:Be,title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,loading:!1,error:null,loadingPreview:!1,previewHtml:"",previewError:null}),computed:{STYLE_TYPE_NONE:()=>"none",STYLE_TYPE_BULLET:()=>Ve,STYLE_TYPE_NUMBERED:()=>"numbered",CONTENT_TYPE_PLAIN:()=>Be,CONTENT_TYPE_MARKDOWN:()=>Ne,REF_TYPE_URL:()=>Ee,REF_TYPE_SUBSPEC:()=>Se,titleMaxLength:()=>window.const.blockTitleMaxLength,existingRefType(){return this.block&&this.block.refType},existingRefItem(){return this.block&&this.block.refType&&this.block.refItem||null},initialUrlObject(){return this.existingRefType===Ee&&this.existingRefItem}},watch:{body(){this.renderMarkdownPreview()},contentType(){this.renderMarkdownPreview()},previewHtml(e){this.addCodeHighlighting()}},methods:{showAddBlock(e,t,o,s){if(!0===o)if(t){let e=ee()('[data-spec-block="'+t+'"]',".spec-view"),s=e.prev("[data-spec-block]");o=s.length?s.data("vc").getStyleType():e.data("vc").getStyleType()}else if(e){let t=ee()('[data-spec-block="'+e+'"]',".spec-view"),s=ee()(">ul>[data-spec-block]:last-child",t);s.length&&(o=s.data("vc").getStyleType())}else{let e=ee()(">ul>[data-spec-block]:last-child",".spec-view");e.length&&(o=e.data("vc").getStyleType())}"string"==typeof o&&(this.styleType=o),this.parentId=e,this.insertBeforeId=t,this.callback=s,this.showing=!0,this.focusTitleInput()},showEditBlock(e,t){this.loading=!0,this.error=null,this.showing=!0,function(e,t){return ee().get("/ajax/spec/load-edit-block",{specId:e,blockId:t}).fail(ne)}(this.specId,e).then((e=>{this.loading=!1,this.block=e,this.styleType=e.styleType,this.contentType=e.contentType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.focusTitleInput()})).fail((()=>{this.error="Error loading block",this.loading=!1}))},focusTitleInput(){this.$nextTick((()=>{ee()("input",this.$refs.titleInput.$el).focus()}))},renderMarkdownPreview(){this.contentType===Ne&&(this.body.trim()?(this.debouncedBodyRender||(this.debouncedBodyRender=re((e=>{this.loadingPreview=!0,this.previewError=null,this.previewXhr&&this.previewXhr.abort();let t=function(e){let t=ee().post("/ajax/render-markdown",{markdown:e});return t.fail((function(e){0===e.status&&"abort"===e.statusText||ne(e)})),t}(e);this.previewXhr=t,t.then((e=>{this.previewXhr===t&&(e.error?this.previewError=e.error:this.previewHtml=e.html,this.loadingPreview=!1,this.previewXhr=null)})).fail((()=>{this.previewXhr===t&&(this.previewError="Error generating preview.",this.loadingPreview=!1,this.previewXhr=null)}))}),1e3)),this.debouncedBodyRender(this.body)):this.previewHtml="")},addCodeHighlighting(){this.previewHtml&&this.$nextTick((()=>{let e=ee()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&Hn(Fn).then((t=>{e.each(((e,o)=>{t.highlightBlock(o)}))}))}))},openEditUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(o=>{this.initialUrlObject&&o.id===this.initialUrlObject.id&&(this.block.refItem=o),this.$refs.refForm.urlUpdated(e),t&&t(o)}),(e=>{this.initialUrlObject&&e===this.initialUrlObject.id&&(this.block.refType=null,this.block.refId=null,this.block.refItem=null),o&&o(e)}))},raisePlayVideo(e){this.$emit("play-video",e)},promotDelete(){this.$emit("prompt-delete",this.block.id,(()=>{this.showing=!1}))},submit(){if(this.refType){if(!this.refFieldsValid||!this.refFields)return void this.$alert('Please specify the attachment or choose "No media".',{type:"error"})}else if(!this.refType&&!this.title.trim()&&!this.body.trim())return void this.$alert("A title, body, or attachment is required.",{type:"error"});if(this.contentType===Ne&&this.previewError)return void this.$alert("Error rendering preview. Please check your HTML syntax.",{type:"error"});let e=this.createSendingSpinner(),t=this.callback;var o,s,n,l,i,a,r,c;this.block?(o=this.specId,s=this.block.id,n=this.styleType,l=this.contentType,i=this.title,a=this.body,r=this.refType,c=this.refFields,c=c||{},ee().post("/ajax/spec/save-block",{specId:o,blockId:s,styleType:n,contentType:l,title:i,body:a,refType:r,...c}).fail(ne)).then((o=>{t(o),this.showing=!1,e.close()})).fail((()=>{e.close()})):function(e,t,o,s,n,l,i,a,r,c){return c=c||{},ee().post("/ajax/spec/create-block",{specId:e,subspecId:t,parentId:o,insertBeforeId:s,styleType:n,contentType:l,title:i,body:a,refType:r,...c}).fail(ne)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,this.contentType,this.title,this.body,this.refType,this.refFields).then((o=>{t(o),this.showing=!1,e.close()})).fail((()=>{e.close()}))},createSendingSpinner(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed(){this.styleType=Ve,this.contentType=Be,this.block=null,this.error=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1,this.previewHtml="",this.previewError=null}}},oi=(0,S.Z)(ti,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("moment"),c=(0,e.resolveComponent)("el-radio"),d=(0,e.resolveComponent)("el-radio-group"),m=(0,e.resolveComponent)("el-input"),u=(0,e.resolveComponent)("ref-form"),p=(0,e.resolveComponent)("el-button"),h=(0,e.resolveComponent)("el-dialog"),g=(0,e.resolveDirective)("loading");return(0,e.openBlock)(),(0,e.createBlock)(h,{title:l.loading||l.block?"Edit block":"Add block",modelValue:l.showing,"onUpdate:modelValue":o[12]||(o[12]=e=>l.showing=e),width:t.$store.getters.dialogLargeWidth,"close-on-click-modal":!1,onClosed:o[13]||(o[13]=e=>i.closed()),"custom-class":"spec-edit-block-modal"},{footer:(0,e.withCtx)((()=>[l.error?((0,e.openBlock)(),(0,e.createElementBlock)("span",yl,[(0,e.createVNode)(p,{onClick:o[8]||(o[8]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Cl])),_:1})])):l.showing?((0,e.openBlock)(),(0,e.createElementBlock)("span",wl,[(0,e.createVNode)(p,{onClick:o[9]||(o[9]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[vl])),_:1}),l.block?((0,e.openBlock)(),(0,e.createBlock)(p,{key:0,onClick:o[10]||(o[10]=e=>i.promotDelete()),type:"warning"},{default:(0,e.withCtx)((()=>[Vl])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(p,{onClick:o[11]||(o[11]=e=>i.submit()),type:"primary"},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.block?"Save":"Add"),1)])),_:1})])):(0,e.createCommentVNode)("v-if",!0)])),default:(0,e.withCtx)((()=>[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Kn,[(0,e.createVNode)(a,{message:"Loading..."})])):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",Gn,(0,e.toDisplayString)(l.error),1)):l.showing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.block?((0,e.openBlock)(),(0,e.createElementBlock)("p",Xn,[Qn,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(r,{datetime:l.block.created},null,8,["datetime"])]),Jn,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(r,{datetime:l.block.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",el,[(0,e.createVNode)(d,{modelValue:l.styleType,"onUpdate:modelValue":o[0]||(o[0]=e=>l.styleType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:i.STYLE_TYPE_BULLET},{default:(0,e.withCtx)((()=>[tl])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.STYLE_TYPE_NUMBERED},{default:(0,e.withCtx)((()=>[ol])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.STYLE_TYPE_NONE},{default:(0,e.withCtx)((()=>[sl])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,e.createElementVNode)("label",null,[nl,(0,e.createVNode)(m,{ref:"titleInput",modelValue:l.title,"onUpdate:modelValue":o[1]||(o[1]=e=>l.title=e),maxlength:i.titleMaxLength,clearable:""},null,8,["modelValue","maxlength"])])]),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",ll,[(0,e.createVNode)(d,{modelValue:l.refType,"onUpdate:modelValue":o[2]||(o[2]=e=>l.refType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:null},{default:(0,e.withCtx)((()=>[il])),_:1}),(0,e.createVNode)(c,{label:i.REF_TYPE_SUBSPEC},{default:(0,e.withCtx)((()=>[al])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.REF_TYPE_URL},{default:(0,e.withCtx)((()=>[rl])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,e.withDirectives)((0,e.createVNode)(u,{ref:"refForm","spec-id":s.specId,"ref-type":l.refType,"existing-ref-type":i.existingRefType,"existing-ref-item":i.existingRefItem,fields:l.refFields,"onUpdate:fields":o[3]||(o[3]=e=>l.refFields=e),valid:l.refFieldsValid,"onUpdate:valid":o[4]||(o[4]=e=>l.refFieldsValid=e),onOpenEditUrl:i.openEditUrl,onPlayVideo:i.raisePlayVideo},null,8,["spec-id","ref-type","existing-ref-type","existing-ref-item","fields","valid","onOpenEditUrl","onPlayVideo"]),[[e.vShow,!!l.refType]])]),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",cl,[(0,e.createVNode)(d,{modelValue:l.contentType,"onUpdate:modelValue":o[5]||(o[5]=e=>l.contentType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:i.CONTENT_TYPE_PLAIN},{default:(0,e.withCtx)((()=>[dl])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.CONTENT_TYPE_MARKDOWN},{default:(0,e.withCtx)((()=>[ml])),_:1},8,["label"])])),_:1},8,["modelValue"])]),l.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",ul,[(0,e.createCommentVNode)(" display preview beneath for final review"),(0,e.createElementVNode)("label",null,[pl,(0,e.createVNode)(m,{type:"textarea",modelValue:l.body,"onUpdate:modelValue":o[6]||(o[6]=e=>l.body=e),autosize:{minRows:2}},null,8,["modelValue"])]),(0,e.createElementVNode)("label",null,[hl,l.previewError?((0,e.openBlock)(),(0,e.createElementBlock)("div",gl,(0,e.toDisplayString)(l.previewError),1)):(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,ref:"renderedHtml",class:"markdown",innerHTML:l.previewHtml},null,8,kl)),[[g,l.loadingPreview]])])])):((0,e.openBlock)(),(0,e.createElementBlock)("label",bl,[fl,(0,e.createVNode)(m,{type:"textarea",modelValue:l.body,"onUpdate:modelValue":o[7]||(o[7]=e=>l.body=e),autosize:{minRows:2}},null,8,["modelValue"])]))])],64)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]]),si={key:0},ni=(0,e.createTextVNode)(" Created "),li=(0,e.createTextVNode)("; last modified "),ii=(0,e.createElementVNode)("div",null,"URL",-1),ai={key:0,class:"preview"},ri={key:0},ci=(0,e.createTextVNode)("Refresh URL preview"),di={key:1},mi={class:"dialog-footer"},ui=(0,e.createTextVNode)("Cancel"),pi=(0,e.createTextVNode)("Delete"),hi={components:{RefUrl:bs,Moment:dt},props:{specId:{type:Number,required:!0}},data:()=>({url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return window.isValidURL=de,!de(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},urlMaxLength:()=>window.const.urlMaxLength,autoRefresh(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.createdCallback=e,this.showing=!0,this.$nextTick((()=>{ee()("input",this.$refs.urlInput.$el).focus()}))},showEdit(e,t,o){this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=o,this.showing=!0,this.$nextTick((()=>{ee()("input",this.$refs.urlInput.$el).focus()}))},submit(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.createdCallback;vt(this.specId,this.url).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},submitSave(){if(this.disableSubmit)return;this.sending=!0;let e=this.updatedCallback;var t,o;(t=this.urlObject.id,o=this.url,ee().post("/ajax/spec/refresh-url",{id:t,url:o}).fail(ne)).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},promptDelete(){this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{this.sending=!0;let e=this.deletedCallback;var t;(t=this.urlObject.id,ee().post("/ajax/spec/delete-url",{id:t}).fail(ne)).then((()=>{e&&e(this.urlObject.id),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},gi={components:{EditBlockModal:oi,EditUrlModal:(0,S.Z)(hi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("ref-url"),d=(0,e.resolveComponent)("el-checkbox"),m=(0,e.resolveComponent)("el-button"),u=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(u,{title:l.urlObject?"Manage link":"Create link",modelValue:l.showing,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[6]||(o[6]=e=>i.closed()),"custom-class":"spec-edit-url-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",mi,[(0,e.createVNode)(m,{onClick:o[2]||(o[2]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[ui])),_:1}),l.urlObject?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0,onClick:o[3]||(o[3]=e=>i.promptDelete()),type:"danger"},{default:(0,e.withCtx)((()=>[pi])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(m,{onClick:o[4]||(o[4]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.urlObject?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.urlObject?((0,e.openBlock)(),(0,e.createElementBlock)("p",si,[ni,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.urlObject.created},null,8,["datetime"])]),li,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.urlObject.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[ii,(0,e.createVNode)(r,{ref:"urlInput",modelValue:l.url,"onUpdate:modelValue":o[0]||(o[0]=e=>l.url=e),maxlength:i.urlMaxLength},null,8,["modelValue","maxlength"])]),l.urlObject?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.url===l.urlObject.url?((0,e.openBlock)(),(0,e.createElementBlock)("div",ai,[(0,e.createVNode)(c,{item:l.urlObject},null,8,["item"]),i.autoRefresh?((0,e.openBlock)(),(0,e.createElementBlock)("p",ri,"URL preview will be updated")):((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,modelValue:l.refresh,"onUpdate:modelValue":o[1]||(o[1]=e=>l.refresh=e)},{default:(0,e.withCtx)((()=>[ci])),_:1},8,["modelValue"]))])):((0,e.openBlock)(),(0,e.createElementBlock)("p",di,"Link will be updated with new URL"))],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]])},props:{spec:Object,subspec:Object,enableEditing:Boolean},emits:["rendered","open-community","url-updated","url-deleted","play-video","prompt-nav-spec"],data(){return{autoscroller:null,eventBus:{all:e=e||new Map,on:function(t,o){var s=e.get(t);s?s.push(o):e.set(t,[o])},off:function(t,o){var s=e.get(t);s&&(o?s.splice(s.indexOf(o)>>>0,1):e.set(t,[]))},emit:function(t,o){var s=e.get(t);s&&s.slice().map((function(e){e(o)})),(s=e.get("*"))&&s.slice().map((function(e){e(t,o)}))}}};var e},computed:{dragging(){return this.$store.state.dragging},specId(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId(){return this.subspec?this.subspec.id:null},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},dragAndDropEnabled(){return this.enableEditing&&!this.$store.getters.mobileViewport}},watch:{dragAndDropEnabled(e){e?this.mountDragAndDrop():this.drake&&(this.drake.destroy(),this.drake=null)},dragging(e){e?this.autoscroller=function(){const e=70,t=ee()(window);let o=null,s=null;function n(e){s=e.clientY}return t.on("mousemove",n),o=window.requestAnimationFrame((function n(){if(null!==s){let o=t.height(),n=0;s<e?n=-((e-s)/e*8+1):s>o-e&&(n=(s-(o-e))/e*8+1),0!==n&&t.scrollTop(t.scrollTop()+n)}o=window.requestAnimationFrame(n)})),{stop:function(){t.off("mousemove",n),o&&(window.cancelAnimationFrame(o),o=null)}}}():this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null)}},mounted(){if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";let e;if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var t=0;t<e.length;t++)this.insertBlock(e[t]);this.$nextTick((()=>{this.$emit("rendered")})),this.mountDragAndDrop();let o=this.eventBus;o.on("open-community",this.openBlockCommunity),o.on("open-edit",this.openEditBlock),o.on("prompt-add-subblock",this.promptAddSubblock),o.on("prompt-delete",this.promptDeleteBlock),o.on("start-moving",this.startMovingBlocks),o.on("add-to-moving",this.addToMovingBlocks),o.on("remove-from-moving",this.removeFromMovingBlocks),o.on("prompt-nav-spec",this.promptNavSpec),o.on("move-before",this.moveBeforeBlock),o.on("move-into",this.moveIntoBlock),o.on("move-after",this.moveAfterBlock),o.on("cancel-moving",this.cancelMovingBlocks),o.on("play-video",this.playVideo)},beforeDestroy(){this.drake&&(this.drake.destroy(),this.drake=null),this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null),this.$store.getters.currentlyMovingBlocks&&this.$store.state.movingBlocksSourceSubspecId===this.subspecId&&this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.getFinalMovingBlockIds()}),this.eventBus.all.clear(),this.eventBus=null,ee()("[data-spec-block]",this.$refs.list).each(((e,t)=>{ee()(t).data("destroy")()}))},methods:{transitRelativeScrollFirst(){let e=ee()(window).scrollTop();ee()("[data-spec-block]",this.$refs.list).each(((t,o)=>{let s=ee()(o),n=s.offset();if(n.top>e){let t=n.top-e;return this.$nextTick((()=>{ee()(window).scrollTop(s.offset().top-t)})),!1}}))},transitRelativeScroll(e){let t=ee()(window).scrollTop(),o=ee()('[data-spec-block="'+e+'"]',this.$refs.list),s=o.offset().top-t;this.$nextTick((()=>{ee()(window).scrollTop(o.offset().top-s)}))},insertBlock(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{vNode:n,destroy:l,el:i}=function(t){let{props:o,children:s,element:n,app:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n,a=(0,e.createVNode)(t,o,s);l&&l._context&&(a.appContext=l._context),i?(0,e.render)(a,i):"undefined"!=typeof document&&(0,e.render)(a,i=document.createElement("div"));const r=()=>{i&&(0,e.render)(null,i),i=null,a=null};return{vNode:a,destroy:r,el:i}}(Wn,{props:{block:t,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:s},app:Ie}),a=n.component.ctx,r=ee()(ee()(i).find(">li")).data("vc",a).data("destroy",l);if(t.subblocks)for(var c=0;c<t.subblocks.length;c++){let e=t.subblocks[c],o=this.insertBlock(e,!1);ee()(">ul.spec-block-list",r).append(o)}return o&&r.appendTo(this.$refs.list),r},mountDragAndDrop(){this.dragAndDropEnabled&&(this.drake||Hn(qn).then((e=>{console.debug("create drake"),this.drake=e({isContainer:e=>ee()(e).is(".spec-block-list"),accepts:(e,t,o,s)=>!ee()(t).closest(".gu-transit").length,moves:(e,t,o,s)=>ee()(o).is(".drag-handle"),mirrorContainer:this.$refs.mirrorList}).on("drag",((e,t)=>{this.$store.commit("startDragging"),this.transitRelativeScroll(ee()(e).attr("data-spec-block"))})).on("dragend",(e=>{this.$store.commit("endDragging"),this.transitRelativeScroll(ee()(e).attr("data-spec-block"))})).on("drop",((e,t,o,s)=>{let n=ee()(e).data("vc").getBlockId(),l=ee()(o).closest("[data-spec-block]");l.length&&l.data("vc").updateHasSubblocks();let i=null,a=ee()(t).closest("[data-spec-block]");if(a.length){let e=a.data("vc");i=e.getBlockId(),e.updateHasSubblocks()}let r=s?ee()(s).data("vc").getBlockId():null;wt([n],this.subspecId,i,r)}))})))},promptAddBlock(){this.$refs.editBlockModal.showAddBlock(null,null,!0,(e=>{let t=this.insertBlock(e,!0,!0);this.panToBlock(t)}))},openBlockCommunity(e){let{blockId:t,onAdjustUnread:o,onAdjustComments:s}=e;this.$emit("open-community",we,t,o,s)},openEditBlock(e){let{blockId:t,callback:o}=e;this.$refs.editBlockModal.showEditBlock(t,o)},promptAddSubblock(e){let{parentId:t,insertBeforeId:o,defaultStyleType:s}=e;this.$refs.editBlockModal.showAddBlock(t,o,s,(e=>{let s=this.insertBlock(e,!1,!0);if(o)s.insertBefore('[data-spec-block="'+o+'"]');else if(t){let e=ee()('[data-spec-block="'+t+'"]');s.appendTo(e.find(">ul.spec-block-list")),e.data("vc").updateHasSubblocks()}else s.appendTo(this.$refs.list);this.panToBlock(s)}))},promptDeleteBlock(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{(function(e){return ee().post("/ajax/spec/delete-block",{blockId:e}).fail(ne)})(e).then((()=>{ee()('[data-spec-block="'+e+'"]').remove(),t&&t()}))})).catch((()=>{}))},startMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:[e]}),this.transitRelativeScroll(e)},addToMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.concat(e)})},removeFromMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.filter((t=>!ae(t,e)))})},moveBeforeBlock(e){let t=ee()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.parent().closest("[data-spec-block]"),s=o.length?o.attr("data-spec-block"):null,n=e;this.moveBlocks(s,n,(e=>{e.insertBefore(t)}))},moveIntoBlock(e){let t=ee()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.attr("data-spec-block"),s=t.find(">ul.spec-block-list");this.moveBlocks(o,null,(e=>{e.appendTo(s)})),t.data("vc").updateHasSubblocks()},moveAfterBlock(e){let t=ee()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.parent().closest("[data-spec-block]"),s=o.length?o.attr("data-spec-block"):null,n=t.next("[data-spec-block]"),l=n.length?n.attr("data-spec-block"):null,i=t;this.moveBlocks(s,l,(e=>{e.insertAfter(i),i=e}))},moveBlocksToBottom(){this.moveBlocks(null,null,(e=>{e.appendTo(this.$refs.list)}))},getFinalMovingBlockIds(){if(!this.$store.getters.currentlyMovingBlocks)return[];if(!ae(this.$store.state.movingBlocksSourceSubspecId,this.subspecId))return this.$store.state.movingBlockIds;let e=[];return ee()("[data-moving-block-id]",this.$refs.list).each(((t,o)=>{let s=ee()(o);s.closest(".spec-block-list.moving").length||e.push(s.attr("data-moving-block-id"))})),e},moveBlocks(e,t,o){var s=this;let n=this.getFinalMovingBlockIds();n.length&&wt(n,this.subspecId,e,t).then((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;if(e)for(var l=0;l<e.length;l++){let n=s.insertBlock(e[l],!1,!0);o(n),t||(t=n)}else{let e={};for(let l=0;l<n.length;l++){let i=ee()('[data-spec-block="'+n[l]+'"]',s.$refs.list),a=i.parent().closest("[data-spec-block]");o(i),a.length&&(e[a.attr("data-spec-block")]=a.data("vc")),t||(t=i)}for(let t in e)e[t].updateHasSubblocks()}s.$store.commit("endMovingBlocks"),s.panToBlock(t)}))},cancelMovingBlocks(e){this.$store.commit("endMovingBlocks"),this.transitRelativeScroll(e)},openEditUrl(e,t,o){this.$refs.editUrlModal.showEdit(e,(e=>{this.eventBus.emit("url-updated",e),t&&t(e)}),(e=>{this.eventBus.emit("url-deleted",e),o&&o(e)}))},playVideo(e){this.$emit("play-video",e)},promptNavSpec(){this.$emit("prompt-nav-spec")},panToBlock(e){let t=e.find(">.content").offset(),o=ee()(window),s=o.scrollTop(),n=o.height();t.top<s+100?o.scrollTop(t.top-100):t.top>s+n-200&&o.scrollTop(t.top-(n-200))}}},ki=(0,S.Z)(gi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("edit-block-modal"),c=(0,e.resolveComponent)("edit-url-modal");return s.spec||s.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("div",on,[(0,e.createElementVNode)("ul",{ref:"list",class:(0,e.normalizeClass)(["spec-block-list",{dragging:i.dragging}])},[(0,e.createCommentVNode)(" managed programatically ")],2),sn,s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[i.choosingAddPosition?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>i.moveBlocksToBottom()),type:"success"},{default:(0,e.withCtx)((()=>[nn,ln])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(a,{key:1,onClick:o[1]||(o[1]=e=>i.promptAddBlock()),type:"primary"},{default:(0,e.withCtx)((()=>[an])),_:1})),(0,e.createElementVNode)("ul",rn,[(0,e.createCommentVNode)(" holds mirror element when dragging block ")],512),(0,e.createVNode)(r,{ref:"editBlockModal","spec-id":i.specId,"subspec-id":i.subspecId,onOpenEditUrl:i.openEditUrl,onPlayVideo:i.playVideo,onPromptDelete:i.promptDeleteBlock},null,8,["spec-id","subspec-id","onOpenEditUrl","onPlayVideo","onPromptDelete"]),(0,e.createVNode)(c,{ref:"editUrlModal","spec-id":i.specId},null,8,["spec-id"])],64)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)}]]),bi={components:{SpecView:ki,LoadingMessage:It},props:{loading:Boolean,spec:Object,enableEditing:Boolean},emits:["rendered","prop-nav-spec","open-community","play-video"],beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter spec-view",e),o()},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate spec-view",e),o()},methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)}}},fi=(0,S.Z)(bi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("spec-view",!0);return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["spec-view-page",{loading:s.loading}])},[s.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",en,[(0,e.createVNode)(a,{message:"Loading..."})])):s.spec?((0,e.openBlock)(),(0,e.createBlock)(r,{key:s.spec.renderTime,spec:s.spec,"enable-editing":s.enableEditing,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onRendered:o[0]||(o[0]=e=>t.$emit("rendered"))},null,8,["spec","enable-editing","onPromptNavSpec","onOpenCommunity","onPlayVideo"])):((0,e.openBlock)(),(0,e.createElementBlock)("p",tn," Failed to load spec. "))],2)}]]),yi={class:"subspec-page"},Ci={key:0},wi={key:0,class:"right"},vi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Vi={key:0},Bi={key:1},Ni=(0,e.createElementVNode)("i",{class:"material-icons"},"settings",-1),Ei=(0,e.createTextVNode)(" Last modified "),Si=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),xi={key:0},Ti={key:1},Ii={class:"name"},Pi={key:1,class:"desc"},Ui={components:{Moment:dt,SpecView:ki},inheritAttrs:!1,props:{enableEditing:Boolean},emits:["prompt-nav-spec","open-community","play-video","open-manage-subspec"],data:()=>({loading:!0,scrollOnRender:!0,subspec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute(){return"subspec"===this.$route.name},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnread(){return this.$store.getters.loggedIn&&this.unreadCount>0}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter subspec",e),o((t=>{t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave subspec"),this.subspec=null,this.unreadCount=0,this.commentsCount=0,ce(),o()},methods:{loadSubspec(e,t,o){console.debug("load subspec"),this.loading=!0,function(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ee().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:o})}(e,t,o).then((e=>{console.debug("subspec loaded",e),this.subspec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,ce(e.name),this.loading=!1,this.scrollOnRendered()})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{e:"subspec",url:encodeURIComponent(this.$route.fullPath)}})}))},scrollOnRendered(){this.scrollOnRender=!0},handleViewRendered(){this.scrollOnRender&&(this.scrollOnRender=!1,this.restoreScroll())},promptNavSpec(){this.$emit("prompt-nav-spec")},openSubspecCommunity(){this.$emit("open-community",Ce,this.subspec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)},openManageSubspec(){this.$emit("open-manage-subspec",this.subspec,(e=>{this.subspec.updated=e.updated,this.subspec.name=e.name,this.subspec.desc=e.desc,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,ce(e.name)}))},restoreScroll(){let e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),ee()(window).scrollTop(e.top).scrollLeft(e.left))}}},Ri=(0,S.Z)(Ui,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("moment"),c=(0,e.resolveComponent)("router-view");return(0,e.openBlock)(),(0,e.createElementBlock)("section",yi,[l.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("header",Ci,[i.onSubspecRoute&&!l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("div",wi,[s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{onClick:o[0]||(o[0]=e=>i.openSubspecCommunity()),type:i.showUnread?"primary":"default",disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[vi,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Vi,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Bi,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type","disabled"]),s.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[1]||(o[1]=e=>i.openManageSubspec()),disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Ni])),_:1},8,["disabled"])):(0,e.createCommentVNode)("v-if",!0)],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("span",null,[Ei,(0,e.createVNode)(r,{datetime:l.subspec.updated,offset:!0},null,8,["datetime"])]),(0,e.createVNode)(a,{onClick:o[2]||(o[2]=e=>i.openSubspecCommunity()),type:i.showUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Si,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",xi,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ti,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])],64))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("h3",Ii,(0,e.toDisplayString)(l.subspec.name),1),l.subspec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Pi,(0,e.toDisplayString)(l.subspec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,null,{default:(0,e.withCtx)((t=>{let{Component:o}=t;return[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(o),{loading:l.loading,subspec:l.subspec,"enable-editing":s.enableEditing,onRendered:i.handleViewRendered,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo},null,8,["loading","subspec","enable-editing","onRendered","onPromptNavSpec","onOpenCommunity","onPlayVideo"]))]})),_:1})])}]]),_i={key:0},Mi={key:2},$i={components:{SpecView:ki,LoadingMessage:It},props:{loading:Boolean,subspec:Object,enableEditing:Boolean},emits:["rendered","prompt-nav-spec","open-community","play-video"],methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)}}},Oi=(0,S.Z)($i,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("spec-view");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["subspec-view-page",{loading:s.loading}])},[s.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",_i,[(0,e.createVNode)(a,{message:"Loading..."})])):s.subspec?((0,e.openBlock)(),(0,e.createBlock)(r,{key:s.subspec.renderTime,subspec:s.subspec,"enable-editing":s.enableEditing,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onRendered:o[0]||(o[0]=e=>t.$emit("rendered"))},null,8,["subspec","enable-editing","onPromptNavSpec","onOpenCommunity","onPlayVideo"])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Mi," Failed to load subspec. "))],2)}]]),ji={class:"community-review-page"},Di=(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h2",null,"Community review")],-1),Ai={class:"content-page"},Li={key:0},Fi=(0,e.createElementVNode)("h3",null,"Your specs",-1),qi={class:"flex-row"},zi={class:"flex-row nowrap fill"},Yi={class:"expand"},Hi=(0,e.createElementVNode)("i",{class:"material-icons"},"expand_less",-1),Zi=(0,e.createElementVNode)("i",{class:"material-icons"},"expand_more",-1),Wi=(0,e.createElementVNode)("i",{class:"material-icons"},"filter_center_focus",-1),Ki={class:"name fill"},Gi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Xi=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),Qi={key:0,class:"subspecs"},Ji={class:"flex-row"},ea={class:"name fill"},ta=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),oa=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),sa={key:1},na={key:1},la=(0,e.createElementVNode)("h3",null,"Your comments",-1),ia={class:"flex-row wrap-reverse"},aa=["textContent"],ra=(0,e.createTextVNode)(" Show only comments with unread replies "),ca={class:"flex-row"},da={class:"fill"},ma=(0,e.createTextVNode)(" updated "),ua=(0,e.createTextVNode)(" posted "),pa=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),ha=["textContent"],ga={key:0},ka=(0,e.createTextVNode)("Load more"),ba={key:1},fa={key:2};function ya(e){return ee().get("/ajax/community-review",e)}const Ca={components:{Moment:dt,CommunityModal:Hs,PlayVideoModal:Xs,Username:x,LoadingMessage:It},data:()=>({loading:!0,showUnreadOnly:!1,specs:[],expandedSpecs:{},subspecsBySpecId:{},comments:[],totalComments:0,hasMoreComments:!1,loadingCommentsPage:!1,specId:null}),computed:{commentsPageArgs(){let e={unreadOnly:this.showUnreadOnly};return this.comments.length&&(e.updatedBefore=this.comments[this.comments.length-1].updated),e},formattedCommentsCount(){let e=this.totalComments;return e+" comment"+(1!==e?"s":"")+(this.showUnreadOnly?" with unread replies":"")}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter community-review",e),o((e=>{e.initPage()}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate community-review",e),this.initPage(),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave community-review"),this.specs=[],this.expandedSpecs={},this.subspecsBySpecId={},this.comments=[],this.totalComments=0,this.hasMoreComments=!1,this.specId=null,o()},methods:{initPage(){this.showUnreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loading=!0,ya(ee().extend({request:"all"},this.commentsPageArgs)).then((e=>{this.specs=e.specs,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments,this.loading=!1})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},expandSpec(e){var t=this.expandedSpecs[e];this.expandedSpecs[e]=!0,void 0===t&&ya({request:"subspecs",specId:e}).then((t=>{this.subspecsBySpecId[e]=t.subspecs})).fail((t=>{this.expandedSpecs[e]=!1,ne(t)}))},collapseSpec(e){this.expandedSpecs[e]=!1},reloadComments(){this.loadingCommentsPage=!0,this.comments=[],ya(ee().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,ne(e)}))},loadMoreComments(){this.loadingCommentsPage=!0,ya(ee().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,ne(e)}))},openSpecCommunity(e){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(ye,e,(t=>{for(var o=0;o<this.specs.length;o++)if(ae(e,this.specs[o].id)){this.specs[o].unread=this.specs[o].unread+t;break}}),(t=>{for(var o=0;o<this.specs.length;o++)if(ae(e,this.specs[o].id)){this.specs[o].total=this.specs[o].total+t;break}}))}))},gotoSpec(e){this.$router.push({name:"spec",params:{specId:e}})},openSubspecCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(Ce,t,(o=>{let s=this.subspecsBySpecId[e];for(var n=0;n<s.length;n++)if(ae(t,s[n].id)){s[n].unread=s[n].unread+o;break}let l=!1;if(o>0)l=!0;else for(n=0;n<s.length;n++)if(s[n].unread>0||s[n].blockUnread>0){l=!0;break}for(n=0;n<this.specs.length;n++)if(ae(e,this.specs[n].id)){this.specs[n].hasUnreadSubspec=l;break}}),(o=>{let s=this.subspecsBySpecId[e];for(var n=0;n<s.length;n++)if(ae(t,s[n].id)){s[n].total=s[n].total+o;break}}))}))},gotoSubspec(e,t){this.$router.push({name:"subspec",params:{specId:e,subspecId:t}})},openCommentCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(ve,t,(e=>{for(var o=0;o<this.comments.length;o++)if(ae(t,this.comments[o].id)){this.comments[o].unread=this.comments[o].unread+e;break}}),(e=>{for(var o=0;o<this.comments.length;o++)if(ae(t,this.comments[o].id)){this.comments[o].total=this.comments[o].total+e;break}}))}))},playVideo(e){this.$refs.playVideoModal.show(e)}}},wa=(0,S.Z)(Ca,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-button"),c=(0,e.resolveComponent)("router-link"),d=(0,e.resolveComponent)("el-checkbox"),m=(0,e.resolveComponent)("username"),u=(0,e.resolveComponent)("moment"),p=(0,e.resolveComponent)("community-modal"),h=(0,e.resolveComponent)("play-video-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("section",ji,[Di,(0,e.createElementVNode)("div",Ai,[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Li,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("section",null,[Fi,l.specs.length?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:0},(0,e.renderList)(l.specs,(t=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:t.id,class:"spec review"},[(0,e.createElementVNode)("div",qi,[(0,e.createElementVNode)("div",zi,[(0,e.createElementVNode)("div",Yi,[t.hasSubspecs?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.expandedSpecs[t.id]?((0,e.openBlock)(),(0,e.createBlock)(r,{key:0,onClick:e=>i.collapseSpec(t.id),type:t.hasUnreadSubspec?"primary":"default",circle:""},{default:(0,e.withCtx)((()=>[Hi])),_:2},1032,["onClick","type"])):((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,onClick:e=>i.expandSpec(t.id),type:t.hasUnreadSubspec?"primary":"default",circle:""},{default:(0,e.withCtx)((()=>[Zi])),_:2},1032,["onClick","type"]))],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createCommentVNode)(" claim same space with hidden button "),(0,e.createVNode)(r,{type:"default",circle:"",style:{visibility:"hidden"}},{default:(0,e.withCtx)((()=>[Wi])),_:1})],2112))]),(0,e.createElementVNode)("div",Ki,[(0,e.createVNode)(c,{to:{name:"spec",params:{specId:t.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(t.name),1)])),_:2},1032,["to"])])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openSpecCommunity(t.id),type:t.unread?"primary":"default"},{default:(0,e.withCtx)((()=>[Gi,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.unread)+" unread ("+(0,e.toDisplayString)(t.total)+" total) ",1)])),_:2},1032,["onClick","type"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.gotoSpec(t.id),type:t.blockUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Xi,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.blockUnread)+" unread ("+(0,e.toDisplayString)(t.blockTotal)+" total) on blocks ",1)])),_:2},1032,["onClick","type"])])]),l.expandedSpecs[t.id]?((0,e.openBlock)(),(0,e.createElementBlock)("div",Qi,[l.subspecsBySpecId[t.id]?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:0},(0,e.renderList)(l.subspecsBySpecId[t.id],(o=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:o.id,class:"subspec review"},[(0,e.createElementVNode)("div",Ji,[(0,e.createElementVNode)("div",ea,[(0,e.createVNode)(c,{to:{name:"subspec",params:{specId:t.id,subspecId:o.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(o.name),1)])),_:2},1032,["to"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openSubspecCommunity(t.id,o.id),type:o.unread?"primary":"default"},{default:(0,e.withCtx)((()=>[ta,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.unread)+" unread ("+(0,e.toDisplayString)(o.total)+" total) ",1)])),_:2},1032,["onClick","type"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.gotoSubspec(t.id,o.id),type:o.blockUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[oa,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.blockUnread)+" unread ("+(0,e.toDisplayString)(o.blockTotal)+" total) on blocks ",1)])),_:2},1032,["onClick","type"])])])])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",sa,[(0,e.createVNode)(a)]))])):(0,e.createCommentVNode)("v-if",!0)])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",na,"No specs"))]),(0,e.createElementVNode)("section",null,[la,(0,e.createElementVNode)("div",ia,[(0,e.createElementVNode)("div",{class:"fill nowraptext",textContent:(0,e.toDisplayString)(i.formattedCommentsCount)},null,8,aa),(0,e.createVNode)(d,{modelValue:l.showUnreadOnly,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showUnreadOnly=e),onChange:o[1]||(o[1]=e=>i.reloadComments())},{default:(0,e.withCtx)((()=>[ra])),_:1},8,["modelValue"])]),l.comments.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.comments,(o=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:o.id,class:"comment review"},[(0,e.createElementVNode)("div",ca,[(0,e.createElementVNode)("div",da,[(0,e.createVNode)(m,{username:t.$store.getters.username},null,8,["username"]),o.updated!==o.created?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[ma,(0,e.createVNode)(u,{datetime:o.updated,offset:!0},null,8,["datetime"])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[ua,(0,e.createVNode)(u,{datetime:o.created,offset:!0},null,8,["datetime"])],64))]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openCommentCommunity(o.specId,o.id),type:o.unread?"primary":"default",size:"small"},{default:(0,e.withCtx)((()=>[pa,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.unread)+" unread ("+(0,e.toDisplayString)(o.total)+" total) ",1)])),_:2},1032,["onClick","type"])])]),(0,e.createElementVNode)("div",{class:"body",textContent:(0,e.toDisplayString)(o.body)},null,8,ha)])))),128)),l.loadingCommentsPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",ga,[(0,e.createVNode)(a,{message:"Loading more comments..."})])):l.hasMoreComments?((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,onClick:o[2]||(o[2]=e=>i.loadMoreComments())},{default:(0,e.withCtx)((()=>[ka])),_:1})):(0,e.createCommentVNode)("v-if",!0)],64)):l.loadingCommentsPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",ba,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createElementBlock)("p",fa,"No comments"))])],64))]),(0,e.createVNode)(p,{ref:"communityModal","spec-id":l.specId,"enable-write":t.$store.getters.loggedIn,onPlayVideo:i.playVideo},null,8,["spec-id","enable-write","onPlayVideo"]),(0,e.createVNode)(h,{ref:"playVideoModal"},null,512)])}]]),va={class:"admin-page"},Va=(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h2",null,"Admin panel")],-1),Ba={class:"content-page"},Na={key:0},Ea={key:1},Sa={key:2},xa={key:3,class:"signup-requests"},Ta=(0,e.createElementVNode)("h3",null,"Signup requests",-1),Ia={class:"options"},Pa=(0,e.createTextVNode)("Show all"),Ua={key:0},Ra=(0,e.createTextVNode)("Approved"),_a=(0,e.createTextVNode)("Denied"),Ma=(0,e.createTextVNode)("Pending"),$a=(0,e.createTextVNode)(" Review "),Oa={key:2},ja={key:3},Da={class:"users"},Aa=(0,e.createElementVNode)("h3",null,"Users",-1),La={key:0},Fa=(0,e.createElementVNode)("td",null,"Request IDâ",-1),qa=(0,e.createElementVNode)("td",null,"Createdâ",-1),za=(0,e.createElementVNode)("td",null,"Usernameâ",-1),Ya=(0,e.createElementVNode)("td",null,"Email addressâ",-1),Ha=(0,e.createElementVNode)("br",null,null,-1),Za=(0,e.createElementVNode)("br",null,null,-1),Wa=(0,e.createElementVNode)("div",null,"Message",-1),Ka={key:0},Ga={class:"dialog-footer"},Xa=(0,e.createTextVNode)(" Cancel "),Qa=(0,e.createTextVNode)(" Decline "),Ja=(0,e.createTextVNode)(" Approve "),er={components:{Moment:dt,Username:x,LoadingMessage:It},data:()=>({loadingSignupRequests:!0,loadingUsers:!0,error:null,showAllSignupRequests:!1,signupRequests:null,reviewingSignupRequest:null,signupRequestResponse:"",sendingSignupRequestReview:!1,users:[]}),computed:{loading(){return this.loadingSignupRequests},unauthorized(){return!(this.loading||this.error||this.signupRequests)}},watch:{showAllSignupRequests(){this.loadSignupRequests()}},beforeRouteEnter(e,t,o){o((e=>{e.loadAdmin()}))},beforeRouteUpdate(e,t,o){this.loadAdmin(),o()},methods:{loadAdmin(){this.error=null,this.loadSignupRequests(),this.loadUsers()},loadSignupRequests(){this.loadingSignupRequests=!0,$.get("/ajax/admin/signup-requests",{all:this.showAllSignupRequests}).then((e=>{this.loadingSignupRequests=!1,this.signupRequests=e})).fail((e=>{this.loadingSignupRequests=!1,this.error=e.status,ne(e)}))},loadUsers(){this.loadingUsers=!0,$.get("/ajax/admin/users").then((e=>{this.loadingUsers=!1,this.users=e})).fail((e=>{this.loadingUsers=!1,this.error=e.status,ne(e)}))},openReviewSignupRequest(e){this.signupRequestResponse="",this.reviewingSignupRequest=e},cancelReviewSignupRequest(){this.reviewingSignupRequest=null,this.signupRequestResponse=""},submitSignupRequestReview(e){this.reviewingSignupRequest&&(this.sendingSignupRequestReview=!0,$.post("/ajax/admin/review-signup",{requestId:this.reviewingSignupRequest.id,approved:e,message:this.signupRequestResponse}).then((()=>{this.sendingSignupRequestReview=!1;for(var t=0;t<this.signupRequests.length;t++)if(ae(this.signupRequests[t].id,this.reviewingSignupRequest.id)){this.showAllSignupRequests?(this.reviewingSignupRequest.reviewed=!0,this.reviewingSignupRequest.approved=e,this.signupRequests.splice(t,1,this.reviewingSignupRequest)):this.signupRequests.splice(t,1);break}this.reviewingSignupRequest=null,this.signupRequestResponse=""})).fail((e=>{this.sendingSignupRequestReview=!1,ne(e)})))}}},tr=(0,S.Z)(er,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-checkbox"),c=(0,e.resolveComponent)("el-table-column"),d=(0,e.resolveComponent)("moment"),m=(0,e.resolveComponent)("el-tag"),u=(0,e.resolveComponent)("el-button"),p=(0,e.resolveComponent)("el-table"),h=(0,e.resolveComponent)("username"),g=(0,e.resolveComponent)("el-input"),k=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createElementBlock)("div",va,[Va,(0,e.createElementVNode)("div",Ba,[i.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Na,[(0,e.createVNode)(a,{message:"Loading..."})])):403===l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ea,"Unauthorized")):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",Sa,"Error "+(0,e.toDisplayString)(l.error),1)):(0,e.createCommentVNode)("v-if",!0),l.signupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("section",xa,[Ta,(0,e.createElementVNode)("div",Ia,[(0,e.createVNode)(r,{modelValue:l.showAllSignupRequests,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showAllSignupRequests=e)},{default:(0,e.withCtx)((()=>[Pa])),_:1},8,["modelValue"])]),l.loadingSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ua,[(0,e.createVNode)(a,{message:"Loading..."})])):l.signupRequests.length?((0,e.openBlock)(),(0,e.createBlock)(p,{key:1,data:l.signupRequests,"max-height":.8*t.$store.state.windowHeight},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{fixed:"",prop:"id",label:"ID",width:"40"}),(0,e.createVNode)(c,{fixed:"",prop:"username",label:"Username",width:"150"}),(0,e.createVNode)(c,{prop:"email",label:"Email address",width:"300"}),(0,e.createVNode)(c,{label:"Created",width:"200"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(d,{datetime:t.row.created,offset:!0},null,8,["datetime"])])),_:1}),l.showAllSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(c,{label:"Status",width:"120"},{default:(0,e.withCtx)((t=>[t.row.reviewed?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[t.row.approved?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0,type:"success"},{default:(0,e.withCtx)((()=>[Ra])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1,type:"warning"},{default:(0,e.withCtx)((()=>[_a])),_:1}))],2112)):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1},{default:(0,e.withCtx)((()=>[Ma])),_:1}))])),_:1}),(0,e.createVNode)(c,{prop:"userId",label:"User ID",width:"120"})],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{label:"Actions",width:"200"},{default:(0,e.withCtx)((t=>[t.row.reviewed?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createBlock)(u,{key:0,onClick:e=>i.openReviewSignupRequest(t.row),size:"small"},{default:(0,e.withCtx)((()=>[$a])),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data","max-height"])):l.showAllSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("p",Oa,"No data")):((0,e.openBlock)(),(0,e.createElementBlock)("p",ja,"No pending requests"))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("section",Da,[Aa,l.loadingUsers?((0,e.openBlock)(),(0,e.createElementBlock)("p",La,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createBlock)(p,{key:1,data:l.users,"max-height":.8*t.$store.state.windowHeight},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{fixed:"",label:"Username",width:"190"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(h,{username:t.row.username,highlight:t.row.highlight},null,8,["username","highlight"])])),_:1}),(0,e.createVNode)(c,{prop:"email",label:"Email address",width:"300"}),(0,e.createVNode)(c,{label:"Created",width:"200"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(d,{datetime:t.row.created,offset:!0},null,8,["datetime"])])),_:1}),(0,e.createVNode)(c,{prop:"specs",label:"Spec count",width:"100"}),(0,e.createVNode)(c,{label:"Actions",width:"200"})])),_:1},8,["data","max-height"]))])]),l.reviewingSignupRequest?((0,e.openBlock)(),(0,e.createBlock)(k,{key:0,title:"Review signup request","close-on-click-modal":!l.sendingSignupRequestReview,width:t.$store.getters.dialogTinyWidth},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Ga,[(0,e.createVNode)(u,{onClick:o[2]||(o[2]=e=>i.cancelReviewSignupRequest()),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Xa])),_:1},8,["disabled"]),(0,e.createVNode)(u,{type:"warning",onClick:o[3]||(o[3]=e=>i.submitSignupRequestReview(!1)),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Qa])),_:1},8,["disabled"]),(0,e.createVNode)(u,{type:"primary",onClick:o[4]||(o[4]=e=>i.submitSignupRequestReview(!0)),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Ja])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[(0,e.createElementVNode)("table",null,[(0,e.createElementVNode)("tr",null,[Fa,(0,e.createElementVNode)("td",null,(0,e.toDisplayString)(l.reviewingSignupRequest.id),1)]),(0,e.createElementVNode)("tr",null,[qa,(0,e.createElementVNode)("td",null,[(0,e.createVNode)(d,{datetime:l.reviewingSignupRequest.created},null,8,["datetime"])])]),(0,e.createElementVNode)("tr",null,[za,(0,e.createElementVNode)("td",null,[(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(l.reviewingSignupRequest.username),1)])]),(0,e.createElementVNode)("tr",null,[Ya,(0,e.createElementVNode)("td",null,[(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(l.reviewingSignupRequest.email),1)])])]),Ha,Za,(0,e.createElementVNode)("label",null,[Wa,(0,e.createVNode)(g,{type:"textarea",modelValue:l.signupRequestResponse,"onUpdate:modelValue":o[1]||(o[1]=e=>l.signupRequestResponse=e),autosize:{minRows:2},readonly:l.sendingSignupRequestReview},null,8,["modelValue","readonly"])]),l.sendingSignupRequestReview?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ka,[(0,e.createVNode)(a,{message:"Sending..."})])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["close-on-click-modal","width"])):(0,e.createCommentVNode)("v-if",!0)])}]]),or={class:"ajax-error-page content-page"},sr={key:0},nr={key:1},lr={key:2},ir={key:3},ar={key:4},rr=(0,e.createTextVNode)("Retry"),cr={computed:{url(){return decodeURIComponent(this.$route.query.url)},errorType(){return this.$route.query.e||!1},statusCode(){return parseInt(this.$route.params.code,10)||0},specForbidden(){return 403===this.statusCode&&"spec"===this.errorType},subspecForbidden(){return 403===this.statusCode&&"subspec"===this.errorType}},methods:{retry(){this.$router.replace(this.url)}}},dr=(0,S.Z)(cr,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",or,[0===i.statusCode?((0,e.openBlock)(),(0,e.createElementBlock)("p",sr,"Could not connect to server")):503===i.statusCode?((0,e.openBlock)(),(0,e.createElementBlock)("p",nr,"CrowdSpec is currently offline for database upgrades")):i.specForbidden?((0,e.openBlock)(),(0,e.createElementBlock)("p",lr,"You do not have access to the requested spec.")):i.subspecForbidden?((0,e.openBlock)(),(0,e.createElementBlock)("p",ir,"You do not have access to the requested subspec.")):((0,e.openBlock)(),(0,e.createElementBlock)("p",ar,"Request failed with error code "+(0,e.toDisplayString)(i.statusCode),1)),i.url?((0,e.openBlock)(),(0,e.createBlock)(a,{key:5,onClick:o[0]||(o[0]=e=>i.retry())},{default:(0,e.withCtx)((()=>[rr])),_:1})):(0,e.createCommentVNode)("v-if",!0)])}]]),mr={class:"content-page"},ur={},pr=(0,S.Z)(ur,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",mr," Not found ")}]]),hr=(0,be.createRouter)({history:(0,be.createWebHashHistory)(),routes:[{name:"index",path:"/",component:Ut},{path:"/spec/:specId",component:Js,children:[{name:"spec",path:"",component:fi},{path:"subspec/:subspecId",component:Ri,children:[{name:"subspec",path:"",component:Oi}]}]},{name:"community-review",path:"/community-review",component:wa},{name:"admin",path:"/admin",component:tr},{name:"ajax-error",path:"/ajax-error/:code",component:dr},{path:"/:pathMatch(.*)",component:pr}],scrollBehavior:(e,t,o)=>(Ue.commit("setSavedScrollPosition",o),o||{left:0,top:0})});hr.beforeEach(((e,t,o)=>{t&&(Ue.getters.currentSpecId&&e.params.specId&&ae(e.params.specId,Ue.getters.currentSpecId)?Ue.commit("saveCurrentSpecScrollTop"):(Ue.commit("clearCurrentSpec"),Ue.commit("endMovingBlocks"))),o()})),hr.afterEach(((e,t)=>{console.debug("afterEach"),Ue.commit("clearSavedScrollPosition")}));const gr=hr,kr=(0,e.createApp)(ke);Ie=kr,window.app=kr,kr.use(s(),{locale:l()}),kr.use(gr),kr.use(Ue),kr.mount("#app")})()})();