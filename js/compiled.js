!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=21)}([function(t,e){t.exports=jQuery},function(t,e){t.exports=Vue},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e){t.exports=Vuex},function(t,e){t.exports=VueRouter},function(t,e){t.exports=moment},function(t,e){t.exports=dragula},function(t,e,i){t.exports=i(38)},function(t,e,i){},function(t,e,i){"use strict";var n=i(2);i.n(n).a},function(t,e,i){"use strict";var n=i(3);i.n(n).a},function(t,e,i){"use strict";var n=i(4);i.n(n).a},function(t,e,i){"use strict";var n=i(5);i.n(n).a},function(t,e,i){"use strict";var n=i(6);i.n(n).a},function(t,e,i){"use strict";var n=i(7);i.n(n).a},function(t,e,i){"use strict";var n=i(8);i.n(n).a},function(t,e,i){"use strict";var n=i(9);i.n(n).a},function(t,e,i){"use strict";var n=i(10);i.n(n).a},function(t,e,i){"use strict";var n=i(11);i.n(n).a},function(t,e,i){"use strict";var n=i(12);i.n(n).a},function(t,e,i){"use strict";var n=i(13);i.n(n).a},function(t,e,i){"use strict";var n=i(14);i.n(n).a},function(t,e,i){"use strict";var n=i(15);i.n(n).a},function(t,e,i){"use strict";var n=i(16);i.n(n).a},function(t,e,i){"use strict";i.r(e);i(22);var n=i(1),s=i.n(n),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app"},[i("header",[i("h1",{on:{click:function(e){return t.gotoIndex()}}},[t._v("CrowdSpec")]),t._v(" "),i("div",[i("span",[t._v(t._s(t.username))]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.logout()}}},[t._v("Log out")])],1)]),t._v(" "),i("router-view",{staticClass:"page-area"})],1)};o._withStripped=!0;var c=i(0),r=i.n(c),l=i(17),a=i.n(l);s.a.use(a.a);var u=r()(window),d=new a.a.Store({state:{currentTime:Date.now(),windowWidth:u.width(),dragging:!1,moving:null,savedScrollPosition:null,currentSpecId:null,currentSpecScrollTop:null},getters:{userID:function(t){return window.user.id},username:function(t){return window.user.username},dialogTinyWidth:function(t){return t.windowWidth<=767?"80%":t.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(t){return t.windowWidth<=767?"90%":t.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(t){return t.windowWidth<=991?"95%":"90%"}},mutations:{setWindowWidth:function(t,e){t.windowWidth=e},startDragging:function(t){t.dragging=!0},endDragging:function(t){t.dragging=!1},startMoving:function(t,e){t.moving=e},endMoving:function(t){t.moving=null},setSavedScrollPosition:function(t,e){t.savedScrollPosition=e},clearSavedScrollPosition:function(t){t.savedScrollPosition=null},saveCurrentSpecScrollTop:function(t,e){t.currentSpecId=e,t.currentSpecScrollTop=u.scrollTop()},clearCurrentSpec:function(t){t.currentSpecId=null,t.currentSpecScrollPosition=null},updateCurrentTime:function(t){t.currentTime=Date.now()}}}),p=d;u.on("resize",(function(){d.commit("setWindowWidth",u.width())}));setTimeout((function t(){d.commit("updateCurrentTime"),setTimeout(t,6e4)}),6e4);var f=i(18),h=i.n(f),b=/^VersionStamp: (.+)$/m;function m(t){console.error(t);var e=null;(t&&(0===t.readyState?e="Could not connect to server.":t.readyState&&t.status?e="Request failed with HTTP error code "+t.status+".":t.message?e=t.message:"string"==typeof t&&(e=t)),e||(e="An error occurred."),t&&t.responseText&&b.test(t.responseText))&&(b.exec(t.responseText)[1]!==window.appVersion&&(e+=" (A new version is available. Reload this page to use the latest client code.)"));s.a.prototype.$alert(e,"Error",{confirmButtonText:"Ok",type:"error"})}function v(t,e){return parseInt(t,10)===parseInt(e,10)}function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(t?" | ":"")+t}function _(t){if(window.URL)try{return new URL(t),!0}catch(t){return!1}return!(!t||!t.trim())}var k=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function y(t){return k.test(t)}var w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index-page"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.promptCreateSpec()}}},[t._v("New spec")]),t._v(" "),i("div",{staticClass:"user-specs"},[i("h2",[t._v("Your specs")]),t._v(" "),t.loading?i("p",[t._v("Loading...")]):t.userSpecs&&t.userSpecs.length?i("ul",{staticClass:"specs-list"},t._l(t.userSpecs,(function(e){return i("router-link",{key:e.id,attrs:{tag:"li",to:{name:"spec",params:{specId:e.id}}}},[i("div",{staticClass:"info"},[i("span",{staticClass:"status",class:{public:e.public}},[e.public?[i("i",{staticClass:"el-icon-umbrella"}),t._v(" Public")]:[i("i",{staticClass:"el-icon-lock"}),t._v(" Private")]],2)]),t._v(" "),i("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:e.id}}}},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"info"},[i("span",{staticClass:"updated"},[t._v("Last modified "),i("strong",[i("moment",{attrs:{datetime:e.updated,offset:!0}})],1)])]),t._v(" "),e.desc?i("div",{staticClass:"desc"},[t._v(t._s(e.desc))]):t._e()],1)})),1):i("p",[t._v("You do not have any specs.")])]),t._v(" "),i("div",{staticClass:"public-specs",class:{"adjust-margin":!!t.userSpecs.length}},[i("h2",[t._v("Public specs")]),t._v(" "),t.loading?i("p",[t._v("Loading...")]):t.publicSpecs&&t.publicSpecs.length?i("ul",{staticClass:"specs-list"},t._l(t.publicSpecs,(function(e){return i("router-link",{key:e.id,attrs:{tag:"li",to:{name:"spec",params:{specId:e.id}}}},[i("div",{staticClass:"info"},[i("span",{staticClass:"username"},[i("i",{staticClass:"el-icon-user"},[t._v(" "+t._s(e.username))])])]),t._v(" "),i("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:e.id}}}},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"info"},[i("span",{staticClass:"updated"},[t._v("Last modified "),i("strong",[i("moment",{attrs:{datetime:e.updated,offset:!0}})],1)])]),t._v(" "),e.desc?i("div",{staticClass:"desc"},[t._v(t._s(e.desc))]):t._e()],1)})),1):i("p",[t._v("There are no public specs......")])]),t._v(" "),i("edit-spec-modal",{ref:"editSpecModal"})],1)};w._withStripped=!0;var S=function(){var t=this.$createElement;return(this._self._c||t)("span",[this._v(this._s(this.output))])};S._withStripped=!0;var I=i(19),C=i.n(I);function T(t,e,i,n,s,o,c,r){var l,a="function"==typeof t?t.options:t;if(e&&(a.render=e,a.staticRenderFns=i,a._compiled=!0),n&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),c?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(c)},a._ssrRegister=l):s&&(l=r?function(){s.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(a.functional){a._injectStyles=l;var u=a.render;a.render=function(t,e){return l.call(e),u(t,e)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:a}}var $=T({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return C.a.parseZone(this.datetime)},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},S,[],!1,null,null,null);$.options.__file="src/widgets/moment.vue";var x=$.exports,j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:t.spec?"Manage spec":"Create spec",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.spec?i("p",[t._v("\n\t\tCreated "),i("strong",[i("moment",{attrs:{datetime:t.spec.created}})],1),t._v(";\n\t\tlast modified "),i("strong",[i("moment",{attrs:{datetime:t.spec.updated,offset:!0}})],1)]):t._e(),t._v(" "),i("label",[t._v("\n\t\tName\n\t\t"),i("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),i("label",[t._v("\n\t\tDescription\n\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}})],1),t._v(" "),i("el-checkbox",{model:{value:t.isPublic,callback:function(e){t.isPublic=e},expression:"isPublic"}},[t._v("Allow public access and community features")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.spec?i("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDeleteSpec()}}},[t._v("Delete")]):t._e(),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.spec?"Save":"Create"))])],1)],1)};function O(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function E(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?O(Object(i),!0).forEach((function(e){U(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function U(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function P(t){return r.a.get("/ajax/spec",{specId:t}).fail(m)}function B(t,e){return r.a.get("/ajax/spec/subspec",{specId:t,subspecId:e}).fail(m)}function R(t,e,i,n){return r.a.post("/ajax/spec/move-block",{blockId:t,subspecId:e,parentId:i,insertBeforeId:n}).fail(m)}j._withStripped=!0;var M={components:{Moment:x},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.callback=t,this.showing=!0,this.$nextTick((function(){r()("input",e.$refs.nameInput.$el).focus()}))},showEdit:function(t,e){var i=this;this.spec=t,this.name=t.name,this.desc=t.desc,this.isPublic=t.public,this.callback=e,this.showing=!0,this.$nextTick((function(){r()("input",i.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,i,n,s=this.callback;(e=this.name,i=this.desc,n=this.isPublic,r.a.post("/ajax/spec/create-spec",{name:e,desc:i,isPublic:n}).fail(m)).then((function(e){s(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;this.sending=!0;var e,i,n,s,o=this.callback;(e=this.spec.id,i=this.name,n=this.desc,s=this.isPublic,r.a.post("/ajax/spec/save-spec",{specId:e,name:i,desc:n,isPublic:s}).fail(m)).then((function(e){o(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))},promptDeleteSpec:function(){var t=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var e;t.sending=!0,(e=t.spec.id,r.a.post("/ajax/spec/delete-spec",{specId:e}).fail(m)).then((function(){t.sending=!1,t.showing=!1,t.$nextTick((function(){t.$router.push({name:"index"})}))})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},A=(i(23),T(M,j,[],!1,null,null,null));A.options.__file="src/spec/edit-spec-modal.vue";var D=A.exports,F={components:{Moment:x,EditSpecModal:D},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(t,e,i){this.reloadSpecs(),i()},methods:{reloadSpecs:function(){var t=this;this.loading=!0,r.a.get("/ajax/home").then((function(e){t.userSpecs=e.userSpecs,t.publicSpecs=e.publicSpecs,t.loading=!1})).fail((function(e){t.loading=!1,m(e)}))},promptCreateSpec:function(){var t=this;this.$refs.editSpecModal.showCreate((function(e){t.$router.push({name:"spec",params:{specId:e}})}))}}},L=(i(24),T(F,w,[],!1,null,null,null));L.options.__file="src/pages/index.vue";var z=L.exports,V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.spec?i("section",{staticClass:"spec-page"},[i("header",[i("div",{staticClass:"right"},[t.currentUserOwns?i("span",[t._v("You own this")]):i("span",[t._v("\n\t\t\t\tOwned by\n\t\t\t\t"),t.spec.username?[t._v(t._s(t.spec.username))]:[t._v(t._s(t.spec.ownerType)+" "+t._s(t.spec.ownerId))]],2),t._v(" "),t.enableEditing?[t.spec.public?i("span",[t._v("\n\t\t\t\t\tPublic\n\t\t\t\t")]):i("span",[i("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[i("i",{staticClass:"el-icon-lock"})])],1),t._v(" "),i("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(e){return t.openManageSpec()}}})]:i("span",[t._v("\n\t\t\t\tLast modified "),i("moment",{attrs:{datetime:t.spec.updated,offset:!0}})],1)],2),t._v(" "),i("h2",[t._v(t._s(t.spec.name))]),t._v(" "),t.spec.desc?i("div",{staticClass:"desc"},[t._v(t._s(t.spec.desc))]):t._e()]),t._v(" "),i("spec-view",{key:t.spec.id,attrs:{spec:t.spec,"enable-editing":t.enableEditing}}),t._v(" "),t.enableEditing?i("edit-spec-modal",{ref:"editSpecModal"}):t._e()],1):t._e()};V._withStripped=!0;var N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.spec||t.subspec?i("div",{staticClass:"spec-view"},[i("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:t.dragging}}),t._v(" "),t.enableEditing?[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.promptAddBlock()}}},[t._v("Add block")]),t._v(" "),i("ul",{ref:"mirrorList",staticClass:"mirror-list"}),t._v(" "),i("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":t.specId,"subspec-id":t.subspecId},on:{"open-edit-url":t.openEditUrl,"play-video":t.playVideo}}),t._v(" "),i("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":t.specId}})]:t._e(),t._v(" "),i("play-video-modal",{ref:"playVideoModal"})],2):t._e()};N._withStripped=!0;var W=i(20),Y=i.n(W),q=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"spec-block",class:t.classes,attrs:{"data-spec-block":t.block.id}},[i("div",{staticClass:"content",class:{"mobile-adjust":t.showActions}},[i("div",{staticClass:"bg"}),t._v(" "),i("div",{staticClass:"layover",on:{mouseleave:function(e){return t.mouseLeaveLayover()}}},[t.enableEditing?[i("div",{staticClass:"expand-control",class:{hide:t.showActions}},[t.unreadSubmissionsCount?i("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t\t")]):t._e(),t._v(" "),i("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(e){t.focusActions=!0}}})],1),t._v(" "),i("div",{staticClass:"actions",class:{show:t.showActions}},[t.choosingAddPosition?[i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(e){return t.cancelChooseAddPosition()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(e){return t.addBeforeThis()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(e){return t.addIntoThis()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.addAfterThis()}}})]:t.movingThis?[i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(e){return t.cancelMoving()}}},[t._v("Cancel move")])]:t.movingAnother?[i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(e){return t.cancelMoving()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(e){return t.moveBeforeThis()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(e){return t.moveIntoThis()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.moveAfterThis()}}})]:[i("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t\t\t")]),t._v(" "),i("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.editBlock()}}}),t._v(" "),i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.promptDeleteBlock()}}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.enterChooseAddPosition()}}}),t._v(" "),i("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(e){return t.startMoving()}}}),t._v(" "),i("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(e){return t.startMoving()}}})]],2)]:i("div",{staticClass:"visitor-actions"},[i("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t")])],1)],2),t._v(" "),t.hasTitle?i("div",{staticClass:"title"},[t._v(t._s(t.title))]):t._e(),t._v(" "),t.hasRefItem?[t.refType===t.REF_TYPE_URL?i("ref-url",{staticClass:"ref-item",attrs:{item:t.refItem},on:{play:function(e){return t.raisePlayVideo(t.refItem)}}}):t.refType===t.REF_TYPE_SUBSPEC?i("ref-subspec",{staticClass:"ref-item",attrs:{item:t.refItem}}):t._e()]:t.refItemMissing?i("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):t._e(),t._v(" "),t.hasBody?i("div",{staticClass:"body"},[t._v(t._s(t.body))]):t._e()],2),t._v(" "),i("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:t.movingThis}})])};q._withStripped=!0;var X=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ref-url"},[t.item.imageData?i("img",{attrs:{src:t.item.imageData}}):t._e(),t._v(" "),i("div",[t.showEdit||t.showPlay?i("div",{staticClass:"right"},[t.showEdit?i("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.$emit("edit")}}}):t._e(),t._v(" "),t.showPlay?i("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.$emit("play")}}},[t._v("Play")]):t._e()],1):t._e(),t._v(" "),i("div",{staticClass:"title"},[t._m(0),t._v(" "),i("a",{attrs:{href:t.item.url,target:"_blank"}},[t._v(t._s(t.item.title&&t.item.title.trim()||t.item.url))])]),t._v(" "),t.item.desc?i("div",{staticClass:"desc"},[t._v(t._s(t.item.desc.trim()))]):t._e()])])};X._withStripped=!0;var Z={props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return y(this.item.url)}}},H=(i(25),T(Z,X,[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i",{staticClass:"el-icon-link"}),this._v(" URL")])}],!1,null,null,null));H.options.__file="src/spec/ref-url.vue";var Q=H.exports,G=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ref-subspec"},[i("div",[i("div",{staticClass:"title"},[t._m(0),t._v(" "),i("router-link",{attrs:{to:{name:"subspec",params:{specId:t.item.specId,subspecId:t.item.id}}}},[t._v("\n\t\t\t\t"+t._s(t.item.name.trim())+"\n\t\t\t")])],1),t._v(" "),t.item.desc?i("div",{staticClass:"desc"},[t._v(t._s(t.item.desc.trim()))]):t._e()])])};G._withStripped=!0;var J={props:{item:Object}},K=(i(26),T(J,G,[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i",{staticClass:"el-icon-s-unfold"}),this._v(" Subspec")])}],!1,null,null,null));K.options.__file="src/spec/ref-subspec.vue";var tt=K.exports;function et(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var it={components:{RefUrl:Q,RefSubspec:tt},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!(!this.body||!this.body.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},hasSubblocks:function(){return!(!this.subblocks||!this.subblocks.length)},classes:function(){var t;return et(t={},this.styleType,!0),et(t,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),et(t,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),t},movingThis:function(){return this.$store.state.moving===this.block.id},movingAnother:function(){return this.$store.state.moving&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother},unreadSubmissionsCount:function(){return 0},submissionsCount:function(){return 0}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var t=r()(this.$el).parent().closest("[data-spec-block]");return t.length?t.attr("data-spec-block"):null},getFollowingBlockId:function(){var t=r()(this.$el).next("[data-spec-block]");return t.length?t.attr("data-spec-block"):null},editBlock:function(){var t=this;this.raiseOpenEdit({id:this.block.id,created:this.block.created,updated:this.updated,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(e){t.updated=e.updated,t.styleType=e.styleType,t.contentType=e.contentType,t.refType=e.refType,t.refId=e.refId,t.refItem=e.refItem,t.title=e.title,t.body=e.body}))},raiseOpenEdit:function(t,e){this.$emit("open-edit",t,e)},promptDeleteBlock:function(){var t=this;this.raisePromptDeleteBlock(this.block.id,(function(){r()(t.$el).remove()}))},raisePromptDeleteBlock:function(t,e){this.$emit("prompt-delete-block",t,e)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var t=this.getParentId(),e=this.block.id;this.raisePromptAddSubblock(t,e)},addIntoThis:function(){var t=this.block.id;this.raisePromptAddSubblock(t,null)},addAfterThis:function(){var t=this.getParentId(),e=this.getFollowingBlockId();this.raisePromptAddSubblock(t,e)},raisePromptAddSubblock:function(t,e){this.$emit("prompt-add-subblock",t,e)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},moveBeforeThis:function(){var t=this,e=this.$store.state.moving,i=this.getParentId(),n=this.block.id;R(e,this.subspecId,i,n).then((function(){r()('[data-spec-block="'+e+'"]').insertBefore(t.$el),t.$store.commit("endMoving")}))},moveIntoThis:function(){var t=this,e=this.$store.state.moving,i=this.block.id;R(e,this.subspecId,i,null).then((function(){r()('[data-spec-block="'+e+'"]').appendTo(t.$refs.sublist),t.$store.commit("endMoving")}))},moveAfterThis:function(){var t=this,e=this.$store.state.moving,i=this.getParentId(),n=this.getFollowingBlockId();R(e,this.subspecId,i,n).then((function(){r()('[data-spec-block="'+e+'"]').insertAfter(t.$el),t.$store.commit("endMoving")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(t){"url"===this.refType&&t.id===this.refId&&(this.refItem=t)},urlDeleted:function(t){"url"===this.refType&&t===this.refId&&(this.refItem=null)},raisePlayVideo:function(t){this.$emit("play-video",t)},openCommunity:function(){this.$alert("Unimplemented")}}},nt=(i(27),T(it,q,[],!1,null,null,null));nt.options.__file="src/spec/block.vue";var st=nt.exports,ot=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:t.block?"Edit block":"Add block",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.block?i("p",[t._v("\n\t\tCreated "),i("strong",[i("moment",{attrs:{datetime:t.block.created}})],1),t._v(";\n\t\tlast modified "),i("strong",[i("moment",{attrs:{datetime:t.block.updated,offset:!0}})],1)]):t._e(),t._v(" "),i("el-radio-group",{model:{value:t.styleType,callback:function(e){t.styleType=e},expression:"styleType"}},[i("el-radio",{attrs:{label:"bullet"}},[t._v("Bullet point")]),t._v(" "),i("el-radio",{attrs:{label:"numbered"}},[t._v("Numbered point")]),t._v(" "),i("el-radio",{attrs:{label:"none"}},[t._v("Indented block")])],1),t._v(" "),i("label",[t._v("\n\t\tTitle\n\t\t"),i("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),i("label",[t._v("\n\t\tBody\n\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}})],1),t._v(" "),i("el-radio-group",{model:{value:t.refType,callback:function(e){t.refType=e},expression:"refType"}},[i("el-radio",{attrs:{label:null}},[t._v("No media")]),t._v(" "),i("el-radio",{attrs:{label:t.REF_TYPE_SUBSPEC}},[t._v("Subspec")]),t._v(" "),i("el-radio",{attrs:{label:t.REF_TYPE_URL}},[t._v("URL")])],1),t._v(" "),t.refType===t.REF_TYPE_URL?i("ref-url-form",{attrs:{"spec-id":t.specId,"initial-url-object":t.existingUrlRefItem,valid:t.refFieldsValid,fields:t.refFields},on:{"update:valid":function(e){t.refFieldsValid=e},"update:fields":function(e){t.refFields=e},"open-edit-url":t.openEditUrl,"play-video":t.raisePlayVideo}}):t.refType===t.REF_TYPE_SUBSPEC?i("ref-subspec-form",{attrs:{"spec-id":t.specId,"initial-subspec":t.existingSubspecRefItem,valid:t.refFieldsValid,fields:t.refFields},on:{"update:valid":function(e){t.refFieldsValid=e},"update:fields":function(e){t.refFields=e}}}):t._e(),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v("\n\t\t\t"+t._s(t.block?"Save":"Add")+"\n\t\t")])],1)],1)};ot._withStripped=!0;var ct=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ref-url-form"},[t.creating?i("el-card",[i("label",[t._v("\n\t\t\tNew link URL\n\t\t\t"),i("el-input",{attrs:{clearable:""},model:{value:t.newUrl,callback:function(e){t.newUrl=e},expression:"newUrl"}}),t._v(" "),t.newUrl&&!t.isValid?i("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):t.newUrlIsVideo?i("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):t._e()],1),t._v(" "),t.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(){t.creating=!1,t.selecting=!0}}},[t._v("\n\t\t\tSelect an existing link\n\t\t")]):t._e(),t._v(" "),t.initialUrlObject?i("el-button",{attrs:{size:"small"},on:{click:function(){t.creating=!1,t.selecting=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()],1):t.selecting?[t.loading?i("p",[t._v("Loading links...")]):t.urlObjects&&t.urlObjects.length?[i("el-select",{attrs:{filterable:"","filter-method":t.filterUrls,placeholder:"Select link"},model:{value:t.refId,callback:function(e){t.refId=e},expression:"refId"}},t._l(t.filteredUrlObjects,(function(t){return i("el-option",{key:t.id,attrs:{value:t.id,label:t.title||t.url}})})),1),t._v(" "),t.selectedUrlObject?i("ref-url",{attrs:{item:t.selectedUrlObject,"show-edit":""},on:{edit:function(e){return t.openEditUrl(t.selectedUrlObject)},play:function(e){return t.raisePlayVideo(t.selectedUrlObject)}}}):t._e()]:t._e(),t._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\tCreate new link\n\t\t")]),t._v(" "),t.initialUrlObject?i("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()]:[t.initialUrlObject?i("ref-url",{attrs:{item:t.initialUrlObject,"show-edit":""},on:{edit:function(e){return t.openEditUrl(t.initialUrlObject)},play:function(e){return t.raisePlayVideo(t.initialUrlObject)}}}):t._e(),t._v(" "),i("div",[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\t\tCreate new link\n\t\t\t")]),t._v(" "),t.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!0}}},[t._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):t._e()],1)]],2)};ct._withStripped=!0;var rt={components:{RefUrl:Q},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var t=this.filter.toLowerCase(),e=[],i=0;i<this.urlObjects.length;i++){var n=this.urlObjects[i];(n.url.toLowerCase().indexOf(t)>=0||n.title&&n.title.toLowerCase().indexOf(t)>=0)&&e.push(n)}return e}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===this.refId)return this.urlObjects[t];return null},newUrlIsVideo:function(){return _(this.newUrl)&&y(this.newUrl)},isValid:function(){return this.creating?_(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null}},watch:{selecting:{immediate:!0,handler:function(t){t&&this.loadLinks()}},isValid:{immediate:!0,handler:function(t){this.$emit("update:valid",t)}},refFields:{immediate:!0,handler:function(t){this.$emit("update:fields",t)}}},methods:{loadLinks:function(){var t,e=this;this.urlObjects||this.loading||(this.loading=!0,(t=this.specId,r.a.get("/ajax/spec/urls",{specId:t}).fail(m)).then((function(t){e.urlObjects=t,t.length||(e.selecting=!1,e.initialUrlObject||(e.creating=!0)),e.loading=!1})).fail((function(){e.urlObjects=[],e.selecting=!1,e.initialUrlObject||(e.creating=!0),e.loading=!1})))},filterUrls:function(t){var e=this;t?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function n(){e=null,t.apply(this,arguments)}return function(){return e&&clearTimeout(e),e=setTimeout(n.bind.apply(n,[this].concat(Array.prototype.slice.call(arguments))),i)}}((function(t){e.filter=t}))),this.debouncedUpdateFilter(t)):this.filter=""},openEditUrl:function(t){var e=this;this.$emit("open-edit-url",t,(function(i){if(e.urlObjects)for(var n=0;n<e.urlObjects.length;n++)if(e.urlObjects[n].id===t.id){e.urlObjects.splice(n,1,i);break}}),(function(){if(e.urlObjects)for(var i=0;i<e.urlObjects.length;i++)if(e.urlObjects[i].id===t.id){e.urlObjects.splice(i,1);break}e.refId===t.id&&(e.refId=null)}))},raisePlayVideo:function(t){this.$emit("play-video",t)}}},lt=(i(28),T(rt,ct,[],!1,null,null,null));lt.options.__file="src/spec/ref-url-form.vue";var at=lt.exports,ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ref-subspec-form"},[t.creating?i("el-card",[i("label",[t._v("\n\t\t\tNew subspec name\n\t\t\t"),i("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:t.subspecName,callback:function(e){t.subspecName=e},expression:"subspecName"}})],1),t._v(" "),i("label",[t._v("\n\t\t\tDescription\n\t\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.subspecDesc,callback:function(e){t.subspecDesc=e},expression:"subspecDesc"}})],1),t._v(" "),t.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()],1):t.selecting?[t.loading?i("p",[t._v("Loading subspecs...")]):t.subspecs&&t.subspecs.length?[i("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:t.refId,callback:function(e){t.refId=e},expression:"refId"}},t._l(t.subspecs,(function(t){return i("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1),t._v(" "),t.selectedSubspec?i("ref-subspec",{attrs:{item:t.selectedSubspec}}):t._e()]:t._e(),t._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\tCreate new subspec\n\t\t")])]:[t.initialSubspec?i("ref-subspec",{attrs:{item:t.initialSubspec}}):t._e(),t._v(" "),i("div",[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),t._v(" "),t.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!0}}},[t._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):t._e()],1)]],2)};ut._withStripped=!0;var dt={components:{RefSubspec:tt},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var t=0;t<this.subspecs.length;t++)if(this.subspecs[t].id===this.refId)return this.subspecs[t];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(t){t&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(t){this.$emit("update:valid",t)}},refFields:{immediate:!0,handler:function(t){this.$emit("update:fields",t)}}},methods:{loadSubspecs:function(){var t,e=this;this.loading||(this.loading=!0,(t=this.specId,r.a.get("/ajax/spec/subspecs",{specId:t}).fail(m)).then((function(t){e.subspecs=t,t.length||(e.creating=!0),e.loading=!1})).fail((function(){e.subspecs=[],e.creating=!0,e.loading=!1})))}}},pt=(i(29),T(dt,ut,[],!1,null,null,null));pt.options.__file="src/spec/ref-subspec-form.vue";var ft={components:{Moment:x,RefUrlForm:at,RefSubspecForm:pt.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&"url"===this.block.refType&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&"subspec"===this.block.refType&&this.block.refItem||null}},watch:{refType:function(t){this.refFields=null}},methods:{showAdd:function(t,e,i){this.parentId=t,this.insertBeforeId=e,this.callback=i,this.showing=!0,this.focusTitleInput()},showEdit:function(t,e){this.block=t,this.styleType=t.styleType,this.title=t.title||"",this.body=t.body||"",this.refType=t.refType,this.callback=e,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var t=this;this.$nextTick((function(){r()("input",t.$refs.titleInput.$el).focus()}))},openEditUrl:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",t,(function(t){e.existingUrlRefItem&&t.id===e.existingUrlRefItem.id&&(e.block.refItem=t),i&&i(t)}),(function(t){e.existingUrlRefItem&&t===e.existingUrlRefItem.id&&(e.block.refType=null,e.block.refId=null,e.block.refItem=null),n&&n(t)}))},raisePlayVideo:function(t){this.$emit("play-video",t)},submit:function(){var t=this;if(!this.disableSubmit){var e,i,n,s,o,c,l,a,u=this.createSendingSpinner(),d=this.callback;this.block?(e=this.specId,i=this.block.id,n=this.styleType,s="plaintext",o=this.title,c=this.body,l=this.refType,a=this.refFields,a=a||{},r.a.post("/ajax/spec/save-block",E({specId:e,blockId:i,styleType:n,contentType:s,title:o,body:c,refType:l},a)).fail(m)).then((function(e){d(e),t.showing=!1,u.close()})).fail((function(){u.close()})):function(t,e,i,n,s,o,c,l,a,u){return u=u||{},r.a.post("/ajax/spec/create-block",E({specId:t,subspecId:e,parentId:i,insertBeforeId:n,styleType:s,contentType:o,title:c,body:l,refType:a},u)).fail(m)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,"plaintext",this.title,this.body,this.refType,this.refFields).then((function(e){d(e),t.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},ht=(i(30),T(ft,ot,[],!1,null,null,null));ht.options.__file="src/spec/edit-block-modal.vue";var bt=ht.exports,mt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:t.urlObject?"Manage link":"Create link",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.urlObject?i("p",[t._v("\n\t\tCreated "),i("strong",[i("moment",{attrs:{datetime:t.urlObject.created}})],1),t._v(";\n\t\tlast modified "),i("strong",[i("moment",{attrs:{datetime:t.urlObject.updated,offset:!0}})],1)]):t._e(),t._v(" "),i("label",[t._v("\n\t\tURL\n\t\t"),i("el-input",{ref:"urlInput",model:{value:t.url,callback:function(e){t.url=e},expression:"url"}})],1),t._v(" "),t.urlObject?[t.url===t.urlObject.url?i("div",{staticClass:"preview"},[t.urlObject.imageData?i("img",{attrs:{src:t.urlObject.imageData}}):t._e(),t._v(" "),i("div",[t.urlObject.title?i("h3",[t._v(t._s(t.urlObject.title.trim()))]):t._e(),t._v(" "),t.urlObject.desc?i("div",[t._v(t._s(t.urlObject.desc.trim()))]):t._e(),t._v(" "),t.autoRefresh?i("p",[t._v("URL preview will be updated")]):i("el-checkbox",{model:{value:t.refresh,callback:function(e){t.refresh=e},expression:"refresh"}},[t._v("Refresh URL preview")])],1)]):i("p",[t._v("Link will be updated with new URL")])]:t._e(),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.urlObject?i("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDelete()}}},[t._v("Delete")]):t._e(),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.urlObject?"Save":"Create"))])],1)],2)};mt._withStripped=!0;var vt={components:{Moment:x},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=_,!_(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.createdCallback=t,this.showing=!0,this.$nextTick((function(){r()("input",e.$refs.urlInput.$el).focus()}))},showEdit:function(t,e,i){var n=this;this.urlObject=t,this.url=t.url,this.refresh=!0,this.updatedCallback=e,this.deletedCallback=i,this.showing=!0,this.$nextTick((function(){r()("input",n.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,i,n=this.createdCallback;(e=this.specId,i=this.url,r.a.post("/ajax/spec/create-url",{specId:e,url:i}).fail(m)).then((function(e){n(e),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,i,n=this.updatedCallback;(e=this.urlObject.id,i=this.url,r.a.post("/ajax/spec/refresh-url",{id:e,url:i}).fail(m)).then((function(e){n(e),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))}},promptDelete:function(){var t=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){t.sending=!0;var e,i=t.deletedCallback;(e=t.urlObject.id,r.a.post("/ajax/spec/delete-url",{id:e}).fail(m)).then((function(){i&&i(t.urlObject.id),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},gt=(i(31),T(vt,mt,[],!1,null,null,null));gt.options.__file="src/spec/edit-url-modal.vue";var _t=gt.exports,kt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"play-video-modal",attrs:{visible:t.showing,width:t.$store.getters.dialogSmallWidth},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.vid?i("div",{staticClass:"embed-responsive"},["youtube"===t.vid.type?i("iframe",{attrs:{src:"https://www.youtube.com/embed/"+t.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===t.vid.type?i("iframe",{attrs:{src:"https://player.vimeo.com/video/"+t.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):t._e()]):t._e()])};kt._withStripped=!0;var yt={data:function(){return{vid:null,showing:!1}},methods:{show:function(t){var e,i,n=(e=t.url,(i=k.exec(e))?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:i[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:i[1]}:null:null);n&&(this.vid=n,this.showing=!0)},closed:function(){this.vid=null}}},wt=(i(32),T(yt,kt,[],!1,null,null,null));wt.options.__file="src/spec/play-video-modal.vue";var St=wt.exports,It=s.a.extend(st),Ct={components:{EditBlockModal:bt,EditUrlModal:_t,PlayVideoModal:St},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new s.a}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null}},watch:{dragging:function(t){t?this.autoscroller=function(){var t=r()(window),e=null,i=null;function n(t){i=t.clientY}return t.on("mousemove",n),e=window.requestAnimationFrame((function n(){if(null!==i){var s=t.height(),o=0;if(i<70)o=-(8*((70-i)/70)+1);else if(i>s-70){o=8*((i-(s-70))/70)+1}0!==o&&t.scrollTop(t.scrollTop()+o)}e=window.requestAnimationFrame(n)})),{stop:function(){t.off("mousemove",n),e&&(window.cancelAnimationFrame(e),e=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var t,e=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)t=this.spec.blocks;else{if(!this.subspec)return;t=this.subspec.blocks}if(t)for(var i=function t(i,n){for(var s=0;s<n.length;s++){var o=n[s],c=e.insertBlock(o,!1);r()(">ul.spec-block-list",i).append(c),o.subblocks&&t(c,o.subblocks)}},n=0;n<t.length;n++){var s=t[n],o=this.insertBlock(s);s.subblocks&&i(o,s.subblocks)}this.enableEditing&&(this.drake=Y()({isContainer:function(t){return r()(t).is(".spec-block-list")},accepts:function(t,e,i,n){return!r()(e).closest(".gu-transit").length},moves:function(t,e,i,n){return r()(i).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(t,i){e.$store.commit("startDragging"),e.transitRelativeScroll(r()(t).attr("data-spec-block"))})).on("dragend",(function(t){e.$store.commit("endDragging"),e.transitRelativeScroll(r()(t).attr("data-spec-block"))})).on("drop",(function(t,i,n,s){var o=r()(i).closest("[data-spec-block]"),c=o.length?o.data("vc").getBlockId():null,l=s?r()(s).data("vc").getBlockId():null;R(r()(t).data("vc").getBlockId(),e.subspecId,c,l)})))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,r()("[data-spec-block]",this.$refs.list).each((function(t,e){r()(e).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var t=this,e=r()(window).scrollTop();r()("[data-spec-block]",this.$refs.list).each((function(i,n){var s=r()(n).offset();if(s.top>e){var o=s.top-e;return t.$nextTick((function(){r()(window).scrollTop(r()(n).offset().top-o)})),!1}}))},transitRelativeScroll:function(t){var e=r()(window).scrollTop(),i=r()('[data-spec-block="'+t+'"]',this.$refs.list),n=i.offset().top-e;this.$nextTick((function(){r()(window).scrollTop(i.offset().top-n)}))},insertBlock:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new It({parent:this,store:p,router:Yt,propsData:{block:t,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing}}).$mount();i.$on("open-edit",this.openEdit),i.$on("prompt-add-subblock",this.promptAddSubblock),i.$on("prompt-delete-block",this.promptDeleteBlock),i.$on("start-moving",this.startMovingBlock),i.$on("end-moving",this.endMovingBlock),i.$on("play-video",this.playVideo);var n=r()(i.$el).data("vc",i);return e&&n.appendTo(this.$refs.list),n},promptAddBlock:function(){this.$refs.editBlockModal.showAdd(null,null,this.insertBlock)},openEdit:function(t,e){this.$refs.editBlockModal.showEdit(t,e)},promptAddSubblock:function(t,e){var i=this;this.$refs.editBlockModal.showAdd(t,e,(function(n){var s=i.insertBlock(n,!1);e?s.insertBefore('[data-spec-block="'+e+'"]'):t?s.appendTo('[data-spec-block="'+t+'"]>ul.spec-block-list'):s.appendTo(i.$refs.list)}))},promptDeleteBlock:function(t,e){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(t){return r.a.post("/ajax/spec/delete-block",{blockId:t}).fail(m)})(t).then(e)})).catch((function(){}))},startMovingBlock:function(t){this.$store.commit("startMoving",t),this.transitRelativeScroll(t)},endMovingBlock:function(t){this.$store.commit("endMoving"),this.transitRelativeScroll(t)},openEditUrl:function(t,e,i){var n=this;this.$refs.editUrlModal.showEdit(t,(function(t){n.eventBus.$emit("url-updated",t),e&&e(t)}),(function(t){n.eventBus.$emit("url-deleted",t),i&&i(t)}))},playVideo:function(t){this.$refs.playVideoModal.show(t)}}},Tt=(i(33),T(Ct,N,[],!1,null,null,null));Tt.options.__file="src/spec/view.vue";var $t=Tt.exports,xt={components:{Moment:x,SpecView:$t,EditSpecModal:D},data:function(){return{spec:null}},computed:{currentUserOwns:function(){return"user"===this.spec.ownerType&&this.$store.getters.userID===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(t,e,i){P(t.params.specId).then((function(t){i((function(e){e.setSpec(t)}))})).fail((function(t){i({name:"ajax-error",params:{code:t.status},replace:!0})}))},beforeRouteUpdate:function(t,e,i){var n=this;P(t.params.specId).then((function(t){n.setSpec(t),i()})).fail((function(t){i({name:"ajax-error",params:{code:t.status},replace:!0})}))},beforeRouteLeave:function(t,e,i){g(),i()},methods:{setSpec:function(t){this.spec=t,g(t.name),this.$nextTick(this.restoreScroll)},openManageSpec:function(){var t=this;this.$refs.editSpecModal.showEdit(this.spec,(function(e){t.spec.updated=e.updated,t.spec.name=e.name,t.spec.desc=e.desc,t.spec.public=e.public,g(e.name)}))},restoreScroll:function(){var t=this.$store.state.savedScrollPosition;t?r()(window).scrollTop(t.y).scrollLeft(t.x):v(this.$store.state.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&r()(window).scrollTop(this.$store.state.currentSpecScrollTop)}}},jt=(i(34),T(xt,V,[],!1,null,null,null));jt.options.__file="src/pages/spec.vue";var Ot=jt.exports,Et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.subspec?i("section",{staticClass:"subspec-page"},[i("header",[i("div",{staticClass:"spec",on:{click:function(e){return t.gotoSpec()}}},[i("h2",[t._v("\n\t\t\t\t"+t._s(t.subspec.specName)+"\n\t\t\t")])]),t._v(" "),i("div",{staticClass:"subspec"},[i("div",{staticClass:"right"},[t.enableEditing?i("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(e){return t.openManageSubspec()}}}):i("span",[t._v("\n\t\t\t\t\tLast modified "),i("moment",{attrs:{datetime:t.subspec.updated,offset:!0}})],1)],1),t._v(" "),i("h3",[t._v(t._s(t.subspec.name))]),t._v(" "),t.subspec.desc?i("div",{staticClass:"desc"},[t._v(t._s(t.subspec.desc))]):t._e()])]),t._v(" "),i("spec-view",{key:t.subspec.id,attrs:{subspec:t.subspec,"enable-editing":t.enableEditing}}),t._v(" "),t.enableEditing?i("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":t.subspec.specId}}):t._e()],1):t._e()};Et._withStripped=!0;var Ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:t.subspec?"Manage subspec":"Create subspec",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.subspec?i("p",[t._v("\n\t\tCreated "),i("strong",[i("moment",{attrs:{datetime:t.subspec.created}})],1),t._v(";\n\t\tlast modified "),i("strong",[i("moment",{attrs:{datetime:t.subspec.updated,offset:!0}})],1)]):t._e(),t._v(" "),i("label",[t._v("\n\t\tName\n\t\t"),i("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),i("label",[t._v("\n\t\tDescription\n\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.subspec?i("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDeleteSubspec()}}},[t._v("Delete")]):t._e(),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.subspec?"Save":"Create"))])],1)])};Ut._withStripped=!0;var Pt={components:{Moment:x},props:{specId:{type:Number,required:!0}},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.callback=t,this.showing=!0,this.$nextTick((function(){r()("input",e.$refs.nameInput.$el).focus()}))},showEdit:function(t,e){var i=this;this.subspec=t,this.name=t.name,this.desc=t.desc,this.callback=e,this.showing=!0,this.$nextTick((function(){r()("input",i.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,i,n,s=this.callback;(e=this.specId,i=this.name,n=this.desc,r.a.post("/ajax/spec/create-subspec",{specId:e,name:i,desc:n}).fail(m)).then((function(e){s(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;this.sending=!0;var e,i,n,s=this.callback;(e=this.subspec.id,i=this.name,n=this.desc,r.a.post("/ajax/spec/save-subspec",{subspecId:e,name:i,desc:n}).fail(m)).then((function(e){s(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))},promptDeleteSubspec:function(){var t=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var e;t.sending=!0,(e=t.subspec.id,r.a.post("/ajax/spec/delete-subspec",{subspecId:e}).fail(m)).then((function(){t.sending=!1,t.showing=!1,t.$nextTick((function(){t.$router.push({name:"spec",params:{specId:t.specId}})}))})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},Bt=(i(35),T(Pt,Ut,[],!1,null,null,null));Bt.options.__file="src/spec/edit-subspec-modal.vue";var Rt={components:{Moment:x,SpecView:$t,EditSubspecModal:Bt.exports},data:function(){return{subspec:null}},computed:{currentUserOwns:function(){return"user"===this.subspec.ownerType&&this.$store.getters.userID===this.subspec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(t,e,i){B(t.params.specId,t.params.subspecId).then((function(t){i((function(e){e.setSubspec(t)}))})).fail((function(t){i({name:"ajax-error",params:{code:t.status},replace:!0})}))},beforeRouteUpdate:function(t,e,i){var n=this;B(t.params.specId,t.params.subspecId).then((function(t){n.setSubspec(t),i(),n.$nextTick(n.restoreScroll)})).fail((function(t){i({name:"ajax-error",params:{code:t.status},replace:!0})}))},beforeRouteLeave:function(t,e,i){g(),i()},methods:{setSubspec:function(t){this.subspec=t,g(t.name),this.$nextTick(this.restoreScroll)},gotoSpec:function(){this.$router.push({name:"spec",params:{specId:this.subspec.specId}})},openManageSubspec:function(){var t=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(e){t.subspec.updated=e.updated,t.subspec.name=e.name,t.subspec.desc=e.desc,g(e.name)}))},restoreScroll:function(){var t=this.$store.state.savedScrollPosition;t&&r()(window).scrollTop(t.y).scrollLeft(t.x)}}},Mt=(i(36),T(Rt,Et,[],!1,null,null,null));Mt.options.__file="src/pages/subspec.vue";var At=Mt.exports,Dt=function(){var t=this.$createElement;return(this._self._c||t)("div",[0===parseInt(this.$route.params.code,10)?[this._v("\n\t\tCould not connect to server\n\t")]:[this._v("\n\t\tRequest failed with error code "+this._s(this.$route.params.code)+"\n\t")]],2)};Dt._withStripped=!0;var Ft=T({},Dt,[],!1,null,null,null);Ft.options.__file="src/pages/ajax-error.vue";var Lt=Ft.exports,zt=function(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("\n\tNot found\n")])};zt._withStripped=!0;var Vt=T({},zt,[],!1,null,null,null);Vt.options.__file="src/pages/not-found.vue";var Nt=Vt.exports,Wt=new h.a({mode:"history",routes:[{name:"index",path:"/",component:z},{name:"spec",path:"/spec/:specId",component:Ot},{name:"subspec",path:"/spec/:specId/subspec/:subspecId",component:At},{name:"ajax-error",path:"/ajax-error/:code",component:Lt},{path:"*",component:Nt}],scrollBehavior:function(t,e,i){return p.commit("setSavedScrollPosition",i),t.hash?{selector:t.hash}:i||{x:0,y:0}}});Wt.beforeEach((function(t,e,i){e&&(!p.state.currentSpecId||t.params.specId&&v(t.params.specId,p.state.currentSpecId)?"spec"===e.name&&p.commit("saveCurrentSpecScrollTop",e.params.specId):p.commit("clearCurrentSpec")),i()})),Wt.afterEach((function(t,e){p.commit("clearSavedScrollPosition")}));var Yt=Wt,qt={store:p,router:Yt,computed:{username:function(){return this.$store.getters.username}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"}}},Xt=(i(37),T(qt,o,[],!1,null,null,null));Xt.options.__file="src/app.vue";var Zt=Xt.exports;ELEMENT.locale(ELEMENT.lang.en),new s.a(Zt).$mount("#app")}]);