(()=>{"use strict";var e={311:(e,t)=>{t.Z=(e,t)=>{const o=e.__vccOpts||e;for(const[e,s]of t)o[e]=s;return o}}},t={};function o(s){var n=t[s];if(void 0!==n)return n.exports;var l=t[s]={exports:{}};return e[s](l,l.exports,o),l.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=Vue,t=ElementPlus;var s=o.n(t);const n=ElementPlusLocaleEn;var l=o.n(n);const i={class:"app"},a=(0,e.createTextVNode)("Log out"),r={class:"username"},c=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,d=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,m=/^#[0-9a-f]{6}$/i;function u(e){if(e&&"object"==typeof e){if(e.hsl)return h(e);if(e.rgb)return e}else if("string"==typeof e){if(c.test(e)){let t=c.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(m.test(e)){function t(e){e=e.toLowerCase();let t=0;for(let o=0;o<e.length;o++){let s=e.charCodeAt(e.length-1-o);s>=48&&s<=57?t+=(s-48)*Math.pow(16,o):s>=97&&s<=122&&(t+=(s-97+10)*Math.pow(16,o))}return t}return{r:t(e.substr(1,2)),g:t(e.substr(3,2)),b:t(e.substr(5,2)),rgb:!0}}if(d.test(e))return h(e)}return{r:0,g:0,b:0,rgb:!0}}function p(e){if(e&&"object"==typeof e){if(e.hsl)return e;if(e.rgb)return g(e)}else if("string"==typeof e){if(d.test(e)){let t=d.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(c.test(e)||m.test(e))return g(e)}return{h:0,s:0,l:0,hsl:!0}}function h(e){if(e&&"object"==typeof e&&e.rgb)return e;let t,o,s,n=(e=p(e)).h,l=e.s/100,i=e.l/100,a=(1-Math.abs(2*i-1))*l,r=a*(1-Math.abs(n/60%2-1)),c=i-a/2;return 0<=n&&n<60?(t=a,o=r,s=0):60<=n&&n<120?(t=r,o=a,s=0):120<=n&&n<180?(t=0,o=a,s=r):180<=n&&n<240?(t=0,o=r,s=a):240<=n&&n<300?(t=r,o=0,s=a):300<=n&&n<360&&(t=a,o=0,s=r),{r:Math.round(255*(t+c)),g:Math.round(255*(o+c)),b:Math.round(255*(s+c)),rgb:!0}}function g(e){if(e&&"object"==typeof e&&e.hsl)return e;let t,o=(e=u(e)).r/255,s=e.g/255,n=e.b/255,l=Math.min(o,s,n),i=Math.max(o,s,n),a=i-l;t=0==a?0:i==o?(s-n)/a%6:i==s?(n-o)/a+2:(o-s)/a+4,t=Math.round(60*t);let r=(i+l)/2;return{h:t<0?t+360:t,s:+(100*(0==a?0:a/(1-Math.abs(2*r-1)))).toFixed(1),l:+(100*r).toFixed(1),hsl:!0}}function k(e){let t=u(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}const b={props:{username:{type:String,required:!0},highlight:String},computed:{style(){let e=this.username===this.$store.getters.username?this.$store.getters.userSettings.userProfile.highlightUsername:this.highlight;if(!e)return null;let t=k(e),o=k(function(e){let t=p(e);return t.l<=25?t.l=75:t.l<=50?t.l=90:t.l<=75?t.l=10:t.l=25,t}(e));return{color:t,"text-shadow":"-1px -1px 0 "+o+", 1px -1px 0 "+o+", -1px 1px 0 "+o+", 1px 1px 0 "+o}}}};var f=o(311);const y=(0,f.Z)(b,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",r,[(0,e.createElementVNode)("i",{class:"material-icons",style:(0,e.normalizeStyle)(i.style)},"person",4),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(s.username),1)])}]]),C=(0,e.createTextVNode)(" Account options for "),v=(0,e.createElementVNode)("strong",{class:"section-heading"},"Profile",-1),w={class:"flex-input"},V=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),B=(0,e.createElementVNode)("strong",{class:"section-heading"},"Block editing",-1),N=(0,e.createElementVNode)("strong",{class:"section-heading"},"Community",-1),E=(0,e.createTextVNode)(" Show only unread comments by default "),S=(0,e.createTextVNode)(" Update "),x=(0,e.createTextVNode)(" Cancel "),T=(0,e.createElementVNode)("p",null,[(0,e.createTextVNode)("Your password is sent through HTTPS to Google Cloud Platform in MontrÃ©al and encrypted server-side using "),(0,e.createElementVNode)("a",{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"},"bcrypt"),(0,e.createTextVNode)(".")],-1),I=(0,e.createElementVNode)("p",null,"Please use a good password so your account is less likely to be hijacked and used to cause trouble.",-1),P=(0,e.createElementVNode)("p",null," For your security, you should not use the same passwords that you use for important services such as email and online banking on other websites. If one website gets hacked, you can lose access to every other site where you use the same password. Is is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service. ",-1),R=(0,e.createTextVNode)(" Update "),U=(0,e.createTextVNode)(" Cancel "),_={key:2,class:"options"},M=(0,e.createTextVNode)("Your email address on file is "),O={class:"email"},j=(0,e.createTextVNode)("."),D=(0,e.createTextVNode)(" Update settings "),A=(0,e.createTextVNode)(" Change password "),F={class:"dialog-footer"},L=(0,e.createTextVNode)("Close"),q=jQuery;var z=o.n(q);const Y=moment;var H=o.n(Y);const Z=/^VersionStamp: (.+)$/m;function W(e){console.error(e);let o=null;e&&(0===e.readyState?o="Could not connect to server.":e.readyState&&e.status?o=503===e.status?"CrowdSpec is currently offline for database upgrades. Please try again in a bit.":"Request failed with HTTP error code "+e.status+".":e.message?o=e.message:"string"==typeof e&&(o=e)),o||(o="An error occurred."),e&&e.responseText&&Z.test(e.responseText)&&Z.exec(e.responseText)[1]!==window.const.appVersion&&(o+=" (A new update is available. Reload this page to use the latest client code.)"),t.ElMessageBox.alert(o,"Error",{confirmButtonText:"Ok",type:"error"})}function K(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;t.ElMessage.success({message:e,duration:o})}function G(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;t.ElMessage.info({message:e,duration:o})}function X(e,t){return null===e&&null===t||parseInt(e,10)===parseInt(t,10)}function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;var o;function s(){o=null,e.apply(this,arguments)}return function(){return o&&clearTimeout(o),o=setTimeout(s.bind(this,...arguments),t)}}function J(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;document.title="CrowdSpec"+(e?" | "+e:"")}function ee(e){if(window.URL)try{return new URL(e),!0}catch{return!1}return!(!e||!e.trim())}const te=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function oe(e){return te.test(e)}function se(e){return e?"url"===e?"URL":e.charAt(0).toUpperCase()+e.slice(1):""}const ne={components:{Username:y},data:()=>({showing:!1,mode:null,settingsForm:{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},changePasswordForm:{oldPass:"",newPass:"",newPass2:""},waiting:!1}),computed:{username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername},updateSettingsMode(){return 1===this.mode},changePasswordMode(){return 2===this.mode},predefinedUsernameHighlights:()=>["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"],changePasswordRules(){return{oldPass:[{validator:(e,t,o)=>{t.trim()?o():o(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:(e,t,o)=>{t.trim().length<window.const.passwordMinLength?o(new Error("Password minimum length is "+window.const.passwordMinLength+" digits")):(this.changePasswordForm.newPass2.trim()&&this.$refs.changePasswordForm.validateField("newPass2"),o())},trigger:"blur"}],newPass2:[{validator:(e,t,o)=>{t.trim()?t!==this.changePasswordForm.newPass?o(new Error("Passwords do not match")):o():o(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show(){this.showing=!0},enterUpdateSettingsMode(){this.mode=1,this.waiting=!0,z().get("/ajax/settings").then((e=>{this.settingsForm=z().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e),this.waiting=!1})).fail((e=>{this.waiting=!1,this.clearMode(),W(e)}))},enterChangePasswordMode(){this.mode=2,this.selectOldPassword()},submitSettings(){this.waiting=!0,z().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((e=>{this.waiting=!1,this.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),this.clearMode(),this.$store.commit("setUserSettings",e)})).fail((e=>{this.waiting=!1,W(e)}))},handleChangePasswordReturn(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():z()("input",this.$refs.newPass2.$el).focus().select():z()("input",this.$refs.newPass.$el).focus().select():z()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword(){this.$refs.changePasswordForm.validate((e=>{e&&(this.waiting=!0,z().post("/ajax/user/change-password",{old:this.changePasswordForm.oldPass,new:this.changePasswordForm.newPass,new2:this.changePasswordForm.newPass2}).then((()=>{this.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),this.clearMode()})).fail((e=>{if(e&&e.readyState)switch(e.status){case 400:this.$message({message:"New password rejected",type:"error",showClose:!0,duration:4e3});break;case 403:this.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:4e3}),this.selectOldPassword();break;default:W(e)}else W(e)})).always((()=>{this.waiting=!1})))}))},selectOldPassword(){this.$nextTick((()=>{this.$refs.oldPass&&z()("input",this.$refs.oldPass.$el).focus().select()}))},clearMode(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},le={components:{Username:y,EditProfileModal:(0,f.Z)(ne,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("username"),r=(0,e.resolveComponent)("el-color-picker"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-form-item"),m=(0,e.resolveComponent)("el-option"),u=(0,e.resolveComponent)("el-select"),p=(0,e.resolveComponent)("el-checkbox"),h=(0,e.resolveComponent)("el-form"),g=(0,e.resolveComponent)("el-input"),k=(0,e.resolveComponent)("el-alert"),b=(0,e.resolveComponent)("el-dialog"),f=(0,e.resolveDirective)("loading");return(0,e.openBlock)(),(0,e.createBlock)(b,{modelValue:l.showing,"onUpdate:modelValue":o[17]||(o[17]=e=>l.showing=e),width:t.$store.getters.dialogTinyWidth,"close-on-click-modal":null===l.mode,onClosed:o[18]||(o[18]=e=>i.clearMode()),"custom-class":"edit-profile-modal"},{title:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",null,[C,(0,e.createVNode)(a,{username:i.username,highlight:i.highlight},null,8,["username","highlight"])])])),footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",F,[(0,e.createVNode)(c,{onClick:o[16]||(o[16]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[L])),_:1})])])),default:(0,e.withCtx)((()=>[i.updateSettingsMode?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,ref:"changePasswordForm",model:l.settingsForm,"label-position":"top"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[v])),default:(0,e.withCtx)((()=>[(0,e.createElementVNode)("div",w,[(0,e.createVNode)(r,{modelValue:l.settingsForm.userProfile.highlightUsername,"onUpdate:modelValue":o[0]||(o[0]=e=>l.settingsForm.userProfile.highlightUsername=e),predefine:i.predefinedUsernameHighlights,"color-format":"rgb"},null,8,["modelValue","predefine"]),l.settingsForm.userProfile.highlightUsername?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[1]||(o[1]=e=>l.settingsForm.userProfile.highlightUsername=null),size:"small"},{default:(0,e.withCtx)((()=>[V])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{username:"Username colour",highlight:l.settingsForm.userProfile.highlightUsername},null,8,["highlight"])])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[B])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(u,{modelValue:l.settingsForm.blockEditing.deleteButton,"onUpdate:modelValue":o[2]||(o[2]=e=>l.settingsForm.blockEditing.deleteButton=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(m,{label:"Show delete button only in edit block modal",value:"modal"}),(0,e.createVNode)(m,{label:"Show delete button on newly added blocks",value:"recent"}),(0,e.createVNode)(m,{label:"Show delete button on all blocks",value:"all"})])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[N])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(p,{modelValue:l.settingsForm.community.unreadOnly,"onUpdate:modelValue":o[3]||(o[3]=e=>l.settingsForm.community.unreadOnly=e)},{default:(0,e.withCtx)((()=>[E])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{type:"primary",onClick:o[4]||(o[4]=e=>i.submitSettings())},{default:(0,e.withCtx)((()=>[S])),_:1}),(0,e.createVNode)(c,{onClick:o[5]||(o[5]=e=>i.clearMode())},{default:(0,e.withCtx)((()=>[x])),_:1})])),_:1})])),_:1},8,["model"])),[[f,l.waiting]]):i.changePasswordMode?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createBlock)(h,{key:1,ref:"changePasswordForm",model:l.changePasswordForm,rules:i.changePasswordRules,"label-position":"top"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(d,{label:"Current password",prop:"oldPass"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"oldPass",type:"password",name:"old_password",modelValue:l.changePasswordForm.oldPass,"onUpdate:modelValue":o[6]||(o[6]=e=>l.changePasswordForm.oldPass=e),autocomplete:"current-password",onKeyup:o[7]||(o[7]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.oldPass)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,{label:"New password",prop:"newPass"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"newPass",type:"password",name:"new_password",modelValue:l.changePasswordForm.newPass,"onUpdate:modelValue":o[8]||(o[8]=e=>l.changePasswordForm.newPass=e),autocomplete:"new-password",onKeyup:o[9]||(o[9]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.newPass)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,{label:"Confirm new password",prop:"newPass2"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"newPass2",type:"password",name:"verify_password",modelValue:l.changePasswordForm.newPass2,"onUpdate:modelValue":o[10]||(o[10]=e=>l.changePasswordForm.newPass2=e),autocomplete:"new-password",onKeyup:o[11]||(o[11]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.newPass2)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(k,{type:"info",closable:!1},{default:(0,e.withCtx)((()=>[T,I,P])),_:1})])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{type:"primary",onClick:o[12]||(o[12]=e=>i.submitChangePassword())},{default:(0,e.withCtx)((()=>[R])),_:1}),(0,e.createVNode)(c,{onClick:o[13]||(o[13]=e=>i.clearMode())},{default:(0,e.withCtx)((()=>[U])),_:1})])),_:1})])),_:1},8,["model","rules"])),[[f,l.waiting]]):((0,e.openBlock)(),(0,e.createElementBlock)("div",_,[(0,e.createElementVNode)("p",null,[M,(0,e.createElementVNode)("span",O,(0,e.toDisplayString)(t.$store.getters.emailAddress),1),j]),(0,e.createVNode)(c,{onClick:o[14]||(o[14]=e=>i.enterUpdateSettingsMode())},{default:(0,e.withCtx)((()=>[D])),_:1}),(0,e.createVNode)(c,{onClick:o[15]||(o[15]=e=>i.enterChangePasswordMode())},{default:(0,e.withCtx)((()=>[A])),_:1})]))])),_:1},8,["modelValue","width","close-on-click-modal"])}]])},computed:{username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername}},methods:{gotoIndex(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout(){window.location.href="/logout"},openEditProfile(){this.$refs.editProfileModal.show()}}},ie=(0,f.Z)(le,[["render",function(t,o,s,n,l,r){const c=(0,e.resolveComponent)("username"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("router-view"),u=(0,e.resolveComponent)("edit-profile-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("div",i,[(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h1",{onClick:o[0]||(o[0]=e=>r.gotoIndex())},"CrowdSpec"),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(d,{onClick:o[1]||(o[1]=e=>r.openEditProfile()),type:"text",class:"username-button"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{username:r.username,highlight:r.highlight},null,8,["username","highlight"])])),_:1}),(0,e.createVNode)(d,{onClick:o[2]||(o[2]=e=>r.logout())},{default:(0,e.withCtx)((()=>[a])),_:1})])]),(0,e.createVNode)(m,{class:"page-area"}),(0,e.createVNode)(u,{ref:"editProfileModal"},null,512)])}]]),ae=(VueRouter,Vuex,"spec"),re="subspec",ce="block",de="comment",me="bullet",ue="plaintext",pe="markdown",he="url",ge="subspec",ke="user",be=z()(window),fe=Vuex.createStore({state:()=>({currentTime:Date.now(),windowWidth:be.width(),windowHeight:be.height(),dragging:!1,movingBlockIds:[],movingBlocksSourceSubspecId:null,savedScrollPosition:null,currentSpec:null,currentSpecScrollTop:null,userSettings:window.user.settings}),getters:{currentUserId:e=>window.user.id,username:e=>window.user.username,emailAddress:e=>window.user.email,userSettings:e=>z().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e.userSettings),userIsAdmin:e=>window.user.admin,mobileViewport:e=>e.windowWidth<=767,dialogTinyWidth:e=>e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%",dialogSmallWidth:e=>e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%",dialogLargeWidth:e=>e.windowWidth<=991?"95%":"90%",currentlyMovingBlocks:e=>e.movingBlockIds.length>0,currentlyMovingBlock:e=>t=>e.movingBlockIds.indexOf(t)>=0,currentSpecId:e=>e.currentSpec?e.currentSpec.id:null,currentSpecOwnedByUser:(e,t)=>!!e.currentSpec&&e.currentSpec.ownerType===ke&&X(e.currentSpec.ownerId,t.currentUserId)},mutations:{updateWindowDimensions(e){e.windowWidth=be.width(),e.windowHeight=be.height()},setUserSettings(e,t){e.userSettings=t},startDragging(e){e.dragging=!0},endDragging(e){e.dragging=!1},setMovingBlocks(e,t){e.movingBlocksSourceSubspecId=t.subspecId,e.movingBlockIds=t.blockIds},endMovingBlocks(e){e.movingBlocksSourceSubspecId=null,e.movingBlockIds=[]},setSavedScrollPosition(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpec(e,t){console.debug("saveCurrentSpec"),e.currentSpec&&!X(e.currentSpec.id,t.id)&&(console.debug("saveCurrentSpec clear currentSpecScrollTop"),e.currentSpecScrollTop=null),e.currentSpec=t},saveCurrentSpecScrollTop(e){console.debug("saveCurrentSpecScrollTop"),e.currentSpecScrollTop=be.scrollTop()},clearCurrentSpec(e){e.currentSpec=null,e.currentSpecScrollTop=null},updateCurrentTime(e){e.currentTime=Date.now()}}}),ye=fe;be.on("resize",(()=>{fe.commit("updateWindowDimensions")})),setTimeout((function e(){fe.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const Ce={class:"index-page"},ve={class:"actions"},we=(0,e.createTextVNode)(" New spec "),Ve=(0,e.createTextVNode)(" Community review "),Be=(0,e.createTextVNode)(" Admin "),Ne={class:"user-specs"},Ee=(0,e.createElementVNode)("h2",null,"Your specs",-1),Se={key:0},xe={key:1,class:"specs-list"},Te=["onClick"],Ie={class:"info"},Pe=(0,e.createElementVNode)("i",{class:"material-icons"},"beach_access",-1),Re=(0,e.createTextVNode)(" Public"),Ue=(0,e.createElementVNode)("i",{class:"material-icons"},"lock",-1),_e=(0,e.createTextVNode)(" Private"),Me=["href","onClick"],Oe={class:"info"},$e={class:"updated"},je=(0,e.createTextVNode)("Last modified "),De={key:0,class:"desc"},Ae={key:2},Fe=(0,e.createElementVNode)("h2",null,"Public specs",-1),Le={key:0},qe={key:1,class:"specs-list"},ze=["onClick"],Ye={class:"info"},He=["href","onClick"],Ze={class:"info"},We={class:"updated"},Ke=(0,e.createTextVNode)("Last modified "),Ge={key:0,class:"desc"},Xe={key:2},Qe={props:{datetime:String,offset:Boolean},data:()=>({timeout:null}),computed:{moment(){return H().parseZone(this.datetime).local()},currentTime(){return this.$store.state.currentTime},output(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},Je=(0,f.Z)(Qe,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",null,(0,e.toDisplayString)(i.output),1)}]]),et={key:0},tt=(0,e.createTextVNode)(" Created "),ot=(0,e.createTextVNode)("; last modified "),st=(0,e.createElementVNode)("div",null,"Name",-1),nt=(0,e.createElementVNode)("div",null,"Description",-1),lt=(0,e.createTextVNode)("Allow public access and community features"),it={class:"dialog-footer"},at=(0,e.createTextVNode)("Cancel"),rt=(0,e.createTextVNode)("Delete");function ct(e,t,o){return z().post("/ajax/spec/create-subspec",{specId:e,name:t,desc:o}).fail(W)}function dt(e,t,o,s){for(var n=0;n<e.length;n++)e[n]=parseInt(e[n],10);return e=JSON.stringify(e),z().post("/ajax/spec/move-blocks",{blockIds:e,subspecId:t,parentId:o,insertBeforeId:s}).fail(W)}function mt(e,t){return z().post("/ajax/spec/create-url",{specId:e,url:t}).fail(W)}function ut(e,t,o,s,n){return z().get("/ajax/spec/community/page",{specId:e,targetType:t,targetId:o,updatedBefore:s,unreadOnly:n}).fail(W)}const pt={components:{Moment:Je},data:()=>({name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{z()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((()=>{z()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;var t,o,s;(t=this.name,o=this.desc,s=this.isPublic,z().post("/ajax/spec/create-spec",{name:t,desc:o,isPublic:s}).fail(W)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,o,s,n;(t=this.spec.id,o=this.name,s=this.desc,n=this.isPublic,z().post("/ajax/spec/save-spec",{specId:t,name:o,desc:s,isPublic:n}).fail(W)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSpec(){this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.spec.id,z().post("/ajax/spec/delete-spec",{specId:e}).fail(W)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"index"})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},ht=(0,f.Z)(pt,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-checkbox"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(m,{title:l.spec?"Manage spec":"Create spec",modelValue:l.showing,"onUpdate:modelValue":o[6]||(o[6]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[7]||(o[7]=e=>i.closed()),"custom-class":"spec-edit-spec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",it,[(0,e.createVNode)(d,{onClick:o[3]||(o[3]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[at])),_:1}),l.spec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[4]||(o[4]=e=>i.promptDeleteSpec()),type:"danger"},{default:(0,e.withCtx)((()=>[rt])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{onClick:o[5]||(o[5]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.spec?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.spec?((0,e.openBlock)(),(0,e.createElementBlock)("p",et,[tt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.spec.created},null,8,["datetime"])]),ot,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.spec.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[st,(0,e.createVNode)(r,{ref:"nameInput",modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.name=e),maxlength:i.nameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[nt,(0,e.createVNode)(r,{type:"textarea",modelValue:l.desc,"onUpdate:modelValue":o[1]||(o[1]=e=>l.desc=e),autosize:{minRows:2}},null,8,["modelValue"])]),(0,e.createVNode)(c,{modelValue:l.isPublic,"onUpdate:modelValue":o[2]||(o[2]=e=>l.isPublic=e)},{default:(0,e.withCtx)((()=>[lt])),_:1},8,["modelValue"])])),_:1},8,["title","modelValue","width"])}]]),gt={class:"loading-message"},kt=(0,e.createElementVNode)("i",{class:"material-icons spin"},"loop",-1),bt={key:0},ft={props:{message:String}},yt=(0,f.Z)(ft,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",gt,[kt,s.message?((0,e.openBlock)(),(0,e.createElementBlock)("span",bt,(0,e.toDisplayString)(s.message),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Ct={components:{Moment:Je,Username:y,EditSpecModal:ht,LoadingMessage:yt},data:()=>({unreadCommunity:0,userSpecs:[],publicSpecs:[],loading:!0}),mounted(){this.reloadSpecs()},beforeRouteUpdate(e,t,o){this.reloadSpecs(),o()},methods:{reloadSpecs(){this.loading=!0,z().get("/ajax/home").then((e=>{this.unreadCommunity=e.unread,this.userSpecs=e.userSpecs,this.publicSpecs=e.publicSpecs,this.loading=!1})).fail((e=>{this.loading=!1,W(e)}))},promptCreateSpec(){this.$refs.editSpecModal.showCreate((e=>{this.$router.push({name:"spec",params:{specId:e}})}))}}},vt=(0,f.Z)(Ct,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("loading-message"),c=(0,e.resolveComponent)("moment"),d=(0,e.resolveComponent)("router-link"),m=(0,e.resolveComponent)("username"),u=(0,e.resolveComponent)("edit-spec-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Ce,[(0,e.createElementVNode)("div",ve,[(0,e.createVNode)(a,{onClick:o[0]||(o[0]=e=>i.promptCreateSpec()),type:"primary"},{default:(0,e.withCtx)((()=>[we])),_:1}),(0,e.createVNode)(a,{onClick:o[1]||(o[1]=e=>t.$router.push({name:"community-review"})),type:l.unreadCommunity?"primary":"default"},{default:(0,e.withCtx)((()=>[Ve,l.unreadCommunity?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)("("+(0,e.toDisplayString)(l.unreadCommunity)+" unread)",1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"]),t.$store.getters.userIsAdmin?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[2]||(o[2]=e=>t.$router.push({name:"admin"})),class:"admin-access"},{default:(0,e.withCtx)((()=>[Be])),_:1})):(0,e.createCommentVNode)("v-if",!0)]),(0,e.createElementVNode)("div",Ne,[Ee,l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Se,[(0,e.createVNode)(r,{message:"Loading..."})])):l.userSpecs&&l.userSpecs.length?((0,e.openBlock)(),(0,e.createElementBlock)("ul",xe,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.userSpecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(d,{key:t.id,to:{name:"spec",params:{specId:t.id}},custom:""},{default:(0,e.withCtx)((o=>{let{navigate:s,href:n}=o;return[(0,e.createElementVNode)("li",{onClick:s},[(0,e.createElementVNode)("div",Ie,[(0,e.createElementVNode)("span",{class:(0,e.normalizeClass)(["status",{public:t.public}])},[t.public?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[Pe,Re],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[Ue,_e],64))],2)]),(0,e.createElementVNode)("a",{href:n,onClick:s,class:"name"},(0,e.toDisplayString)(t.name),9,Me),(0,e.createElementVNode)("div",Oe,[(0,e.createElementVNode)("span",$e,[je,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:t.updated,offset:!0},null,8,["datetime"])])])]),t.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",De,(0,e.toDisplayString)(t.desc),1)):(0,e.createCommentVNode)("v-if",!0)],8,Te)]})),_:2},1032,["to"])))),128))])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Ae,"You do not have any specs."))]),(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["public-specs",{"adjust-margin":!!l.userSpecs.length}])},[Fe,l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Le,[(0,e.createVNode)(r,{message:"Loading..."})])):l.publicSpecs&&l.publicSpecs.length?((0,e.openBlock)(),(0,e.createElementBlock)("ul",qe,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.publicSpecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(d,{key:t.id,to:{name:"spec",params:{specId:t.id}},custom:""},{default:(0,e.withCtx)((o=>{let{navigate:s,href:n}=o;return[(0,e.createElementVNode)("li",{onClick:s},[(0,e.createElementVNode)("div",Ye,[(0,e.createVNode)(m,{username:t.username,highlight:t.highlight},null,8,["username","highlight"])]),(0,e.createElementVNode)("a",{href:n,onClick:s,class:"name"},(0,e.toDisplayString)(t.name),9,He),(0,e.createElementVNode)("div",Ze,[(0,e.createElementVNode)("span",We,[Ke,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:t.updated,offset:!0},null,8,["datetime"])])])]),(0,e.createCommentVNode)('<div class="tags">\n\t\t\t\t\t\t<el-tag size="mini" :closable="false" type="success">dsf</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false" type="primary">d</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">asdfsadf</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">asd</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">fghfdghsdfg</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">rtrgegrae</el-tag>\n\t\t\t\t\t</div>'),t.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ge,(0,e.toDisplayString)(t.desc),1)):(0,e.createCommentVNode)("v-if",!0)],8,ze)]})),_:2},1032,["to"])))),128))])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Xe,"There are no public specs......"))],2),(0,e.createVNode)(u,{ref:"editSpecModal"},null,512)])}]]),wt={class:"spec-page"},Vt={key:0},Bt={key:0,class:"right"},Nt={key:0},Et={key:1},St=(0,e.createTextVNode)(" Owned by "),xt={key:0},Tt={key:1},It=(0,e.createElementVNode)("i",{class:"material-icons"},"lock",-1),Pt=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Rt=(0,e.createElementVNode)("i",{class:"material-icons"},"settings",-1),Ut=(0,e.createTextVNode)(" Last modified "),_t=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Mt=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),Ot={key:1,class:"desc"},$t={key:0},jt=(0,e.createTextVNode)(" Created "),Dt=(0,e.createTextVNode)("; last modified "),At=(0,e.createElementVNode)("div",null,"Name",-1),Ft=(0,e.createElementVNode)("div",null,"Description",-1),Lt={class:"dialog-footer"},qt=(0,e.createTextVNode)("Cancel"),zt=(0,e.createTextVNode)("Delete"),Yt={components:{Moment:Je},props:{specId:Number},data:()=>({name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{z()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((()=>{z()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;ct(this.specId,this.name,this.desc).then((t=>{e(t.id),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,o,s;(t=this.subspec.id,o=this.name,s=this.desc,z().post("/ajax/spec/save-subspec",{subspecId:t,name:o,desc:s}).fail(W)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSubspec(){this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.subspec.id,z().post("/ajax/spec/delete-subspec",{subspecId:e}).fail(W)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"spec",params:{specId:this.specId}})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.subspec=null,this.name="",this.desc=""}}},Ht=(0,f.Z)(Yt,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(d,{title:l.subspec?"Manage subspec":"Create subspec",modelValue:l.showing,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[6]||(o[6]=e=>i.closed()),"custom-class":"spec-edit-subspec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Lt,[(0,e.createVNode)(c,{onClick:o[2]||(o[2]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[qt])),_:1}),l.subspec?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[3]||(o[3]=e=>i.promptDeleteSubspec()),type:"danger"},{default:(0,e.withCtx)((()=>[zt])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{onClick:o[4]||(o[4]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.subspec?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("p",$t,[jt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.subspec.created},null,8,["datetime"])]),Dt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.subspec.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[At,(0,e.createVNode)(r,{ref:"nameInput",modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.name=e),maxlength:i.nameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[Ft,(0,e.createVNode)(r,{type:"textarea",modelValue:l.desc,"onUpdate:modelValue":o[1]||(o[1]=e=>l.desc=e),autosize:{minRows:2}},null,8,["modelValue"])])])),_:1},8,["title","modelValue","width"])}]]),Zt={key:0},Wt={key:2},Kt=(0,e.createTextVNode)("New subspec"),Gt={class:"dialog-footer"},Xt=(0,e.createTextVNode)("Close"),Qt=(0,e.createTextVNode)(" Go to spec "),Jt={class:"ref-subspec ref-item"},eo={class:"title"},to=(0,e.createElementVNode)("span",null,[(0,e.createElementVNode)("i",{class:"material-icons"},"subdirectory_arrow_right"),(0,e.createTextVNode)(" Subspec")],-1),oo={key:0,class:"desc"},so={props:{item:Object}},no=(0,f.Z)(so,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("router-link");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Jt,[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("div",eo,[to,(0,e.createVNode)(a,{to:{name:"subspec",params:{specId:s.item.specId,subspecId:s.item.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(s.item.name.trim()),1)])),_:1},8,["to"])]),s.item.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",oo,(0,e.toDisplayString)(s.item.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0)])])}]]),lo={components:{RefSubspec:no,LoadingMessage:yt},props:{specId:Number,subspecId:Number},emits:["open-create-subspec"],data:()=>({subspecs:[],loading:!1,showing:!1}),watch:{$route:{deep:!0,handler(){this.showing=!1}}},methods:{show(){this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((e=>{this.subspecs=e,this.loading=!1})).fail((e=>{this.loading=!1,this.showing=!1,W(e)}))},openCreateSubspec(){this.$emit("open-create-subspec"),this.showing=!1},goToSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},closed(){this.loading=!1,this.subspecs=[]}}},io=(0,f.Z)(lo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("ref-subspec"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(d,{title:"Navigate spec",modelValue:l.showing,"onUpdate:modelValue":o[3]||(o[3]=e=>l.showing=e),width:t.$store.getters.dialogTinyWidth,onClosed:o[4]||(o[4]=e=>i.closed()),"custom-class":"nav-spec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Gt,[(0,e.createVNode)(c,{onClick:o[1]||(o[1]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Xt])),_:1}),s.subspecId?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[2]||(o[2]=e=>i.goToSpec()),type:"primary"},{default:(0,e.withCtx)((()=>[Qt])),_:1})):(0,e.createCommentVNode)("v-if",!0)])])),default:(0,e.withCtx)((()=>[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Zt,[(0,e.createVNode)(a,{message:"Loading..."})])):l.subspecs.length?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:1},(0,e.renderList)(l.subspecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(r,{key:t.id,item:t},null,8,["item"])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",Wt,"No subspecs.")),(0,e.createVNode)(c,{onClick:o[0]||(o[0]=e=>i.openCreateSubspec()),class:"new-subspec-button"},{default:(0,e.withCtx)((()=>[Kt])),_:1})])),_:1},8,["modelValue","width"])}]]),ao={key:0},ro={key:1},co={key:0,class:"updated"},mo=(0,e.createTextVNode)(" Last modified "),uo={class:"new-comment-area"},po={key:0},ho=(0,e.createTextVNode)(" Cancel "),go=(0,e.createTextVNode)(" Post "),ko={class:"controls-area flex-row wrap-reverse"},bo=["textContent"],fo=(0,e.createTextVNode)(" Show only unread comments "),yo={key:5},Co={key:0},vo=(0,e.createTextVNode)(" Load more "),wo={class:"dialog-footer"},Vo=(0,e.createTextVNode)("Close"),Bo=(0,e.createElementVNode)("i",{class:"material-icons"},"north_west",-1),No={class:"bar"},Eo={class:"label"},So=["textContent"],xo={props:{target:Object,targetType:String},computed:{label(){let e=se(this.targetType);return this.targetType===ce&&this.target.refType&&(e+=" ("+se(this.target.refType)+")"),e},content(){switch(this.targetType){case ae:case re:return this.target.name;case ce:let e;if(e=(this.target.title||"").trim())return e;if(e=(this.target.body||"").trim())return e;if(this.target.refItem)switch(this.target.refType){case ge:return this.target.refItem.name;case he:return this.target.refItem.title||this.target.refItem.url}return"";case de:return this.target.body}}}},To={emits:["pop-stack"],components:{StackBar:(0,f.Z)(xo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["community-context-stack-bar",s.targetType])},[(0,e.createVNode)(a,{size:"small",type:"primary",circle:""},{default:(0,e.withCtx)((()=>[Bo])),_:1}),(0,e.createElementVNode)("span",No,[(0,e.createElementVNode)("span",Eo,(0,e.toDisplayString)(i.label||"..."),1),(0,e.createElementVNode)("span",{class:"content",textContent:(0,e.toDisplayString)(i.content||"...")},null,8,So)])],2)}]])},data:()=>({stack:[],empty:!0,cachedContext:[]}),computed:{available(){return this.stack.length}},methods:{replaceStack(e){this.stack=e,this.cachedContext=[],this.checkEmpty()},pushStack(e,t,o,s){this.empty=!1,this.stack.push({targetType:e,target:t,onAdjustUnread:o,onAdjustComments:s})},popStack(){if(this.stack.length){let e=this.stack.splice(this.stack.length-1,1)[0];return this.$emit("pop-stack",e.targetType,e.target.id,e.onAdjustUnread,e.onAdjustComments),this.cacheItemHandlers(e),e}return null},jumpStack(e){let t=this.stack.splice(e,this.stack.length-e),o=t[0];for(this.$emit("pop-stack",o.targetType,o.target.id,o.onAdjustUnread,o.onAdjustComments),e=0;e<t.length;e++)this.cacheItemHandlers(t[e]);return o},cacheItemHandlers(e){for(var t=0;t<this.cachedContext.length;t++){let o=this.cachedContext[t];if(o.targetType===e.targetType&&X(o.target.id,e.target.id)){this.cachedContext.splice(t,1);break}}(e.onAdjustUnread||e.onAdjustComments)&&this.cachedContext.push(e)},retrieveCachedHandlers(e,t){for(var o=0;o<this.cachedContext.length;o++){let s=this.cachedContext[o];if(s.targetType===e&&X(s.target.id,t))return this.cachedContext.splice(o,1)[0]}return null},getParentContext(){return this.stack.length?this.stack[this.stack.length-1]:null},clearStack(){this.stack=[],this.cachedContext=[]},checkEmpty(){return this.empty=!this.stack.length}}},Io=(0,f.Z)(To,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("stack-bar");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["community-context-stack",{empty:l.empty}])},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.stack,((t,o)=>((0,e.openBlock)(),(0,e.createBlock)(e.Transition,{key:t.targetType+"-"+t.target.id,onAfterLeave:i.checkEmpty,name:"fade",appear:""},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(a,{target:t.target,"target-type":t.targetType,onClick:e=>i.jumpStack(o)},null,8,["target","target-type","onClick"])])),_:2},1032,["onAfterLeave"])))),128))],2)}]]),Po={class:"spec-preview community-target-preview"},Ro={class:"name"},Uo={key:0,class:"desc"},_o={props:{spec:Object}},Mo=(0,f.Z)(_o,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Po,[(0,e.createElementVNode)("div",Ro,(0,e.toDisplayString)(s.spec.name),1),s.spec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Uo,(0,e.toDisplayString)(s.spec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Oo={class:"spec-subspec-preview community-target-preview"},$o={class:"name"},jo={key:0,class:"desc"},Do={props:{subspec:Object}},Ao=(0,f.Z)(Do,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Oo,[(0,e.createElementVNode)("div",$o,(0,e.toDisplayString)(s.subspec.name),1),s.subspec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",jo,(0,e.toDisplayString)(s.subspec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Fo=["data-block-preview-id"],Lo={key:0,class:"title"},qo=["textContent"],zo=["innerHTML"],Yo={class:"ref-url ref-item"},Ho=["src"],Zo={key:0,class:"right"},Wo=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),Ko=(0,e.createTextVNode)("Play"),Go={class:"title"},Xo=(0,e.createElementVNode)("i",{class:"material-icons"},"link",-1),Qo=["href"],Jo={key:1,class:"desc"},es={props:{item:Object,showEdit:Boolean},emits:["edit","play"],computed:{showPlay(){return oe(this.item.url)}}},ts=(0,f.Z)(es,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Yo,[s.item.imageData?((0,e.openBlock)(),(0,e.createElementBlock)("img",{key:0,src:s.item.imageData},null,8,Ho)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[s.showEdit||i.showPlay?((0,e.openBlock)(),(0,e.createElementBlock)("div",Zo,[s.showEdit?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>t.$emit("edit")),size:"small",circle:""},{default:(0,e.withCtx)((()=>[Wo])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.showPlay?((0,e.openBlock)(),(0,e.createBlock)(a,{key:1,onClick:o[1]||(o[1]=e=>t.$emit("play")),size:"small",type:"primary",class:"play-button"},{default:(0,e.withCtx)((()=>[Ko])),_:1})):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Go,[(0,e.createElementVNode)("span",null,[Xo,(0,e.createTextVNode)(" "+(0,e.toDisplayString)(i.showPlay?"Video":"URL"),1)]),(0,e.createElementVNode)("a",{href:s.item.url,target:"_blank",onClick:o[2]||(o[2]=(0,e.withModifiers)((()=>{}),["stop"]))},(0,e.toDisplayString)(s.item.title&&s.item.title.trim()||s.item.url),9,Qo)]),s.item.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Jo,(0,e.toDisplayString)(s.item.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0)])])}]]),os={class:"dynamic-stylesheet",style:{display:"none"}},ss=/^\/\*(?:[^\*]|\*(?!\/))+\*\/$/;function ns(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!t||"object"!=typeof t)return 0;let n=0,l=[];const i=()=>{let t=o.join("").trim();if(t){for(let e=0;e<l.length;e++){let t=l[e].trim();t&&!ss.test(t)&&";"!==t.charAt(t.length-1)&&(l[e]=t+";")}l=l.join(""),l&&((e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+l+"}",s+n):(e.styleSheet||e.sheet).addRule(t,l,s+n),n++),l=[]}else l=[]};if(Array.isArray(t))for(let a=0;a<t.length;a++){let r=t[a];r&&("string"==typeof r?l.push(r):"object"==typeof r&&(i(),n+=ns(e,r,o,s+n)))}else for(let a in t)if(t.hasOwnProperty(a)){let r=t[a];r&&("string"==typeof r?l.push(a+":"+r+";"):"object"==typeof r&&(i(),"&"===a.charAt(0)?a=a.substr(1):[">",":","+","~"," "].indexOf(a.charAt(0))<0&&(a=" "+a),n+=ns(e,r,o.concat([a]),s+n)))}return i(),n}function ls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||"object"!=typeof e)return"";let o="",s=[];const n=()=>{let e=t.join("").trim();if(e){let t=[];for(let e=0;e<s.length;e++){let o=s[e].trim();o?";"===o.charAt(o.length-1)||ss.test(o)?t.push(o):t.push(o+";"):t.push("")}t.length&&(t=t.join("\n\t"),o+="\n"+e+" {\n\t"+t+"\n}")}else for(let e=0;e<s.length;e++){let t=s[e].trim();t&&!ss.test(t)||(o+="\n"+t)}s=[]};if(Array.isArray(e))for(let l=0;l<e.length;l++){let i=e[l];"string"==typeof i?s.push(i):i&&"object"==typeof i&&(n(),o+=ls(i,t.concat([""])))}else for(let l in e)if(e.hasOwnProperty(l)){let i=e[l];if(i)switch(typeof i){case"string":s.push(l+": "+i+";");break;case"object":n(),"&"===l.charAt(0)?l=l.substr(1):[">",":","+","~"," "].indexOf(l.charAt(0))<0&&(l=" "+l),o+=ls(i,t.concat([l]));break;case"boolean":s.push(l)}}return n(),o+(t.length?"":"\n")}const is={props:{rules:[Object,Array],innerMarkupOutput:Boolean},watch:{rules:{deep:!0,handler(){this.recreateSheet()}},innerMarkupOutput(){this.recreateSheet()}},mounted(){this.recreateSheet()},beforeDestroy(){this.removeSheet()},methods:{recreateSheet(){this.removeSheet(),this.rules&&(this.$stylesheet=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=document.createElement("style");return s.type="text/css",e.appendChild(s),!s.styleSheet&&!s.sheet||o?s.innerHTML=ls(t):ns(s,t),s}(this.$el,this.rules,this.innerMarkupOutput))},removeSheet(){this.$stylesheet&&(this.$stylesheet.parentNode.removeChild(this.$stylesheet),this.$stylesheet=null)}}},as={components:{RefUrl:ts,RefSubspec:no,DynamicStylesheet:(0,f.Z)(is,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",os)}]])},props:{block:Object},emits:["play-video"],computed:{CONTENT_TYPE_PLAIN:()=>ue,CONTENT_TYPE_MARKDOWN:()=>pe,REF_TYPE_URL:()=>he,REF_TYPE_SUBSPEC:()=>ge,blockId(){return parseInt(this.block.id,10)||0},blockNumber(){return"numbered"===this.block.styleType&&parseInt(this.block.number,10)||0},blockPreviewRules(){let e;switch(this.block.styleType){case"bullet":e="'\\2022'";break;case"numbered":e="'"+this.blockNumber+".'";break;default:return null}return{['[data-block-preview-id="'+this.blockId+'"]']:{">li:before":{content:e}}}},hasTitle(){return!(!this.block.title||!this.block.title.trim())},hasRefItem(){return!(!this.block.refType||!this.block.refItem)},hasBody(){return!!(this.block.body&&this.block.body.trim()||this.block.html&&this.block.html.trim())},refItemMissing(){return!!this.block.refType&&!this.block.refItem}},methods:{raisePlayVideo(e){this.$emit("play-video",e)}}},rs=(0,f.Z)(as,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("ref-url"),r=(0,e.resolveComponent)("ref-subspec"),c=(0,e.resolveComponent)("el-alert"),d=(0,e.resolveComponent)("dynamic-stylesheet");return(0,e.openBlock)(),(0,e.createElementBlock)("ul",{"data-block-preview-id":i.blockId,class:"spec-block-preview community-target-preview"},[(0,e.createElementVNode)("li",null,[i.hasTitle?((0,e.openBlock)(),(0,e.createElementBlock)("div",Lo,(0,e.toDisplayString)(s.block.title),1)):(0,e.createCommentVNode)("v-if",!0),i.hasRefItem?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[s.block.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,item:s.block.refItem,onPlay:o[0]||(o[0]=e=>i.raisePlayVideo(s.block.refItem)),class:"ref-item"},null,8,["item"])):s.block.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,item:s.block.refItem,class:"ref-item"},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],2112)):i.refItemMissing?((0,e.openBlock)(),(0,e.createBlock)(c,{key:2,title:"Content unavailable",closable:!1,type:"warning"})):(0,e.createCommentVNode)("v-if",!0),i.hasBody?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:3},[s.block.contentType===i.CONTENT_TYPE_PLAIN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"body plain",textContent:(0,e.toDisplayString)(s.block.body)},null,8,qo)):s.block.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,class:"body markdown",innerHTML:s.block.html},null,8,zo)):(0,e.createCommentVNode)("v-if",!0)],2112)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{rules:i.blockPreviewRules},null,8,["rules"])])],8,Fo)}]]),cs={class:"info"},ds={class:"right"},ms=(0,e.createTextVNode)(" Read "),us=(0,e.createTextVNode)(" Unread "),ps=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),hs={key:0},gs=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),ks=(0,e.createElementVNode)("i",{class:"material-icons"},"delete",-1),bs=(0,e.createTextVNode)(" posted "),fs=(0,e.createTextVNode)(" (updated "),ys=(0,e.createTextVNode)(") "),Cs={key:0},vs={key:1},ws={key:2,class:"edit-comment-area"},Vs=(0,e.createTextVNode)(" Cancel "),Bs=(0,e.createTextVNode)(" Save "),Ns=(0,e.createTextVNode)(" Delete "),Es={key:3,class:"body"},Ss={components:{Username:y,Moment:Je,LoadingMessage:yt},props:{specId:Number,comment:Object,showCommunity:Boolean,showUnreadOnly:Boolean},emits:["update-unread","open-comments","deleted"],data(){return{userRead:this.comment.userRead||!1,sendingRead:!1,editing:!1,updated:this.comment.updated,body:this.comment.body,editingBody:"",sendingEdit:!1,sendingDelete:!1}},computed:{userCanEdit(){return this.$store.getters.currentUserId===this.comment.userId},userCanDelete(){return this.userCanEdit||this.$store.getters.currentSpecOwnedByUser},disableSaveEdit(){return!this.editingBody.trim()||this.sendingEdit},unreadCount(){return this.comment.unreadCount||0},commentsCount(){return this.comment.commentsCount||0}},watch:{editing(e){e&&this.$nextTick((()=>{this.$refs.editCommentInput&&z()("textarea",this.$refs.editCommentInput.$el).focus()}))}},methods:{setUserRead(e){this.sendingRead=!0,function(e,t,o,s){return z().post("/ajax/spec/community/mark-read",{specId:e,targetType:"comment",targetId:o,read:s}).fail(W)}(this.specId,0,this.comment.id,e).then((()=>{this.sendingRead=!1,this.userRead=e,this.$emit("update-unread",e?-1:1)})).fail((()=>{this.sendingRead=!1}))},openComments(){this.$emit("open-comments",this.comment.id)},edit(){this.editingBody.trim()||(this.editingBody=this.body),this.editing=!0},cancelEdit(){this.editing=!1},saveEdit(){var e,t,o;this.disableSaveEdit||(this.sendingEdit=!0,(e=this.specId,t=this.comment.id,o=this.editingBody,z().post("/ajax/spec/community/update-comment",{specId:e,commentId:t,body:o}).fail(W)).then((e=>{this.sendingEdit=!1,this.editing=!1,this.updated=e.updated,this.body=e.body,this.editingBody=""})).fail((()=>{this.sendingEdit=!1})))},promptDelete(){this.$confirm("Permanently delete this comment?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e,t;this.sendingDelete=!0,(e=this.specId,t=this.comment.id,z().post("/ajax/spec/community/delete-comment",{specId:e,commentId:t}).fail(W)).then((()=>{this.sendingDelete=!1,this.$emit("deleted",this.comment.id)})).fail((()=>{this.sendingDelete=!1}))})).catch((function(){}))},isUnread(){return!this.userRead}}},xs={components:{ContextStack:Io,Moment:Je,PreviewSpec:Mo,PreviewSubspec:Ao,PreviewBlock:rs,PreviewComment:(0,f.Z)(Ss,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-checkbox"),r=(0,e.resolveComponent)("el-tag"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("username"),m=(0,e.resolveComponent)("moment"),u=(0,e.resolveComponent)("loading-message"),p=(0,e.resolveComponent)("el-input");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["spec-comment-preview community-target-preview",{community:s.showCommunity}])},[(0,e.createElementVNode)("div",cs,[(0,e.createElementVNode)("div",ds,[(0,e.createVNode)(a,{modelValue:l.userRead,disabled:l.sendingRead,onChange:i.setUserRead,size:"small"},null,8,["modelValue","disabled","onChange"]),l.userRead?((0,e.openBlock)(),(0,e.createBlock)(r,{key:0,size:"small",type:"success",onClick:o[0]||(o[0]=e=>i.setUserRead(!1))},{default:(0,e.withCtx)((()=>[ms])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,size:"small",type:"info",onClick:o[1]||(o[1]=e=>i.setUserRead(!0))},{default:(0,e.withCtx)((()=>[us])),_:1})),s.showCommunity?((0,e.openBlock)(),(0,e.createBlock)(c,{key:2,onClick:o[2]||(o[2]=e=>i.openComments()),type:i.unreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[ps,s.showUnreadOnly||i.unreadCount||i.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",hs,[s.showUnreadOnly||i.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[i.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(i.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):i.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(i.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])):(0,e.createCommentVNode)("v-if",!0),i.userCanEdit?((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,onClick:o[3]||(o[3]=e=>i.edit()),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[gs])),_:1})):i.userCanDelete?((0,e.openBlock)(),(0,e.createBlock)(c,{key:4,onClick:o[4]||(o[4]=e=>i.promptDelete()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[ks])),_:1})):(0,e.createCommentVNode)("v-if",!0)]),(0,e.createVNode)(d,{username:s.comment.username,highlight:s.comment.highlight},null,8,["username","highlight"]),bs,(0,e.createVNode)(m,{datetime:s.comment.created,offset:!0},null,8,["datetime"]),l.updated!==s.comment.created?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[fs,(0,e.createVNode)(m,{datetime:l.updated,offset:!0},null,8,["datetime"]),ys],64)):(0,e.createCommentVNode)("v-if",!0)]),l.sendingDelete?((0,e.openBlock)(),(0,e.createElementBlock)("div",Cs,[(0,e.createVNode)(u,{message:"Deleting..."})])):l.sendingEdit?((0,e.openBlock)(),(0,e.createElementBlock)("div",vs,[(0,e.createVNode)(u,{message:"Saving..."})])):l.editing?((0,e.openBlock)(),(0,e.createElementBlock)("div",ws,[(0,e.createVNode)(p,{ref:"editCommentInput",type:"textarea",modelValue:l.editingBody,"onUpdate:modelValue":o[5]||(o[5]=e=>l.editingBody=e),autosize:{minRows:2}},null,8,["modelValue"]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(c,{onClick:o[6]||(o[6]=e=>i.cancelEdit()),disabled:i.disableSaveEdit,type:"warning",size:"small"},{default:(0,e.withCtx)((()=>[Vs])),_:1},8,["disabled"]),(0,e.createVNode)(c,{onClick:o[7]||(o[7]=e=>i.saveEdit()),disabled:i.disableSaveEdit,type:"primary",size:"small"},{default:(0,e.withCtx)((()=>[Bs])),_:1},8,["disabled"]),(0,e.createVNode)(c,{onClick:o[8]||(o[8]=e=>i.promptDelete()),disabled:i.disableSaveEdit,type:"danger",size:"small"},{default:(0,e.withCtx)((()=>[Ns])),_:1},8,["disabled"])])])):((0,e.openBlock)(),(0,e.createElementBlock)("div",Es,(0,e.toDisplayString)(l.body),1))],2)}]]),LoadingMessage:yt},props:{specId:Number},emits:["play-video"],data:()=>({showing:!1,loading:!1,error:null,targetType:null,target:null,comments:[],unreadCount:0,commentsCount:0,hasMoreComments:!1,loadingPage:!1,addingComment:!1,newCommentBody:"",sendingComment:!1,onAdjustUnread:null,onAdjustComments:null,unreadOnly:!1,reloadingComments:!1}),computed:{TARGET_TYPE_SPEC:()=>ae,TARGET_TYPE_SUBSPEC:()=>re,TARGET_TYPE_BLOCK:()=>ce,TARGET_TYPE_COMMENT:()=>de,modalTitle(){switch(this.targetType){case ae:return"Spec community";case re:return"Subspec community";case ce:return"Block community";case de:return"Comment community"}return"Community space"},targetUpdated(){return this.target&&this.targetType!==de?this.target.updated:null},disablePostComment(){return!this.newCommentBody.trim()},formattedCommentsCount(){let e=this.unreadOnly?this.unreadCount:this.commentsCount;return e+(this.unreadOnly?" unread":"")+(this.targetType===de?" sub":"")+" comment"+(1!==e?"s":"")}},watch:{addingComment(e){e&&this.$nextTick((()=>{this.$refs.newCommentInput&&z()("textarea",this.$refs.newCommentInput.$el).focus().select()}))}},methods:{openCommunity(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=o,this.onAdjustComments=s,this.unreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loadCommunity(e,t),this.showing=!0},openCommunityReview(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=o,this.onAdjustComments=s,this.unreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loadCommunity(e,t,!0),this.showing=!0},loadCommunity(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.loading=!0,this.error=null,function(e,t,o,s,n){return z().get("/ajax/spec/community",{specId:e,targetType:t,targetId:o,unreadOnly:s,loadStack:n}).fail(W)}(this.specId,e,t,this.unreadOnly,o).then((s=>{switch(this.loading=!1,this.targetType=e,e){case ae:this.target=s.spec;break;case re:this.target=s.subspec;break;case ce:this.target=s.block;break;case de:this.target=s.comment}o&&s.stack&&this.$refs.contextStack.replaceStack(s.stack),this.comments=s.comments,this.unreadCount=s.unreadCount,this.commentsCount=s.commentsCount,this.hasMoreComments=s.commentsCount>s.comments.length,this.newCommentBody="";let n=this.$refs.contextStack.retrieveCachedHandlers(e,t);n&&(this.onAdjustUnread=n.onAdjustUnread,this.onAdjustComments=n.onAdjustComments)})).fail((()=>{this.loading=!1,this.error="Failed to load community.",this.$refs.contextStack.checkEmpty()&&(this.showing=!1)}))},reloadCommunity(){this.reloadingComments=!0,ut(this.specId,this.targetType,this.target.id,null,this.unreadOnly).then((e=>{this.reloadingComments=!1,this.comments=e.comments,this.unreadCount=e.unreadCount,this.commentsCount=e.commentsCount,this.hasMoreComments=e.hasMore})).fail((()=>{this.reloadingComments=!1}))},loadMoreComments(){this.loadingPage=!0;let e=this.comments[this.comments.length-1].updated;ut(this.specId,this.targetType,this.target.id,e,this.unreadOnly).then((e=>{this.loadingPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMore})).fail((()=>{this.loadingPage=!1}))},addComment(){var e,t,o,s;this.addingComment?this.disablePostComment||(this.sendingComment=!0,(e=this.specId,t=this.targetType,o=this.target.id,s=this.newCommentBody,z().post("/ajax/spec/community/add-comment",{specId:e,targetType:t,targetId:o,body:s}).fail(W)).then((e=>{this.sendingComment=!1,this.comments.unshift(e),this.adjustComments(1),this.addingComment=!1,this.newCommentBody=""})).fail((()=>{this.sendingComment=!1}))):this.addingComment=!0},cancelAddComment(){this.addingComment=!1},openComments(e){this.$refs.contextStack.pushStack(this.targetType,this.target,this.onAdjustUnread,this.onAdjustComments),this.onAdjustUnread=null,this.onAdjustComments=null,this.loadCommunity("comment",e)},adjustUnread(e){this.unreadCount+=e,this.onAdjustUnread&&this.onAdjustUnread(e)},adjustComments(e){this.commentsCount+=e,this.onAdjustComments&&this.onAdjustComments(e)},commentDeleted(e){if(this.targetType===de&&this.target.id===e){let e=this.$refs.previewComment.isUnread(),t=this.$refs.contextStack.popStack();e&&t.onAdjustUnread&&t.onAdjustUnread(-1),t.onAdjustComments&&t.onAdjustComments(-1)}else for(var t=0;t<this.comments.length;t++)if(X(this.comments[t].id,e)){let e=!this.$refs.comments[t].userRead;this.comments.splice(t,1),e&&this.adjustUnread(-1),this.adjustComments(-1);break}},contextUpdateUnread(e){let t=this.$refs.contextStack.getParentContext();t&&t.onAdjustUnread&&t.onAdjustUnread(e)},popStack(e,t,o,s){this.$refs.contextStack.cacheItemHandlers({targetType:this.targetType,target:this.target,onAdjustUnread:this.onAdjustUnread,onAdjustComments:this.onAdjustComments}),this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t)},raisePlayVideo(e){this.$emit("play-video",e)},closed(){this.targetType=null,this.target=null,this.error=null,this.addingComment=!1,this.newCommentBody="",this.onAdjustUnread=null,this.onAdjustComments=null,this.$refs.contextStack.clearStack()}}},Ts=(0,f.Z)(xs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("context-stack"),r=(0,e.resolveComponent)("loading-message"),c=(0,e.resolveComponent)("moment"),d=(0,e.resolveComponent)("preview-spec"),m=(0,e.resolveComponent)("preview-subspec"),u=(0,e.resolveComponent)("preview-block"),p=(0,e.resolveComponent)("preview-comment"),h=(0,e.resolveComponent)("el-input"),g=(0,e.resolveComponent)("el-button"),k=(0,e.resolveComponent)("el-checkbox"),b=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(b,{title:i.modalTitle,modelValue:l.showing,"onUpdate:modelValue":o[8]||(o[8]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[9]||(o[9]=e=>i.closed()),"custom-class":"spec-block-community-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",wo,[(0,e.createVNode)(g,{onClick:o[7]||(o[7]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Vo])),_:1})])])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(a,{ref:"contextStack",onPopStack:i.popStack},null,8,["onPopStack"]),l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",ao,[(0,e.createVNode)(r,{message:"Loading..."})])):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",ro,(0,e.toDisplayString)(l.error),1)):l.target?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.targetType!==i.TARGET_TYPE_COMMENT?((0,e.openBlock)(),(0,e.createElementBlock)("div",co,[mo,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:i.targetUpdated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),l.targetType===i.TARGET_TYPE_SPEC?((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,spec:l.target},null,8,["spec"])):l.targetType===i.TARGET_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(m,{key:2,subspec:l.target},null,8,["subspec"])):l.targetType===i.TARGET_TYPE_BLOCK?((0,e.openBlock)(),(0,e.createBlock)(u,{key:3,block:l.target,onPlayVideo:i.raisePlayVideo},null,8,["block","onPlayVideo"])):l.targetType===i.TARGET_TYPE_COMMENT?((0,e.openBlock)(),(0,e.createBlock)(p,{key:4,ref:"previewComment","spec-id":s.specId,comment:l.target,onDeleted:i.commentDeleted,onUpdateUnread:i.contextUpdateUnread},null,8,["spec-id","comment","onDeleted","onUpdateUnread"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",uo,[l.sendingComment?((0,e.openBlock)(),(0,e.createElementBlock)("p",po,[(0,e.createVNode)(r,{message:"Posting comment..."})])):l.addingComment?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.addingComment?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,ref:"newCommentInput",type:"textarea",modelValue:l.newCommentBody,"onUpdate:modelValue":o[0]||(o[0]=e=>l.newCommentBody=e),autosize:{minRows:2},placeholder:"Type comment here"},null,8,["modelValue"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(g,{onClick:o[1]||(o[1]=e=>i.cancelAddComment()),type:"warning"},{default:(0,e.withCtx)((()=>[ho])),_:1}),(0,e.createVNode)(g,{onClick:o[2]||(o[2]=e=>i.addComment()),disabled:i.disablePostComment,type:"primary"},{default:(0,e.withCtx)((()=>[go])),_:1},8,["disabled"])])],64)):((0,e.openBlock)(),(0,e.createBlock)(g,{key:2,onClick:o[3]||(o[3]=e=>i.addComment()),type:"primary"},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)(" Comment on this "+(0,e.toDisplayString)(l.targetType),1)])),_:1}))]),(0,e.createElementVNode)("div",ko,[(0,e.createElementVNode)("div",{class:"fill nowraptext",textContent:(0,e.toDisplayString)(i.formattedCommentsCount)},null,8,bo),(0,e.createVNode)(k,{modelValue:l.unreadOnly,"onUpdate:modelValue":o[4]||(o[4]=e=>l.unreadOnly=e),onChange:o[5]||(o[5]=e=>i.reloadCommunity())},{default:(0,e.withCtx)((()=>[fo])),_:1},8,["modelValue"])]),l.reloadingComments?((0,e.openBlock)(),(0,e.createElementBlock)("p",yo,[(0,e.createVNode)(r,{message:"Reloading..."})])):l.comments.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:6},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.comments,(t=>((0,e.openBlock)(),(0,e.createBlock)(p,{ref_for:!0,ref:"comments",key:t.id,"spec-id":s.specId,comment:t,"show-community":!0,"show-unread-only":l.unreadOnly,onOpenComments:i.openComments,onUpdateUnread:i.adjustUnread,onDeleted:i.commentDeleted},null,8,["spec-id","comment","show-unread-only","onOpenComments","onUpdateUnread","onDeleted"])))),128)),l.loadingPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",Co,[(0,e.createVNode)(r,{message:"Loading more comments..."})])):l.hasMoreComments?((0,e.openBlock)(),(0,e.createBlock)(g,{key:1,onClick:o[6]||(o[6]=e=>i.loadMoreComments())},{default:(0,e.withCtx)((()=>[vo])),_:1})):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]]),Is={key:0,class:"embed-responsive"},Ps=["src"],Rs=["src"],Us={data:()=>({vid:null,showing:!1}),methods:{show(e){let t=function(e){let t=te.exec(e);return t?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:t[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:t[1]}:null:null}(e.url);t&&(this.vid=t,this.showing=!0)},closed(){this.vid=null}}},_s=(0,f.Z)(Us,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(a,{modelValue:l.showing,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,onClosed:o[1]||(o[1]=e=>i.closed()),"custom-class":"play-video-modal"},{default:(0,e.withCtx)((()=>[l.vid?((0,e.openBlock)(),(0,e.createElementBlock)("div",Is,["youtube"===l.vid.type?((0,e.openBlock)(),(0,e.createElementBlock)("iframe",{key:0,src:"https://www.youtube.com/embed/"+l.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""},null,8,Ps)):"vimeo"===l.vid.type?((0,e.openBlock)(),(0,e.createElementBlock)("iframe",{key:1,src:"https://player.vimeo.com/video/"+l.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""},null,8,Rs)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["modelValue","width"])}]]),Ms={components:{Username:y,Moment:Je,EditSpecModal:ht,EditSubspecModal:Ht,NavSpecModal:io,CommunityModal:Ts,PlayVideoModal:_s},data:()=>({loading:!0,scrollOnRender:!0,spec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute(){return"spec"===this.$route.name},currentUserOwns(){return this.spec&&this.spec.ownerType===ke&&this.$store.getters.currentUserId===this.spec.ownerId},enableEditing(){return this.currentUserOwns},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.userSettings.community.unreadOnly}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter spec",e),o((t=>{t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave spec"),this.spec=null,this.unreadCount=0,this.commentsCount=0,J(),o()},methods:{loadSpec(e,t){console.debug("load spec"),this.loading=!0,function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return z().get("/ajax/spec",{specId:e,loadBlocks:t}).fail(W)}(e,t).then((e=>{console.debug("spec loaded",e),this.spec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,J(e.name),this.loading=!1,this.scrollOnRendered(),this.$store.commit("saveCurrentSpec",e)})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},scrollOnRendered(){this.scrollOnRender=!0},handleViewRendered(){this.scrollOnRender&&(this.scrollOnRender=!1,this.restoreScroll())},gotoSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec(){this.$refs.editSpecModal.showEdit(this.spec,(e=>{this.spec.updated=e.updated,this.spec.name=e.name,this.spec.desc=e.desc,this.spec.public=e.public,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,J(e.name)}))},openManageSubspec(e,t){this.$refs.editSubspecModal.showEdit(e,t)},openSpecCommunity(){this.$refs.communityModal.openCommunity(ae,this.spec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,o,s){this.$refs.communityModal.openCommunity(e,t,o,s)},playVideo(e){this.$refs.playVideoModal.show(e)},promptNavSpec(){this.$refs.navSpecModal.show()},openCreateSubspec(){this.$refs.editSubspecModal.showCreate((e=>{this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:e}})}))},restoreScroll(){if(this.onSpecRoute){let e=this.$store.state.savedScrollPosition;e?(console.debug("restoreScroll spec"),z()(window).scrollTop(e.top).scrollLeft(e.left)):X(this.$store.getters.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),z()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},Os=(0,f.Z)(Ms,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("username"),r=(0,e.resolveComponent)("el-tooltip"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("moment"),m=(0,e.resolveComponent)("router-view"),u=(0,e.resolveComponent)("edit-spec-modal"),p=(0,e.resolveComponent)("edit-subspec-modal"),h=(0,e.resolveComponent)("nav-spec-modal"),g=(0,e.resolveComponent)("community-modal"),k=(0,e.resolveComponent)("play-video-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("section",wt,[l.spec?((0,e.openBlock)(),(0,e.createElementBlock)("header",Vt,[l.loading?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createElementBlock)("div",Bt,[i.currentUserOwns?((0,e.openBlock)(),(0,e.createElementBlock)("span",Nt,"You own this")):((0,e.openBlock)(),(0,e.createElementBlock)("span",Et,[St,l.spec.username?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,username:l.spec.username,highlight:l.spec.highlight},null,8,["username","highlight"])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.spec.ownerType)+" "+(0,e.toDisplayString)(l.spec.ownerId),1)],2112))])),i.onSpecRoute?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.spec.public?((0,e.openBlock)(),(0,e.createElementBlock)("span",xt," Public ")):((0,e.openBlock)(),(0,e.createElementBlock)("span",Tt,[(0,e.createVNode)(r,{content:"Unpublished",placement:"left"},{default:(0,e.withCtx)((()=>[It])),_:1})])),(0,e.createVNode)(c,{onClick:o[0]||(o[0]=e=>i.openSpecCommunity()),type:l.unreadCount?"primary":"default",disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Pt,i.showUnreadOnly||l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type","disabled"]),(0,e.createVNode)(c,{onClick:o[1]||(o[1]=e=>i.openManageSpec()),disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Rt])),_:1},8,["disabled"])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("span",null,[Ut,(0,e.createVNode)(d,{datetime:l.spec.updated,offset:!0},null,8,["datetime"])]),(0,e.createVNode)(c,{onClick:o[2]||(o[2]=e=>i.openSpecCommunity()),type:l.unreadCount?"primary":"default"},{default:(0,e.withCtx)((()=>[_t,i.showUnreadOnly||l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])],64))],2112)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{onClick:o[3]||(o[3]=e=>i.promptNavSpec())},{default:(0,e.withCtx)((()=>[Mt])),_:1})])),(0,e.createElementVNode)("h2",{onClick:o[4]||(o[4]=e=>i.gotoSpec()),class:"name"},(0,e.toDisplayString)(l.spec.name),1),l.spec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ot,(0,e.toDisplayString)(l.spec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(m,null,{default:(0,e.withCtx)((t=>{let{Component:o}=t;return[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(o),{loading:l.loading,spec:l.spec,"enable-editing":i.enableEditing,onRendered:i.handleViewRendered,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onOpenManageSubspec:i.openManageSubspec},null,8,["loading","spec","enable-editing","onRendered","onPromptNavSpec","onOpenCommunity","onPlayVideo","onOpenManageSubspec"]))]})),_:1}),i.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(u,{key:1,ref:"editSpecModal"},null,512)):(0,e.createCommentVNode)("v-if",!0),i.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(p,{key:2,ref:"editSubspecModal","spec-id":i.specId},null,8,["spec-id"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(h,{ref:"navSpecModal","spec-id":i.specId,"subspec-id":i.subspecId,onOpenCreateSubspec:o[5]||(o[5]=e=>i.openCreateSubspec())},null,8,["spec-id","subspec-id"]),(0,e.createVNode)(g,{ref:"communityModal","spec-id":i.specId,onPlayVideo:i.playVideo},null,8,["spec-id","onPlayVideo"]),(0,e.createVNode)(k,{ref:"playVideoModal"},null,512)])}]]),$s={key:0},js={key:0,class:"spec-view"},Ds=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),As=(0,e.createElementVNode)("span",null,"Move block here",-1),Fs=(0,e.createTextVNode)(" Add block "),Ls={ref:"mirrorList",class:"mirror-list"},qs=["data-spec-block"],zs=(0,e.createElementVNode)("div",{class:"bg"},null,-1),Ys=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Hs=(0,e.createElementVNode)("i",{class:"material-icons"},"more_horiz",-1),Zs=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),Ws=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),Ks=(0,e.createElementVNode)("i",{class:"material-icons"},"south_east",-1),Gs=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_downward",-1),Xs=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),Qs=(0,e.createTextVNode)("Cancel"),Js=(0,e.createTextVNode)("Cancel move"),en=(0,e.createElementVNode)("i",{class:"material-icons"},"input",-1),tn=(0,e.createTextVNode)("Context"),on=(0,e.createTextVNode)("Change context"),sn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),nn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),ln=(0,e.createElementVNode)("i",{class:"material-icons"},"south_east",-1),an=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_downward",-1),rn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),cn={key:0},dn=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),mn=(0,e.createElementVNode)("i",{class:"material-icons"},"delete",-1),un=(0,e.createElementVNode)("i",{class:"material-icons"},"add",-1),pn=(0,e.createElementVNode)("i",{class:"material-icons"},"drag_handle",-1),hn={key:1,class:"visitor-actions"},gn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),kn={key:0,class:"layover parent-moving-layover"},bn={key:1,class:"title"},fn=["textContent"],yn=["innerHTML"],Cn="highlight",vn="dragula";let wn={};function Vn(e){let t=[];for(var o=0;o<e.length;o++){let s=e[o];if(/\.js$/.test(s.src)){let e=document.createElement("script");e.type="text/javascript",e.crossOrigin="anonymous",s.integrity&&(e.integrity=s.integrity);let o=z().Deferred();e.addEventListener("load",(function(){o.resolve()})),e.addEventListener("error",(function(){o.reject()})),t.push(o),e.src=s.src,document.body.appendChild(e)}else if(/\.css$/.test(s.src)){let e=document.createElement("link");e.rel="stylesheet",e.crossOrigin="anonymous",s.integrity&&(e.integrity=s.integrity);let o=z().Deferred();e.addEventListener("load",(function(){o.resolve()})),e.addEventListener("error",(function(){o.reject()})),t.push(o),e.href=s.src,document.body.appendChild(e)}}return z().when.apply(z(),t)}function Bn(e){if(wn[e])return wn[e];switch(e){case Cn:return wn[e]=Vn([{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/default.min.css",integrity:"sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js",integrity:"sha512-zol3kFQ5tnYhL7PzGt0LnllHHVWRGt2bTCIywDiScVvLIlaDOVJ6sPdJTVi0m3rA660RT+yZxkkRzMbb1L8Zkw=="}]).then((function(){return console.debug("highlight.js loaded"),window.hljs})).fail((function(){W("Failed to load highlight.js code highlighting library")}));case vn:return wn[e]=Vn([{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.css",integrity:"sha512-zlYhSecphd+kwRzeCOyj7/u3HZIQ3Q0NP7AN7ZEKhYTdi0AQOGGbc7eA3I/mUffqjdr8G1/9xoS478h+I0MQGg=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js",integrity:"sha512-NgXVRE+Mxxf647SqmbB9wPS5SEpWiLFp5G7ItUNFi+GVUyQeP+7w4vnKtc2O/Dm74TpTFKXNjakd40pfSKNulg=="}]).then((function(){return console.debug("dragula.js loaded"),window.dragula})).fail((function(){W("Failed to load dragula.js drag and drop library")}))}}const Nn={components:{RefUrl:ts,RefSubspec:no},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,renderedHtml:this.block.html,refItem:this.block.refItem,unreadCount:this.block.unreadCount||0,commentsCount:this.block.commentsCount||0,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{CONTENT_TYPE_PLAIN:()=>ue,CONTENT_TYPE_MARKDOWN:()=>pe,REF_TYPE_URL:()=>he,REF_TYPE_SUBSPEC:()=>ge,showDeleteButton(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle(){return!(!this.title||!this.title.trim())},hasBody(){return!!(this.body&&this.body.trim()||this.renderedHtml&&this.renderedHtml.trim())},hasRefItem(){return!(!this.refType||!this.refItem)},refItemMissing(){return!!this.refType&&!this.refItem},classes(){return{[this.styleType]:!0,"title-only":this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks,"ref-item-only":this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks}},currentlyMovingBlocks(){return this.$store.getters.currentlyMovingBlocks},movingThis(){return this.$store.getters.currentlyMovingBlock(this.block.id)},movingOtherBlocks(){return this.currentlyMovingBlocks&&!this.movingThis},showAddToMoving(){return this.movingOtherBlocks&&X(this.$store.state.movingBlocksSourceSubspecId,this.subspecId)},showActions(){return this.focusActions||this.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.userSettings.community.unreadOnly},clearRef(){return!!this.unreadCount},mobileAdjust(){return this.showActions||!!this.unreadCount||!this.showUnreadOnly&&!!this.commentsCount}},watch:{renderedHtml(){this.addCodeHighlighting()}},mounted(){this.eventBus.on("url-updated",this.urlUpdated),this.eventBus.on("url-deleted",this.urlDeleted),this.addCodeHighlighting()},beforeDestroy(){this.eventBus.off("url-updated",this.urlUpdated),this.eventBus.off("url-deleted",this.urlDeleted)},methods:{getBlockId(){return this.block.id},getStyleType(){return this.styleType},addCodeHighlighting(){this.contentType===pe&&this.renderedHtml&&this.$nextTick((()=>{let e=z()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&Bn(Cn).then((t=>{e.each(((e,o)=>{t.highlightBlock(o)}))}))}))},getParentId(){let e=z()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId(){let e=z()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock(){this.raiseOpenEdit(this.block.id,(e=>{this.updated=e.updated,this.styleType=e.styleType,this.contentType=e.contentType,this.refType=e.refType,this.refId=e.refId,this.refItem=e.refItem,this.title=e.title,this.body=e.body,this.renderedHtml=e.html,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0}))},raiseOpenEdit(e,t){this.eventBus.emit("open-edit",{blockId:e,callback:t})},promptDeleteBlock(){this.eventBus.emit("prompt-delete",this.block.id)},enterChooseAddPosition(){this.choosingAddPosition=!0},cancelChooseAddPosition(){this.choosingAddPosition=!1},addBeforeThis(){let e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t,this.styleType)},addIntoThis(){let e=this.block.id;this.raisePromptAddSubblock(e,null,!0)},addAfterThis(){let e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t,this.styleType)},raisePromptAddSubblock(e,t,o){this.eventBus.emit("prompt-add-subblock",{parentId:e,insertBeforeId:t,defaultStyleType:o})},startMoving(){this.eventBus.emit("start-moving",this.block.id),this.focusActions=!1},addThisToMovingBlocks(){this.eventBus.emit("add-to-moving",this.block.id)},removeThisFromMovingBlocks(){this.eventBus.emit("remove-from-moving",this.block.id)},promptNavSpec(){this.eventBus.emit("prompt-nav-spec")},cancelMoving(){this.eventBus.emit("cancel-moving",this.block.id)},moveBeforeThis(){this.eventBus.emit("move-before",this.block.id)},moveIntoThis(){this.eventBus.emit("move-into",this.block.id)},moveAfterThis(){this.eventBus.emit("move-after",this.block.id)},mouseLeaveLayover(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated(e){this.refType===he&&e.id===this.refId&&(this.refItem=e)},urlDeleted(e){this.refType===he&&e===this.refId&&(this.refItem=null)},raisePlayVideo(e){this.eventBus.emit("play-video",e)},openCommunity(){this.eventBus.emit("open-community",{blockId:this.block.id,onAdjustUnread:e=>{this.unreadCount+=e},onAdjustComments:e=>{this.commentsCount+=e}})},updateHasSubblocks(){this.hasSubblocks=this.$refs.sublist.childElementCount>0},touchstart(e){this.lastTouchStartTime=Date.now()},selectstart(e){this.lastTouchStartTime&&Date.now()-this.lastTouchStartTime<200&&(e.preventDefault(),e.stopPropagation())}}},En=(0,f.Z)(Nn,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("el-checkbox"),c=(0,e.resolveComponent)("ref-url"),d=(0,e.resolveComponent)("ref-subspec"),m=(0,e.resolveComponent)("el-alert");return(0,e.openBlock)(),(0,e.createElementBlock)("li",{"data-spec-block":s.block.id,class:(0,e.normalizeClass)(["spec-block",i.classes]),onTouchstart:o[23]||(o[23]=function(){return i.touchstart&&i.touchstart(...arguments)}),onSelectstart:o[24]||(o[24]=function(){return i.selectstart&&i.selectstart(...arguments)})},[(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["content",{"clear-ref":i.clearRef,"mobile-adjust":i.mobileAdjust}])},[zs,(0,e.createElementVNode)("div",{class:"layover",onMouseleave:o[21]||(o[21]=e=>i.mouseLeaveLayover())},[s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["expand-control",{hide:i.showActions}])},[(0,e.createCommentVNode)(" only show community button to admins in collapsed mobile menu when there are unread submissions "),(0,e.createCommentVNode)(" always show community button to guests, who only make community interactions "),i.showUnreadOnly&&l.unreadCount?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>i.openCommunity()),type:"primary",size:"small",round:""},{default:(0,e.withCtx)((()=>[Ys,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(l.unreadCount)+" unread",1)])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{onClick:o[1]||(o[1]=e=>l.focusActions=!0),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Hs])),_:1})],2),(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["actions",{show:i.showActions}])},[l.choosingAddPosition?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{onClick:o[2]||(o[2]=e=>i.cancelChooseAddPosition()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Zs])),_:1}),(0,e.createVNode)(a,{onClick:o[3]||(o[3]=e=>i.addBeforeThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Ws])),_:1}),(0,e.createVNode)(a,{onClick:o[4]||(o[4]=e=>i.addIntoThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Ks])),_:1}),(0,e.createVNode)(a,{onClick:o[5]||(o[5]=e=>i.addAfterThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Gs])),_:1})],64)):i.movingThis?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(a,{onClick:o[6]||(o[6]=e=>i.cancelMoving()),type:"warning",size:"small"},{default:(0,e.withCtx)((()=>[Xs,(0,e.createElementVNode)("span",null,[t.$store.getters.mobileViewport?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[Qs],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[Js],2112))])])),_:1}),(0,e.createVNode)(a,{onClick:o[7]||(o[7]=e=>i.promptNavSpec()),size:"small"},{default:(0,e.withCtx)((()=>[en,(0,e.createElementVNode)("span",null,[t.$store.getters.mobileViewport?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[tn],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[on],2112))])])),_:1}),(0,e.createVNode)(r,{key:"removeFromMoving","data-moving-block-id":s.block.id,modelValue:!0,onClick:o[8]||(o[8]=e=>i.removeThisFromMovingBlocks())},null,8,["data-moving-block-id"])],64)):i.movingOtherBlocks?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[(0,e.createVNode)(a,{onClick:o[9]||(o[9]=e=>i.cancelMoving()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[sn])),_:1}),(0,e.createVNode)(a,{onClick:o[10]||(o[10]=e=>i.moveBeforeThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[nn])),_:1}),(0,e.createVNode)(a,{onClick:o[11]||(o[11]=e=>i.moveIntoThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[ln])),_:1}),(0,e.createVNode)(a,{onClick:o[12]||(o[12]=e=>i.moveAfterThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[an])),_:1}),i.showAddToMoving?((0,e.openBlock)(),(0,e.createBlock)(r,{key:"addToMoving",modelValue:!1,onClick:o[13]||(o[13]=e=>i.addThisToMovingBlocks())})):(0,e.createCommentVNode)("v-if",!0)],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:3},[(0,e.createVNode)(a,{onClick:o[14]||(o[14]=e=>i.openCommunity()),type:l.unreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[rn,i.showUnreadOnly||l.unreadCount||l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",cn,[i.showUnreadOnly||l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"]),(0,e.createVNode)(a,{onClick:o[15]||(o[15]=e=>i.editBlock()),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[dn])),_:1}),i.showDeleteButton?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[16]||(o[16]=e=>i.promptDeleteBlock()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[mn])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{onClick:o[17]||(o[17]=e=>i.enterChooseAddPosition()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[un])),_:1}),(0,e.createVNode)(a,{onClick:o[18]||(o[18]=e=>i.startMoving()),class:"move-action",type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[pn])),_:1}),(0,e.createElementVNode)("i",{onClick:o[19]||(o[19]=e=>i.startMoving()),class:"material-icons drag-handle"},"drag_handle")],64))],2)],64)):((0,e.openBlock)(),(0,e.createElementBlock)("div",hn,[(0,e.createVNode)(a,{onClick:o[20]||(o[20]=e=>i.openCommunity()),type:l.unreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[gn,(0,e.createElementVNode)("span",null,[i.showUnreadOnly||l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])])),_:1},8,["type"])]))],32),i.currentlyMovingBlocks?((0,e.openBlock)(),(0,e.createElementBlock)("div",kn,[(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{modelValue:!0,disabled:""})])])):(0,e.createCommentVNode)("v-if",!0),i.hasTitle?((0,e.openBlock)(),(0,e.createElementBlock)("div",bn,(0,e.toDisplayString)(l.title),1)):(0,e.createCommentVNode)("v-if",!0),i.hasRefItem?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,item:l.refItem,class:"ref-item",onPlay:o[22]||(o[22]=e=>i.raisePlayVideo(l.refItem))},null,8,["item"])):l.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,item:l.refItem,class:"ref-item"},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],2112)):i.refItemMissing?((0,e.openBlock)(),(0,e.createBlock)(m,{key:3,title:"Content unavailable",closable:!1,type:"warning"})):(0,e.createCommentVNode)("v-if",!0),i.hasBody?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:4},[l.contentType===i.CONTENT_TYPE_PLAIN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"body plain",textContent:(0,e.toDisplayString)(l.body)},null,8,fn)):l.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,ref:"renderedHtml",class:"body markdown",innerHTML:l.renderedHtml},null,8,yn)):(0,e.createCommentVNode)("v-if",!0)],2112)):(0,e.createCommentVNode)("v-if",!0)],2),(0,e.createElementVNode)("ul",{ref:"sublist",class:(0,e.normalizeClass)(["spec-block-list",{moving:i.movingThis}])},[(0,e.createCommentVNode)(" managed programatically ")],2)],42,qs)}]]),Sn={key:0},xn={key:1},Tn={key:0},In=(0,e.createTextVNode)(" Created "),Pn=(0,e.createTextVNode)("; last modified "),Rn={class:"field"},Un=(0,e.createTextVNode)("Bullet point"),_n=(0,e.createTextVNode)("Numbered point"),Mn=(0,e.createTextVNode)("Indented block"),On=(0,e.createElementVNode)("div",null,"Title",-1),$n={class:"field"},jn=(0,e.createTextVNode)("No media"),Dn=(0,e.createTextVNode)("Subspec"),An=(0,e.createTextVNode)("URL"),Fn={class:"field"},Ln=(0,e.createTextVNode)("Plain text"),qn=(0,e.createTextVNode)("Markdown"),zn={key:0,class:"split-even"},Yn=(0,e.createElementVNode)("div",null,"Body",-1),Hn=(0,e.createElementVNode)("div",null,"Preview",-1),Zn={key:0,class:"error"},Wn=["innerHTML"],Kn={key:1},Gn=(0,e.createElementVNode)("div",null,"Body",-1),Xn={key:0,class:"dialog-footer"},Qn=(0,e.createTextVNode)("Close"),Jn={key:1,class:"dialog-footer"},el=(0,e.createTextVNode)("Cancel"),tl=(0,e.createTextVNode)("Delete"),ol={class:"ref-form"},sl={key:0},nl={key:1},ll=(0,e.createElementVNode)("div",null,"New link URL",-1),il=(0,e.createTextVNode)(" Create "),al=(0,e.createTextVNode)(" Select an existing link "),rl=(0,e.createTextVNode)(" Cancel "),cl={key:0},dl={key:"url-select-actions"},ml=(0,e.createTextVNode)(" Create new link "),ul=(0,e.createTextVNode)(" Cancel "),pl={key:"url-keep-actions"},hl=(0,e.createTextVNode)(" Create new link "),gl=(0,e.createTextVNode)(" Select a different link "),kl={key:0},bl=(0,e.createElementVNode)("div",null,"New subspec name",-1),fl=(0,e.createElementVNode)("div",null,"Description",-1),yl=(0,e.createTextVNode)(" Create "),Cl=(0,e.createTextVNode)(" Select an existing subspec "),vl=(0,e.createTextVNode)(" Cancel "),wl={key:0},Vl={key:"subspec-select-actions"},Bl=(0,e.createTextVNode)(" Create new subspec "),Nl=(0,e.createTextVNode)(" Cancel "),El={key:"subspec-keep-actions"},Sl=(0,e.createTextVNode)(" Create new subspec "),xl=(0,e.createTextVNode)(" Select a different subspec "),Tl="keep",Il="create",Pl="select",Rl={components:{RefUrl:ts,RefSubspec:no,LoadingMessage:yt},props:{specId:{type:Number,required:!0},refType:String,existingRefType:String,existingRefItem:Object,valid:Boolean,fields:Object},emits:["update:valid","update:fields","open-edit-url","play-video"],data(){return{newUrl:"",urlId:this.existingRefType===he&&this.existingRefItem&&this.existingRefItem.id||null,urlFilter:"",urlMode:this.existingRefType===he&&this.existingRefItem?Tl:Il,urlObjects:null,urlObjectsLoaded:!1,loadingUrlObjects:!1,creatingUrlObject:!1,newSubspecName:"",newSubspecDesc:"",subspecId:this.existingRefType===ge&&this.existingRefItem&&this.existingRefItem.id||null,subspecFilter:"",subspecMode:this.existingRefType===ge&&this.existingRefItem?Tl:Il,subspecs:null,subspecsLoaded:!1,loadingSubspecs:!1,creatingSubspec:!1}},computed:{REF_TYPE_URL:()=>he,REF_TYPE_SUBSPEC:()=>ge,MODE_KEEP:()=>Tl,MODE_CREATE:()=>Il,MODE_SELECT:()=>Pl,initialUrlObject(){return this.existingRefType===he&&this.existingRefItem},urlSelectModeAvailable(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},filteredUrlObjects(){if(this.urlFilter&&this.urlObjects){let t=this.urlFilter.toLowerCase(),o=[];for(var e=0;e<this.urlObjects.length;e++){let s=this.urlObjects[e];(s.url.toLowerCase().indexOf(t)>=0||s.title&&s.title.toLowerCase().indexOf(t)>=0)&&o.push(s)}return o}return this.urlObjects},selectedUrlObject(){if(this.urlObjects&&this.urlId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.urlId)return this.urlObjects[e];return null},newUrlIsVideo(){return ee(this.newUrl)&&oe(this.newUrl)},disableCreateUrl(){return!ee(this.newUrl)||this.creatingUrlObject},urlMaxLength:()=>window.const.urlMaxLength,initialSubspec(){return this.existingRefType===ge&&this.existingRefItem},subspecSelectModeAvailable(){return null===this.subspecs||this.subspecs.length>1||this.subspecs.length&&!this.initialSubspec||1===this.subspecs.length&&this.subspecs[0].id!==this.initialSubspec.id},filteredSubspecs(){if(this.subspecFilter&&this.subspecs){let t=this.subspecFilter.toLowerCase(),o=[];for(var e=0;e<this.subspecs.length;e++){let s=this.subspecs[e];(s.name.toLowerCase().indexOf(t)>=0||s.desc&&s.desc.toLowerCase().indexOf(t)>=0)&&o.push(s)}return o}return this.subspecs},selectedSubspec(){if(this.subspecs&&this.subspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.subspecId)return this.subspecs[e];return null},disableCreateSubspec(){return!this.newSubspecName.trim()||this.creatingSubspec},subspecNameMaxLength:()=>window.const.specNameMaxLength,isValid(){switch(this.refType){case he:switch(this.urlMode){case Tl:return!!this.initialUrlObject;case Il:return ee(this.newUrl);case Pl:return!!this.urlId}break;case ge:switch(this.subspecMode){case Tl:return!!this.initialSubspec;case Il:return!!this.newSubspecName.trim();case Pl:return!!this.subspecId}}return!1},refFields(){switch(this.refType){case he:switch(this.urlMode){case Tl:return this.initialUrlObject?{refId:this.initialUrlObject.id}:null;case Il:return{refUrl:this.newUrl};case Pl:return{refId:this.urlId}}break;case ge:switch(this.subspecMode){case Tl:return this.initialSubspec?{refId:this.initialSubspec.id}:null;case Il:return{refName:this.newSubspecName,refDesc:this.newSubspecDesc};case Pl:return{refId:this.subspecId}}}return null}},watch:{urlMode(e){e!==Pl||this.urlObjectsLoaded||this.loadUrlObjects()},subspecMode(e){e!==Pl||this.subspecsLoaded||this.loadSubspecs()},isValid:{immediate:!0,handler(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,deep:!0,handler(e){this.$emit("update:fields",e)}}},methods:{loadUrlObjects(){var e;this.loadingUrlObjects||(this.loadingUrlObjects=!0,(e=this.specId,z().get("/ajax/spec/urls",{specId:e}).fail(W)).then((e=>{this.urlObjects=e,e.length||(this.urlMode=Il,G("No URLs available.")),this.urlObjectsLoaded=!0,this.loadingUrlObjects=!1})).fail((()=>{this.urlObjects||(this.initialUrlObject?this.urlMode=Tl:this.urlMode=Il),this.urlObjectsLoaded=!0,this.loadingUrlObjects=!1})))},filterUrlObjects(e){e?(this.debouncedFilterURLs||(this.debouncedFilterURLs=Q((e=>{this.urlFilter=e}))),this.debouncedFilterURLs(e)):this.urlFilter=""},openEditUrl(e){this.$emit("open-edit-url",e,(t=>{if(this.urlObjects)for(var o=0;o<this.urlObjects.length;o++)if(this.urlObjects[o].id===e.id){this.urlObjects.splice(o,1,t);break}}),(()=>{if(this.urlObjects)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects.splice(t,1);break}this.urlId===e.id&&(this.urlId=null)}))},raisePlayVideo(e){this.$emit("play-video",e)},createUrl(){this.creatingUrlObject=!0,mt(this.specId,this.newUrl).then((e=>{if(this.urlId=e.id,this.urlMode=Pl,this.newUrl="",this.creatingUrlObject=!1,this.urlObjects){for(let t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id)return;this.urlObjects.push(e)}else this.urlObjects=[e];K("URL created.")})).fail((()=>{this.creatingUrlObject=!1}))},loadSubspecs(){var e;this.loadingSubspecs||(this.loadingSubspecs=!0,(e=this.specId,z().get("/ajax/spec/subspecs",{specId:e}).fail(W)).then((e=>{this.subspecs=e,e.length||(this.subspecMode=Il,G("No subspecs available.")),this.subspecsLoaded=!0,this.loadingSubspecs=!1})).fail((()=>{this.subspecs||(this.initialSubspec?this.subspecMode=Tl:this.subspecMode=Il),this.subspecsLoaded=!0,this.loadingSubspecs=!1})))},createSubspec(){this.creatingSubspec=!0,ct(this.specId,this.newSubspecName,this.newSubspecDesc).then((e=>{this.subspecId=e.id,this.subspecMode=Pl,this.newSubspecName="",this.newSubspecDesc="",this.creatingSubspec=!1,this.subspecs?this.subspecs.push(e):this.subspecs=[e],K("Subspec created.")})).fail((()=>{this.creatingSubspec=!1}))},urlUpdated(e){if(this.urlObjects)for(let t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects[t]=e;break}}}},Ul={components:{Moment:Je,RefForm:(0,f.Z)(Rl,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-alert"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-card"),u=(0,e.resolveComponent)("el-option"),p=(0,e.resolveComponent)("el-select"),h=(0,e.resolveComponent)("ref-url"),g=(0,e.resolveComponent)("ref-subspec");return(0,e.openBlock)(),(0,e.createElementBlock)("div",ol,[s.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.urlMode===i.MODE_CREATE?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0},{default:(0,e.withCtx)((()=>[l.creatingUrlObject?((0,e.openBlock)(),(0,e.createElementBlock)("p",sl,[(0,e.createVNode)(a,{message:"Creating..."})])):((0,e.openBlock)(),(0,e.createElementBlock)("label",nl,[ll,(0,e.createVNode)(r,{modelValue:l.newUrl,"onUpdate:modelValue":o[0]||(o[0]=e=>l.newUrl=e),maxlength:i.urlMaxLength,clearable:""},null,8,["modelValue","maxlength"]),l.newUrl&&!i.isValid?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,title:"Invalid URL",type:"error",closable:!1})):i.newUrlIsVideo?((0,e.openBlock)(),(0,e.createBlock)(c,{key:1,title:"Embeddable video detected",type:"info",closable:!1})):(0,e.createCommentVNode)("v-if",!0)])),(0,e.createVNode)(d,{onClick:o[1]||(o[1]=e=>i.createUrl()),disabled:i.disableCreateUrl,type:"primary"},{default:(0,e.withCtx)((()=>[il])),_:1},8,["disabled"]),i.urlSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:2,onClick:o[2]||(o[2]=e=>l.urlMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[al])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:3,onClick:o[3]||(o[3]=e=>l.urlMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[rl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1})):l.urlMode===i.MODE_SELECT?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.loadingUrlObjects?((0,e.openBlock)(),(0,e.createElementBlock)("p",cl,[(0,e.createVNode)(a,{message:"Loading links..."})])):l.urlObjects&&l.urlObjects.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(p,{modelValue:l.urlId,"onUpdate:modelValue":o[4]||(o[4]=e=>l.urlId=e),filterable:"","filter-method":i.filterUrlObjects,placeholder:"Select link"},{default:(0,e.withCtx)((()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(i.filteredUrlObjects,(t=>((0,e.openBlock)(),(0,e.createBlock)(u,{key:t.id,value:t.id,label:t.title||t.url},null,8,["value","label"])))),128))])),_:1},8,["modelValue","filter-method"]),i.selectedUrlObject?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,item:i.selectedUrlObject,"show-edit":"",onEdit:o[5]||(o[5]=e=>i.openEditUrl(i.selectedUrlObject)),onPlay:o[6]||(o[6]=e=>i.raisePlayVideo(i.selectedUrlObject))},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",dl,[(0,e.createVNode)(d,{onClick:o[7]||(o[7]=e=>l.urlMode=i.MODE_CREATE)},{default:(0,e.withCtx)((()=>[ml])),_:1}),i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[8]||(o[8]=e=>l.urlMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[ul])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,item:i.initialUrlObject,"show-edit":"",onEdit:o[9]||(o[9]=e=>i.openEditUrl(i.initialUrlObject)),onPlay:o[10]||(o[10]=e=>i.raisePlayVideo(i.initialUrlObject))},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",pl,[(0,e.createVNode)(d,{onClick:o[11]||(o[11]=e=>l.urlMode=i.MODE_CREATE)},{default:(0,e.withCtx)((()=>[hl])),_:1}),i.urlSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[12]||(o[12]=e=>l.urlMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[gl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64))],2112)):s.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.subspecMode===i.MODE_CREATE?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0},{default:(0,e.withCtx)((()=>[l.creatingSubspec?((0,e.openBlock)(),(0,e.createElementBlock)("p",kl,[(0,e.createVNode)(a,{message:"Creating..."})])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("label",null,[bl,(0,e.createVNode)(r,{ref:"newSubspecNameInput",modelValue:l.newSubspecName,"onUpdate:modelValue":o[13]||(o[13]=e=>l.newSubspecName=e),maxlength:i.subspecNameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[fl,(0,e.createVNode)(r,{type:"textarea",modelValue:l.newSubspecDesc,"onUpdate:modelValue":o[14]||(o[14]=e=>l.newSubspecDesc=e),autosize:{minRows:2}},null,8,["modelValue"])])],64)),(0,e.createVNode)(d,{onClick:o[15]||(o[15]=e=>i.createSubspec()),disabled:i.disableCreateSubspec,type:"primary"},{default:(0,e.withCtx)((()=>[yl])),_:1},8,["disabled"]),i.subspecSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:2,onClick:o[16]||(o[16]=e=>l.subspecMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Cl])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:3,onClick:o[17]||(o[17]=e=>l.subspecMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[vl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1})):l.subspecMode===i.MODE_SELECT?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.loadingSubspecs?((0,e.openBlock)(),(0,e.createElementBlock)("p",wl,[(0,e.createVNode)(a,{message:"Loading subspecs..."})])):l.subspecs&&l.subspecs.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(p,{modelValue:l.subspecId,"onUpdate:modelValue":o[18]||(o[18]=e=>l.subspecId=e),filterable:"",placeholder:"Select subspec"},{default:(0,e.withCtx)((()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.subspecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(u,{key:t.id,value:t.id,label:t.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),i.selectedSubspec?((0,e.openBlock)(),(0,e.createBlock)(g,{key:0,item:i.selectedSubspec},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Vl,[(0,e.createVNode)(d,{onClick:o[19]||(o[19]=e=>l.subspecMode=i.MODE_CREATE),size:"small"},{default:(0,e.withCtx)((()=>[Bl])),_:1}),i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[20]||(o[20]=e=>l.subspecMode=i.MODE_KEEP),size:"small"},{default:(0,e.withCtx)((()=>[Nl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(g,{key:0,item:i.initialSubspec},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",El,[(0,e.createVNode)(d,{onClick:o[21]||(o[21]=e=>l.subspecMode=i.MODE_CREATE),size:"small"},{default:(0,e.withCtx)((()=>[Sl])),_:1}),i.subspecSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[22]||(o[22]=e=>l.subspecMode=i.MODE_SELECT),size:"small"},{default:(0,e.withCtx)((()=>[xl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64))],2112)):(0,e.createCommentVNode)("v-if",!0)])}]]),LoadingMessage:yt},props:{specId:{type:Number,required:!0},subspecId:Number},emits:["open-edit-url","play-video","prompt-delete"],data:()=>({styleType:me,contentType:ue,title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,loading:!1,error:null,loadingPreview:!1,previewHtml:"",previewError:null}),computed:{STYLE_TYPE_NONE:()=>"none",STYLE_TYPE_BULLET:()=>me,STYLE_TYPE_NUMBERED:()=>"numbered",CONTENT_TYPE_PLAIN:()=>ue,CONTENT_TYPE_MARKDOWN:()=>pe,REF_TYPE_URL:()=>he,REF_TYPE_SUBSPEC:()=>ge,titleMaxLength:()=>window.const.blockTitleMaxLength,existingRefType(){return this.block&&this.block.refType},existingRefItem(){return this.block&&this.block.refType&&this.block.refItem||null},initialUrlObject(){return this.existingRefType===he&&this.existingRefItem}},watch:{body(){this.renderMarkdownPreview()},contentType(){this.renderMarkdownPreview()},previewHtml(e){this.addCodeHighlighting()}},methods:{showAddBlock(e,t,o,s){if(!0===o)if(t){let e=z()('[data-spec-block="'+t+'"]',".spec-view"),s=e.prev("[data-spec-block]");o=s.length?s.data("vc").getStyleType():e.data("vc").getStyleType()}else if(e){let t=z()('[data-spec-block="'+e+'"]',".spec-view"),s=z()(">ul>[data-spec-block]:last-child",t);s.length&&(o=s.data("vc").getStyleType())}else{let e=z()(">ul>[data-spec-block]:last-child",".spec-view");e.length&&(o=e.data("vc").getStyleType())}"string"==typeof o&&(this.styleType=o),this.parentId=e,this.insertBeforeId=t,this.callback=s,this.showing=!0,this.focusTitleInput()},showEditBlock(e,t){this.loading=!0,this.error=null,this.showing=!0,function(e,t){return z().get("/ajax/spec/load-edit-block",{specId:e,blockId:t}).fail(W)}(this.specId,e).then((e=>{this.loading=!1,this.block=e,this.styleType=e.styleType,this.contentType=e.contentType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.focusTitleInput()})).fail((()=>{this.error="Error loading block",this.loading=!1}))},focusTitleInput(){this.$nextTick((()=>{z()("input",this.$refs.titleInput.$el).focus()}))},renderMarkdownPreview(){this.contentType===pe&&(this.body.trim()?(this.debouncedBodyRender||(this.debouncedBodyRender=Q((e=>{this.loadingPreview=!0,this.previewError=null,this.previewXhr&&this.previewXhr.abort();let t=function(e){let t=z().post("/ajax/render-markdown",{markdown:e});return t.fail((function(e){0===e.status&&"abort"===e.statusText||W(e)})),t}(e);this.previewXhr=t,t.then((e=>{this.previewXhr===t&&(e.error?this.previewError=e.error:this.previewHtml=e.html,this.loadingPreview=!1,this.previewXhr=null)})).fail((()=>{this.previewXhr===t&&(this.previewError="Error generating preview.",this.loadingPreview=!1,this.previewXhr=null)}))}),1e3)),this.debouncedBodyRender(this.body)):this.previewHtml="")},addCodeHighlighting(){this.previewHtml&&this.$nextTick((()=>{let e=z()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&Bn(Cn).then((t=>{e.each(((e,o)=>{t.highlightBlock(o)}))}))}))},openEditUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(o=>{this.initialUrlObject&&o.id===this.initialUrlObject.id&&(this.block.refItem=o),this.$refs.refForm.urlUpdated(e),t&&t(o)}),(e=>{this.initialUrlObject&&e===this.initialUrlObject.id&&(this.block.refType=null,this.block.refId=null,this.block.refItem=null),o&&o(e)}))},raisePlayVideo(e){this.$emit("play-video",e)},promotDelete(){this.$emit("prompt-delete",this.block.id,(()=>{this.showing=!1}))},submit(){if(this.refType){if(!this.refFieldsValid||!this.refFields)return void this.$alert('Please specify the attachment or choose "No media".',{type:"error"})}else if(!this.refType&&!this.title.trim()&&!this.body.trim())return void this.$alert("A title, body, or attachment is required.",{type:"error"});if(this.contentType===pe&&this.previewError)return void this.$alert("Error rendering preview. Please check your HTML syntax.",{type:"error"});let e=this.createSendingSpinner(),t=this.callback;var o,s,n,l,i,a,r,c;this.block?(o=this.specId,s=this.block.id,n=this.styleType,l=this.contentType,i=this.title,a=this.body,r=this.refType,c=this.refFields,c=c||{},z().post("/ajax/spec/save-block",{specId:o,blockId:s,styleType:n,contentType:l,title:i,body:a,refType:r,...c}).fail(W)).then((o=>{t(o),this.showing=!1,e.close()})).fail((()=>{e.close()})):function(e,t,o,s,n,l,i,a,r,c){return c=c||{},z().post("/ajax/spec/create-block",{specId:e,subspecId:t,parentId:o,insertBeforeId:s,styleType:n,contentType:l,title:i,body:a,refType:r,...c}).fail(W)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,this.contentType,this.title,this.body,this.refType,this.refFields).then((o=>{t(o),this.showing=!1,e.close()})).fail((()=>{e.close()}))},createSendingSpinner(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed(){this.styleType=me,this.contentType=ue,this.block=null,this.error=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1,this.previewHtml="",this.previewError=null}}},_l=(0,f.Z)(Ul,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("moment"),c=(0,e.resolveComponent)("el-radio"),d=(0,e.resolveComponent)("el-radio-group"),m=(0,e.resolveComponent)("el-input"),u=(0,e.resolveComponent)("ref-form"),p=(0,e.resolveComponent)("el-button"),h=(0,e.resolveComponent)("el-dialog"),g=(0,e.resolveDirective)("loading");return(0,e.openBlock)(),(0,e.createBlock)(h,{title:l.loading||l.block?"Edit block":"Add block",modelValue:l.showing,"onUpdate:modelValue":o[12]||(o[12]=e=>l.showing=e),width:t.$store.getters.dialogLargeWidth,"close-on-click-modal":!1,onClosed:o[13]||(o[13]=e=>i.closed()),"custom-class":"spec-edit-block-modal"},{footer:(0,e.withCtx)((()=>[l.error?((0,e.openBlock)(),(0,e.createElementBlock)("span",Xn,[(0,e.createVNode)(p,{onClick:o[8]||(o[8]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Qn])),_:1})])):l.showing?((0,e.openBlock)(),(0,e.createElementBlock)("span",Jn,[(0,e.createVNode)(p,{onClick:o[9]||(o[9]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[el])),_:1}),l.block?((0,e.openBlock)(),(0,e.createBlock)(p,{key:0,onClick:o[10]||(o[10]=e=>i.promotDelete()),type:"warning"},{default:(0,e.withCtx)((()=>[tl])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(p,{onClick:o[11]||(o[11]=e=>i.submit()),type:"primary"},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.block?"Save":"Add"),1)])),_:1})])):(0,e.createCommentVNode)("v-if",!0)])),default:(0,e.withCtx)((()=>[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Sn,[(0,e.createVNode)(a,{message:"Loading..."})])):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",xn,(0,e.toDisplayString)(l.error),1)):l.showing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.block?((0,e.openBlock)(),(0,e.createElementBlock)("p",Tn,[In,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(r,{datetime:l.block.created},null,8,["datetime"])]),Pn,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(r,{datetime:l.block.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",Rn,[(0,e.createVNode)(d,{modelValue:l.styleType,"onUpdate:modelValue":o[0]||(o[0]=e=>l.styleType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:i.STYLE_TYPE_BULLET},{default:(0,e.withCtx)((()=>[Un])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.STYLE_TYPE_NUMBERED},{default:(0,e.withCtx)((()=>[_n])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.STYLE_TYPE_NONE},{default:(0,e.withCtx)((()=>[Mn])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,e.createElementVNode)("label",null,[On,(0,e.createVNode)(m,{ref:"titleInput",modelValue:l.title,"onUpdate:modelValue":o[1]||(o[1]=e=>l.title=e),maxlength:i.titleMaxLength,clearable:""},null,8,["modelValue","maxlength"])])]),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",$n,[(0,e.createVNode)(d,{modelValue:l.refType,"onUpdate:modelValue":o[2]||(o[2]=e=>l.refType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:null},{default:(0,e.withCtx)((()=>[jn])),_:1}),(0,e.createVNode)(c,{label:i.REF_TYPE_SUBSPEC},{default:(0,e.withCtx)((()=>[Dn])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.REF_TYPE_URL},{default:(0,e.withCtx)((()=>[An])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,e.withDirectives)((0,e.createVNode)(u,{ref:"refForm","spec-id":s.specId,"ref-type":l.refType,"existing-ref-type":i.existingRefType,"existing-ref-item":i.existingRefItem,fields:l.refFields,"onUpdate:fields":o[3]||(o[3]=e=>l.refFields=e),valid:l.refFieldsValid,"onUpdate:valid":o[4]||(o[4]=e=>l.refFieldsValid=e),onOpenEditUrl:i.openEditUrl,onPlayVideo:i.raisePlayVideo},null,8,["spec-id","ref-type","existing-ref-type","existing-ref-item","fields","valid","onOpenEditUrl","onPlayVideo"]),[[e.vShow,!!l.refType]])]),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",Fn,[(0,e.createVNode)(d,{modelValue:l.contentType,"onUpdate:modelValue":o[5]||(o[5]=e=>l.contentType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:i.CONTENT_TYPE_PLAIN},{default:(0,e.withCtx)((()=>[Ln])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.CONTENT_TYPE_MARKDOWN},{default:(0,e.withCtx)((()=>[qn])),_:1},8,["label"])])),_:1},8,["modelValue"])]),l.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",zn,[(0,e.createCommentVNode)(" display preview beneath for final review"),(0,e.createElementVNode)("label",null,[Yn,(0,e.createVNode)(m,{type:"textarea",modelValue:l.body,"onUpdate:modelValue":o[6]||(o[6]=e=>l.body=e),autosize:{minRows:2}},null,8,["modelValue"])]),(0,e.createElementVNode)("label",null,[Hn,l.previewError?((0,e.openBlock)(),(0,e.createElementBlock)("div",Zn,(0,e.toDisplayString)(l.previewError),1)):(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,ref:"renderedHtml",class:"markdown",innerHTML:l.previewHtml},null,8,Wn)),[[g,l.loadingPreview]])])])):((0,e.openBlock)(),(0,e.createElementBlock)("label",Kn,[Gn,(0,e.createVNode)(m,{type:"textarea",modelValue:l.body,"onUpdate:modelValue":o[7]||(o[7]=e=>l.body=e),autosize:{minRows:2}},null,8,["modelValue"])]))])],64)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]]),Ml={key:0},Ol=(0,e.createTextVNode)(" Created "),$l=(0,e.createTextVNode)("; last modified "),jl=(0,e.createElementVNode)("div",null,"URL",-1),Dl={key:0,class:"preview"},Al=["src"],Fl={key:0},Ll={key:1},ql={key:2},zl=(0,e.createTextVNode)("Refresh URL preview"),Yl={key:1},Hl={class:"dialog-footer"},Zl=(0,e.createTextVNode)("Cancel"),Wl=(0,e.createTextVNode)("Delete"),Kl={components:{Moment:Je},props:{specId:{type:Number,required:!0}},data:()=>({url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return window.isValidURL=ee,!ee(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},urlMaxLength:()=>window.const.urlMaxLength,autoRefresh(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.createdCallback=e,this.showing=!0,this.$nextTick((()=>{z()("input",this.$refs.urlInput.$el).focus()}))},showEdit(e,t,o){this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=o,this.showing=!0,this.$nextTick((()=>{z()("input",this.$refs.urlInput.$el).focus()}))},submit(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.createdCallback;mt(this.specId,this.url).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},submitSave(){if(this.disableSubmit)return;this.sending=!0;let e=this.updatedCallback;var t,o;(t=this.urlObject.id,o=this.url,z().post("/ajax/spec/refresh-url",{id:t,url:o}).fail(W)).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},promptDelete(){this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{this.sending=!0;let e=this.deletedCallback;var t;(t=this.urlObject.id,z().post("/ajax/spec/delete-url",{id:t}).fail(W)).then((()=>{e&&e(this.urlObject.id),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},Gl={components:{EditBlockModal:_l,EditUrlModal:(0,f.Z)(Kl,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-checkbox"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(m,{title:l.urlObject?"Manage link":"Create link",modelValue:l.showing,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[6]||(o[6]=e=>i.closed()),"custom-class":"spec-edit-url-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Hl,[(0,e.createVNode)(d,{onClick:o[2]||(o[2]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Zl])),_:1}),l.urlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[3]||(o[3]=e=>i.promptDelete()),type:"danger"},{default:(0,e.withCtx)((()=>[Wl])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{onClick:o[4]||(o[4]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.urlObject?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.urlObject?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ml,[Ol,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.urlObject.created},null,8,["datetime"])]),$l,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.urlObject.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[jl,(0,e.createVNode)(r,{ref:"urlInput",modelValue:l.url,"onUpdate:modelValue":o[0]||(o[0]=e=>l.url=e),maxlength:i.urlMaxLength},null,8,["modelValue","maxlength"])]),l.urlObject?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.url===l.urlObject.url?((0,e.openBlock)(),(0,e.createElementBlock)("div",Dl,[l.urlObject.imageData?((0,e.openBlock)(),(0,e.createElementBlock)("img",{key:0,src:l.urlObject.imageData},null,8,Al)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[l.urlObject.title?((0,e.openBlock)(),(0,e.createElementBlock)("h3",Fl,(0,e.toDisplayString)(l.urlObject.title.trim()),1)):(0,e.createCommentVNode)("v-if",!0),l.urlObject.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ll,(0,e.toDisplayString)(l.urlObject.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0),i.autoRefresh?((0,e.openBlock)(),(0,e.createElementBlock)("p",ql,"URL preview will be updated")):((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,modelValue:l.refresh,"onUpdate:modelValue":o[1]||(o[1]=e=>l.refresh=e)},{default:(0,e.withCtx)((()=>[zl])),_:1},8,["modelValue"]))])])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Yl,"Link will be updated with new URL"))],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]])},props:{spec:Object,subspec:Object,enableEditing:Boolean},emits:["rendered","open-community","url-updated","url-deleted","play-video","prompt-nav-spec"],data(){return{autoscroller:null,eventBus:{all:e=e||new Map,on:function(t,o){var s=e.get(t);s?s.push(o):e.set(t,[o])},off:function(t,o){var s=e.get(t);s&&(o?s.splice(s.indexOf(o)>>>0,1):e.set(t,[]))},emit:function(t,o){var s=e.get(t);s&&s.slice().map((function(e){e(o)})),(s=e.get("*"))&&s.slice().map((function(e){e(t,o)}))}}};var e},computed:{dragging(){return this.$store.state.dragging},specId(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId(){return this.subspec?this.subspec.id:null},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},dragAndDropEnabled(){return this.enableEditing&&!this.$store.getters.mobileViewport}},watch:{dragAndDropEnabled(e){e?this.mountDragAndDrop():this.drake&&(this.drake.destroy(),this.drake=null)},dragging(e){e?this.autoscroller=function(){const e=70,t=z()(window);let o=null,s=null;function n(e){s=e.clientY}return t.on("mousemove",n),o=window.requestAnimationFrame((function n(){if(null!==s){let o=t.height(),n=0;s<e?n=-((e-s)/e*8+1):s>o-e&&(n=(s-(o-e))/e*8+1),0!==n&&t.scrollTop(t.scrollTop()+n)}o=window.requestAnimationFrame(n)})),{stop:function(){t.off("mousemove",n),o&&(window.cancelAnimationFrame(o),o=null)}}}():this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null)}},mounted(){if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";let e;if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var t=0;t<e.length;t++)this.insertBlock(e[t]);this.$nextTick((()=>{this.$emit("rendered")})),this.mountDragAndDrop();let o=this.eventBus;o.on("open-community",this.openBlockCommunity),o.on("open-edit",this.openEditBlock),o.on("prompt-add-subblock",this.promptAddSubblock),o.on("prompt-delete",this.promptDeleteBlock),o.on("start-moving",this.startMovingBlocks),o.on("add-to-moving",this.addToMovingBlocks),o.on("remove-from-moving",this.removeFromMovingBlocks),o.on("prompt-nav-spec",this.promptNavSpec),o.on("move-before",this.moveBeforeBlock),o.on("move-into",this.moveIntoBlock),o.on("move-after",this.moveAfterBlock),o.on("cancel-moving",this.cancelMovingBlocks),o.on("play-video",this.playVideo)},beforeDestroy(){this.drake&&(this.drake.destroy(),this.drake=null),this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null),this.$store.getters.currentlyMovingBlocks&&this.$store.state.movingBlocksSourceSubspecId===this.subspecId&&this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.getFinalMovingBlockIds()}),this.eventBus.all.clear(),this.eventBus=null,z()("[data-spec-block]",this.$refs.list).each(((e,t)=>{z()(t).data("destroy")()}))},methods:{transitRelativeScrollFirst(){let e=z()(window).scrollTop();z()("[data-spec-block]",this.$refs.list).each(((t,o)=>{let s=z()(o),n=s.offset();if(n.top>e){let t=n.top-e;return this.$nextTick((()=>{z()(window).scrollTop(s.offset().top-t)})),!1}}))},transitRelativeScroll(e){let t=z()(window).scrollTop(),o=z()('[data-spec-block="'+e+'"]',this.$refs.list),s=o.offset().top-t;this.$nextTick((()=>{z()(window).scrollTop(o.offset().top-s)}))},insertBlock(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{vNode:n,destroy:l,el:i}=function(t){let{props:o,children:s,element:n,app:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n,a=(0,e.createVNode)(t,o,s);l&&l._context&&(a.appContext=l._context),i?(0,e.render)(a,i):"undefined"!=typeof document&&(0,e.render)(a,i=document.createElement("div"));const r=()=>{i&&(0,e.render)(null,i),i=null,a=null};return{vNode:a,destroy:r,el:i}}(En,{props:{block:t,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:s},app:window.app}),a=n.component.ctx,r=z()(z()(i).find(">li")).data("vc",a).data("destroy",l);if(t.subblocks)for(var c=0;c<t.subblocks.length;c++){let e=t.subblocks[c],o=this.insertBlock(e,!1);z()(">ul.spec-block-list",r).append(o)}return o&&r.appendTo(this.$refs.list),r},mountDragAndDrop(){this.dragAndDropEnabled&&(this.drake||Bn(vn).then((e=>{console.debug("create drake"),this.drake=e({isContainer:e=>z()(e).is(".spec-block-list"),accepts:(e,t,o,s)=>!z()(t).closest(".gu-transit").length,moves:(e,t,o,s)=>z()(o).is(".drag-handle"),mirrorContainer:this.$refs.mirrorList}).on("drag",((e,t)=>{this.$store.commit("startDragging"),this.transitRelativeScroll(z()(e).attr("data-spec-block"))})).on("dragend",(e=>{this.$store.commit("endDragging"),this.transitRelativeScroll(z()(e).attr("data-spec-block"))})).on("drop",((e,t,o,s)=>{let n=z()(e).data("vc").getBlockId(),l=z()(o).closest("[data-spec-block]");l.length&&l.data("vc").updateHasSubblocks();let i=null,a=z()(t).closest("[data-spec-block]");if(a.length){let e=a.data("vc");i=e.getBlockId(),e.updateHasSubblocks()}let r=s?z()(s).data("vc").getBlockId():null;dt([n],this.subspecId,i,r)}))})))},promptAddBlock(){this.$refs.editBlockModal.showAddBlock(null,null,!0,(e=>{let t=this.insertBlock(e,!0,!0);this.panToBlock(t)}))},openBlockCommunity(e){let{blockId:t,onAdjustUnread:o,onAdjustComments:s}=e;this.$emit("open-community",ce,t,o,s)},openEditBlock(e){let{blockId:t,callback:o}=e;this.$refs.editBlockModal.showEditBlock(t,o)},promptAddSubblock(e){let{parentId:t,insertBeforeId:o,defaultStyleType:s}=e;this.$refs.editBlockModal.showAddBlock(t,o,s,(e=>{let s=this.insertBlock(e,!1,!0);if(o)s.insertBefore('[data-spec-block="'+o+'"]');else if(t){let e=z()('[data-spec-block="'+t+'"]');s.appendTo(e.find(">ul.spec-block-list")),e.data("vc").updateHasSubblocks()}else s.appendTo(this.$refs.list);this.panToBlock(s)}))},promptDeleteBlock(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{(function(e){return z().post("/ajax/spec/delete-block",{blockId:e}).fail(W)})(e).then((()=>{z()('[data-spec-block="'+e+'"]').remove(),t&&t()}))})).catch((()=>{}))},startMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:[e]}),this.transitRelativeScroll(e)},addToMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.concat(e)})},removeFromMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.filter((t=>!X(t,e)))})},moveBeforeBlock(e){let t=z()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.parent().closest("[data-spec-block]"),s=o.length?o.attr("data-spec-block"):null,n=e;this.moveBlocks(s,n,(e=>{e.insertBefore(t)}))},moveIntoBlock(e){let t=z()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.attr("data-spec-block"),s=t.find(">ul.spec-block-list");this.moveBlocks(o,null,(e=>{e.appendTo(s)})),t.data("vc").updateHasSubblocks()},moveAfterBlock(e){let t=z()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.parent().closest("[data-spec-block]"),s=o.length?o.attr("data-spec-block"):null,n=t.next("[data-spec-block]"),l=n.length?n.attr("data-spec-block"):null,i=t;this.moveBlocks(s,l,(e=>{e.insertAfter(i),i=e}))},moveBlocksToBottom(){this.moveBlocks(null,null,(e=>{e.appendTo(this.$refs.list)}))},getFinalMovingBlockIds(){if(!this.$store.getters.currentlyMovingBlocks)return[];if(!X(this.$store.state.movingBlocksSourceSubspecId,this.subspecId))return this.$store.state.movingBlockIds;let e=[];return z()("[data-moving-block-id]",this.$refs.list).each(((t,o)=>{let s=z()(o);s.closest(".spec-block-list.moving").length||e.push(s.attr("data-moving-block-id"))})),e},moveBlocks(e,t,o){var s=this;let n=this.getFinalMovingBlockIds();n.length&&dt(n,this.subspecId,e,t).then((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;if(e)for(var l=0;l<e.length;l++){let n=s.insertBlock(e[l],!1,!0);o(n),t||(t=n)}else{let e={};for(let l=0;l<n.length;l++){let i=z()('[data-spec-block="'+n[l]+'"]',s.$refs.list),a=i.parent().closest("[data-spec-block]");o(i),a.length&&(e[a.attr("data-spec-block")]=a.data("vc")),t||(t=i)}for(let t in e)e[t].updateHasSubblocks()}s.$store.commit("endMovingBlocks"),s.panToBlock(t)}))},cancelMovingBlocks(e){this.$store.commit("endMovingBlocks"),this.transitRelativeScroll(e)},openEditUrl(e,t,o){this.$refs.editUrlModal.showEdit(e,(e=>{this.eventBus.emit("url-updated",e),t&&t(e)}),(e=>{this.eventBus.emit("url-deleted",e),o&&o(e)}))},playVideo(e){this.$emit("play-video",e)},promptNavSpec(){this.$emit("prompt-nav-spec")},panToBlock(e){let t=e.find(">.content").offset(),o=z()(window),s=o.scrollTop(),n=o.height();t.top<s+100?o.scrollTop(t.top-100):t.top>s+n-200&&o.scrollTop(t.top-(n-200))}}},Xl=(0,f.Z)(Gl,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("edit-block-modal"),c=(0,e.resolveComponent)("edit-url-modal");return s.spec||s.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("div",js,[(0,e.createElementVNode)("ul",{ref:"list",class:(0,e.normalizeClass)(["spec-block-list",{dragging:i.dragging}])},[(0,e.createCommentVNode)(" managed programatically ")],2),s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[i.choosingAddPosition?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>i.moveBlocksToBottom()),type:"success"},{default:(0,e.withCtx)((()=>[Ds,As])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(a,{key:1,onClick:o[1]||(o[1]=e=>i.promptAddBlock()),type:"primary"},{default:(0,e.withCtx)((()=>[Fs])),_:1})),(0,e.createElementVNode)("ul",Ls,[(0,e.createCommentVNode)(" holds mirror element when dragging block ")],512),(0,e.createVNode)(r,{ref:"editBlockModal","spec-id":i.specId,"subspec-id":i.subspecId,onOpenEditUrl:i.openEditUrl,onPlayVideo:i.playVideo,onPromptDelete:i.promptDeleteBlock},null,8,["spec-id","subspec-id","onOpenEditUrl","onPlayVideo","onPromptDelete"]),(0,e.createVNode)(c,{ref:"editUrlModal","spec-id":i.specId},null,8,["spec-id"])],64)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)}]]),Ql={components:{SpecView:Xl,LoadingMessage:yt},props:{loading:Boolean,spec:Object,enableEditing:Boolean},emits:["rendered","prop-nav-spec","open-community","play-video"],beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter spec-view",e),o()},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate spec-view",e),o()},methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)}}},Jl=(0,f.Z)(Ql,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("spec-view",!0);return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["spec-view-page",{loading:s.loading}])},[s.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",$s,[(0,e.createVNode)(a,{message:"Loading..."})])):s.spec?((0,e.openBlock)(),(0,e.createBlock)(r,{key:s.spec.renderTime,spec:s.spec,"enable-editing":s.enableEditing,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onRendered:o[0]||(o[0]=e=>t.$emit("rendered"))},null,8,["spec","enable-editing","onPromptNavSpec","onOpenCommunity","onPlayVideo"])):(0,e.createCommentVNode)("v-if",!0)],2)}]]),ei={class:"subspec-page"},ti={key:0},oi={key:0,class:"right"},si=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),ni=(0,e.createElementVNode)("i",{class:"material-icons"},"settings",-1),li=(0,e.createTextVNode)(" Last modified "),ii=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),ai={class:"name"},ri={key:1,class:"desc"},ci={components:{Moment:Je,SpecView:Xl},inheritAttrs:!1,props:{enableEditing:Boolean},emits:["prompt-nav-spec","open-community","play-video","open-manage-subspec"],data:()=>({loading:!0,scrollOnRender:!0,subspec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute(){return"subspec"===this.$route.name},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.userSettings.community.unreadOnly}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter subspec",e),o((t=>{t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave subspec"),this.subspec=null,this.unreadCount=0,this.commentsCount=0,J(),o()},methods:{loadSubspec(e,t,o){console.debug("load subspec"),this.loading=!0,function(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return z().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:o}).fail(W)}(e,t,o).then((e=>{console.debug("subspec loaded",e),this.subspec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,J(e.name),this.loading=!1,this.scrollOnRendered()})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},scrollOnRendered(){this.scrollOnRender=!0},handleViewRendered(){this.scrollOnRender&&(this.scrollOnRender=!1,this.restoreScroll())},promptNavSpec(){this.$emit("prompt-nav-spec")},openSubspecCommunity(){this.$emit("open-community",re,this.subspec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)},openManageSubspec(){this.$emit("open-manage-subspec",this.subspec,(e=>{this.subspec.updated=e.updated,this.subspec.name=e.name,this.subspec.desc=e.desc,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,J(e.name)}))},restoreScroll(){let e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),z()(window).scrollTop(e.top).scrollLeft(e.left))}}},di=(0,f.Z)(ci,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("moment"),c=(0,e.resolveComponent)("router-view");return(0,e.openBlock)(),(0,e.createElementBlock)("section",ei,[l.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("header",ti,[i.onSubspecRoute&&!l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("div",oi,[s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{onClick:o[0]||(o[0]=e=>i.openSubspecCommunity()),type:l.unreadCount?"primary":"default",disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[si,i.showUnreadOnly||l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type","disabled"]),s.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[1]||(o[1]=e=>i.openManageSubspec()),disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[ni])),_:1},8,["disabled"])):(0,e.createCommentVNode)("v-if",!0)],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("span",null,[li,(0,e.createVNode)(r,{datetime:l.subspec.updated,offset:!0},null,8,["datetime"])]),(0,e.createVNode)(a,{onClick:o[2]||(o[2]=e=>i.openSubspecCommunity()),type:l.unreadCount?"primary":"default"},{default:(0,e.withCtx)((()=>[ii,i.showUnreadOnly||l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):(0,e.createCommentVNode)("v-if",!0)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount),1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])],64))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("h3",ai,(0,e.toDisplayString)(l.subspec.name),1),l.subspec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",ri,(0,e.toDisplayString)(l.subspec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,null,{default:(0,e.withCtx)((t=>{let{Component:o}=t;return[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(o),{loading:l.loading,subspec:l.subspec,"enable-editing":s.enableEditing,onRendered:i.handleViewRendered,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo},null,8,["loading","subspec","enable-editing","onRendered","onPromptNavSpec","onOpenCommunity","onPlayVideo"]))]})),_:1})])}]]),mi={key:0},ui={components:{SpecView:Xl,LoadingMessage:yt},props:{loading:Boolean,subspec:Object,enableEditing:Boolean},emits:["rendered","prompt-nav-spec","open-community","play-video"],methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)}}},pi=(0,f.Z)(ui,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("spec-view");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["subspec-view-page",{loading:s.loading}])},[s.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",mi,[(0,e.createVNode)(a,{message:"Loading..."})])):s.subspec?((0,e.openBlock)(),(0,e.createBlock)(r,{key:s.subspec.renderTime,subspec:s.subspec,"enable-editing":s.enableEditing,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onRendered:o[0]||(o[0]=e=>t.$emit("rendered"))},null,8,["subspec","enable-editing","onPromptNavSpec","onOpenCommunity","onPlayVideo"])):(0,e.createCommentVNode)("v-if",!0)],2)}]]),hi={class:"community-review-page"},gi=(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h2",null,"Community review")],-1),ki={class:"content-page"},bi={key:0},fi=(0,e.createElementVNode)("h3",null,"Your specs",-1),yi={class:"flex-row"},Ci={class:"flex-row nowrap fill"},vi={class:"expand"},wi=(0,e.createElementVNode)("i",{class:"material-icons"},"expand_less",-1),Vi=(0,e.createElementVNode)("i",{class:"material-icons"},"expand_more",-1),Bi=(0,e.createElementVNode)("i",{class:"material-icons"},"filter_center_focus",-1),Ni={class:"name fill"},Ei=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Si=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),xi={key:0,class:"subspecs"},Ti={class:"flex-row"},Ii={class:"name fill"},Pi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Ri=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),Ui={key:1},_i={key:1},Mi=(0,e.createElementVNode)("h3",null,"Your comments",-1),Oi={class:"flex-row wrap-reverse"},$i=["textContent"],ji=(0,e.createTextVNode)(" Show only comments with unread replies "),Di={class:"flex-row"},Ai={class:"fill"},Fi=(0,e.createTextVNode)(" updated "),Li=(0,e.createTextVNode)(" posted "),qi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),zi=["textContent"],Yi={key:0},Hi=(0,e.createTextVNode)("Load more"),Zi={key:1},Wi={key:2};function Ki(e){return z().get("/ajax/community-review",e)}const Gi={components:{Moment:Je,CommunityModal:Ts,PlayVideoModal:_s,Username:y,LoadingMessage:yt},data:()=>({loading:!0,showUnreadOnly:!1,specs:[],expandedSpecs:{},subspecsBySpecId:{},comments:[],totalComments:0,hasMoreComments:!1,loadingCommentsPage:!1,specId:null}),computed:{commentsPageArgs(){let e={unreadOnly:this.showUnreadOnly};return this.comments.length&&(e.updatedBefore=this.comments[this.comments.length-1].updated),e},formattedCommentsCount(){let e=this.totalComments;return e+" comment"+(1!==e?"s":"")+(this.showUnreadOnly?" with unread replies":"")}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter community-review",e),o((e=>{e.initPage()}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate community-review",e),this.initPage(),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave community-review"),this.specs=[],this.expandedSpecs={},this.subspecsBySpecId={},this.comments=[],this.totalComments=0,this.hasMoreComments=!1,this.specId=null,o()},methods:{initPage(){this.showUnreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loading=!0,Ki(z().extend({request:"all"},this.commentsPageArgs)).then((e=>{this.specs=e.specs,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments,this.loading=!1})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},expandSpec(e){var t=this.expandedSpecs[e];this.expandedSpecs[e]=!0,void 0===t&&Ki({request:"subspecs",specId:e}).then((t=>{this.subspecsBySpecId[e]=t.subspecs})).fail((t=>{this.expandedSpecs[e]=!1,W(t)}))},collapseSpec(e){this.$set(this.expandedSpecs,e,!1)},reloadComments(){this.loadingCommentsPage=!0,this.comments=[],Ki(z().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,W(e)}))},loadMoreComments(){this.loadingCommentsPage=!0,Ki(z().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,W(e)}))},openSpecCommunity(e){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(ae,e,(t=>{for(var o=0;o<this.specs.length;o++)if(X(e,this.specs[o].id)){this.$set(this.specs[o],"unread",this.specs[o].unread+t);break}}),(t=>{for(var o=0;o<this.specs.length;o++)if(X(e,this.specs[o].id)){this.$set(this.specs[o],"total",this.specs[o].total+t);break}}))}))},gotoSpec(e){this.$router.push({name:"spec",params:{specId:e}})},openSubspecCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(re,t,(o=>{let s=this.subspecsBySpecId[e];for(var n=0;n<s.length;n++)if(X(t,s[n].id)){this.$set(s[n],"unread",s[n].unread+o);break}let l=!1;if(o>0)l=!0;else for(n=0;n<s.length;n++)if(s[n].unread>0||s[n].blockUnread>0){l=!0;break}for(n=0;n<this.specs.length;n++)if(X(e,this.specs[n].id)){this.$set(this.specs[n],"hasUnreadSubspec",l);break}}),(o=>{let s=this.subspecsBySpecId[e];for(var n=0;n<s.length;n++)if(X(t,s[n].id)){this.$set(s[n],"total",s[n].total+o);break}}))}))},gotoSubspec(e,t){this.$router.push({name:"subspec",params:{specId:e,subspecId:t}})},openCommentCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(de,t,(e=>{for(var o=0;o<this.comments.length;o++)if(X(t,this.comments[o].id)){this.$set(this.comments[o],"unread",this.comments[o].unread+e);break}}),(e=>{for(var o=0;o<this.comments.length;o++)if(X(t,this.comments[o].id)){this.$set(this.comments[o],"total",this.comments[o].total+e);break}}))}))},playVideo(e){this.$refs.playVideoModal.show(e)}}},Xi=(0,f.Z)(Gi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-button"),c=(0,e.resolveComponent)("router-link"),d=(0,e.resolveComponent)("el-checkbox"),m=(0,e.resolveComponent)("username"),u=(0,e.resolveComponent)("moment"),p=(0,e.resolveComponent)("community-modal"),h=(0,e.resolveComponent)("play-video-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("section",hi,[gi,(0,e.createElementVNode)("div",ki,[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",bi,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("section",null,[fi,l.specs.length?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:0},(0,e.renderList)(l.specs,(t=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:t.id,class:"spec review"},[(0,e.createElementVNode)("div",yi,[(0,e.createElementVNode)("div",Ci,[(0,e.createElementVNode)("div",vi,[t.hasSubspecs?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.expandedSpecs[t.id]?((0,e.openBlock)(),(0,e.createBlock)(r,{key:0,onClick:e=>i.collapseSpec(t.id),type:t.hasUnreadSubspec?"primary":"default",circle:""},{default:(0,e.withCtx)((()=>[wi])),_:2},1032,["onClick","type"])):((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,onClick:e=>i.expandSpec(t.id),type:t.hasUnreadSubspec?"primary":"default",circle:""},{default:(0,e.withCtx)((()=>[Vi])),_:2},1032,["onClick","type"]))],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createCommentVNode)(" claim same space with hidden button "),(0,e.createVNode)(r,{type:"default",circle:"",style:{visibility:"hidden"}},{default:(0,e.withCtx)((()=>[Bi])),_:1})],2112))]),(0,e.createElementVNode)("div",Ni,[(0,e.createVNode)(c,{to:{name:"spec",params:{specId:t.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(t.name),1)])),_:2},1032,["to"])])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openSpecCommunity(t.id),type:t.unread?"primary":"default"},{default:(0,e.withCtx)((()=>[Ei,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.unread)+" unread ("+(0,e.toDisplayString)(t.total)+" total) ",1)])),_:2},1032,["onClick","type"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.gotoSpec(t.id),type:t.blockUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Si,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.blockUnread)+" unread ("+(0,e.toDisplayString)(t.blockTotal)+" total) on blocks ",1)])),_:2},1032,["onClick","type"])])]),l.expandedSpecs[t.id]?((0,e.openBlock)(),(0,e.createElementBlock)("div",xi,[l.subspecsBySpecId[t.id]?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:0},(0,e.renderList)(l.subspecsBySpecId[t.id],(o=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:o.id,class:"subspec review"},[(0,e.createElementVNode)("div",Ti,[(0,e.createElementVNode)("div",Ii,[(0,e.createVNode)(c,{to:{name:"subspec",params:{specId:t.id,subspecId:o.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(o.name),1)])),_:2},1032,["to"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openSubspecCommunity(t.id,o.id),type:o.unread?"primary":"default"},{default:(0,e.withCtx)((()=>[Pi,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.unread)+" unread ("+(0,e.toDisplayString)(o.total)+" total) ",1)])),_:2},1032,["onClick","type"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.gotoSubspec(t.id,o.id),type:o.blockUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Ri,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.blockUnread)+" unread ("+(0,e.toDisplayString)(o.blockTotal)+" total) on blocks ",1)])),_:2},1032,["onClick","type"])])])])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",Ui,[(0,e.createVNode)(a)]))])):(0,e.createCommentVNode)("v-if",!0)])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",_i,"No specs"))]),(0,e.createElementVNode)("section",null,[Mi,(0,e.createElementVNode)("div",Oi,[(0,e.createElementVNode)("div",{class:"fill nowraptext",textContent:(0,e.toDisplayString)(i.formattedCommentsCount)},null,8,$i),(0,e.createVNode)(d,{modelValue:l.showUnreadOnly,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showUnreadOnly=e),onChange:o[1]||(o[1]=e=>i.reloadComments())},{default:(0,e.withCtx)((()=>[ji])),_:1},8,["modelValue"])]),l.comments.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.comments,(o=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:o.id,class:"comment review"},[(0,e.createElementVNode)("div",Di,[(0,e.createElementVNode)("div",Ai,[(0,e.createVNode)(m,{username:t.$store.getters.username},null,8,["username"]),o.updated!==o.created?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[Fi,(0,e.createVNode)(u,{datetime:o.updated,offset:!0},null,8,["datetime"])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[Li,(0,e.createVNode)(u,{datetime:o.created,offset:!0},null,8,["datetime"])],64))]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openCommentCommunity(o.specId,o.id),type:o.unread?"primary":"default",size:"small"},{default:(0,e.withCtx)((()=>[qi,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.unread)+" unread ("+(0,e.toDisplayString)(o.total)+" total) ",1)])),_:2},1032,["onClick","type"])])]),(0,e.createElementVNode)("div",{class:"body",textContent:(0,e.toDisplayString)(o.body)},null,8,zi)])))),128)),l.loadingCommentsPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",Yi,[(0,e.createVNode)(a,{message:"Loading more comments..."})])):l.hasMoreComments?((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,onClick:o[2]||(o[2]=e=>i.loadMoreComments())},{default:(0,e.withCtx)((()=>[Hi])),_:1})):(0,e.createCommentVNode)("v-if",!0)],64)):l.loadingCommentsPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",Zi,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Wi,"No comments"))])],64))]),(0,e.createVNode)(p,{ref:"communityModal","spec-id":l.specId,onPlayVideo:i.playVideo},null,8,["spec-id","onPlayVideo"]),(0,e.createVNode)(h,{ref:"playVideoModal"},null,512)])}]]),Qi={class:"admin-page"},Ji=(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h2",null,"Admin panel")],-1),ea={class:"content-page"},ta={key:0},oa={key:1},sa={key:2},na={key:3,class:"signup-requests"},la=(0,e.createElementVNode)("h3",null,"Signup requests",-1),ia={class:"options"},aa=(0,e.createTextVNode)("Show all"),ra={key:0},ca=(0,e.createTextVNode)("Approved"),da=(0,e.createTextVNode)("Denied"),ma=(0,e.createTextVNode)("Pending"),ua=(0,e.createTextVNode)(" Review "),pa={key:2},ha={key:3},ga={class:"users"},ka=(0,e.createElementVNode)("h3",null,"Users",-1),ba={key:0},fa=(0,e.createElementVNode)("td",null,"Request IDâ",-1),ya=(0,e.createElementVNode)("td",null,"Createdâ",-1),Ca=(0,e.createElementVNode)("td",null,"Usernameâ",-1),va=(0,e.createElementVNode)("td",null,"Email addressâ",-1),wa=(0,e.createElementVNode)("br",null,null,-1),Va=(0,e.createElementVNode)("br",null,null,-1),Ba=(0,e.createElementVNode)("div",null,"Message",-1),Na={key:0},Ea={class:"dialog-footer"},Sa=(0,e.createTextVNode)(" Cancel "),xa=(0,e.createTextVNode)(" Decline "),Ta=(0,e.createTextVNode)(" Approve "),Ia={components:{Moment:Je,Username:y,LoadingMessage:yt},data:()=>({loadingSignupRequests:!0,loadingUsers:!0,error:null,showAllSignupRequests:!1,signupRequests:null,reviewingSignupRequest:null,signupRequestResponse:"",sendingSignupRequestReview:!1,users:[]}),computed:{loading(){return this.loadingSignupRequests},unauthorized(){return!(this.loading||this.error||this.signupRequests)}},watch:{showAllSignupRequests(){this.loadSignupRequests()}},beforeRouteEnter(e,t,o){o((e=>{e.loadAdmin()}))},beforeRouteUpdate(e,t,o){this.loadAdmin(),o()},methods:{loadAdmin(){this.error=null,this.loadSignupRequests(),this.loadUsers()},loadSignupRequests(){this.loadingSignupRequests=!0,$.get("/ajax/admin/signup-requests",{all:this.showAllSignupRequests}).then((e=>{this.loadingSignupRequests=!1,this.signupRequests=e})).fail((e=>{this.loadingSignupRequests=!1,this.error=e.status,W(e)}))},loadUsers(){this.loadingUsers=!0,$.get("/ajax/admin/users").then((e=>{this.loadingUsers=!1,this.users=e})).fail((e=>{this.loadingUsers=!1,this.error=e.status,W(e)}))},openReviewSignupRequest(e){this.signupRequestResponse="",this.reviewingSignupRequest=e},cancelReviewSignupRequest(){this.reviewingSignupRequest=null,this.signupRequestResponse=""},submitSignupRequestReview(e){this.reviewingSignupRequest&&(this.sendingSignupRequestReview=!0,$.post("/ajax/admin/review-signup",{requestId:this.reviewingSignupRequest.id,approved:e,message:this.signupRequestResponse}).then((()=>{this.sendingSignupRequestReview=!1;for(var t=0;t<this.signupRequests.length;t++)if(X(this.signupRequests[t].id,this.reviewingSignupRequest.id)){this.showAllSignupRequests?(this.reviewingSignupRequest.reviewed=!0,this.reviewingSignupRequest.approved=e,this.signupRequests.splice(t,1,this.reviewingSignupRequest)):this.signupRequests.splice(t,1);break}this.reviewingSignupRequest=null,this.signupRequestResponse=""})).fail((e=>{this.sendingSignupRequestReview=!1,W(e)})))}}},Pa=(0,f.Z)(Ia,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-checkbox"),c=(0,e.resolveComponent)("el-table-column"),d=(0,e.resolveComponent)("moment"),m=(0,e.resolveComponent)("el-tag"),u=(0,e.resolveComponent)("el-button"),p=(0,e.resolveComponent)("el-table"),h=(0,e.resolveComponent)("username"),g=(0,e.resolveComponent)("el-input"),k=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Qi,[Ji,(0,e.createElementVNode)("div",ea,[i.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",ta,[(0,e.createVNode)(a,{message:"Loading..."})])):403===l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",oa,"Unauthorized")):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",sa,"Error "+(0,e.toDisplayString)(l.error),1)):(0,e.createCommentVNode)("v-if",!0),l.signupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("section",na,[la,(0,e.createElementVNode)("div",ia,[(0,e.createVNode)(r,{modelValue:l.showAllSignupRequests,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showAllSignupRequests=e)},{default:(0,e.withCtx)((()=>[aa])),_:1},8,["modelValue"])]),l.loadingSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("p",ra,[(0,e.createVNode)(a,{message:"Loading..."})])):l.signupRequests.length?((0,e.openBlock)(),(0,e.createBlock)(p,{key:1,data:l.signupRequests,"max-height":.8*t.$store.state.windowHeight},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{fixed:"",prop:"id",label:"ID",width:"40"}),(0,e.createVNode)(c,{fixed:"",prop:"username",label:"Username",width:"150"}),(0,e.createVNode)(c,{prop:"email",label:"Email address",width:"300"}),(0,e.createVNode)(c,{label:"Created",width:"200"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(d,{datetime:t.row.created,offset:!0},null,8,["datetime"])])),_:1}),l.showAllSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(c,{label:"Status",width:"120"},{default:(0,e.withCtx)((t=>[t.row.reviewed?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[t.row.approved?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0,type:"success"},{default:(0,e.withCtx)((()=>[ca])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1,type:"warning"},{default:(0,e.withCtx)((()=>[da])),_:1}))],2112)):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1},{default:(0,e.withCtx)((()=>[ma])),_:1}))])),_:1}),(0,e.createVNode)(c,{prop:"userId",label:"User ID",width:"120"})],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{label:"Actions",width:"200"},{default:(0,e.withCtx)((t=>[t.row.reviewed?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createBlock)(u,{key:0,onClick:e=>i.openReviewSignupRequest(t.row),size:"small"},{default:(0,e.withCtx)((()=>[ua])),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data","max-height"])):l.showAllSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("p",pa,"No data")):((0,e.openBlock)(),(0,e.createElementBlock)("p",ha,"No pending requests"))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("section",ga,[ka,l.loadingUsers?((0,e.openBlock)(),(0,e.createElementBlock)("p",ba,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createBlock)(p,{key:1,data:l.users,"max-height":.8*t.$store.state.windowHeight},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{fixed:"",label:"Username",width:"190"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(h,{username:t.row.username,highlight:t.row.highlight},null,8,["username","highlight"])])),_:1}),(0,e.createVNode)(c,{prop:"email",label:"Email address",width:"300"}),(0,e.createVNode)(c,{label:"Created",width:"200"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(d,{datetime:t.row.created,offset:!0},null,8,["datetime"])])),_:1}),(0,e.createVNode)(c,{prop:"specs",label:"Spec count",width:"100"}),(0,e.createVNode)(c,{label:"Actions",width:"200"})])),_:1},8,["data","max-height"]))])]),l.reviewingSignupRequest?((0,e.openBlock)(),(0,e.createBlock)(k,{key:0,title:"Review signup request","close-on-click-modal":!l.sendingSignupRequestReview,width:t.$store.getters.dialogTinyWidth,visible:""},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Ea,[(0,e.createVNode)(u,{onClick:o[2]||(o[2]=e=>i.cancelReviewSignupRequest()),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Sa])),_:1},8,["disabled"]),(0,e.createVNode)(u,{type:"warning",onClick:o[3]||(o[3]=e=>i.submitSignupRequestReview(!1)),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[xa])),_:1},8,["disabled"]),(0,e.createVNode)(u,{type:"primary",onClick:o[4]||(o[4]=e=>i.submitSignupRequestReview(!0)),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Ta])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[(0,e.createElementVNode)("table",null,[(0,e.createElementVNode)("tr",null,[fa,(0,e.createElementVNode)("td",null,(0,e.toDisplayString)(l.reviewingSignupRequest.id),1)]),(0,e.createElementVNode)("tr",null,[ya,(0,e.createElementVNode)("td",null,[(0,e.createVNode)(d,{datetime:l.reviewingSignupRequest.created},null,8,["datetime"])])]),(0,e.createElementVNode)("tr",null,[Ca,(0,e.createElementVNode)("td",null,[(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(l.reviewingSignupRequest.username),1)])]),(0,e.createElementVNode)("tr",null,[va,(0,e.createElementVNode)("td",null,[(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(l.reviewingSignupRequest.email),1)])])]),wa,Va,(0,e.createElementVNode)("label",null,[Ba,(0,e.createVNode)(g,{type:"textarea",modelValue:l.signupRequestResponse,"onUpdate:modelValue":o[1]||(o[1]=e=>l.signupRequestResponse=e),autosize:{minRows:2},readonly:l.sendingSignupRequestReview},null,8,["modelValue","readonly"])]),l.sendingSignupRequestReview?((0,e.openBlock)(),(0,e.createElementBlock)("p",Na,[(0,e.createVNode)(a,{message:"Sending..."})])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["close-on-click-modal","width"])):(0,e.createCommentVNode)("v-if",!0)])}]]),Ra={class:"ajax-error-page content-page"},Ua={key:0},_a={key:1},Ma={key:2},Oa=(0,e.createTextVNode)("Retry"),$a={computed:{url(){return decodeURIComponent(this.$route.query.url)},statusCode(){return parseInt(this.$route.params.code,10)||0}},methods:{retry(){this.$router.replace(this.url)}}},ja=(0,f.Z)($a,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Ra,[0===i.statusCode?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ua,"Could not connect to server")):503===i.statusCode?((0,e.openBlock)(),(0,e.createElementBlock)("p",_a,"CrowdSpec is currently offline for database upgrades")):((0,e.openBlock)(),(0,e.createElementBlock)("p",Ma,"Request failed with error code "+(0,e.toDisplayString)(i.statusCode),1)),i.url?((0,e.openBlock)(),(0,e.createBlock)(a,{key:3,onClick:o[0]||(o[0]=e=>i.retry())},{default:(0,e.withCtx)((()=>[Oa])),_:1})):(0,e.createCommentVNode)("v-if",!0)])}]]),Da={class:"content-page"},Aa={},Fa=(0,f.Z)(Aa,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Da," Not found ")}]]),La=VueRouter.createRouter({history:VueRouter.createWebHashHistory(),routes:[{name:"index",path:"/",component:vt},{path:"/spec/:specId",component:Os,children:[{name:"spec",path:"",component:Jl},{path:"subspec/:subspecId",component:di,children:[{name:"subspec",path:"",component:pi}]}]},{name:"community-review",path:"/community-review",component:Xi},{name:"admin",path:"/admin",component:Pa},{name:"ajax-error",path:"/ajax-error/:code",component:ja},{path:"/:pathMatch(.*)",component:Fa}],scrollBehavior:(e,t,o)=>(ye.commit("setSavedScrollPosition",o),o||{left:0,top:0})});La.beforeEach(((e,t,o)=>{t&&(!ye.getters.currentSpecId||e.params.specId&&X(e.params.specId,ye.getters.currentSpecId)?"spec"===t.name&&ye.commit("saveCurrentSpecScrollTop"):(ye.commit("clearCurrentSpec"),ye.commit("endMovingBlocks"))),o()})),La.afterEach(((e,t)=>{console.debug("afterEach"),ye.commit("clearSavedScrollPosition")}));const qa=La;let za=Vue.createApp(ie);window.app=za,za.use(s(),{locale:l()}),za.use(qa),za.use(ye),za.mount("#app")})()})();