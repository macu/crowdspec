!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=20)}([function(e,t){e.exports=jQuery},function(e,t){e.exports=Vue},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t){e.exports=Vuex},function(e,t){e.exports=VueRouter},function(e,t){e.exports=dragula},function(e,t,i){e.exports=i(37)},function(e,t,i){},function(e,t,i){"use strict";var n=i(2);i.n(n).a},function(e,t,i){"use strict";var n=i(3);i.n(n).a},function(e,t,i){"use strict";var n=i(4);i.n(n).a},function(e,t,i){"use strict";var n=i(5);i.n(n).a},function(e,t,i){"use strict";var n=i(6);i.n(n).a},function(e,t,i){"use strict";var n=i(7);i.n(n).a},function(e,t,i){"use strict";var n=i(8);i.n(n).a},function(e,t,i){"use strict";var n=i(9);i.n(n).a},function(e,t,i){"use strict";var n=i(10);i.n(n).a},function(e,t,i){"use strict";var n=i(11);i.n(n).a},function(e,t,i){"use strict";var n=i(12);i.n(n).a},function(e,t,i){"use strict";var n=i(13);i.n(n).a},function(e,t,i){"use strict";var n=i(14);i.n(n).a},function(e,t,i){"use strict";var n=i(15);i.n(n).a},function(e,t,i){"use strict";var n=i(16);i.n(n).a},function(e,t,i){"use strict";i.r(t);i(21);var n=i(1),s=i.n(n),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app"},[i("div",{staticClass:"header"},[i("h1",{on:{click:function(t){return e.gotoIndex()}}},[e._v("CrowdSpec")]),e._v(" "),i("div",[i("span",[e._v(e._s(e.username))]),e._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.logout()}}},[e._v("Log out")])],1)]),e._v(" "),i("div",{staticClass:"content-area"},[i("router-view")],1)])};o._withStripped=!0;var l=i(0),r=i.n(l),c=i(17),a=i.n(c);s.a.use(a.a);var u=r()(window),d=new a.a.Store({state:{windowWidth:u.width(),dragging:!1,moving:null,savedScrollPosition:null},getters:{userID:function(e){return window.user.id},username:function(e){return window.user.username},dialogTinyWidth:function(e){return e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(e){return e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(e){return e.windowWidth<=991?"95%":"90%"}},mutations:{setWindowWidth:function(e,t){e.windowWidth=t},startDragging:function(e){e.dragging=!0},endDragging:function(e){e.dragging=!1},startMoving:function(e,t){e.moving=t},endMoving:function(e){e.moving=null},setSavedScrollPosition:function(e,t){e.savedScrollPosition=t},clearSavedScrollPosition:function(e){e.savedScrollPosition=null}}}),p=d;u.on("resize",(function(){d.commit("setWindowWidth",u.width())}));var f=i(18),h=i.n(f),b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"index-page"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.promptCreateSpec()}}},[e._v("New spec")]),e._v(" "),i("div",{staticClass:"user-specs"},[i("h2",[e._v("Your specs")]),e._v(" "),e.loading?i("p",[e._v("Loading...")]):e.userSpecs&&e.userSpecs.length?i("ul",e._l(e.userSpecs,(function(t){return i("li",{key:t.id},[i("router-link",{attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))])],1)})),0):i("p",[e._v("You do not have any specs.")])]),e._v(" "),i("edit-spec-modal",{ref:"editSpecModal"})],1)};b._withStripped=!0;var v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:e.spec?"Manage spec":"Create spec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[i("label",[e._v("\n\t\tName\n\t\t"),i("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),i("label",[e._v("\n\t\tDescription\n\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),e.spec?i("p",[e._v("Created "+e._s(e.spec.created))]):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.spec?i("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSpec()}}},[e._v("Delete")]):e._e(),e._v(" "),i("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.spec?"Save":"Create"))])],1)])};v._withStripped=!0;var m=/^VersionStamp: (.+)$/m;function g(e){console.error(e);var t=null;(e&&(0===e.readyState?t="Could not connect to server.":e.readyState&&e.status?t="Request failed with error code "+e.status+".":e.message?t=e.message:"string"==typeof e&&(t=e)),t||(t="An error occurred."),e&&e.responseText&&m.test(e.responseText))&&(m.exec(e.responseText)[1]!==window.appVersion&&(t+=" (A new version is available. Reload this page to use the latest client code.)"));s.a.prototype.$alert(t,"Error",{confirmButtonText:"Ok",type:"error"})}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(e?" | ":"")+e}function k(e){if(window.URL)try{return new URL(e),!0}catch(e){return!1}return!(!e||!e.trim())}var y=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function w(e){return y.test(e)}function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function I(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){$(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function $(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function T(e){return r.a.get("/ajax/spec",{specId:e}).fail(g)}function x(e,t){return r.a.get("/ajax/spec/subspec",{specId:e,subspecId:t}).fail(g)}function C(e,t,i,n){return r.a.post("/ajax/spec/move-block",{blockId:e,subspecId:t,parentId:i,insertBeforeId:n}).fail(g)}var j={data:function(){return{name:"",desc:"",spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){r()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var i=this;this.spec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((function(){r()("input",i.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,i,n=this.callback;(t=this.name,i=this.desc,r.a.post("/ajax/spec/create-spec",{name:t,desc:i}).fail(g)).then((function(t){n(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,i,n,s=this.callback;(t=this.spec.id,i=this.name,n=this.desc,r.a.post("/ajax/spec/save-spec",{specId:t,name:i,desc:n}).fail(g)).then((function(t){s(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSpec:function(){var e=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.spec.id,r.a.post("/ajax/spec/delete-spec",{specId:t}).fail(g)).then((function(){e.sending=!1,e.showing=!1,e.$router.push({name:"index"})})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc=""}}};i(22);function O(e,t,i,n,s,o,l,r){var c,a="function"==typeof e?e.options:e;if(t&&(a.render=t,a.staticRenderFns=i,a._compiled=!0),n&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),l?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},a._ssrRegister=c):s&&(c=r?function(){s.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:s),c)if(a.functional){a._injectStyles=c;var u=a.render;a.render=function(e,t){return c.call(t),u(e,t)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:a}}var E=O(j,v,[],!1,null,null,null);E.options.__file="src/spec/edit-spec-modal.vue";var U=E.exports,B={components:{EditSpecModal:U},data:function(){return{userSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(e,t,i){this.reloadSpecs(),i()},methods:{reloadSpecs:function(){var e=this;this.loading=!0,r.a.get("/ajax/user-specs").then((function(t){e.userSpecs=t,e.loading=!1})).fail((function(t){e.loading=!1,g(t)}))},promptCreateSpec:function(){var e=this;this.$refs.editSpecModal.showCreate((function(t){e.$router.push({name:"spec",params:{specId:t}})}))}}},P=(i(23),O(B,b,[],!1,null,null,null));P.options.__file="src/pages/index.vue";var R=P.exports,M=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.spec?i("section",{staticClass:"spec-page"},[i("header",[i("div",{staticClass:"right"},[e.currentUserOwns?i("span",[e._v("You own this")]):i("span",[e._v("Owned by "+e._s(e.spec.ownerType)+" "+e._s(e.spec.ownerId))]),e._v(" "),e.spec.public?i("span",[e._v("\n\t\t\t\tPublic\n\t\t\t")]):i("span",[i("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[i("i",{staticClass:"el-icon-lock"})])],1),e._v(" "),i("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSpec()}}})],1),e._v(" "),i("h2",[e._v(e._s(e.name))]),e._v(" "),e.desc?i("div",{staticClass:"desc"},[e._v(e._s(e.desc))]):e._e()]),e._v(" "),i("spec-view",{key:e.spec.id,attrs:{spec:e.spec}}),e._v(" "),i("edit-spec-modal",{ref:"editSpecModal"})],1):e._e()};M._withStripped=!0;var A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.spec||e.subspec?i("div",{staticClass:"spec-view"},[i("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:e.dragging}}),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.promptAddBlock()}}},[e._v("Add block")]),e._v(" "),i("ul",{ref:"mirrorList",staticClass:"mirror-list"}),e._v(" "),i("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId},on:{"open-edit-url":e.openEditUrl,"play-video":e.playVideo}}),e._v(" "),i("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":e.specId}}),e._v(" "),i("play-video-modal",{ref:"playVideoModal"})],1):e._e()};A._withStripped=!0;var D=i(19),F=i.n(D),L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",{staticClass:"spec-block",class:e.classes,attrs:{"data-spec-block":e.block.id}},[i("div",{staticClass:"content"},[i("div",{staticClass:"bg"}),e._v(" "),i("div",{staticClass:"layover",on:{mouseleave:function(t){return e.mouseLeaveLayover()}}},[i("div",{staticClass:"expand-control",class:{hide:e.showActions}},[i("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(t){e.focusActions=!0}}})],1),e._v(" "),i("div",{staticClass:"actions",class:{show:e.showActions}},[e.choosingAddPosition?[i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelChooseAddPosition()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.addBeforeThis()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.addIntoThis()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.addAfterThis()}}})]:e.movingThis?[i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.cancelMoving()}}},[e._v("Cancel move")])]:e.movingAnother?[i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelMoving()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.moveBeforeThis()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.moveIntoThis()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.moveAfterThis()}}})]:[i("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editBlock()}}}),e._v(" "),i("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDeleteBlock()}}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.enterChooseAddPosition()}}}),e._v(" "),i("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(t){return e.startMoving()}}}),e._v(" "),i("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(t){return e.startMoving()}}})]],2)]),e._v(" "),e.title?i("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.refType&&e.refItem?[e.refType===e.REF_TYPE_URL?i("ref-url",{staticClass:"ref-item",attrs:{item:e.refItem},on:{play:function(t){return e.raisePlayVideo(e.refItem)}}}):e.refType===e.REF_TYPE_SUBSPEC?i("ref-subspec",{staticClass:"ref-item",attrs:{item:e.refItem}}):e._e()]:e._e(),e._v(" "),e.body?i("div",{staticClass:"body"},[e._v(e._s(e.body))]):e._e()],2),e._v(" "),i("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:e.movingThis}})])};L._withStripped=!0;var V=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ref-url"},[e.item.imageData?i("img",{attrs:{src:e.item.imageData}}):e._e(),e._v(" "),i("div",[e.showEdit||e.showPlay?i("div",{staticClass:"right"},[e.showEdit?i("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.$emit("edit")}}}):e._e(),e._v(" "),e.showPlay?i("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$emit("play")}}},[e._v("Play")]):e._e()],1):e._e(),e._v(" "),i("div",{staticClass:"title"},[e._m(0),e._v(" "),i("a",{attrs:{href:e.item.url,target:"_blank"}},[e._v(e._s(e.item.title&&e.item.title.trim()||e.item.url))])]),e._v(" "),e.item.desc?i("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};V._withStripped=!0;var z={props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return w(this.item.url)}}},N=(i(24),O(z,V,[function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("i",{staticClass:"el-icon-link"}),this._v(" URL")])}],!1,null,null,null));N.options.__file="src/spec/ref-url.vue";var W=N.exports,Y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ref-subspec"},[i("div",[i("div",{staticClass:"title"},[e._m(0),e._v(" "),i("router-link",{attrs:{to:{name:"subspec",params:{specId:e.item.specId,subspecId:e.item.id}}}},[e._v("\n\t\t\t\t"+e._s(e.item.name.trim())+"\n\t\t\t")])],1),e._v(" "),e.item.desc?i("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};Y._withStripped=!0;var q={props:{item:Object}},X=(i(25),O(q,Y,[function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("i",{staticClass:"el-icon-s-unfold"}),this._v(" Subspec")])}],!1,null,null,null));X.options.__file="src/spec/ref-subspec.vue";var Q=X.exports,Z={components:{RefUrl:W,RefSubspec:Q},props:{block:Object,eventBus:Object},data:function(){return{styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},classes:function(){return[this.styleType]},movingThis:function(){return this.$store.state.moving===this.block.id},movingAnother:function(){return this.$store.state.moving&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var e=r()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId:function(){var e=r()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock:function(){var e=this;this.raiseOpenEdit({id:this.block.id,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(t){e.styleType=t.styleType,e.contentType=t.contentType,e.refType=t.refType,e.refId=t.refId,e.refItem=t.refItem,e.title=t.title,e.body=t.body}))},raiseOpenEdit:function(e,t){this.$emit("open-edit",e,t)},promptDeleteBlock:function(){var e=this;this.raisePromptDeleteBlock(this.block.id,(function(){r()(e.$el).remove()}))},raisePromptDeleteBlock:function(e,t){this.$emit("prompt-delete-block",e,t)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t)},addIntoThis:function(){var e=this.block.id;this.raisePromptAddSubblock(e,null)},addAfterThis:function(){var e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t)},raisePromptAddSubblock:function(e,t){this.$emit("prompt-add-subblock",e,t)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},moveBeforeThis:function(){var e=this,t=this.$store.state.moving,i=this.getParentId(),n=this.block.id;C(t,null,i,n).then((function(){r()('[data-spec-block="'+t+'"]').insertBefore(e.$el),e.$store.commit("endMoving")}))},moveIntoThis:function(){var e=this,t=this.$store.state.moving,i=this.block.id;C(t,null,i,null).then((function(){r()('[data-spec-block="'+t+'"]').appendTo(e.$refs.sublist),e.$store.commit("endMoving")}))},moveAfterThis:function(){var e=this,t=this.$store.state.moving,i=this.getParentId(),n=this.getFollowingBlockId();C(t,null,i,n).then((function(){r()('[data-spec-block="'+t+'"]').insertAfter(e.$el),e.$store.commit("endMoving")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(e){"url"===this.refType&&e.id===this.refId&&(this.refItem=e)},urlDeleted:function(e){"url"===this.refType&&e===this.refId&&(this.refType=null,this.refId=null,this.refItem=null)},raisePlayVideo:function(e){this.$emit("play-video",e)}}},G=(i(26),O(Z,L,[],!1,null,null,null));G.options.__file="src/spec/block.vue";var H=G.exports,J=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:e.block?"Edit block":"Add block",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[i("el-radio-group",{model:{value:e.styleType,callback:function(t){e.styleType=t},expression:"styleType"}},[i("el-radio",{attrs:{label:"bullet"}},[e._v("Bullet point")]),e._v(" "),i("el-radio",{attrs:{label:"numbered"}},[e._v("Numbered point")]),e._v(" "),i("el-radio",{attrs:{label:"none"}},[e._v("Indented block")])],1),e._v(" "),i("label",[e._v("\n\t\tTitle\n\t\t"),i("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),i("label",[e._v("\n\t\tBody\n\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),i("el-radio-group",{model:{value:e.refType,callback:function(t){e.refType=t},expression:"refType"}},[i("el-radio",{attrs:{label:null}},[e._v("No media")]),e._v(" "),i("el-radio",{attrs:{label:e.REF_TYPE_SUBSPEC}},[e._v("Subspec")]),e._v(" "),i("el-radio",{attrs:{label:e.REF_TYPE_URL}},[e._v("URL")])],1),e._v(" "),e.refType===e.REF_TYPE_URL?i("ref-url-form",{attrs:{"spec-id":e.specId,"initial-url-object":e.existingUrlRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t},"open-edit-url":e.openEditUrl,"play-video":e.raisePlayVideo}}):e.refType===e.REF_TYPE_SUBSPEC?i("ref-subspec-form",{attrs:{"spec-id":e.specId,"initial-subspec":e.existingSubspecRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t}}}):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),i("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v("\n\t\t\t"+e._s(e.block?"Save":"Add")+"\n\t\t")])],1)],1)};J._withStripped=!0;var K=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ref-url-form"},[e.creating?i("el-card",[i("label",[e._v("\n\t\t\tNew link URL\n\t\t\t"),i("el-input",{attrs:{clearable:""},model:{value:e.newUrl,callback:function(t){e.newUrl=t},expression:"newUrl"}}),e._v(" "),e.newUrl&&!e.isValid?i("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):e.newUrlIsVideo?i("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):e._e()],1),e._v(" "),e.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?i("p",[e._v("Loading links...")]):e.urlObjects&&e.urlObjects.length?[i("el-select",{attrs:{filterable:"","filter-method":e.filterUrls,placeholder:"Select link"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.filteredUrlObjects,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.title||e.url}})})),1),e._v(" "),e.selectedUrlObject?i("ref-url",{attrs:{item:e.selectedUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.selectedUrlObject)},play:function(t){return e.raisePlayVideo(e.selectedUrlObject)}}}):e._e()]:e._e(),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new link\n\t\t")])]:[e.initialUrlObject?i("ref-url",{attrs:{item:e.initialUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.initialUrlObject)},play:function(t){return e.raisePlayVideo(e.initialUrlObject)}}}):e._e(),e._v(" "),i("div",[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new link\n\t\t\t")]),e._v(" "),e.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):e._e()],1)]],2)};K._withStripped=!0;var ee={components:{RefUrl:W},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!1,selecting:!this.initialUrlObject,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var e=this.filter.toLowerCase(),t=[],i=0;i<this.urlObjects.length;i++){var n=this.urlObjects[i];(n.url.toLowerCase().indexOf(e)>=0||n.title&&n.title.toLowerCase().indexOf(e)>=0)&&t.push(n)}return t}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.refId)return this.urlObjects[e];return null},newUrlIsVideo:function(){return k(this.newUrl)&&w(this.newUrl)},isValid:function(){return this.creating?k(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadLinks()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadLinks:function(){var e,t=this;this.loading||(this.loading=!0,(e=this.specId,r.a.get("/ajax/spec/urls",{specId:e}).fail(g)).then((function(e){t.urlObjects=e,e.length||(t.selecting=!1,t.initialUrlObject||(t.creating=!0)),t.loading=!1})).fail((function(){t.urlObjects=[],t.selecting=!1,t.initialUrlObject||(t.creating=!0),t.loading=!1})))},filterUrls:function(e){var t=this;e?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function n(){t=null,e.apply(this,arguments)}return function(){return t&&clearTimeout(t),t=setTimeout(n.bind.apply(n,[this].concat(Array.prototype.slice.call(arguments))),i)}}((function(e){t.filter=e}))),this.debouncedUpdateFilter(e)):this.filter=""},openEditUrl:function(e){var t=this;this.$emit("open-edit-url",e,(function(i){if(t.urlObjects)for(var n=0;n<t.urlObjects.length;n++)if(t.urlObjects[n].id===e.id){t.urlObjects.splice(n,1,i);break}}),(function(){if(t.urlObjects)for(var i=0;i<t.urlObjects.length;i++)if(t.urlObjects[i].id===e.id){t.urlObjects.splice(i,1);break}t.refId===e.id&&(t.refId=null)}))},raisePlayVideo:function(e){this.$emit("play-video",e)}}},te=(i(27),O(ee,K,[],!1,null,null,null));te.options.__file="src/spec/ref-url-form.vue";var ie=te.exports,ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ref-subspec-form"},[e.creating?i("el-card",[i("label",[e._v("\n\t\t\tNew subspec name\n\t\t\t"),i("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:e.subspecName,callback:function(t){e.subspecName=t},expression:"subspecName"}})],1),e._v(" "),i("label",[e._v("\n\t\t\tDescription\n\t\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.subspecDesc,callback:function(t){e.subspecDesc=t},expression:"subspecDesc"}})],1),e._v(" "),e.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?i("p",[e._v("Loading subspecs...")]):e.subspecs&&e.subspecs.length?[i("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.subspecs,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?i("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:e._e(),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new subspec\n\t\t")])]:[e.initialSubspec?i("ref-subspec",{attrs:{item:e.initialSubspec}}):e._e(),e._v(" "),i("div",[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),e._v(" "),e.selectModeAvailable?i("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):e._e()],1)]],2)};ne._withStripped=!0;var se={components:{RefSubspec:Q},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.refId)return this.subspecs[e];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadSubspecs:function(){var e,t=this;this.loading||(this.loading=!0,(e=this.specId,r.a.get("/ajax/spec/subspecs",{specId:e}).fail(g)).then((function(e){t.subspecs=e,e.length||(t.creating=!0),t.loading=!1})).fail((function(){t.subspecs=[],t.creating=!0,t.loading=!1})))}}},oe=(i(28),O(se,ne,[],!1,null,null,null));oe.options.__file="src/spec/ref-subspec-form.vue";var le={components:{RefUrlForm:ie,RefSubspecForm:oe.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&"url"===this.block.refType&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&"subspec"===this.block.refType&&this.block.refItem||null}},watch:{refType:function(e){this.refFields=null}},methods:{showAdd:function(e,t,i){this.parentId=e,this.insertBeforeId=t,this.callback=i,this.showing=!0,this.focusTitleInput()},showEdit:function(e,t){this.block=e,this.styleType=e.styleType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var e=this;this.$nextTick((function(){r()("input",e.$refs.titleInput.$el).focus()}))},openEditUrl:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(function(e){t.existingUrlRefItem&&e.id===t.existingUrlRefItem.id&&(t.block.refItem=e),i&&i(e)}),(function(e){t.existingUrlRefItem&&e===t.existingUrlRefItem.id&&(t.block.refType=null,t.block.refId=null,t.block.refItem=null),n&&n(e)}))},raisePlayVideo:function(e){this.$emit("play-video",e)},submit:function(){var e=this;if(!this.disableSubmit){var t,i,n,s,o,l,c,a,u=this.createSendingSpinner(),d=this.callback;this.block?(t=this.specId,i=this.block.id,n=this.styleType,s="plaintext",o=this.title,l=this.body,c=this.refType,a=this.refFields,a=a||{},r.a.post("/ajax/spec/save-block",I({specId:t,blockId:i,styleType:n,contentType:s,title:o,body:l,refType:c},a)).fail(g)).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()})):function(e,t,i,n,s,o,l,c,a,u){return u=u||{},r.a.post("/ajax/spec/create-block",I({specId:e,subspecId:t,parentId:i,insertBeforeId:n,styleType:s,contentType:o,title:l,body:c,refType:a},u)).fail(g)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,"plaintext",this.title,this.body,this.refType,this.refFields).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},re=(i(29),O(le,J,[],!1,null,null,null));re.options.__file="src/spec/edit-block-modal.vue";var ce=re.exports,ae=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:e.urlObject?"Manage link":"Create link",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[i("label",[e._v("\n\t\tURL\n\t\t"),i("el-input",{ref:"urlInput",model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1),e._v(" "),e.urlObject?[e.url===e.urlObject.url?i("div",{staticClass:"preview"},[e.urlObject.imageData?i("img",{attrs:{src:e.urlObject.imageData}}):e._e(),e._v(" "),i("div",[e.urlObject.title?i("h3",[e._v(e._s(e.urlObject.title.trim()))]):e._e(),e._v(" "),e.urlObject.desc?i("div",[e._v(e._s(e.urlObject.desc.trim()))]):e._e(),e._v(" "),e.autoRefresh?i("p",[e._v("URL preview will be updated")]):i("el-checkbox",{model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}},[e._v("Refresh URL preview")])],1)]):i("p",[e._v("Link will be updated with new URL")])]:e._e(),e._v(" "),e.urlObject?i("p",[e._v("Updated "+e._s(e.urlObject.updated))]):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.urlObject?i("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),i("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.urlObject?"Save":"Create"))])],1)],2)};ae._withStripped=!0;var ue={props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=k,!k(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(e){var t=this;this.createdCallback=e,this.showing=!0,this.$nextTick((function(){r()("input",t.$refs.urlInput.$el).focus()}))},showEdit:function(e,t,i){var n=this;this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=i,this.showing=!0,this.$nextTick((function(){r()("input",n.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,i,n=this.createdCallback;(t=this.specId,i=this.url,r.a.post("/ajax/spec/create-url",{specId:t,url:i}).fail(g)).then((function(t){n(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,i,n=this.updatedCallback;(t=this.urlObject.id,i=this.url,r.a.post("/ajax/spec/refresh-url",{id:t,url:i}).fail(g)).then((function(t){n(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},promptDelete:function(){var e=this;this.$confirm("Permanently delete this link?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){e.sending=!0;var t,i=e.deletedCallback;(t=e.urlObject.id,r.a.post("/ajax/spec/delete-url",{id:t}).fail(g)).then((function(){i&&i(e.urlObject.id),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},de=(i(30),O(ue,ae,[],!1,null,null,null));de.options.__file="src/spec/edit-url-modal.vue";var pe=de.exports,fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"play-video-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogSmallWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.vid?i("div",{staticClass:"embed-responsive"},["youtube"===e.vid.type?i("iframe",{attrs:{src:"https://www.youtube.com/embed/"+e.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===e.vid.type?i("iframe",{attrs:{src:"https://player.vimeo.com/video/"+e.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):e._e()]):e._e()])};fe._withStripped=!0;var he={data:function(){return{vid:null,showing:!1}},methods:{show:function(e){var t,i,n=(t=e.url,(i=y.exec(t))?t.indexOf("youtube.com")||t.indexOf("youtu.be")?{type:"youtube",id:i[1]}:t.indexOf("vimeo.com")?{type:"vimeo",id:i[1]}:null:null);n&&(this.vid=n,this.showing=!0)},closed:function(){this.vid=null}}},be=(i(31),O(he,fe,[],!1,null,null,null));be.options.__file="src/spec/play-video-modal.vue";var ve=be.exports,me=s.a.extend(H),ge={components:{EditBlockModal:ce,EditUrlModal:pe,PlayVideoModal:ve},props:{spec:Object,subspec:Object},data:function(){return{autoscroller:null,eventBus:new s.a}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null}},watch:{dragging:function(e){e?this.autoscroller=function(){var e=r()(window),t=null,i=null;function n(e){i=e.clientY}return e.on("mousemove",n),t=window.requestAnimationFrame((function n(){if(null!==i){var s=e.height(),o=0;if(i<70)o=-(8*((70-i)/70)+1);else if(i>s-70){o=8*((i-(s-70))/70)+1}0!==o&&e.scrollTop(e.scrollTop()+o)}t=window.requestAnimationFrame(n)})),{stop:function(){e.off("mousemove",n),t&&(window.cancelAnimationFrame(t),t=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var e,t=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var i=function e(i,n){for(var s=0;s<n.length;s++){var o=n[s],l=t.insertBlock(o,!1);r()(">ul.spec-block-list",i).append(l),o.subblocks&&e(l,o.subblocks)}},n=0;n<e.length;n++){var s=e[n],o=this.insertBlock(s);s.subblocks&&i(o,s.subblocks)}this.drake=F()({isContainer:function(e){return r()(e).is(".spec-block-list")},accepts:function(e,t,i,n){return!r()(t).closest(".gu-transit").length},moves:function(e,t,i,n){return r()(i).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(e,i){t.$store.commit("startDragging"),t.transitRelativeScroll(r()(e).attr("data-spec-block"))})).on("dragend",(function(e){t.$store.commit("endDragging"),t.transitRelativeScroll(r()(e).attr("data-spec-block"))})).on("drop",(function(e,t,i,n){var s=r()(t).closest("[data-spec-block]"),o=s.length?s.data("vc").getBlockId():null,l=n?r()(n).data("vc").getBlockId():null;C(r()(e).data("vc").getBlockId(),null,o,l)}))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,r()("[data-spec-block]",this.$refs.list).each((function(e,t){r()(t).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var e=this,t=r()(window).scrollTop();r()("[data-spec-block]",this.$refs.list).each((function(i,n){var s=r()(n).offset();if(s.top>t){var o=s.top-t;return e.$nextTick((function(){r()(window).scrollTop(r()(n).offset().top-o)})),!1}}))},transitRelativeScroll:function(e){var t=r()(window).scrollTop(),i=r()('[data-spec-block="'+e+'"]',this.$refs.list),n=i.offset().top-t;this.$nextTick((function(){r()(window).scrollTop(i.offset().top-n)}))},insertBlock:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new me({parent:this,store:p,router:De,propsData:{block:e,eventBus:this.eventBus}}).$mount();i.$on("open-edit",this.openEdit),i.$on("prompt-add-subblock",this.promptAddSubblock),i.$on("prompt-delete-block",this.promptDeleteBlock),i.$on("start-moving",this.startMovingBlock),i.$on("end-moving",this.endMovingBlock),i.$on("play-video",this.playVideo);var n=r()(i.$el).data("vc",i);return t&&n.appendTo(this.$refs.list),n},promptAddBlock:function(){this.$refs.editBlockModal.showAdd(null,null,this.insertBlock)},openEdit:function(e,t){this.$refs.editBlockModal.showEdit(e,t)},promptAddSubblock:function(e,t){var i=this;this.$refs.editBlockModal.showAdd(e,t,(function(n){var s=i.insertBlock(n,!1);t?s.insertBefore('[data-spec-block="'+t+'"]'):e?s.appendTo('[data-spec-block="'+e+'"]>ul.spec-block-list'):s.appendTo(i.$refs.list)}))},promptDeleteBlock:function(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(e){return r.a.post("/ajax/spec/delete-block",{blockId:e}).fail(g)})(e).then(t)})).catch((function(){}))},startMovingBlock:function(e){this.$store.commit("startMoving",e),this.transitRelativeScroll(e)},endMovingBlock:function(e){this.$store.commit("endMoving"),this.transitRelativeScroll(e)},openEditUrl:function(e,t,i){var n=this;this.$refs.editUrlModal.showEdit(e,(function(e){n.eventBus.$emit("url-updated",e),t&&t(e)}),(function(e){n.eventBus.$emit("url-deleted",e),i&&i(e)}))},playVideo:function(e){this.$refs.playVideoModal.show(e)}}},_e=(i(32),O(ge,A,[],!1,null,null,null));_e.options.__file="src/spec/view.vue";var ke=_e.exports,ye={components:{SpecView:ke,EditSpecModal:U},data:function(){return{spec:null,name:"",desc:""}},computed:{currentUserOwns:function(){return"user"===this.spec.ownerType&&this.$store.getters.userID===this.spec.ownerId}},beforeRouteEnter:function(e,t,i){T(e.params.specId).then((function(e){i((function(t){t.setSpec(e)}))})).fail((function(e){i({name:"ajax-error",params:{code:e.status},replace:!0})}))},beforeRouteUpdate:function(e,t,i){var n=this;T(e.params.specId).then((function(e){n.setSpec(e),i()})).fail((function(e){i({name:"ajax-error",params:{code:e.status},replace:!0})}))},beforeRouteLeave:function(e,t,i){_(),i()},methods:{setSpec:function(e){this.spec=e,this.name=e.name,this.desc=e.desc,_(e.name),this.$nextTick(this.restoreScroll)},openManageSpec:function(){var e=this;this.$refs.editSpecModal.showEdit({id:this.spec.id,name:this.name,desc:this.desc,created:this.spec.created},(function(t){e.name=t.name,e.desc=t.desc,_(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e&&r()(window).scrollTop(e.y).scrollLeft(e.x)}}},we=(i(33),O(ye,M,[],!1,null,null,null));we.options.__file="src/pages/spec.vue";var Se=we.exports,Ie=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.subspec?i("section",{staticClass:"subspec-page"},[i("header",[i("div",{staticClass:"spec",on:{click:function(t){return e.gotoSpec()}}},[i("h2",[e._v("\n\t\t\t\t"+e._s(e.subspec.specName)+"\n\t\t\t")])]),e._v(" "),i("div",{staticClass:"subspec"},[i("h3",[i("div",{staticClass:"right"},[i("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSubspec()}}})],1),e._v("\n\t\t\t\t"+e._s(e.name)+"\n\t\t\t")]),e._v(" "),e.desc?i("div",{staticClass:"desc"},[e._v(e._s(e.desc))]):e._e()])]),e._v(" "),i("spec-view",{key:e.subspec.id,attrs:{subspec:e.subspec}}),e._v(" "),i("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":e.subspec.specId}})],1):e._e()};Ie._withStripped=!0;var $e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:e.subspec?"Manage subspec":"Create subspec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[i("label",[e._v("\n\t\tName\n\t\t"),i("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),i("label",[e._v("\n\t\tDescription\n\t\t"),i("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),e.subspec?i("p",[e._v("Created "+e._s(e.subspec.created))]):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.subspec?i("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSubspec()}}},[e._v("Delete")]):e._e(),e._v(" "),i("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.subspec?"Save":"Create"))])],1)])};$e._withStripped=!0;var Te={props:{specId:{type:Number,required:!0}},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){r()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var i=this;this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((function(){r()("input",i.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,i,n,s=this.callback;(t=this.specId,i=this.name,n=this.desc,r.a.post("/ajax/spec/create-subspec",{specId:t,name:i,desc:n}).fail(g)).then((function(t){s(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,i,n,s=this.callback;(t=this.subspec.id,i=this.name,n=this.desc,r.a.post("/ajax/spec/save-subspec",{subspecId:t,name:i,desc:n}).fail(g)).then((function(t){s(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSubspec:function(){var e=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.subspec.id,r.a.post("/ajax/spec/delete-subspec",{subspecId:t}).fail(g)).then((function(){e.sending=!1,e.showing=!1,e.$router.push({name:"spec",params:{specId:e.specId}})})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},xe=(i(34),O(Te,$e,[],!1,null,null,null));xe.options.__file="src/spec/edit-subspec-modal.vue";var Ce={components:{SpecView:ke,EditSubspecModal:xe.exports},data:function(){return{subspec:null,name:"",desc:""}},beforeRouteEnter:function(e,t,i){x(e.params.specId,e.params.subspecId).then((function(e){i((function(t){t.setSubspec(e)}))})).fail((function(e){i({name:"ajax-error",params:{code:e.status},replace:!0})}))},beforeRouteUpdate:function(e,t,i){var n=this;x(e.params.specId,e.params.subspecId).then((function(e){n.setSubspec(e),i(),n.$nextTick(n.restoreScroll)})).fail((function(e){i({name:"ajax-error",params:{code:e.status},replace:!0})}))},beforeRouteLeave:function(e,t,i){_(),i()},methods:{setSubspec:function(e){this.subspec=e,this.name=e.name,this.desc=e.desc,_(e.name),this.$nextTick(this.restoreScroll)},gotoSpec:function(){this.$router.push({name:"spec",params:{specId:this.subspec.specId}})},openManageSubspec:function(){var e=this;this.$refs.editSubspecModal.showEdit({id:this.subspec.id,name:this.name,desc:this.desc,created:this.subspec.created},(function(t){e.name=t.name,e.desc=t.desc,_(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e&&r()(window).scrollTop(e.y).scrollLeft(e.x)}}},je=(i(35),O(Ce,Ie,[],!1,null,null,null));je.options.__file="src/pages/subspec.vue";var Oe=je.exports,Ee=function(){var e=this.$createElement;return(this._self._c||e)("div",[0===parseInt(this.$route.params.code,10)?[this._v("\n\t\tCould not connect to server\n\t")]:[this._v("\n\t\tRequest failed with error code "+this._s(this.$route.params.code)+"\n\t")]],2)};Ee._withStripped=!0;var Ue=O({},Ee,[],!1,null,null,null);Ue.options.__file="src/pages/ajax-error.vue";var Be=Ue.exports,Pe=function(){var e=this.$createElement;return(this._self._c||e)("div",[this._v("\n\tNot found\n")])};Pe._withStripped=!0;var Re=O({},Pe,[],!1,null,null,null);Re.options.__file="src/pages/not-found.vue";var Me=Re.exports,Ae=new h.a({mode:"history",routes:[{name:"index",path:"/",component:R},{name:"spec",path:"/spec/:specId",component:Se},{name:"subspec",path:"/spec/:specId/subspec/:subspecId",component:Oe},{name:"ajax-error",path:"/ajax-error/:code",component:Be},{path:"*",component:Me}],scrollBehavior:function(e,t,i){return p.commit("setSavedScrollPosition",i),e.hash?{selector:e.hash}:i||{x:0,y:0}}});Ae.afterEach((function(e,t){p.commit("clearSavedScrollPosition")}));var De=Ae,Fe={store:p,router:De,computed:{username:function(){return this.$store.getters.username}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"}}},Le=(i(36),O(Fe,o,[],!1,null,null,null));Le.options.__file="src/app.vue";var Ve=Le.exports;ELEMENT.locale(ELEMENT.lang.en),new s.a(Ve).$mount("#app")}]);