(()=>{"use strict";var e={311:(e,t)=>{t.Z=(e,t)=>{const o=e.__vccOpts||e;for(const[e,s]of t)o[e]=s;return o}}},t={};function o(s){var n=t[s];if(void 0!==n)return n.exports;var l=t[s]={exports:{}};return e[s](l,l.exports,o),l.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=Vue,t=ElementPlus;var s=o.n(t);const n=ElementPlusLocaleEn;var l=o.n(n);const i={class:"app"},a={key:0},r=[(0,e.createElementVNode)("span",null,"Loading...",-1)],c={key:1},d=(0,e.createTextVNode)("Log out"),m={key:2},u=(0,e.createTextVNode)("Log in"),p=(0,e.createTextVNode)("Sign up"),h={class:"username"},g=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,k=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,b=/^#[0-9a-f]{6}$/i;function f(e){if(e&&"object"==typeof e){if(e.hsl)return C(e);if(e.rgb)return e}else if("string"==typeof e){if(g.test(e)){let t=g.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(b.test(e)){function t(e){e=e.toLowerCase();let t=0;for(let o=0;o<e.length;o++){let s=e.charCodeAt(e.length-1-o);s>=48&&s<=57?t+=(s-48)*Math.pow(16,o):s>=97&&s<=122&&(t+=(s-97+10)*Math.pow(16,o))}return t}return{r:t(e.substr(1,2)),g:t(e.substr(3,2)),b:t(e.substr(5,2)),rgb:!0}}if(k.test(e))return C(e)}return{r:0,g:0,b:0,rgb:!0}}function y(e){if(e&&"object"==typeof e){if(e.hsl)return e;if(e.rgb)return w(e)}else if("string"==typeof e){if(k.test(e)){let t=k.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(g.test(e)||b.test(e))return w(e)}return{h:0,s:0,l:0,hsl:!0}}function C(e){if(e&&"object"==typeof e&&e.rgb)return e;let t,o,s,n=(e=y(e)).h,l=e.s/100,i=e.l/100,a=(1-Math.abs(2*i-1))*l,r=a*(1-Math.abs(n/60%2-1)),c=i-a/2;return 0<=n&&n<60?(t=a,o=r,s=0):60<=n&&n<120?(t=r,o=a,s=0):120<=n&&n<180?(t=0,o=a,s=r):180<=n&&n<240?(t=0,o=r,s=a):240<=n&&n<300?(t=r,o=0,s=a):300<=n&&n<360&&(t=a,o=0,s=r),{r:Math.round(255*(t+c)),g:Math.round(255*(o+c)),b:Math.round(255*(s+c)),rgb:!0}}function w(e){if(e&&"object"==typeof e&&e.hsl)return e;let t,o=(e=f(e)).r/255,s=e.g/255,n=e.b/255,l=Math.min(o,s,n),i=Math.max(o,s,n),a=i-l;t=0==a?0:i==o?(s-n)/a%6:i==s?(n-o)/a+2:(o-s)/a+4,t=Math.round(60*t);let r=(i+l)/2;return{h:t<0?t+360:t,s:+(100*(0==a?0:a/(1-Math.abs(2*r-1)))).toFixed(1),l:+(100*r).toFixed(1),hsl:!0}}function v(e){let t=f(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}const V={name:"username",props:{username:{type:String,required:!0},highlight:String},computed:{style(){let e=this.username===this.$store.getters.username?this.$store.getters.userSettings.userProfile.highlightUsername:this.highlight;if(!e)return null;let t=v(e),o=v(function(e){let t=y(e);return t.l<=25?t.l=75:t.l<=50?t.l=90:t.l<=75?t.l=10:t.l=25,t}(e));return{color:t,"text-shadow":"-1px -1px 0 "+o+", 1px -1px 0 "+o+", -1px 1px 0 "+o+", 1px 1px 0 "+o}}}};var B=o(311);const N=(0,B.Z)(V,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",h,[(0,e.createElementVNode)("i",{class:"material-icons",style:(0,e.normalizeStyle)(i.style)},"person",4),(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(s.username),1)])}]]),E=(0,e.createTextVNode)(" Account options for "),S=(0,e.createElementVNode)("strong",{class:"section-heading"},"Profile",-1),x={class:"flex-input"},T=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),I=(0,e.createElementVNode)("strong",{class:"section-heading"},"Block editing",-1),P=(0,e.createElementVNode)("strong",{class:"section-heading"},"Community",-1),U=(0,e.createTextVNode)(" Show only unread comments by default "),R=(0,e.createTextVNode)(" Update "),_=(0,e.createTextVNode)(" Cancel "),M=(0,e.createElementVNode)("p",null,[(0,e.createTextVNode)("Your password is sent through HTTPS to Google Cloud Platform in MontrÃ©al and encrypted server-side using "),(0,e.createElementVNode)("a",{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"},"bcrypt"),(0,e.createTextVNode)(".")],-1),O=(0,e.createElementVNode)("p",null,"Please use a good password so your account is less likely to be hijacked and used to cause trouble.",-1),j=(0,e.createElementVNode)("p",null," For your security, you should not use the same passwords that you use for important services such as email and online banking on other websites. If one website gets hacked, you can lose access to every other site where you use the same password. Is is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service. ",-1),D=(0,e.createTextVNode)(" Update "),A=(0,e.createTextVNode)(" Cancel "),F={key:2,class:"options"},L=(0,e.createTextVNode)("Your email address on file is "),q={class:"email"},z=(0,e.createTextVNode)("."),Y=(0,e.createTextVNode)(" Update settings "),H=(0,e.createTextVNode)(" Change password "),Z={class:"dialog-footer"},W=(0,e.createTextVNode)("Close"),K=jQuery;var G=o.n(K);const X=moment;var Q=o.n(X);const J=/^VersionStamp: (.+)$/m;function ee(e){console.error(e);let o=null;e&&(0===e.readyState?o="Could not connect to server.":e.readyState&&e.status?o=503===e.status?"CrowdSpec is currently offline for database upgrades. Please try again in a bit.":"Request failed with HTTP error code "+e.status+".":e.message?o=e.message:"string"==typeof e&&(o=e)),o||(o="An error occurred."),e&&e.responseText&&J.test(e.responseText)&&J.exec(e.responseText)[1]!==window.const.appVersion&&(o+=" (A new update is available. Reload this page to use the latest client code.)"),t.ElMessageBox.alert(o,"Error",{confirmButtonText:"Ok",type:"error"})}function te(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;t.ElMessage.success({message:e,duration:o})}function oe(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;t.ElMessage.info({message:e,duration:o})}function se(e,t){return null===e&&null===t||parseInt(e,10)===parseInt(t,10)}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;var o;function s(){o=null,e.apply(this,arguments)}return function(){return o&&clearTimeout(o),o=setTimeout(s.bind(this,...arguments),t)}}function le(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;document.title="CrowdSpec"+(e?" | "+e:"")}function ie(e){if(window.URL)try{return new URL(e),!0}catch{return!1}return!(!e||!e.trim())}const ae=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function re(e){return ae.test(e)}function ce(e){return e?"url"===e?"URL":e.charAt(0).toUpperCase()+e.slice(1):""}const de={components:{Username:N},data:()=>({showing:!1,mode:null,settingsForm:{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},changePasswordForm:{oldPass:"",newPass:"",newPass2:""},waiting:!1}),computed:{username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername},updateSettingsMode(){return 1===this.mode},changePasswordMode(){return 2===this.mode},predefinedUsernameHighlights:()=>["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"],changePasswordRules(){return{oldPass:[{validator:(e,t,o)=>{t.trim()?o():o(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:(e,t,o)=>{t.trim().length<window.const.passwordMinLength?o(new Error("Password minimum length is "+window.const.passwordMinLength+" digits")):(this.changePasswordForm.newPass2.trim()&&this.$refs.changePasswordForm.validateField("newPass2"),o())},trigger:"blur"}],newPass2:[{validator:(e,t,o)=>{t.trim()?t!==this.changePasswordForm.newPass?o(new Error("Passwords do not match")):o():o(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show(){this.showing=!0},enterUpdateSettingsMode(){this.mode=1,this.waiting=!0,G().get("/ajax/settings").then((e=>{this.settingsForm=G().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e),this.waiting=!1})).fail((e=>{this.waiting=!1,this.clearMode(),ee(e)}))},enterChangePasswordMode(){this.mode=2,this.selectOldPassword()},submitSettings(){this.waiting=!0,G().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((e=>{this.waiting=!1,this.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),this.clearMode(),this.$store.commit("setUserSettings",e)})).fail((e=>{this.waiting=!1,ee(e)}))},handleChangePasswordReturn(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():G()("input",this.$refs.newPass2.$el).focus().select():G()("input",this.$refs.newPass.$el).focus().select():G()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword(){this.$refs.changePasswordForm.validate((e=>{e&&(this.waiting=!0,G().post("/ajax/user/change-password",{old:this.changePasswordForm.oldPass,new:this.changePasswordForm.newPass,new2:this.changePasswordForm.newPass2}).then((()=>{this.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),this.clearMode()})).fail((e=>{if(e&&e.readyState)switch(e.status){case 400:this.$message({message:"New password rejected",type:"error",showClose:!0,duration:4e3});break;case 403:this.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:4e3}),this.selectOldPassword();break;default:ee(e)}else ee(e)})).always((()=>{this.waiting=!1})))}))},selectOldPassword(){this.$nextTick((()=>{this.$refs.oldPass&&G()("input",this.$refs.oldPass.$el).focus().select()}))},clearMode(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},me={components:{Username:N,EditProfileModal:(0,B.Z)(de,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("username"),r=(0,e.resolveComponent)("el-color-picker"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-form-item"),m=(0,e.resolveComponent)("el-option"),u=(0,e.resolveComponent)("el-select"),p=(0,e.resolveComponent)("el-checkbox"),h=(0,e.resolveComponent)("el-form"),g=(0,e.resolveComponent)("el-input"),k=(0,e.resolveComponent)("el-alert"),b=(0,e.resolveComponent)("el-dialog"),f=(0,e.resolveDirective)("loading");return(0,e.openBlock)(),(0,e.createBlock)(b,{modelValue:l.showing,"onUpdate:modelValue":o[17]||(o[17]=e=>l.showing=e),width:t.$store.getters.dialogTinyWidth,"close-on-click-modal":null===l.mode,onClosed:o[18]||(o[18]=e=>i.clearMode()),"custom-class":"edit-profile-modal"},{title:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",null,[E,(0,e.createVNode)(a,{username:i.username,highlight:i.highlight},null,8,["username","highlight"])])])),footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Z,[(0,e.createVNode)(c,{onClick:o[16]||(o[16]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[W])),_:1})])])),default:(0,e.withCtx)((()=>[i.updateSettingsMode?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,ref:"changePasswordForm",model:l.settingsForm,"label-position":"top"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[S])),default:(0,e.withCtx)((()=>[(0,e.createElementVNode)("div",x,[(0,e.createVNode)(r,{modelValue:l.settingsForm.userProfile.highlightUsername,"onUpdate:modelValue":o[0]||(o[0]=e=>l.settingsForm.userProfile.highlightUsername=e),predefine:i.predefinedUsernameHighlights,"color-format":"rgb"},null,8,["modelValue","predefine"]),l.settingsForm.userProfile.highlightUsername?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[1]||(o[1]=e=>l.settingsForm.userProfile.highlightUsername=null),size:"small"},{default:(0,e.withCtx)((()=>[T])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{username:"Username colour",highlight:l.settingsForm.userProfile.highlightUsername},null,8,["highlight"])])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[I])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(u,{modelValue:l.settingsForm.blockEditing.deleteButton,"onUpdate:modelValue":o[2]||(o[2]=e=>l.settingsForm.blockEditing.deleteButton=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(m,{label:"Show delete button only in edit block modal",value:"modal"}),(0,e.createVNode)(m,{label:"Show delete button on newly added blocks",value:"recent"}),(0,e.createVNode)(m,{label:"Show delete button on all blocks",value:"all"})])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{label:(0,e.withCtx)((()=>[P])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(p,{modelValue:l.settingsForm.community.unreadOnly,"onUpdate:modelValue":o[3]||(o[3]=e=>l.settingsForm.community.unreadOnly=e)},{default:(0,e.withCtx)((()=>[U])),_:1},8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{type:"primary",onClick:o[4]||(o[4]=e=>i.submitSettings())},{default:(0,e.withCtx)((()=>[R])),_:1}),(0,e.createVNode)(c,{onClick:o[5]||(o[5]=e=>i.clearMode())},{default:(0,e.withCtx)((()=>[_])),_:1})])),_:1})])),_:1},8,["model"])),[[f,l.waiting]]):i.changePasswordMode?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createBlock)(h,{key:1,ref:"changePasswordForm",model:l.changePasswordForm,rules:i.changePasswordRules,"label-position":"top"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(d,{label:"Current password",prop:"oldPass"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"oldPass",type:"password",name:"old_password",modelValue:l.changePasswordForm.oldPass,"onUpdate:modelValue":o[6]||(o[6]=e=>l.changePasswordForm.oldPass=e),autocomplete:"current-password",onKeyup:o[7]||(o[7]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.oldPass)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,{label:"New password",prop:"newPass"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"newPass",type:"password",name:"new_password",modelValue:l.changePasswordForm.newPass,"onUpdate:modelValue":o[8]||(o[8]=e=>l.changePasswordForm.newPass=e),autocomplete:"new-password",onKeyup:o[9]||(o[9]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.newPass)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,{label:"Confirm new password",prop:"newPass2"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{ref:"newPass2",type:"password",name:"verify_password",modelValue:l.changePasswordForm.newPass2,"onUpdate:modelValue":o[10]||(o[10]=e=>l.changePasswordForm.newPass2=e),autocomplete:"new-password",onKeyup:o[11]||(o[11]=(0,e.withKeys)((e=>i.handleChangePasswordReturn(t.$refs.newPass2)),["enter"]))},null,8,["modelValue"])])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(k,{type:"info",closable:!1},{default:(0,e.withCtx)((()=>[M,O,j])),_:1})])),_:1}),(0,e.createVNode)(d,null,{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{type:"primary",onClick:o[12]||(o[12]=e=>i.submitChangePassword())},{default:(0,e.withCtx)((()=>[D])),_:1}),(0,e.createVNode)(c,{onClick:o[13]||(o[13]=e=>i.clearMode())},{default:(0,e.withCtx)((()=>[A])),_:1})])),_:1})])),_:1},8,["model","rules"])),[[f,l.waiting]]):((0,e.openBlock)(),(0,e.createElementBlock)("div",F,[(0,e.createElementVNode)("p",null,[L,(0,e.createElementVNode)("span",q,(0,e.toDisplayString)(t.$store.getters.emailAddress),1),z]),(0,e.createVNode)(c,{onClick:o[14]||(o[14]=e=>i.enterUpdateSettingsMode())},{default:(0,e.withCtx)((()=>[Y])),_:1}),(0,e.createVNode)(c,{onClick:o[15]||(o[15]=e=>i.enterChangePasswordMode())},{default:(0,e.withCtx)((()=>[H])),_:1})]))])),_:1},8,["modelValue","width","close-on-click-modal"])}]])},computed:{loadingUser(){return this.$store.getters.loadingUser},loggedIn(){return this.$store.getters.loggedIn},username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername}},mounted(){this.$store.dispatch("loadAuth")},methods:{gotoLogin(){window.location.href="/login"},gotoSignup(){window.location.href="/signup"},gotoIndex(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout(){(function(e,o,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"warning";return t.ElMessageBox.confirm(o,e,{confirmButtonText:s,cancelButtonText:"Cancel",type:n})})(null,"Please confirm that you wish to log out.","Log out").then((()=>{this.$store.dispatch("logOut")})).catch((()=>{}))},openEditProfile(){this.$refs.editProfileModal.show()}}},ue=(0,B.Z)(me,[["render",function(t,o,s,n,l,h){const g=(0,e.resolveComponent)("username"),k=(0,e.resolveComponent)("el-button"),b=(0,e.resolveComponent)("router-view"),f=(0,e.resolveComponent)("edit-profile-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("div",i,[(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h1",{onClick:o[0]||(o[0]=e=>h.gotoIndex())},"CrowdSpec"),h.loadingUser?((0,e.openBlock)(),(0,e.createElementBlock)("div",a,r)):h.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)("div",c,[(0,e.createVNode)(k,{onClick:o[1]||(o[1]=e=>h.openEditProfile()),type:"text",class:"username-button"},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(g,{username:h.username,highlight:h.highlight},null,8,["username","highlight"])])),_:1}),(0,e.createVNode)(k,{onClick:o[2]||(o[2]=e=>h.logout())},{default:(0,e.withCtx)((()=>[d])),_:1})])):((0,e.openBlock)(),(0,e.createElementBlock)("div",m,[(0,e.createVNode)(k,{onClick:o[3]||(o[3]=e=>h.gotoLogin())},{default:(0,e.withCtx)((()=>[u])),_:1}),(0,e.createVNode)(k,{onClick:o[4]||(o[4]=e=>h.gotoSignup())},{default:(0,e.withCtx)((()=>[p])),_:1})]))]),(0,e.createVNode)(b,{class:"page-area"}),h.loggedIn?((0,e.openBlock)(),(0,e.createBlock)(f,{key:0,ref:"editProfileModal"},null,512)):(0,e.createCommentVNode)("v-if",!0)])}]]),pe=VueRouter,he=Vuex,ge="spec",ke="subspec",be="block",fe="comment",ye="bullet",Ce="plaintext",we="markdown",ve="url",Ve="subspec",Be="user",Ne=G()(window);let Ee=null;const Se=(0,he.createStore)({state:()=>({currentTime:Date.now(),windowWidth:Ne.width(),windowHeight:Ne.height(),currentSpec:null,savedScrollPosition:null,currentSpecScrollTop:null,dragging:!1,movingBlockIds:[],movingBlocksSourceSubspecId:null,user:null,userSettings:null}),getters:{loggedIn:e=>!!e.user,loadingUser:e=>!1===e.user,currentUserId:e=>e.user?e.user.id:null,username:e=>e.user?e.user.username:null,emailAddress:e=>e.user?e.user.email:null,userSettings:e=>e.user?G().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e.userSettings):{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},userIsAdmin:e=>!!e.user&&e.user.admin,defaultShowUnreadCommentsOnly:(e,t)=>t.loggedIn&&t.userSettings.community.unreadOnly,mobileViewport:e=>e.windowWidth<=767,dialogTinyWidth:e=>e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%",dialogSmallWidth:e=>e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%",dialogLargeWidth:e=>e.windowWidth<=991?"95%":"90%",currentSpecId:e=>e.currentSpec?e.currentSpec.id:null,currentSpecOwnedByUser:(e,t)=>!!e.currentSpec&&e.currentSpec.ownerType===Be&&se(e.currentSpec.ownerId,t.currentUserId),currentlyMovingBlocks:e=>e.movingBlockIds.length>0,currentlyMovingBlock:e=>t=>e.movingBlockIds.indexOf(t)>=0},mutations:{updateWindowDimensions(e){e.windowWidth=Ne.width(),e.windowHeight=Ne.height()},updateCurrentTime(e){e.currentTime=Date.now()},setUser(e,t){e.user=t},setUserSettings(e,t){e.userSettings=t},saveCurrentSpec(e,t){console.debug("saveCurrentSpec"),e.currentSpec&&!se(e.currentSpec.id,t.id)&&(console.debug("saveCurrentSpec clear currentSpecScrollTop"),e.currentSpecScrollTop=null),e.currentSpec=t},startDragging(e){e.dragging=!0},endDragging(e){e.dragging=!1},setMovingBlocks(e,t){e.movingBlocksSourceSubspecId=t.subspecId,e.movingBlockIds=t.blockIds},endMovingBlocks(e){e.movingBlocksSourceSubspecId=null,e.movingBlockIds=[]},setSavedScrollPosition(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpecScrollTop(e){console.debug("saveCurrentSpecScrollTop"),e.currentSpecScrollTop=Ne.scrollTop()},clearCurrentSpec(e){e.currentSpec=null,e.currentSpecScrollTop=null}},actions:{loadAuth(e){let{commit:t}=e;t("setUser",!1),G().get("/ajax/auth").then((e=>{t("setUser",e)})).fail((e=>{t("setUser",null),e&&e.readyState&&e.status&&403===e.status||ee(e)}))},logOut(e){let{commit:t}=e;G().get("/ajax/logout").then((e=>{t("setUser",null)})).fail(ee)}}}),xe=Se;Ne.on("resize",(()=>{Se.commit("updateWindowDimensions")})),setTimeout((function e(){Se.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const Te={class:"index-page"},Ie={key:0,class:"actions"},Pe=(0,e.createTextVNode)(" New spec "),Ue=(0,e.createTextVNode)(" Community review "),Re=(0,e.createTextVNode)(" Admin "),_e={key:1,class:"user-specs"},Me=(0,e.createElementVNode)("h2",null,"Your specs",-1),$e={key:0},Oe={key:1,class:"specs-list"},je=["onClick"],De={class:"info"},Ae=(0,e.createElementVNode)("i",{class:"material-icons"},"beach_access",-1),Fe=(0,e.createTextVNode)(" Public"),Le=(0,e.createElementVNode)("i",{class:"material-icons"},"lock",-1),qe=(0,e.createTextVNode)(" Private"),ze=["href","onClick"],Ye={class:"info"},He={class:"updated"},Ze=(0,e.createTextVNode)("Last modified "),We={key:0,class:"desc"},Ke={key:2},Ge=(0,e.createElementVNode)("h2",null,"Public specs",-1),Xe={key:0},Qe={key:1,class:"specs-list"},Je=["onClick"],et={class:"info"},tt=["href","onClick"],ot={class:"info"},st={class:"updated"},nt=(0,e.createTextVNode)("Last modified "),lt={key:0,class:"desc"},it={key:2},at={props:{datetime:String,offset:Boolean},data:()=>({timeout:null}),computed:{moment(){return Q().parseZone(this.datetime).local()},currentTime(){return this.$store.state.currentTime},output(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},rt=(0,B.Z)(at,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",null,(0,e.toDisplayString)(i.output),1)}]]),ct={key:0},dt=(0,e.createTextVNode)(" Created "),mt=(0,e.createTextVNode)("; last modified "),ut=(0,e.createElementVNode)("div",null,"Name",-1),pt=(0,e.createElementVNode)("div",null,"Description",-1),ht=(0,e.createTextVNode)("Allow public access and community features"),gt={class:"dialog-footer"},kt=(0,e.createTextVNode)("Cancel"),bt=(0,e.createTextVNode)("Delete");function ft(e,t,o){return G().post("/ajax/spec/create-subspec",{specId:e,name:t,desc:o}).fail(ee)}function yt(e,t,o,s){for(var n=0;n<e.length;n++)e[n]=parseInt(e[n],10);return e=JSON.stringify(e),G().post("/ajax/spec/move-blocks",{blockIds:e,subspecId:t,parentId:o,insertBeforeId:s}).fail(ee)}function Ct(e,t){return G().post("/ajax/spec/create-url",{specId:e,url:t}).fail(ee)}function wt(e,t,o,s,n){return G().get("/ajax/spec/community/page",{specId:e,targetType:t,targetId:o,updatedBefore:s,unreadOnly:n}).fail(ee)}const vt={components:{Moment:rt},data:()=>({name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{G()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((()=>{G()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;var t,o,s;(t=this.name,o=this.desc,s=this.isPublic,G().post("/ajax/spec/create-spec",{name:t,desc:o,isPublic:s}).fail(ee)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,o,s,n;(t=this.spec.id,o=this.name,s=this.desc,n=this.isPublic,G().post("/ajax/spec/save-spec",{specId:t,name:o,desc:s,isPublic:n}).fail(ee)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSpec(){this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.spec.id,G().post("/ajax/spec/delete-spec",{specId:e}).fail(ee)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"index"})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},Vt=(0,B.Z)(vt,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-checkbox"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(m,{title:l.spec?"Manage spec":"Create spec",modelValue:l.showing,"onUpdate:modelValue":o[6]||(o[6]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[7]||(o[7]=e=>i.closed()),"custom-class":"spec-edit-spec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",gt,[(0,e.createVNode)(d,{onClick:o[3]||(o[3]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[kt])),_:1}),l.spec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[4]||(o[4]=e=>i.promptDeleteSpec()),type:"danger"},{default:(0,e.withCtx)((()=>[bt])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{onClick:o[5]||(o[5]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.spec?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.spec?((0,e.openBlock)(),(0,e.createElementBlock)("p",ct,[dt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.spec.created},null,8,["datetime"])]),mt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.spec.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[ut,(0,e.createVNode)(r,{ref:"nameInput",modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.name=e),maxlength:i.nameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[pt,(0,e.createVNode)(r,{type:"textarea",modelValue:l.desc,"onUpdate:modelValue":o[1]||(o[1]=e=>l.desc=e),autosize:{minRows:2}},null,8,["modelValue"])]),(0,e.createVNode)(c,{modelValue:l.isPublic,"onUpdate:modelValue":o[2]||(o[2]=e=>l.isPublic=e)},{default:(0,e.withCtx)((()=>[ht])),_:1},8,["modelValue"])])),_:1},8,["title","modelValue","width"])}]]),Bt={class:"loading-message"},Nt=(0,e.createElementVNode)("i",{class:"material-icons spin"},"loop",-1),Et={key:0},St={props:{message:String}},xt=(0,B.Z)(St,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",Bt,[Nt,s.message?((0,e.openBlock)(),(0,e.createElementBlock)("span",Et,(0,e.toDisplayString)(s.message),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Tt={components:{Moment:rt,Username:N,EditSpecModal:Vt,LoadingMessage:xt},data:()=>({unreadCommunity:0,userSpecs:[],publicSpecs:[],loading:!0}),computed:{loggedIn(){return this.$store.getters.loggedIn}},mounted(){this.reloadSpecs()},beforeRouteUpdate(e,t,o){this.reloadSpecs(),o()},methods:{reloadSpecs(){this.loading=!0,G().get("/ajax/home").then((e=>{this.unreadCommunity=e.unread,this.userSpecs=e.userSpecs,this.publicSpecs=e.publicSpecs,this.loading=!1})).fail((e=>{this.loading=!1,ee(e)}))},promptCreateSpec(){this.$store.state.loggedIn&&this.$refs.editSpecModal.showCreate((e=>{this.$router.push({name:"spec",params:{specId:e}})}))}}},It=(0,B.Z)(Tt,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("loading-message"),c=(0,e.resolveComponent)("moment"),d=(0,e.resolveComponent)("router-link"),m=(0,e.resolveComponent)("username"),u=(0,e.resolveComponent)("edit-spec-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Te,[i.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ie,[(0,e.createVNode)(a,{onClick:o[0]||(o[0]=e=>i.promptCreateSpec()),type:"primary"},{default:(0,e.withCtx)((()=>[Pe])),_:1}),(0,e.createVNode)(a,{onClick:o[1]||(o[1]=e=>t.$router.push({name:"community-review"})),type:l.unreadCommunity?"primary":"default"},{default:(0,e.withCtx)((()=>[Ue,l.unreadCommunity?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)("("+(0,e.toDisplayString)(l.unreadCommunity)+" unread)",1)],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"]),t.$store.getters.userIsAdmin?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[2]||(o[2]=e=>t.$router.push({name:"admin"})),class:"admin-access"},{default:(0,e.withCtx)((()=>[Re])),_:1})):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),i.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)("div",_e,[Me,l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",$e,[(0,e.createVNode)(r,{message:"Loading..."})])):l.userSpecs&&l.userSpecs.length?((0,e.openBlock)(),(0,e.createElementBlock)("ul",Oe,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.userSpecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(d,{key:t.id,to:{name:"spec",params:{specId:t.id}},custom:""},{default:(0,e.withCtx)((o=>{let{navigate:s,href:n}=o;return[(0,e.createElementVNode)("li",{onClick:s},[(0,e.createElementVNode)("div",De,[(0,e.createElementVNode)("span",{class:(0,e.normalizeClass)(["status",{public:t.public}])},[t.public?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[Ae,Fe],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[Le,qe],64))],2)]),(0,e.createElementVNode)("a",{href:n,onClick:s,class:"name"},(0,e.toDisplayString)(t.name),9,ze),(0,e.createElementVNode)("div",Ye,[(0,e.createElementVNode)("span",He,[Ze,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:t.updated,offset:!0},null,8,["datetime"])])])]),t.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",We,(0,e.toDisplayString)(t.desc),1)):(0,e.createCommentVNode)("v-if",!0)],8,je)]})),_:2},1032,["to"])))),128))])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Ke,"You do not have any specs."))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["public-specs",{"adjust-margin":!!l.userSpecs.length}])},[Ge,l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Xe,[(0,e.createVNode)(r,{message:"Loading..."})])):l.publicSpecs&&l.publicSpecs.length?((0,e.openBlock)(),(0,e.createElementBlock)("ul",Qe,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.publicSpecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(d,{key:t.id,to:{name:"spec",params:{specId:t.id}},custom:""},{default:(0,e.withCtx)((o=>{let{navigate:s,href:n}=o;return[(0,e.createElementVNode)("li",{onClick:s},[(0,e.createElementVNode)("div",et,[(0,e.createVNode)(m,{username:t.username,highlight:t.highlight},null,8,["username","highlight"])]),(0,e.createElementVNode)("a",{href:n,onClick:s,class:"name"},(0,e.toDisplayString)(t.name),9,tt),(0,e.createElementVNode)("div",ot,[(0,e.createElementVNode)("span",st,[nt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:t.updated,offset:!0},null,8,["datetime"])])])]),(0,e.createCommentVNode)('<div class="tags">\n\t\t\t\t\t\t<el-tag size="mini" :closable="false" type="success">dsf</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false" type="primary">d</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">asdfsadf</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">asd</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">fghfdghsdfg</el-tag>\n\t\t\t\t\t\t<el-tag size="mini" :closable="false">rtrgegrae</el-tag>\n\t\t\t\t\t</div>'),t.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",lt,(0,e.toDisplayString)(t.desc),1)):(0,e.createCommentVNode)("v-if",!0)],8,Je)]})),_:2},1032,["to"])))),128))])):((0,e.openBlock)(),(0,e.createElementBlock)("p",it,"There are no public specs......"))],2),i.loggedIn?((0,e.openBlock)(),(0,e.createBlock)(u,{key:2,ref:"editSpecModal"},null,512)):(0,e.createCommentVNode)("v-if",!0)])}]]),Pt={class:"spec-page"},Ut={key:0},Rt={key:0,class:"right"},_t={key:0},Mt={key:1},$t=(0,e.createTextVNode)(" Owned by "),Ot={key:0},jt={key:1},Dt=(0,e.createElementVNode)("i",{class:"material-icons"},"lock",-1),At=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Ft={key:0},Lt={key:1},qt=(0,e.createElementVNode)("i",{class:"material-icons"},"settings",-1),zt=(0,e.createTextVNode)(" Last modified "),Yt=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Ht={key:0},Zt={key:1},Wt=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),Kt={key:1,class:"desc"},Gt={key:0},Xt=(0,e.createTextVNode)(" Created "),Qt=(0,e.createTextVNode)("; last modified "),Jt=(0,e.createElementVNode)("div",null,"Name",-1),eo=(0,e.createElementVNode)("div",null,"Description",-1),to={class:"dialog-footer"},oo=(0,e.createTextVNode)("Cancel"),so=(0,e.createTextVNode)("Delete"),no={components:{Moment:rt},props:{specId:Number},data:()=>({name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{G()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((()=>{G()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;ft(this.specId,this.name,this.desc).then((t=>{e(t.id),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,o,s;(t=this.subspec.id,o=this.name,s=this.desc,G().post("/ajax/spec/save-subspec",{subspecId:t,name:o,desc:s}).fail(ee)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSubspec(){this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.subspec.id,G().post("/ajax/spec/delete-subspec",{subspecId:e}).fail(ee)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"spec",params:{specId:this.specId}})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.subspec=null,this.name="",this.desc=""}}},lo=(0,B.Z)(no,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(d,{title:l.subspec?"Manage subspec":"Create subspec",modelValue:l.showing,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[6]||(o[6]=e=>i.closed()),"custom-class":"spec-edit-subspec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",to,[(0,e.createVNode)(c,{onClick:o[2]||(o[2]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[oo])),_:1}),l.subspec?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[3]||(o[3]=e=>i.promptDeleteSubspec()),type:"danger"},{default:(0,e.withCtx)((()=>[so])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{onClick:o[4]||(o[4]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.subspec?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("p",Gt,[Xt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.subspec.created},null,8,["datetime"])]),Qt,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.subspec.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[Jt,(0,e.createVNode)(r,{ref:"nameInput",modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.name=e),maxlength:i.nameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[eo,(0,e.createVNode)(r,{type:"textarea",modelValue:l.desc,"onUpdate:modelValue":o[1]||(o[1]=e=>l.desc=e),autosize:{minRows:2}},null,8,["modelValue"])])])),_:1},8,["title","modelValue","width"])}]]),io={key:0},ao={key:2},ro=(0,e.createTextVNode)(" New subspec "),co={class:"dialog-footer"},mo=(0,e.createTextVNode)("Close"),uo=(0,e.createTextVNode)(" Go to spec "),po={class:"ref-subspec ref-item"},ho={class:"title"},go=(0,e.createElementVNode)("span",null,[(0,e.createElementVNode)("i",{class:"material-icons"},"subdirectory_arrow_right"),(0,e.createTextVNode)(" Subspec")],-1),ko={key:0,class:"desc"},bo={props:{item:Object}},fo=(0,B.Z)(bo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("router-link");return(0,e.openBlock)(),(0,e.createElementBlock)("div",po,[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("div",ho,[go,(0,e.createVNode)(a,{to:{name:"subspec",params:{specId:s.item.specId,subspecId:s.item.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(s.item.name.trim()),1)])),_:1},8,["to"])]),s.item.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",ko,(0,e.toDisplayString)(s.item.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0)])])}]]),yo={components:{RefSubspec:fo,LoadingMessage:xt},props:{specId:Number,subspecId:Number,enableEditing:Boolean},emits:["open-create-subspec"],data:()=>({subspecs:[],loading:!1,showing:!1}),watch:{$route:{deep:!0,handler(){this.showing=!1}}},methods:{show(){this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((e=>{this.subspecs=e,this.loading=!1})).fail((e=>{this.loading=!1,this.showing=!1,ee(e)}))},openCreateSubspec(){this.$emit("open-create-subspec"),this.showing=!1},goToSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},closed(){this.loading=!1,this.subspecs=[]}}},Co=(0,B.Z)(yo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("ref-subspec"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(d,{title:"Navigate spec",modelValue:l.showing,"onUpdate:modelValue":o[3]||(o[3]=e=>l.showing=e),width:t.$store.getters.dialogTinyWidth,onClosed:o[4]||(o[4]=e=>i.closed()),"custom-class":"nav-spec-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",co,[(0,e.createVNode)(c,{onClick:o[1]||(o[1]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[mo])),_:1}),s.subspecId?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,onClick:o[2]||(o[2]=e=>i.goToSpec()),type:"primary"},{default:(0,e.withCtx)((()=>[uo])),_:1})):(0,e.createCommentVNode)("v-if",!0)])])),default:(0,e.withCtx)((()=>[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",io,[(0,e.createVNode)(a,{message:"Loading..."})])):l.subspecs.length?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:1},(0,e.renderList)(l.subspecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(r,{key:t.id,item:t},null,8,["item"])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",ao,"No subspecs.")),s.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,onClick:o[0]||(o[0]=e=>i.openCreateSubspec()),class:"new-subspec-button"},{default:(0,e.withCtx)((()=>[ro])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["modelValue","width"])}]]),wo={key:0},vo={key:1},Vo={key:0,class:"updated"},Bo=(0,e.createTextVNode)(" Last modified "),No={key:5,class:"new-comment-area"},Eo={key:0},So=(0,e.createTextVNode)(" Cancel "),xo=(0,e.createTextVNode)(" Post "),To={class:"controls-area flex-row wrap-reverse"},Io={class:"fill nowraptext comments-count"},Po={key:2},Uo=(0,e.createTextVNode)(" Show only unread comments "),Ro={key:6},_o={key:0},Mo=(0,e.createTextVNode)(" Load more "),$o={class:"dialog-footer"},Oo=(0,e.createTextVNode)("Close"),jo=(0,e.createElementVNode)("i",{class:"material-icons"},"north_west",-1),Do={class:"bar"},Ao={class:"label"},Fo=["textContent"],Lo={props:{target:Object,targetType:String},computed:{label(){let e=ce(this.targetType);return this.targetType===be&&this.target.refType&&(e+=" ("+ce(this.target.refType)+")"),e},content(){switch(this.targetType){case ge:case ke:return this.target.name;case be:let e;if(e=(this.target.title||"").trim())return e;if(e=(this.target.body||"").trim())return e;if(this.target.refItem)switch(this.target.refType){case Ve:return this.target.refItem.name;case ve:return this.target.refItem.title||this.target.refItem.url}return"";case fe:return this.target.body}}}},qo={emits:["pop-stack"],components:{StackBar:(0,B.Z)(Lo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["community-context-stack-bar",s.targetType])},[(0,e.createVNode)(a,{size:"small",type:"primary",circle:""},{default:(0,e.withCtx)((()=>[jo])),_:1}),(0,e.createElementVNode)("span",Do,[(0,e.createElementVNode)("span",Ao,(0,e.toDisplayString)(i.label||"..."),1),(0,e.createElementVNode)("span",{class:"content",textContent:(0,e.toDisplayString)(i.content||"...")},null,8,Fo)])],2)}]])},data:()=>({stack:[],empty:!0,cachedContext:[]}),computed:{available(){return this.stack.length}},methods:{replaceStack(e){this.stack=e,this.cachedContext=[],this.checkEmpty()},pushStack(e,t,o,s){this.empty=!1,this.stack.push({targetType:e,target:t,onAdjustUnread:o,onAdjustComments:s})},popStack(){if(this.stack.length){let e=this.stack.splice(this.stack.length-1,1)[0];return this.$emit("pop-stack",e.targetType,e.target.id,e.onAdjustUnread,e.onAdjustComments),this.cacheItemHandlers(e),this.checkEmpty(),e}return null},jumpStack(e){let t=this.stack.splice(e,this.stack.length-e),o=t[0];for(this.$emit("pop-stack",o.targetType,o.target.id,o.onAdjustUnread,o.onAdjustComments),e=0;e<t.length;e++)this.cacheItemHandlers(t[e]);return this.checkEmpty(),o},cacheItemHandlers(e){for(var t=0;t<this.cachedContext.length;t++){let o=this.cachedContext[t];if(o.targetType===e.targetType&&se(o.target.id,e.target.id)){this.cachedContext.splice(t,1);break}}(e.onAdjustUnread||e.onAdjustComments)&&this.cachedContext.push(e)},retrieveCachedHandlers(e,t){for(var o=0;o<this.cachedContext.length;o++){let s=this.cachedContext[o];if(s.targetType===e&&se(s.target.id,t))return this.cachedContext.splice(o,1)[0]}return null},getParentContext(){return this.stack.length?this.stack[this.stack.length-1]:null},clearStack(){this.stack=[],this.cachedContext=[],this.empty=!0},checkEmpty(){return this.empty=!this.stack.length}}},zo=(0,B.Z)(qo,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("stack-bar");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["community-context-stack",{empty:l.empty}])},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.stack,((t,o)=>((0,e.openBlock)(),(0,e.createBlock)(e.Transition,{key:t.targetType+"-"+t.target.id,name:"fade",appear:""},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(a,{target:t.target,"target-type":t.targetType,onClick:e=>i.jumpStack(o)},null,8,["target","target-type","onClick"])])),_:2},1024)))),128))],2)}]]),Yo={class:"spec-preview community-target-preview"},Ho={class:"name"},Zo={key:0,class:"desc"},Wo={props:{spec:Object}},Ko=(0,B.Z)(Wo,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Yo,[(0,e.createElementVNode)("div",Ho,(0,e.toDisplayString)(s.spec.name),1),s.spec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Zo,(0,e.toDisplayString)(s.spec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),Go={class:"spec-subspec-preview community-target-preview"},Xo={class:"name"},Qo={key:0,class:"desc"},Jo={props:{subspec:Object}},es=(0,B.Z)(Jo,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",Go,[(0,e.createElementVNode)("div",Xo,(0,e.toDisplayString)(s.subspec.name),1),s.subspec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Qo,(0,e.toDisplayString)(s.subspec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])}]]),ts=["data-block-preview-id"],os={key:0,class:"title"},ss=["textContent"],ns=["innerHTML"],ls={class:"ref-url ref-item"},is=["src"],as={key:0,class:"right"},rs=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),cs=(0,e.createTextVNode)("Play"),ds={class:"title"},ms=(0,e.createElementVNode)("i",{class:"material-icons"},"link",-1),us=["href"],ps={key:1,class:"desc"},hs={props:{item:Object,showEdit:Boolean},emits:["edit","play"],computed:{showPlay(){return re(this.item.url)}}},gs=(0,B.Z)(hs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",ls,[s.item.imageData?((0,e.openBlock)(),(0,e.createElementBlock)("img",{key:0,src:s.item.imageData},null,8,is)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[s.showEdit||i.showPlay?((0,e.openBlock)(),(0,e.createElementBlock)("div",as,[s.showEdit?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>t.$emit("edit")),size:"small",circle:""},{default:(0,e.withCtx)((()=>[rs])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.showPlay?((0,e.openBlock)(),(0,e.createBlock)(a,{key:1,onClick:o[1]||(o[1]=e=>t.$emit("play")),size:"small",type:"primary",class:"play-button"},{default:(0,e.withCtx)((()=>[cs])),_:1})):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",ds,[(0,e.createElementVNode)("span",null,[ms,(0,e.createTextVNode)(" "+(0,e.toDisplayString)(i.showPlay?"Video":"URL"),1)]),(0,e.createElementVNode)("a",{href:s.item.url,target:"_blank",onClick:o[2]||(o[2]=(0,e.withModifiers)((()=>{}),["stop"]))},(0,e.toDisplayString)(s.item.title&&s.item.title.trim()||s.item.url),9,us)]),s.item.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",ps,(0,e.toDisplayString)(s.item.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0)])])}]]),ks={class:"dynamic-stylesheet",style:{display:"none"}},bs=/^\/\*(?:[^\*]|\*(?!\/))+\*\/$/;function fs(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!t||"object"!=typeof t)return 0;let n=0,l=[];const i=()=>{let t=o.join("").trim();if(t){for(let e=0;e<l.length;e++){let t=l[e].trim();t&&!bs.test(t)&&";"!==t.charAt(t.length-1)&&(l[e]=t+";")}l=l.join(""),l&&((e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+l+"}",s+n):(e.styleSheet||e.sheet).addRule(t,l,s+n),n++),l=[]}else l=[]};if(Array.isArray(t))for(let a=0;a<t.length;a++){let r=t[a];r&&("string"==typeof r?l.push(r):"object"==typeof r&&(i(),n+=fs(e,r,o,s+n)))}else for(let a in t)if(t.hasOwnProperty(a)){let r=t[a];r&&("string"==typeof r?l.push(a+":"+r+";"):"object"==typeof r&&(i(),"&"===a.charAt(0)?a=a.substr(1):[">",":","+","~"," "].indexOf(a.charAt(0))<0&&(a=" "+a),n+=fs(e,r,o.concat([a]),s+n)))}return i(),n}function ys(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||"object"!=typeof e)return"";let o="",s=[];const n=()=>{let e=t.join("").trim();if(e){let t=[];for(let e=0;e<s.length;e++){let o=s[e].trim();o?";"===o.charAt(o.length-1)||bs.test(o)?t.push(o):t.push(o+";"):t.push("")}t.length&&(t=t.join("\n\t"),o+="\n"+e+" {\n\t"+t+"\n}")}else for(let e=0;e<s.length;e++){let t=s[e].trim();t&&!bs.test(t)||(o+="\n"+t)}s=[]};if(Array.isArray(e))for(let l=0;l<e.length;l++){let i=e[l];"string"==typeof i?s.push(i):i&&"object"==typeof i&&(n(),o+=ys(i,t.concat([""])))}else for(let l in e)if(e.hasOwnProperty(l)){let i=e[l];if(i)switch(typeof i){case"string":s.push(l+": "+i+";");break;case"object":n(),"&"===l.charAt(0)?l=l.substr(1):[">",":","+","~"," "].indexOf(l.charAt(0))<0&&(l=" "+l),o+=ys(i,t.concat([l]));break;case"boolean":s.push(l)}}return n(),o+(t.length?"":"\n")}const Cs={props:{rules:[Object,Array],innerMarkupOutput:Boolean},watch:{rules:{deep:!0,handler(){this.recreateSheet()}},innerMarkupOutput(){this.recreateSheet()}},mounted(){this.recreateSheet()},beforeDestroy(){this.removeSheet()},methods:{recreateSheet(){this.removeSheet(),this.rules&&(this.$stylesheet=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=document.createElement("style");return s.type="text/css",e.appendChild(s),!s.styleSheet&&!s.sheet||o?s.innerHTML=ys(t):fs(s,t),s}(this.$el,this.rules,this.innerMarkupOutput))},removeSheet(){this.$stylesheet&&(this.$stylesheet.parentNode.removeChild(this.$stylesheet),this.$stylesheet=null)}}},ws={components:{RefUrl:gs,RefSubspec:fo,DynamicStylesheet:(0,B.Z)(Cs,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("span",ks)}]])},props:{block:Object},emits:["play-video"],computed:{CONTENT_TYPE_PLAIN:()=>Ce,CONTENT_TYPE_MARKDOWN:()=>we,REF_TYPE_URL:()=>ve,REF_TYPE_SUBSPEC:()=>Ve,blockId(){return parseInt(this.block.id,10)||0},blockNumber(){return"numbered"===this.block.styleType&&parseInt(this.block.number,10)||0},blockPreviewRules(){let e;switch(this.block.styleType){case"bullet":e="'\\2022'";break;case"numbered":e="'"+this.blockNumber+".'";break;default:return null}return{['[data-block-preview-id="'+this.blockId+'"]']:{">li:before":{content:e}}}},hasTitle(){return!(!this.block.title||!this.block.title.trim())},hasRefItem(){return!(!this.block.refType||!this.block.refItem)},hasBody(){return!!(this.block.body&&this.block.body.trim()||this.block.html&&this.block.html.trim())},refItemMissing(){return!!this.block.refType&&!this.block.refItem}},methods:{raisePlayVideo(e){this.$emit("play-video",e)}}},vs=(0,B.Z)(ws,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("ref-url"),r=(0,e.resolveComponent)("ref-subspec"),c=(0,e.resolveComponent)("el-alert"),d=(0,e.resolveComponent)("dynamic-stylesheet");return(0,e.openBlock)(),(0,e.createElementBlock)("ul",{"data-block-preview-id":i.blockId,class:"spec-block-preview community-target-preview"},[(0,e.createElementVNode)("li",null,[i.hasTitle?((0,e.openBlock)(),(0,e.createElementBlock)("div",os,(0,e.toDisplayString)(s.block.title),1)):(0,e.createCommentVNode)("v-if",!0),i.hasRefItem?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[s.block.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,item:s.block.refItem,onPlay:o[0]||(o[0]=e=>i.raisePlayVideo(s.block.refItem)),class:"ref-item"},null,8,["item"])):s.block.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,item:s.block.refItem,class:"ref-item"},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],2112)):i.refItemMissing?((0,e.openBlock)(),(0,e.createBlock)(c,{key:2,title:"Content unavailable",closable:!1,type:"warning"})):(0,e.createCommentVNode)("v-if",!0),i.hasBody?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:3},[s.block.contentType===i.CONTENT_TYPE_PLAIN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"body plain",textContent:(0,e.toDisplayString)(s.block.body)},null,8,ss)):s.block.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,class:"body markdown",innerHTML:s.block.html},null,8,ns)):(0,e.createCommentVNode)("v-if",!0)],2112)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{rules:i.blockPreviewRules},null,8,["rules"])])],8,ts)}]]),Vs={class:"info"},Bs={class:"right"},Ns=(0,e.createTextVNode)(" Read "),Es=(0,e.createTextVNode)(" Unread "),Ss=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),xs={key:0},Ts={key:1},Is=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),Ps=(0,e.createElementVNode)("i",{class:"material-icons"},"delete",-1),Us=(0,e.createTextVNode)(" posted "),Rs=(0,e.createTextVNode)(" (updated "),_s=(0,e.createTextVNode)(") "),Ms={key:0},$s={key:1},Os={key:2,class:"edit-comment-area"},js=(0,e.createTextVNode)(" Cancel "),Ds=(0,e.createTextVNode)(" Save "),As=(0,e.createTextVNode)(" Delete "),Fs={key:3,class:"body"},Ls={components:{Username:N,Moment:rt,LoadingMessage:xt},props:{specId:Number,comment:Object,showCommunity:Boolean,showUnreadOnly:Boolean},emits:["update-unread","open-comments","deleted"],data(){return{userRead:this.comment.userRead||!1,sendingRead:!1,editing:!1,updated:this.comment.updated,body:this.comment.body,editingBody:"",sendingEdit:!1,sendingDelete:!1}},computed:{loggedIn(){return this.$store.getters.loggedIn},userCanEdit(){return this.$store.getters.currentUserId===this.comment.userId},userCanDelete(){return this.userCanEdit||this.$store.getters.currentSpecOwnedByUser},disableSaveEdit(){return!this.editingBody.trim()||this.sendingEdit},unreadCount(){return this.comment.unreadCount||0},commentsCount(){return this.comment.commentsCount||0},showUnread(){return this.$store.getters.loggedIn&&this.unreadCount>0},showCommentsCount(){return!this.showUnreadOnly&&this.commentsCount>0}},watch:{editing(e){e&&this.$nextTick((()=>{this.$refs.editCommentInput&&G()("textarea",this.$refs.editCommentInput.$el).focus()}))}},methods:{setUserRead(e){this.sendingRead=!0,function(e,t,o,s){return G().post("/ajax/spec/community/mark-read",{specId:e,targetType:"comment",targetId:o,read:s}).fail(ee)}(this.specId,0,this.comment.id,e).then((()=>{this.sendingRead=!1,this.userRead=e,this.$emit("update-unread",e?-1:1)})).fail((()=>{this.sendingRead=!1}))},openComments(){this.$emit("open-comments",this.comment.id)},edit(){this.editingBody.trim()||(this.editingBody=this.body),this.editing=!0},cancelEdit(){this.editing=!1},saveEdit(){var e,t,o;this.disableSaveEdit||(this.sendingEdit=!0,(e=this.specId,t=this.comment.id,o=this.editingBody,G().post("/ajax/spec/community/update-comment",{specId:e,commentId:t,body:o}).fail(ee)).then((e=>{this.sendingEdit=!1,this.editing=!1,this.updated=e.updated,this.body=e.body,this.editingBody=""})).fail((()=>{this.sendingEdit=!1})))},promptDelete(){this.$confirm("Permanently delete this comment?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e,t;this.sendingDelete=!0,(e=this.specId,t=this.comment.id,G().post("/ajax/spec/community/delete-comment",{specId:e,commentId:t}).fail(ee)).then((()=>{this.sendingDelete=!1,this.$emit("deleted",this.comment.id)})).fail((()=>{this.sendingDelete=!1}))})).catch((function(){}))},isUnread(){return!this.userRead}}},qs={components:{ContextStack:zo,Moment:rt,PreviewSpec:Ko,PreviewSubspec:es,PreviewBlock:vs,PreviewComment:(0,B.Z)(Ls,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-checkbox"),r=(0,e.resolveComponent)("el-tag"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("username"),m=(0,e.resolveComponent)("moment"),u=(0,e.resolveComponent)("loading-message"),p=(0,e.resolveComponent)("el-input");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["spec-comment-preview community-target-preview",{community:s.showCommunity}])},[(0,e.createElementVNode)("div",Vs,[(0,e.createElementVNode)("div",Bs,[i.loggedIn?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{modelValue:l.userRead,disabled:l.sendingRead,onChange:i.setUserRead,size:"small"},null,8,["modelValue","disabled","onChange"]),l.userRead?((0,e.openBlock)(),(0,e.createBlock)(r,{key:0,size:"small",type:"success",onClick:o[0]||(o[0]=e=>i.setUserRead(!1))},{default:(0,e.withCtx)((()=>[Ns])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,size:"small",type:"info",onClick:o[1]||(o[1]=e=>i.setUserRead(!0))},{default:(0,e.withCtx)((()=>[Es])),_:1}))],64)):(0,e.createCommentVNode)("v-if",!0),s.showCommunity?((0,e.openBlock)(),(0,e.createBlock)(c,{key:1,onClick:o[2]||(o[2]=e=>i.openComments()),type:i.showUnread?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[Ss,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",xs,(0,e.toDisplayString)(i.unreadCount)+" unread",1)):i.showCommentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ts,(0,e.toDisplayString)(i.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])):(0,e.createCommentVNode)("v-if",!0),i.userCanEdit?((0,e.openBlock)(),(0,e.createBlock)(c,{key:2,onClick:o[3]||(o[3]=e=>i.edit()),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Is])),_:1})):i.userCanDelete?((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,onClick:o[4]||(o[4]=e=>i.promptDelete()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Ps])),_:1})):(0,e.createCommentVNode)("v-if",!0)]),(0,e.createVNode)(d,{username:s.comment.username,highlight:s.comment.highlight},null,8,["username","highlight"]),Us,(0,e.createVNode)(m,{datetime:s.comment.created,offset:!0},null,8,["datetime"]),l.updated!==s.comment.created?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[Rs,(0,e.createVNode)(m,{datetime:l.updated,offset:!0},null,8,["datetime"]),_s],64)):(0,e.createCommentVNode)("v-if",!0)]),l.sendingDelete?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ms,[(0,e.createVNode)(u,{message:"Deleting..."})])):l.sendingEdit?((0,e.openBlock)(),(0,e.createElementBlock)("div",$s,[(0,e.createVNode)(u,{message:"Saving..."})])):l.editing?((0,e.openBlock)(),(0,e.createElementBlock)("div",Os,[(0,e.createVNode)(p,{ref:"editCommentInput",type:"textarea",modelValue:l.editingBody,"onUpdate:modelValue":o[5]||(o[5]=e=>l.editingBody=e),autosize:{minRows:2}},null,8,["modelValue"]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(c,{onClick:o[6]||(o[6]=e=>i.cancelEdit()),disabled:i.disableSaveEdit,type:"warning",size:"small"},{default:(0,e.withCtx)((()=>[js])),_:1},8,["disabled"]),(0,e.createVNode)(c,{onClick:o[7]||(o[7]=e=>i.saveEdit()),disabled:i.disableSaveEdit,type:"primary",size:"small"},{default:(0,e.withCtx)((()=>[Ds])),_:1},8,["disabled"]),(0,e.createVNode)(c,{onClick:o[8]||(o[8]=e=>i.promptDelete()),disabled:i.disableSaveEdit,type:"danger",size:"small"},{default:(0,e.withCtx)((()=>[As])),_:1},8,["disabled"])])])):((0,e.openBlock)(),(0,e.createElementBlock)("div",Fs,(0,e.toDisplayString)(l.body),1))],2)}]]),LoadingMessage:xt},props:{specId:Number,enableWrite:Boolean},emits:["play-video"],data:()=>({showing:!1,loading:!1,error:null,targetType:null,target:null,comments:[],unreadCount:0,filterUnreadOnly:!1,commentsCount:0,hasMoreComments:!1,loadingPage:!1,addingComment:!1,newCommentBody:"",sendingComment:!1,onAdjustUnread:null,onAdjustComments:null,reloadingComments:!1}),computed:{loggedIn(){return this.$store.getters.loggedIn},TARGET_TYPE_SPEC:()=>ge,TARGET_TYPE_SUBSPEC:()=>ke,TARGET_TYPE_BLOCK:()=>be,TARGET_TYPE_COMMENT:()=>fe,modalTitle(){switch(this.targetType){case ge:return"Spec community";case ke:return"Subspec community";case be:return"Block community";case fe:return"Comment community"}return"Community space"},targetUpdated(){return this.target&&this.targetType!==fe?this.target.updated:null},disablePostComment(){return!this.newCommentBody.trim()},showUnreadOnly(){return this.$store.getters.loggedIn&&this.filterUnreadOnly}},watch:{addingComment(e){e&&this.$nextTick((()=>{this.$refs.newCommentInput&&G()("textarea",this.$refs.newCommentInput.$el).focus().select()}))}},methods:{openCommunity(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t),this.showing=!0},openCommunityReview(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t,!0),this.showing=!0},loadCommunity(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.loading=!0,this.error=null,function(e,t,o,s,n){return G().get("/ajax/spec/community",{specId:e,targetType:t,targetId:o,unreadOnly:s,loadStack:n}).fail(ee)}(this.specId,e,t,this.showUnreadOnly,o).then((s=>{switch(this.loading=!1,this.targetType=e,e){case ge:this.target=s.spec;break;case ke:this.target=s.subspec;break;case be:this.target=s.block;break;case fe:this.target=s.comment}o&&s.stack&&this.$refs.contextStack.replaceStack(s.stack),this.comments=s.comments,this.unreadCount=s.unreadCount,this.commentsCount=s.commentsCount,this.hasMoreComments=s.commentsCount>s.comments.length,this.newCommentBody="";let n=this.$refs.contextStack.retrieveCachedHandlers(e,t);n&&(this.onAdjustUnread=n.onAdjustUnread,this.onAdjustComments=n.onAdjustComments)})).fail((()=>{this.loading=!1,this.error="Failed to load community.",this.$refs.contextStack.checkEmpty()&&(this.showing=!1)}))},reloadCommunity(){this.reloadingComments=!0,wt(this.specId,this.targetType,this.target.id,null,this.showUnreadOnly).then((e=>{this.reloadingComments=!1,this.comments=e.comments,this.unreadCount=e.unreadCount,this.commentsCount=e.commentsCount,this.hasMoreComments=e.hasMore})).fail((()=>{this.reloadingComments=!1}))},loadMoreComments(){this.loadingPage=!0;let e=this.comments[this.comments.length-1].updated;wt(this.specId,this.targetType,this.target.id,e,this.showUnreadOnly).then((e=>{this.loadingPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMore})).fail((()=>{this.loadingPage=!1}))},addComment(){var e,t,o,s;this.addingComment?this.disablePostComment||(this.sendingComment=!0,(e=this.specId,t=this.targetType,o=this.target.id,s=this.newCommentBody,G().post("/ajax/spec/community/add-comment",{specId:e,targetType:t,targetId:o,body:s}).fail(ee)).then((e=>{this.sendingComment=!1,this.comments.unshift(e),this.adjustComments(1),this.addingComment=!1,this.newCommentBody=""})).fail((()=>{this.sendingComment=!1}))):this.addingComment=!0},cancelAddComment(){this.addingComment=!1},openComments(e){this.$refs.contextStack.pushStack(this.targetType,this.target,this.onAdjustUnread,this.onAdjustComments),this.onAdjustUnread=null,this.onAdjustComments=null,this.loadCommunity("comment",e)},adjustUnread(e){this.unreadCount+=e,this.onAdjustUnread&&this.onAdjustUnread(e)},adjustComments(e){this.commentsCount+=e,this.onAdjustComments&&this.onAdjustComments(e)},commentDeleted(e){if(this.targetType===fe&&this.target.id===e){let e=this.$refs.previewComment.isUnread(),t=this.$refs.contextStack.popStack();e&&t.onAdjustUnread&&t.onAdjustUnread(-1),t.onAdjustComments&&t.onAdjustComments(-1)}else for(var t=0;t<this.comments.length;t++)if(se(this.comments[t].id,e)){let e=!this.$refs.comments[t].userRead;this.comments.splice(t,1),e&&this.adjustUnread(-1),this.adjustComments(-1);break}},contextUpdateUnread(e){let t=this.$refs.contextStack.getParentContext();t&&t.onAdjustUnread&&t.onAdjustUnread(e)},popStack(e,t,o,s){this.$refs.contextStack.cacheItemHandlers({targetType:this.targetType,target:this.target,onAdjustUnread:this.onAdjustUnread,onAdjustComments:this.onAdjustComments}),this.onAdjustUnread=o,this.onAdjustComments=s,this.loadCommunity(e,t)},raisePlayVideo(e){this.$emit("play-video",e)},closed(){this.targetType=null,this.target=null,this.error=null,this.addingComment=!1,this.newCommentBody="",this.onAdjustUnread=null,this.onAdjustComments=null,this.$refs.contextStack.clearStack()}}},zs=(0,B.Z)(qs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("context-stack"),r=(0,e.resolveComponent)("loading-message"),c=(0,e.resolveComponent)("moment"),d=(0,e.resolveComponent)("preview-spec"),m=(0,e.resolveComponent)("preview-subspec"),u=(0,e.resolveComponent)("preview-block"),p=(0,e.resolveComponent)("preview-comment"),h=(0,e.resolveComponent)("el-input"),g=(0,e.resolveComponent)("el-button"),k=(0,e.resolveComponent)("el-checkbox"),b=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(b,{title:i.modalTitle,modelValue:l.showing,"onUpdate:modelValue":o[8]||(o[8]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[9]||(o[9]=e=>i.closed()),"custom-class":"spec-block-community-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",$o,[(0,e.createVNode)(g,{onClick:o[7]||(o[7]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Oo])),_:1})])])),default:(0,e.withCtx)((()=>[(0,e.createVNode)(a,{ref:"contextStack",onPopStack:i.popStack},null,8,["onPopStack"]),l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",wo,[(0,e.createVNode)(r,{message:"Loading..."})])):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",vo,(0,e.toDisplayString)(l.error),1)):l.target?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.targetType!==i.TARGET_TYPE_COMMENT?((0,e.openBlock)(),(0,e.createElementBlock)("div",Vo,[Bo,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(c,{datetime:i.targetUpdated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),l.targetType===i.TARGET_TYPE_SPEC?((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,spec:l.target},null,8,["spec"])):l.targetType===i.TARGET_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(m,{key:2,subspec:l.target},null,8,["subspec"])):l.targetType===i.TARGET_TYPE_BLOCK?((0,e.openBlock)(),(0,e.createBlock)(u,{key:3,block:l.target,onPlayVideo:i.raisePlayVideo},null,8,["block","onPlayVideo"])):l.targetType===i.TARGET_TYPE_COMMENT?((0,e.openBlock)(),(0,e.createBlock)(p,{key:4,ref:"previewComment","spec-id":s.specId,comment:l.target,onDeleted:i.commentDeleted,onUpdateUnread:i.contextUpdateUnread},null,8,["spec-id","comment","onDeleted","onUpdateUnread"])):(0,e.createCommentVNode)("v-if",!0),s.enableWrite?((0,e.openBlock)(),(0,e.createElementBlock)("div",No,[l.sendingComment?((0,e.openBlock)(),(0,e.createElementBlock)("p",Eo,[(0,e.createVNode)(r,{message:"Posting comment..."})])):l.addingComment?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.addingComment?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,ref:"newCommentInput",type:"textarea",modelValue:l.newCommentBody,"onUpdate:modelValue":o[0]||(o[0]=e=>l.newCommentBody=e),autosize:{minRows:2},placeholder:"Type comment here"},null,8,["modelValue"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(g,{onClick:o[1]||(o[1]=e=>i.cancelAddComment()),type:"warning"},{default:(0,e.withCtx)((()=>[So])),_:1}),(0,e.createVNode)(g,{onClick:o[2]||(o[2]=e=>i.addComment()),disabled:i.disablePostComment,type:"primary"},{default:(0,e.withCtx)((()=>[xo])),_:1},8,["disabled"])])],64)):((0,e.openBlock)(),(0,e.createBlock)(g,{key:2,onClick:o[3]||(o[3]=e=>i.addComment()),type:"primary"},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)(" Comment on this "+(0,e.toDisplayString)(l.targetType),1)])),_:1}))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",To,[(0,e.createElementVNode)("div",Io,[l.unreadCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createTextVNode)((0,e.toDisplayString)(l.unreadCount)+" unread",1)],2112)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.commentsCount)+" comments",1)],2112)):((0,e.openBlock)(),(0,e.createElementBlock)("em",Po,"No comments"))]),i.loggedIn?((0,e.openBlock)(),(0,e.createBlock)(k,{key:0,modelValue:l.filterUnreadOnly,"onUpdate:modelValue":o[4]||(o[4]=e=>l.filterUnreadOnly=e),onChange:o[5]||(o[5]=e=>i.reloadCommunity())},{default:(0,e.withCtx)((()=>[Uo])),_:1},8,["modelValue"])):(0,e.createCommentVNode)("v-if",!0)]),l.reloadingComments?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ro,[(0,e.createVNode)(r,{message:"Reloading..."})])):l.comments.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:7},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.comments,(t=>((0,e.openBlock)(),(0,e.createBlock)(p,{ref_for:!0,ref:"comments",key:t.id,"spec-id":s.specId,comment:t,"show-community":!0,"show-unread-only":i.showUnreadOnly,onOpenComments:i.openComments,onUpdateUnread:i.adjustUnread,onDeleted:i.commentDeleted},null,8,["spec-id","comment","show-unread-only","onOpenComments","onUpdateUnread","onDeleted"])))),128)),l.loadingPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",_o,[(0,e.createVNode)(r,{message:"Loading more comments..."})])):l.hasMoreComments?((0,e.openBlock)(),(0,e.createBlock)(g,{key:1,onClick:o[6]||(o[6]=e=>i.loadMoreComments())},{default:(0,e.withCtx)((()=>[Mo])),_:1})):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]]),Ys={key:0,class:"embed-responsive"},Hs=["src"],Zs=["src"],Ws={data:()=>({vid:null,showing:!1}),methods:{show(e){let t=function(e){let t=ae.exec(e);return t?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:t[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:t[1]}:null:null}(e.url);t&&(this.vid=t,this.showing=!0)},closed(){this.vid=null}}},Ks=(0,B.Z)(Ws,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(a,{modelValue:l.showing,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,onClosed:o[1]||(o[1]=e=>i.closed()),"custom-class":"play-video-modal"},{default:(0,e.withCtx)((()=>[l.vid?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ys,["youtube"===l.vid.type?((0,e.openBlock)(),(0,e.createElementBlock)("iframe",{key:0,src:"https://www.youtube.com/embed/"+l.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""},null,8,Hs)):"vimeo"===l.vid.type?((0,e.openBlock)(),(0,e.createElementBlock)("iframe",{key:1,src:"https://player.vimeo.com/video/"+l.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""},null,8,Zs)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["modelValue","width"])}]]),Gs={components:{Username:N,Moment:rt,EditSpecModal:Vt,EditSubspecModal:lo,NavSpecModal:Co,CommunityModal:zs,PlayVideoModal:Ks},data:()=>({loading:!0,scrollOnRender:!0,spec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute(){return"spec"===this.$route.name},currentUserOwns(){return this.$store.getters.loggedIn&&this.spec&&this.spec.ownerType===Be&&this.$store.getters.currentUserId===this.spec.ownerId},enableEditing(){return this.currentUserOwns},enableWriteComments(){return this.$store.getters.loggedIn},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnread(){return this.$store.getters.loggedIn&&this.unreadCount>0}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter spec",e),o((t=>{t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave spec"),this.spec=null,this.unreadCount=0,this.commentsCount=0,le(),o()},methods:{loadSpec(e,t){console.debug("load spec"),this.loading=!0,function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return G().get("/ajax/spec",{specId:e,loadBlocks:t})}(e,t).then((e=>{console.debug("spec loaded",e),this.spec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,le(e.name),this.loading=!1,this.scrollOnRendered(),this.$store.commit("saveCurrentSpec",e)})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{e:"spec",url:encodeURIComponent(this.$route.fullPath)}})}))},scrollOnRendered(){this.scrollOnRender=!0},handleViewRendered(){this.scrollOnRender&&(this.scrollOnRender=!1,this.restoreScroll())},gotoSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec(){this.$refs.editSpecModal.showEdit(this.spec,(e=>{this.spec.updated=e.updated,this.spec.name=e.name,this.spec.desc=e.desc,this.spec.public=e.public,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,le(e.name)}))},openManageSubspec(e,t){this.$refs.editSubspecModal.showEdit(e,t)},openSpecCommunity(){this.$refs.communityModal.openCommunity(ge,this.spec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,o,s){this.$refs.communityModal.openCommunity(e,t,o,s)},playVideo(e){this.$refs.playVideoModal.show(e)},promptNavSpec(){this.$refs.navSpecModal.show()},openCreateSubspec(){this.$refs.editSubspecModal.showCreate((e=>{this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:e}})}))},restoreScroll(){if(this.onSpecRoute){let e=this.$store.state.savedScrollPosition;e?(console.debug("restoreScroll spec"),G()(window).scrollTop(e.top).scrollLeft(e.left)):se(this.$store.getters.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),G()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},Xs=(0,B.Z)(Gs,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("username"),r=(0,e.resolveComponent)("el-tooltip"),c=(0,e.resolveComponent)("el-button"),d=(0,e.resolveComponent)("moment"),m=(0,e.resolveComponent)("router-view"),u=(0,e.resolveComponent)("edit-spec-modal"),p=(0,e.resolveComponent)("edit-subspec-modal"),h=(0,e.resolveComponent)("nav-spec-modal"),g=(0,e.resolveComponent)("community-modal"),k=(0,e.resolveComponent)("play-video-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("section",Pt,[l.spec?((0,e.openBlock)(),(0,e.createElementBlock)("header",Ut,[l.loading?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createElementBlock)("div",Rt,[i.currentUserOwns?((0,e.openBlock)(),(0,e.createElementBlock)("span",_t,"You own this")):((0,e.openBlock)(),(0,e.createElementBlock)("span",Mt,[$t,l.spec.username?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,username:l.spec.username,highlight:l.spec.highlight},null,8,["username","highlight"])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createTextVNode)((0,e.toDisplayString)(l.spec.ownerType)+" "+(0,e.toDisplayString)(l.spec.ownerId),1)],2112))])),i.onSpecRoute?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.spec.public?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ot," Public ")):((0,e.openBlock)(),(0,e.createElementBlock)("span",jt,[(0,e.createVNode)(r,{content:"Unpublished",placement:"left"},{default:(0,e.withCtx)((()=>[Dt])),_:1})])),(0,e.createVNode)(c,{onClick:o[0]||(o[0]=e=>i.openSpecCommunity()),type:i.showUnread?"primary":"default",disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[At,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ft,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Lt,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type","disabled"]),(0,e.createVNode)(c,{onClick:o[1]||(o[1]=e=>i.openManageSpec()),disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[qt])),_:1},8,["disabled"])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("span",null,[zt,(0,e.createVNode)(d,{datetime:l.spec.updated,offset:!0},null,8,["datetime"])]),(0,e.createVNode)(c,{onClick:o[2]||(o[2]=e=>i.openSpecCommunity()),type:i.showUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Yt,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ht,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Zt,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])],64))],2112)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{onClick:o[3]||(o[3]=e=>i.promptNavSpec())},{default:(0,e.withCtx)((()=>[Wt])),_:1})])),(0,e.createElementVNode)("h2",{onClick:o[4]||(o[4]=e=>i.gotoSpec()),class:"name"},(0,e.toDisplayString)(l.spec.name),1),l.spec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Kt,(0,e.toDisplayString)(l.spec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(m,null,{default:(0,e.withCtx)((t=>{let{Component:o}=t;return[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(o),{loading:l.loading,spec:l.spec,"enable-editing":i.enableEditing,onRendered:i.handleViewRendered,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onOpenManageSubspec:i.openManageSubspec},null,8,["loading","spec","enable-editing","onRendered","onPromptNavSpec","onOpenCommunity","onPlayVideo","onOpenManageSubspec"]))]})),_:1}),i.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(u,{key:1,ref:"editSpecModal"},null,512)):(0,e.createCommentVNode)("v-if",!0),i.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(p,{key:2,ref:"editSubspecModal","spec-id":i.specId},null,8,["spec-id"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(h,{ref:"navSpecModal","spec-id":i.specId,"subspec-id":i.subspecId,"enable-editing":i.enableEditing,onOpenCreateSubspec:o[5]||(o[5]=e=>i.openCreateSubspec())},null,8,["spec-id","subspec-id","enable-editing"]),(0,e.createVNode)(g,{ref:"communityModal","spec-id":i.specId,"enable-write":i.enableWriteComments,onPlayVideo:i.playVideo},null,8,["spec-id","enable-write","onPlayVideo"]),(0,e.createVNode)(k,{ref:"playVideoModal"},null,512)])}]]),Qs={key:0},Js={key:2},en={key:0,class:"spec-view"},tn=(0,e.createElementVNode)("p",{class:"empty-message"},"No content.",-1),on=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),sn=(0,e.createElementVNode)("span",null,"Move block here",-1),nn=(0,e.createTextVNode)(" Add block "),ln={ref:"mirrorList",class:"mirror-list"},an=["data-spec-block"],rn=(0,e.createElementVNode)("div",{class:"bg"},null,-1),cn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),dn=(0,e.createElementVNode)("i",{class:"material-icons"},"more_horiz",-1),mn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),un=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),pn=(0,e.createElementVNode)("i",{class:"material-icons"},"south_east",-1),hn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_downward",-1),gn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),kn=(0,e.createTextVNode)("Cancel"),bn=(0,e.createTextVNode)("Cancel move"),fn=(0,e.createElementVNode)("i",{class:"material-icons"},"input",-1),yn=(0,e.createTextVNode)("Context"),Cn=(0,e.createTextVNode)("Change context"),wn=(0,e.createElementVNode)("i",{class:"material-icons"},"close",-1),vn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_upward",-1),Vn=(0,e.createElementVNode)("i",{class:"material-icons"},"south_east",-1),Bn=(0,e.createElementVNode)("i",{class:"material-icons"},"arrow_downward",-1),Nn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),En={key:0},Sn={key:1},xn=(0,e.createElementVNode)("i",{class:"material-icons"},"edit",-1),Tn=(0,e.createElementVNode)("i",{class:"material-icons"},"delete",-1),In=(0,e.createElementVNode)("i",{class:"material-icons"},"add",-1),Pn=(0,e.createElementVNode)("i",{class:"material-icons"},"drag_handle",-1),Un={key:1,class:"visitor-actions"},Rn=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),_n={key:0},Mn={key:1},$n={key:0,class:"layover parent-moving-layover"},On={key:1,class:"title"},jn=["textContent"],Dn=["innerHTML"],An="highlight",Fn="dragula";let Ln={};function qn(e){let t=[];for(var o=0;o<e.length;o++){let s=e[o];if(/\.js$/.test(s.src)){let e=document.createElement("script");e.type="text/javascript",e.crossOrigin="anonymous",s.integrity&&(e.integrity=s.integrity);let o=G().Deferred();e.addEventListener("load",(function(){o.resolve()})),e.addEventListener("error",(function(){o.reject()})),t.push(o),e.src=s.src,document.body.appendChild(e)}else if(/\.css$/.test(s.src)){let e=document.createElement("link");e.rel="stylesheet",e.crossOrigin="anonymous",s.integrity&&(e.integrity=s.integrity);let o=G().Deferred();e.addEventListener("load",(function(){o.resolve()})),e.addEventListener("error",(function(){o.reject()})),t.push(o),e.href=s.src,document.body.appendChild(e)}}return G().when.apply(G(),t)}function zn(e){if(Ln[e])return Ln[e];switch(e){case An:return Ln[e]=qn([{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/default.min.css",integrity:"sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js",integrity:"sha512-zol3kFQ5tnYhL7PzGt0LnllHHVWRGt2bTCIywDiScVvLIlaDOVJ6sPdJTVi0m3rA660RT+yZxkkRzMbb1L8Zkw=="}]).then((function(){return console.debug("highlight.js loaded"),window.hljs})).fail((function(){ee("Failed to load highlight.js code highlighting library")}));case Fn:return Ln[e]=qn([{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.css",integrity:"sha512-zlYhSecphd+kwRzeCOyj7/u3HZIQ3Q0NP7AN7ZEKhYTdi0AQOGGbc7eA3I/mUffqjdr8G1/9xoS478h+I0MQGg=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js",integrity:"sha512-NgXVRE+Mxxf647SqmbB9wPS5SEpWiLFp5G7ItUNFi+GVUyQeP+7w4vnKtc2O/Dm74TpTFKXNjakd40pfSKNulg=="}]).then((function(){return console.debug("dragula.js loaded"),window.dragula})).fail((function(){ee("Failed to load dragula.js drag and drop library")}))}}const Yn={components:{RefUrl:gs,RefSubspec:fo},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,renderedHtml:this.block.html,refItem:this.block.refItem,unreadCount:this.block.unreadCount||0,commentsCount:this.block.commentsCount||0,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{CONTENT_TYPE_PLAIN:()=>Ce,CONTENT_TYPE_MARKDOWN:()=>we,REF_TYPE_URL:()=>ve,REF_TYPE_SUBSPEC:()=>Ve,enableEditingDynamic(){return this.$store.getters.loggedIn&&this.enableEditing},showDeleteButton(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle(){return!(!this.title||!this.title.trim())},hasBody(){return!!(this.body&&this.body.trim()||this.renderedHtml&&this.renderedHtml.trim())},hasRefItem(){return!(!this.refType||!this.refItem)},refItemMissing(){return!!this.refType&&!this.refItem},classes(){return{[this.styleType]:!0,"title-only":this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks,"ref-item-only":this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks}},currentlyMovingBlocks(){return this.$store.getters.currentlyMovingBlocks},movingThis(){return this.$store.getters.currentlyMovingBlock(this.block.id)},movingOtherBlocks(){return this.currentlyMovingBlocks&&!this.movingThis},showAddToMoving(){return this.movingOtherBlocks&&se(this.$store.state.movingBlocksSourceSubspecId,this.subspecId)},showActions(){return this.focusActions||this.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.loggedIn&&this.$store.getters.userSettings.community.unreadOnly},showUnreadCount(){return this.$store.getters.loggedIn&&!!this.unreadCount},clearRef(){return!!this.unreadCount},mobileAdjust(){return this.showActions||!!this.unreadCount||!this.showUnreadOnly&&!!this.commentsCount}},watch:{renderedHtml(){this.addCodeHighlighting()}},mounted(){this.eventBus.on("url-updated",this.urlUpdated),this.eventBus.on("url-deleted",this.urlDeleted),this.addCodeHighlighting()},beforeDestroy(){this.eventBus.off("url-updated",this.urlUpdated),this.eventBus.off("url-deleted",this.urlDeleted)},methods:{getBlockId(){return this.block.id},getStyleType(){return this.styleType},addCodeHighlighting(){this.contentType===we&&this.renderedHtml&&this.$nextTick((()=>{let e=G()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&zn(An).then((t=>{e.each(((e,o)=>{t.highlightBlock(o)}))}))}))},getParentId(){let e=G()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId(){let e=G()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock(){this.raiseOpenEdit(this.block.id,(e=>{this.updated=e.updated,this.styleType=e.styleType,this.contentType=e.contentType,this.refType=e.refType,this.refId=e.refId,this.refItem=e.refItem,this.title=e.title,this.body=e.body,this.renderedHtml=e.html,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0}))},raiseOpenEdit(e,t){this.eventBus.emit("open-edit",{blockId:e,callback:t})},promptDeleteBlock(){this.eventBus.emit("prompt-delete",this.block.id)},enterChooseAddPosition(){this.choosingAddPosition=!0},cancelChooseAddPosition(){this.choosingAddPosition=!1},addBeforeThis(){let e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t,this.styleType)},addIntoThis(){let e=this.block.id;this.raisePromptAddSubblock(e,null,!0)},addAfterThis(){let e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t,this.styleType)},raisePromptAddSubblock(e,t,o){this.eventBus.emit("prompt-add-subblock",{parentId:e,insertBeforeId:t,defaultStyleType:o})},startMoving(){this.eventBus.emit("start-moving",this.block.id),this.focusActions=!1},addThisToMovingBlocks(){this.eventBus.emit("add-to-moving",this.block.id)},removeThisFromMovingBlocks(){this.eventBus.emit("remove-from-moving",this.block.id)},promptNavSpec(){this.eventBus.emit("prompt-nav-spec")},cancelMoving(){this.eventBus.emit("cancel-moving",this.block.id)},moveBeforeThis(){this.eventBus.emit("move-before",this.block.id)},moveIntoThis(){this.eventBus.emit("move-into",this.block.id)},moveAfterThis(){this.eventBus.emit("move-after",this.block.id)},mouseLeaveLayover(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated(e){this.refType===ve&&e.id===this.refId&&(this.refItem=e)},urlDeleted(e){this.refType===ve&&e===this.refId&&(this.refItem=null)},raisePlayVideo(e){this.eventBus.emit("play-video",e)},openCommunity(){this.eventBus.emit("open-community",{blockId:this.block.id,onAdjustUnread:e=>{this.unreadCount+=e},onAdjustComments:e=>{this.commentsCount+=e}})},updateHasSubblocks(){this.hasSubblocks=this.$refs.sublist.childElementCount>0},touchstart(e){this.lastTouchStartTime=Date.now()},selectstart(e){this.lastTouchStartTime&&Date.now()-this.lastTouchStartTime<200&&(e.preventDefault(),e.stopPropagation())}}},Hn=(0,B.Z)(Yn,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("el-checkbox"),c=(0,e.resolveComponent)("ref-url"),d=(0,e.resolveComponent)("ref-subspec"),m=(0,e.resolveComponent)("el-alert");return(0,e.openBlock)(),(0,e.createElementBlock)("li",{"data-spec-block":s.block.id,class:(0,e.normalizeClass)(["spec-block",i.classes]),onTouchstart:o[23]||(o[23]=function(){return i.touchstart&&i.touchstart(...arguments)}),onSelectstart:o[24]||(o[24]=function(){return i.selectstart&&i.selectstart(...arguments)})},[(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["content",{"clear-ref":i.clearRef,"mobile-adjust":i.mobileAdjust}])},[rn,(0,e.createElementVNode)("div",{class:"layover",onMouseleave:o[21]||(o[21]=e=>i.mouseLeaveLayover())},[i.enableEditingDynamic?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["expand-control",{hide:i.showActions}])},[(0,e.createCommentVNode)(" only show community button to admins in collapsed mobile menu when there are unread submissions "),(0,e.createCommentVNode)(" always show community button to guests, who only make community interactions "),i.showUnreadCount?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>i.openCommunity()),type:"primary",size:"small",round:""},{default:(0,e.withCtx)((()=>[cn,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(l.unreadCount)+" unread",1)])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{onClick:o[1]||(o[1]=e=>l.focusActions=!0),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[dn])),_:1})],2),(0,e.createElementVNode)("div",{class:(0,e.normalizeClass)(["actions",{show:i.showActions}])},[l.choosingAddPosition?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{onClick:o[2]||(o[2]=e=>i.cancelChooseAddPosition()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[mn])),_:1}),(0,e.createVNode)(a,{onClick:o[3]||(o[3]=e=>i.addBeforeThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[un])),_:1}),(0,e.createVNode)(a,{onClick:o[4]||(o[4]=e=>i.addIntoThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[pn])),_:1}),(0,e.createVNode)(a,{onClick:o[5]||(o[5]=e=>i.addAfterThis()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[hn])),_:1})],64)):i.movingThis?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(a,{onClick:o[6]||(o[6]=e=>i.cancelMoving()),type:"warning",size:"small"},{default:(0,e.withCtx)((()=>[gn,(0,e.createElementVNode)("span",null,[t.$store.getters.mobileViewport?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[kn],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[bn],2112))])])),_:1}),(0,e.createVNode)(a,{onClick:o[7]||(o[7]=e=>i.promptNavSpec()),size:"small"},{default:(0,e.withCtx)((()=>[fn,(0,e.createElementVNode)("span",null,[t.$store.getters.mobileViewport?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[yn],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[Cn],2112))])])),_:1}),(0,e.createVNode)(r,{key:"removeFromMoving","data-moving-block-id":s.block.id,modelValue:!0,onClick:o[8]||(o[8]=e=>i.removeThisFromMovingBlocks())},null,8,["data-moving-block-id"])],64)):i.movingOtherBlocks?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[(0,e.createVNode)(a,{onClick:o[9]||(o[9]=e=>i.cancelMoving()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[wn])),_:1}),(0,e.createVNode)(a,{onClick:o[10]||(o[10]=e=>i.moveBeforeThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[vn])),_:1}),(0,e.createVNode)(a,{onClick:o[11]||(o[11]=e=>i.moveIntoThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Vn])),_:1}),(0,e.createVNode)(a,{onClick:o[12]||(o[12]=e=>i.moveAfterThis()),type:"success",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Bn])),_:1}),i.showAddToMoving?((0,e.openBlock)(),(0,e.createBlock)(r,{key:"addToMoving",modelValue:!1,onClick:o[13]||(o[13]=e=>i.addThisToMovingBlocks())})):(0,e.createCommentVNode)("v-if",!0)],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:3},[(0,e.createVNode)(a,{onClick:o[14]||(o[14]=e=>i.openCommunity()),type:i.showUnreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[Nn,i.showUnreadCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",En,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Sn,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"]),(0,e.createVNode)(a,{onClick:o[15]||(o[15]=e=>i.editBlock()),type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[xn])),_:1}),i.showDeleteButton?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[16]||(o[16]=e=>i.promptDeleteBlock()),type:"warning",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Tn])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(a,{onClick:o[17]||(o[17]=e=>i.enterChooseAddPosition()),type:"primary",size:"small",circle:""},{default:(0,e.withCtx)((()=>[In])),_:1}),(0,e.createVNode)(a,{onClick:o[18]||(o[18]=e=>i.startMoving()),class:"move-action",type:"default",size:"small",circle:""},{default:(0,e.withCtx)((()=>[Pn])),_:1}),(0,e.createElementVNode)("i",{onClick:o[19]||(o[19]=e=>i.startMoving()),class:"material-icons drag-handle"},"drag_handle")],64))],2)],64)):((0,e.openBlock)(),(0,e.createElementBlock)("div",Un,[(0,e.createVNode)(a,{onClick:o[20]||(o[20]=e=>i.openCommunity()),type:i.showUnreadCount?"primary":"default",size:"small",round:""},{default:(0,e.withCtx)((()=>[Rn,i.showUnreadCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",_n,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Mn,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])]))],32),i.currentlyMovingBlocks?((0,e.openBlock)(),(0,e.createElementBlock)("div",$n,[(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{modelValue:!0,disabled:""})])])):(0,e.createCommentVNode)("v-if",!0),i.hasTitle?((0,e.openBlock)(),(0,e.createElementBlock)("div",On,(0,e.toDisplayString)(l.title),1)):(0,e.createCommentVNode)("v-if",!0),i.hasRefItem?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,item:l.refItem,class:"ref-item",onPlay:o[22]||(o[22]=e=>i.raisePlayVideo(l.refItem))},null,8,["item"])):l.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createBlock)(d,{key:1,item:l.refItem,class:"ref-item"},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],2112)):i.refItemMissing?((0,e.openBlock)(),(0,e.createBlock)(m,{key:3,title:"Content unavailable",closable:!1,type:"warning"})):(0,e.createCommentVNode)("v-if",!0),i.hasBody?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:4},[l.contentType===i.CONTENT_TYPE_PLAIN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:0,class:"body plain",textContent:(0,e.toDisplayString)(l.body)},null,8,jn)):l.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,ref:"renderedHtml",class:"body markdown",innerHTML:l.renderedHtml},null,8,Dn)):(0,e.createCommentVNode)("v-if",!0)],2112)):(0,e.createCommentVNode)("v-if",!0)],2),(0,e.createElementVNode)("ul",{ref:"sublist",class:(0,e.normalizeClass)(["spec-block-list",{moving:i.movingThis}])},[(0,e.createCommentVNode)(" managed programatically ")],2)],42,an)}]]),Zn={key:0},Wn={key:1},Kn={key:0},Gn=(0,e.createTextVNode)(" Created "),Xn=(0,e.createTextVNode)("; last modified "),Qn={class:"field"},Jn=(0,e.createTextVNode)("Bullet point"),el=(0,e.createTextVNode)("Numbered point"),tl=(0,e.createTextVNode)("Indented block"),ol=(0,e.createElementVNode)("div",null,"Title",-1),sl={class:"field"},nl=(0,e.createTextVNode)("No media"),ll=(0,e.createTextVNode)("Subspec"),il=(0,e.createTextVNode)("URL"),al={class:"field"},rl=(0,e.createTextVNode)("Plain text"),cl=(0,e.createTextVNode)("Markdown"),dl={key:0,class:"split-even"},ml=(0,e.createElementVNode)("div",null,"Body",-1),ul=(0,e.createElementVNode)("div",null,"Preview",-1),pl={key:0,class:"error"},hl=["innerHTML"],gl={key:1},kl=(0,e.createElementVNode)("div",null,"Body",-1),bl={key:0,class:"dialog-footer"},fl=(0,e.createTextVNode)("Close"),yl={key:1,class:"dialog-footer"},Cl=(0,e.createTextVNode)("Cancel"),wl=(0,e.createTextVNode)("Delete"),vl={class:"ref-form"},Vl={key:0},Bl={key:1},Nl=(0,e.createElementVNode)("div",null,"New link URL",-1),El=(0,e.createTextVNode)(" Create "),Sl=(0,e.createTextVNode)(" Select an existing link "),xl=(0,e.createTextVNode)(" Cancel "),Tl={key:0},Il={key:"url-select-actions"},Pl=(0,e.createTextVNode)(" Create new link "),Ul=(0,e.createTextVNode)(" Cancel "),Rl={key:"url-keep-actions"},_l=(0,e.createTextVNode)(" Create new link "),Ml=(0,e.createTextVNode)(" Select a different link "),$l={key:0},Ol=(0,e.createElementVNode)("div",null,"New subspec name",-1),jl=(0,e.createElementVNode)("div",null,"Description",-1),Dl=(0,e.createTextVNode)(" Create "),Al=(0,e.createTextVNode)(" Select an existing subspec "),Fl=(0,e.createTextVNode)(" Cancel "),Ll={key:0},ql={key:"subspec-select-actions"},zl=(0,e.createTextVNode)(" Create new subspec "),Yl=(0,e.createTextVNode)(" Cancel "),Hl={key:"subspec-keep-actions"},Zl=(0,e.createTextVNode)(" Create new subspec "),Wl=(0,e.createTextVNode)(" Select a different subspec "),Kl="keep",Gl="create",Xl="select",Ql={components:{RefUrl:gs,RefSubspec:fo,LoadingMessage:xt},props:{specId:{type:Number,required:!0},refType:String,existingRefType:String,existingRefItem:Object,valid:Boolean,fields:Object},emits:["update:valid","update:fields","open-edit-url","play-video"],data(){return{newUrl:"",urlId:this.existingRefType===ve&&this.existingRefItem&&this.existingRefItem.id||null,urlFilter:"",urlMode:this.existingRefType===ve&&this.existingRefItem?Kl:Gl,urlObjects:null,urlObjectsLoaded:!1,loadingUrlObjects:!1,creatingUrlObject:!1,newSubspecName:"",newSubspecDesc:"",subspecId:this.existingRefType===Ve&&this.existingRefItem&&this.existingRefItem.id||null,subspecFilter:"",subspecMode:this.existingRefType===Ve&&this.existingRefItem?Kl:Gl,subspecs:null,subspecsLoaded:!1,loadingSubspecs:!1,creatingSubspec:!1}},computed:{REF_TYPE_URL:()=>ve,REF_TYPE_SUBSPEC:()=>Ve,MODE_KEEP:()=>Kl,MODE_CREATE:()=>Gl,MODE_SELECT:()=>Xl,initialUrlObject(){return this.existingRefType===ve&&this.existingRefItem},urlSelectModeAvailable(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},filteredUrlObjects(){if(this.urlFilter&&this.urlObjects){let t=this.urlFilter.toLowerCase(),o=[];for(var e=0;e<this.urlObjects.length;e++){let s=this.urlObjects[e];(s.url.toLowerCase().indexOf(t)>=0||s.title&&s.title.toLowerCase().indexOf(t)>=0)&&o.push(s)}return o}return this.urlObjects},selectedUrlObject(){if(this.urlObjects&&this.urlId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.urlId)return this.urlObjects[e];return null},newUrlIsVideo(){return ie(this.newUrl)&&re(this.newUrl)},disableCreateUrl(){return!ie(this.newUrl)||this.creatingUrlObject},urlMaxLength:()=>window.const.urlMaxLength,initialSubspec(){return this.existingRefType===Ve&&this.existingRefItem},subspecSelectModeAvailable(){return null===this.subspecs||this.subspecs.length>1||this.subspecs.length&&!this.initialSubspec||1===this.subspecs.length&&this.subspecs[0].id!==this.initialSubspec.id},filteredSubspecs(){if(this.subspecFilter&&this.subspecs){let t=this.subspecFilter.toLowerCase(),o=[];for(var e=0;e<this.subspecs.length;e++){let s=this.subspecs[e];(s.name.toLowerCase().indexOf(t)>=0||s.desc&&s.desc.toLowerCase().indexOf(t)>=0)&&o.push(s)}return o}return this.subspecs},selectedSubspec(){if(this.subspecs&&this.subspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.subspecId)return this.subspecs[e];return null},disableCreateSubspec(){return!this.newSubspecName.trim()||this.creatingSubspec},subspecNameMaxLength:()=>window.const.specNameMaxLength,isValid(){switch(this.refType){case ve:switch(this.urlMode){case Kl:return!!this.initialUrlObject;case Gl:return ie(this.newUrl);case Xl:return!!this.urlId}break;case Ve:switch(this.subspecMode){case Kl:return!!this.initialSubspec;case Gl:return!!this.newSubspecName.trim();case Xl:return!!this.subspecId}}return!1},refFields(){switch(this.refType){case ve:switch(this.urlMode){case Kl:return this.initialUrlObject?{refId:this.initialUrlObject.id}:null;case Gl:return{refUrl:this.newUrl};case Xl:return{refId:this.urlId}}break;case Ve:switch(this.subspecMode){case Kl:return this.initialSubspec?{refId:this.initialSubspec.id}:null;case Gl:return{refName:this.newSubspecName,refDesc:this.newSubspecDesc};case Xl:return{refId:this.subspecId}}}return null}},watch:{urlMode(e){e!==Xl||this.urlObjectsLoaded||this.loadUrlObjects()},subspecMode(e){e!==Xl||this.subspecsLoaded||this.loadSubspecs()},isValid:{immediate:!0,handler(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,deep:!0,handler(e){this.$emit("update:fields",e)}}},methods:{loadUrlObjects(){var e;this.loadingUrlObjects||(this.loadingUrlObjects=!0,(e=this.specId,G().get("/ajax/spec/urls",{specId:e}).fail(ee)).then((e=>{this.urlObjects=e,e.length||(this.urlMode=Gl,oe("No URLs available.")),this.urlObjectsLoaded=!0,this.loadingUrlObjects=!1})).fail((()=>{this.urlObjects||(this.initialUrlObject?this.urlMode=Kl:this.urlMode=Gl),this.urlObjectsLoaded=!0,this.loadingUrlObjects=!1})))},filterUrlObjects(e){e?(this.debouncedFilterURLs||(this.debouncedFilterURLs=ne((e=>{this.urlFilter=e}))),this.debouncedFilterURLs(e)):this.urlFilter=""},openEditUrl(e){this.$emit("open-edit-url",e,(t=>{if(this.urlObjects)for(var o=0;o<this.urlObjects.length;o++)if(this.urlObjects[o].id===e.id){this.urlObjects.splice(o,1,t);break}}),(()=>{if(this.urlObjects)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects.splice(t,1);break}this.urlId===e.id&&(this.urlId=null)}))},raisePlayVideo(e){this.$emit("play-video",e)},createUrl(){this.creatingUrlObject=!0,Ct(this.specId,this.newUrl).then((e=>{if(this.urlId=e.id,this.urlMode=Xl,this.newUrl="",this.creatingUrlObject=!1,this.urlObjects){for(let t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id)return;this.urlObjects.push(e)}else this.urlObjects=[e];te("URL created.")})).fail((()=>{this.creatingUrlObject=!1}))},loadSubspecs(){var e;this.loadingSubspecs||(this.loadingSubspecs=!0,(e=this.specId,G().get("/ajax/spec/subspecs",{specId:e}).fail(ee)).then((e=>{this.subspecs=e,e.length||(this.subspecMode=Gl,oe("No subspecs available.")),this.subspecsLoaded=!0,this.loadingSubspecs=!1})).fail((()=>{this.subspecs||(this.initialSubspec?this.subspecMode=Kl:this.subspecMode=Gl),this.subspecsLoaded=!0,this.loadingSubspecs=!1})))},createSubspec(){this.creatingSubspec=!0,ft(this.specId,this.newSubspecName,this.newSubspecDesc).then((e=>{this.subspecId=e.id,this.subspecMode=Xl,this.newSubspecName="",this.newSubspecDesc="",this.creatingSubspec=!1,this.subspecs?this.subspecs.push(e):this.subspecs=[e],te("Subspec created.")})).fail((()=>{this.creatingSubspec=!1}))},urlUpdated(e){if(this.urlObjects)for(let t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects[t]=e;break}}}},Jl={components:{Moment:rt,RefForm:(0,B.Z)(Ql,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-alert"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-card"),u=(0,e.resolveComponent)("el-option"),p=(0,e.resolveComponent)("el-select"),h=(0,e.resolveComponent)("ref-url"),g=(0,e.resolveComponent)("ref-subspec");return(0,e.openBlock)(),(0,e.createElementBlock)("div",vl,[s.refType===i.REF_TYPE_URL?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.urlMode===i.MODE_CREATE?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0},{default:(0,e.withCtx)((()=>[l.creatingUrlObject?((0,e.openBlock)(),(0,e.createElementBlock)("p",Vl,[(0,e.createVNode)(a,{message:"Creating..."})])):((0,e.openBlock)(),(0,e.createElementBlock)("label",Bl,[Nl,(0,e.createVNode)(r,{modelValue:l.newUrl,"onUpdate:modelValue":o[0]||(o[0]=e=>l.newUrl=e),maxlength:i.urlMaxLength,clearable:""},null,8,["modelValue","maxlength"]),l.newUrl&&!i.isValid?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,title:"Invalid URL",type:"error",closable:!1})):i.newUrlIsVideo?((0,e.openBlock)(),(0,e.createBlock)(c,{key:1,title:"Embeddable video detected",type:"info",closable:!1})):(0,e.createCommentVNode)("v-if",!0)])),(0,e.createVNode)(d,{onClick:o[1]||(o[1]=e=>i.createUrl()),disabled:i.disableCreateUrl,type:"primary"},{default:(0,e.withCtx)((()=>[El])),_:1},8,["disabled"]),i.urlSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:2,onClick:o[2]||(o[2]=e=>l.urlMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Sl])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:3,onClick:o[3]||(o[3]=e=>l.urlMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[xl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1})):l.urlMode===i.MODE_SELECT?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.loadingUrlObjects?((0,e.openBlock)(),(0,e.createElementBlock)("p",Tl,[(0,e.createVNode)(a,{message:"Loading links..."})])):l.urlObjects&&l.urlObjects.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(p,{modelValue:l.urlId,"onUpdate:modelValue":o[4]||(o[4]=e=>l.urlId=e),filterable:"","filter-method":i.filterUrlObjects,placeholder:"Select link"},{default:(0,e.withCtx)((()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(i.filteredUrlObjects,(t=>((0,e.openBlock)(),(0,e.createBlock)(u,{key:t.id,value:t.id,label:t.title||t.url},null,8,["value","label"])))),128))])),_:1},8,["modelValue","filter-method"]),i.selectedUrlObject?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,item:i.selectedUrlObject,"show-edit":"",onEdit:o[5]||(o[5]=e=>i.openEditUrl(i.selectedUrlObject)),onPlay:o[6]||(o[6]=e=>i.raisePlayVideo(i.selectedUrlObject))},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Il,[(0,e.createVNode)(d,{onClick:o[7]||(o[7]=e=>l.urlMode=i.MODE_CREATE)},{default:(0,e.withCtx)((()=>[Pl])),_:1}),i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[8]||(o[8]=e=>l.urlMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[Ul])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.initialUrlObject?((0,e.openBlock)(),(0,e.createBlock)(h,{key:0,item:i.initialUrlObject,"show-edit":"",onEdit:o[9]||(o[9]=e=>i.openEditUrl(i.initialUrlObject)),onPlay:o[10]||(o[10]=e=>i.raisePlayVideo(i.initialUrlObject))},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Rl,[(0,e.createVNode)(d,{onClick:o[11]||(o[11]=e=>l.urlMode=i.MODE_CREATE)},{default:(0,e.withCtx)((()=>[_l])),_:1}),i.urlSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[12]||(o[12]=e=>l.urlMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Ml])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64))],2112)):s.refType===i.REF_TYPE_SUBSPEC?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.subspecMode===i.MODE_CREATE?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0},{default:(0,e.withCtx)((()=>[l.creatingSubspec?((0,e.openBlock)(),(0,e.createElementBlock)("p",$l,[(0,e.createVNode)(a,{message:"Creating..."})])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("label",null,[Ol,(0,e.createVNode)(r,{ref:"newSubspecNameInput",modelValue:l.newSubspecName,"onUpdate:modelValue":o[13]||(o[13]=e=>l.newSubspecName=e),maxlength:i.subspecNameMaxLength,clearable:""},null,8,["modelValue","maxlength"])]),(0,e.createElementVNode)("label",null,[jl,(0,e.createVNode)(r,{type:"textarea",modelValue:l.newSubspecDesc,"onUpdate:modelValue":o[14]||(o[14]=e=>l.newSubspecDesc=e),autosize:{minRows:2}},null,8,["modelValue"])])],64)),(0,e.createVNode)(d,{onClick:o[15]||(o[15]=e=>i.createSubspec()),disabled:i.disableCreateSubspec,type:"primary"},{default:(0,e.withCtx)((()=>[Dl])),_:1},8,["disabled"]),i.subspecSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:2,onClick:o[16]||(o[16]=e=>l.subspecMode=i.MODE_SELECT)},{default:(0,e.withCtx)((()=>[Al])),_:1})):(0,e.createCommentVNode)("v-if",!0),i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:3,onClick:o[17]||(o[17]=e=>l.subspecMode=i.MODE_KEEP)},{default:(0,e.withCtx)((()=>[Fl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])),_:1})):l.subspecMode===i.MODE_SELECT?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.loadingSubspecs?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ll,[(0,e.createVNode)(a,{message:"Loading subspecs..."})])):l.subspecs&&l.subspecs.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createVNode)(p,{modelValue:l.subspecId,"onUpdate:modelValue":o[18]||(o[18]=e=>l.subspecId=e),filterable:"",placeholder:"Select subspec"},{default:(0,e.withCtx)((()=>[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.subspecs,(t=>((0,e.openBlock)(),(0,e.createBlock)(u,{key:t.id,value:t.id,label:t.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),i.selectedSubspec?((0,e.openBlock)(),(0,e.createBlock)(g,{key:0,item:i.selectedSubspec},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0)],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",ql,[(0,e.createVNode)(d,{onClick:o[19]||(o[19]=e=>l.subspecMode=i.MODE_CREATE),size:"small"},{default:(0,e.withCtx)((()=>[zl])),_:1}),i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[20]||(o[20]=e=>l.subspecMode=i.MODE_KEEP),size:"small"},{default:(0,e.withCtx)((()=>[Yl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[i.initialSubspec?((0,e.openBlock)(),(0,e.createBlock)(g,{key:0,item:i.initialSubspec},null,8,["item"])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",Hl,[(0,e.createVNode)(d,{onClick:o[21]||(o[21]=e=>l.subspecMode=i.MODE_CREATE),size:"small"},{default:(0,e.withCtx)((()=>[Zl])),_:1}),i.subspecSelectModeAvailable?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[22]||(o[22]=e=>l.subspecMode=i.MODE_SELECT),size:"small"},{default:(0,e.withCtx)((()=>[Wl])),_:1})):(0,e.createCommentVNode)("v-if",!0)])],64))],2112)):(0,e.createCommentVNode)("v-if",!0)])}]]),LoadingMessage:xt},props:{specId:{type:Number,required:!0},subspecId:Number},emits:["open-edit-url","play-video","prompt-delete"],data:()=>({styleType:ye,contentType:Ce,title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,loading:!1,error:null,loadingPreview:!1,previewHtml:"",previewError:null}),computed:{STYLE_TYPE_NONE:()=>"none",STYLE_TYPE_BULLET:()=>ye,STYLE_TYPE_NUMBERED:()=>"numbered",CONTENT_TYPE_PLAIN:()=>Ce,CONTENT_TYPE_MARKDOWN:()=>we,REF_TYPE_URL:()=>ve,REF_TYPE_SUBSPEC:()=>Ve,titleMaxLength:()=>window.const.blockTitleMaxLength,existingRefType(){return this.block&&this.block.refType},existingRefItem(){return this.block&&this.block.refType&&this.block.refItem||null},initialUrlObject(){return this.existingRefType===ve&&this.existingRefItem}},watch:{body(){this.renderMarkdownPreview()},contentType(){this.renderMarkdownPreview()},previewHtml(e){this.addCodeHighlighting()}},methods:{showAddBlock(e,t,o,s){if(!0===o)if(t){let e=G()('[data-spec-block="'+t+'"]',".spec-view"),s=e.prev("[data-spec-block]");o=s.length?s.data("vc").getStyleType():e.data("vc").getStyleType()}else if(e){let t=G()('[data-spec-block="'+e+'"]',".spec-view"),s=G()(">ul>[data-spec-block]:last-child",t);s.length&&(o=s.data("vc").getStyleType())}else{let e=G()(">ul>[data-spec-block]:last-child",".spec-view");e.length&&(o=e.data("vc").getStyleType())}"string"==typeof o&&(this.styleType=o),this.parentId=e,this.insertBeforeId=t,this.callback=s,this.showing=!0,this.focusTitleInput()},showEditBlock(e,t){this.loading=!0,this.error=null,this.showing=!0,function(e,t){return G().get("/ajax/spec/load-edit-block",{specId:e,blockId:t}).fail(ee)}(this.specId,e).then((e=>{this.loading=!1,this.block=e,this.styleType=e.styleType,this.contentType=e.contentType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.focusTitleInput()})).fail((()=>{this.error="Error loading block",this.loading=!1}))},focusTitleInput(){this.$nextTick((()=>{G()("input",this.$refs.titleInput.$el).focus()}))},renderMarkdownPreview(){this.contentType===we&&(this.body.trim()?(this.debouncedBodyRender||(this.debouncedBodyRender=ne((e=>{this.loadingPreview=!0,this.previewError=null,this.previewXhr&&this.previewXhr.abort();let t=function(e){let t=G().post("/ajax/render-markdown",{markdown:e});return t.fail((function(e){0===e.status&&"abort"===e.statusText||ee(e)})),t}(e);this.previewXhr=t,t.then((e=>{this.previewXhr===t&&(e.error?this.previewError=e.error:this.previewHtml=e.html,this.loadingPreview=!1,this.previewXhr=null)})).fail((()=>{this.previewXhr===t&&(this.previewError="Error generating preview.",this.loadingPreview=!1,this.previewXhr=null)}))}),1e3)),this.debouncedBodyRender(this.body)):this.previewHtml="")},addCodeHighlighting(){this.previewHtml&&this.$nextTick((()=>{let e=G()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&zn(An).then((t=>{e.each(((e,o)=>{t.highlightBlock(o)}))}))}))},openEditUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(o=>{this.initialUrlObject&&o.id===this.initialUrlObject.id&&(this.block.refItem=o),this.$refs.refForm.urlUpdated(e),t&&t(o)}),(e=>{this.initialUrlObject&&e===this.initialUrlObject.id&&(this.block.refType=null,this.block.refId=null,this.block.refItem=null),o&&o(e)}))},raisePlayVideo(e){this.$emit("play-video",e)},promotDelete(){this.$emit("prompt-delete",this.block.id,(()=>{this.showing=!1}))},submit(){if(this.refType){if(!this.refFieldsValid||!this.refFields)return void this.$alert('Please specify the attachment or choose "No media".',{type:"error"})}else if(!this.refType&&!this.title.trim()&&!this.body.trim())return void this.$alert("A title, body, or attachment is required.",{type:"error"});if(this.contentType===we&&this.previewError)return void this.$alert("Error rendering preview. Please check your HTML syntax.",{type:"error"});let e=this.createSendingSpinner(),t=this.callback;var o,s,n,l,i,a,r,c;this.block?(o=this.specId,s=this.block.id,n=this.styleType,l=this.contentType,i=this.title,a=this.body,r=this.refType,c=this.refFields,c=c||{},G().post("/ajax/spec/save-block",{specId:o,blockId:s,styleType:n,contentType:l,title:i,body:a,refType:r,...c}).fail(ee)).then((o=>{t(o),this.showing=!1,e.close()})).fail((()=>{e.close()})):function(e,t,o,s,n,l,i,a,r,c){return c=c||{},G().post("/ajax/spec/create-block",{specId:e,subspecId:t,parentId:o,insertBeforeId:s,styleType:n,contentType:l,title:i,body:a,refType:r,...c}).fail(ee)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,this.contentType,this.title,this.body,this.refType,this.refFields).then((o=>{t(o),this.showing=!1,e.close()})).fail((()=>{e.close()}))},createSendingSpinner(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed(){this.styleType=ye,this.contentType=Ce,this.block=null,this.error=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1,this.previewHtml="",this.previewError=null}}},ei=(0,B.Z)(Jl,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("moment"),c=(0,e.resolveComponent)("el-radio"),d=(0,e.resolveComponent)("el-radio-group"),m=(0,e.resolveComponent)("el-input"),u=(0,e.resolveComponent)("ref-form"),p=(0,e.resolveComponent)("el-button"),h=(0,e.resolveComponent)("el-dialog"),g=(0,e.resolveDirective)("loading");return(0,e.openBlock)(),(0,e.createBlock)(h,{title:l.loading||l.block?"Edit block":"Add block",modelValue:l.showing,"onUpdate:modelValue":o[12]||(o[12]=e=>l.showing=e),width:t.$store.getters.dialogLargeWidth,"close-on-click-modal":!1,onClosed:o[13]||(o[13]=e=>i.closed()),"custom-class":"spec-edit-block-modal"},{footer:(0,e.withCtx)((()=>[l.error?((0,e.openBlock)(),(0,e.createElementBlock)("span",bl,[(0,e.createVNode)(p,{onClick:o[8]||(o[8]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[fl])),_:1})])):l.showing?((0,e.openBlock)(),(0,e.createElementBlock)("span",yl,[(0,e.createVNode)(p,{onClick:o[9]||(o[9]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[Cl])),_:1}),l.block?((0,e.openBlock)(),(0,e.createBlock)(p,{key:0,onClick:o[10]||(o[10]=e=>i.promotDelete()),type:"warning"},{default:(0,e.withCtx)((()=>[wl])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(p,{onClick:o[11]||(o[11]=e=>i.submit()),type:"primary"},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.block?"Save":"Add"),1)])),_:1})])):(0,e.createCommentVNode)("v-if",!0)])),default:(0,e.withCtx)((()=>[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Zn,[(0,e.createVNode)(a,{message:"Loading..."})])):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",Wn,(0,e.toDisplayString)(l.error),1)):l.showing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:2},[l.block?((0,e.openBlock)(),(0,e.createElementBlock)("p",Kn,[Gn,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(r,{datetime:l.block.created},null,8,["datetime"])]),Xn,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(r,{datetime:l.block.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",Qn,[(0,e.createVNode)(d,{modelValue:l.styleType,"onUpdate:modelValue":o[0]||(o[0]=e=>l.styleType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:i.STYLE_TYPE_BULLET},{default:(0,e.withCtx)((()=>[Jn])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.STYLE_TYPE_NUMBERED},{default:(0,e.withCtx)((()=>[el])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.STYLE_TYPE_NONE},{default:(0,e.withCtx)((()=>[tl])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,e.createElementVNode)("label",null,[ol,(0,e.createVNode)(m,{ref:"titleInput",modelValue:l.title,"onUpdate:modelValue":o[1]||(o[1]=e=>l.title=e),maxlength:i.titleMaxLength,clearable:""},null,8,["modelValue","maxlength"])])]),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",sl,[(0,e.createVNode)(d,{modelValue:l.refType,"onUpdate:modelValue":o[2]||(o[2]=e=>l.refType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:null},{default:(0,e.withCtx)((()=>[nl])),_:1}),(0,e.createVNode)(c,{label:i.REF_TYPE_SUBSPEC},{default:(0,e.withCtx)((()=>[ll])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.REF_TYPE_URL},{default:(0,e.withCtx)((()=>[il])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,e.withDirectives)((0,e.createVNode)(u,{ref:"refForm","spec-id":s.specId,"ref-type":l.refType,"existing-ref-type":i.existingRefType,"existing-ref-item":i.existingRefItem,fields:l.refFields,"onUpdate:fields":o[3]||(o[3]=e=>l.refFields=e),valid:l.refFieldsValid,"onUpdate:valid":o[4]||(o[4]=e=>l.refFieldsValid=e),onOpenEditUrl:i.openEditUrl,onPlayVideo:i.raisePlayVideo},null,8,["spec-id","ref-type","existing-ref-type","existing-ref-item","fields","valid","onOpenEditUrl","onPlayVideo"]),[[e.vShow,!!l.refType]])]),(0,e.createElementVNode)("section",null,[(0,e.createElementVNode)("div",al,[(0,e.createVNode)(d,{modelValue:l.contentType,"onUpdate:modelValue":o[5]||(o[5]=e=>l.contentType=e)},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{label:i.CONTENT_TYPE_PLAIN},{default:(0,e.withCtx)((()=>[rl])),_:1},8,["label"]),(0,e.createVNode)(c,{label:i.CONTENT_TYPE_MARKDOWN},{default:(0,e.withCtx)((()=>[cl])),_:1},8,["label"])])),_:1},8,["modelValue"])]),l.contentType===i.CONTENT_TYPE_MARKDOWN?((0,e.openBlock)(),(0,e.createElementBlock)("div",dl,[(0,e.createCommentVNode)(" display preview beneath for final review"),(0,e.createElementVNode)("label",null,[ml,(0,e.createVNode)(m,{type:"textarea",modelValue:l.body,"onUpdate:modelValue":o[6]||(o[6]=e=>l.body=e),autosize:{minRows:2}},null,8,["modelValue"])]),(0,e.createElementVNode)("label",null,[ul,l.previewError?((0,e.openBlock)(),(0,e.createElementBlock)("div",pl,(0,e.toDisplayString)(l.previewError),1)):(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:1,ref:"renderedHtml",class:"markdown",innerHTML:l.previewHtml},null,8,hl)),[[g,l.loadingPreview]])])])):((0,e.openBlock)(),(0,e.createElementBlock)("label",gl,[kl,(0,e.createVNode)(m,{type:"textarea",modelValue:l.body,"onUpdate:modelValue":o[7]||(o[7]=e=>l.body=e),autosize:{minRows:2}},null,8,["modelValue"])]))])],64)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]]),ti={key:0},oi=(0,e.createTextVNode)(" Created "),si=(0,e.createTextVNode)("; last modified "),ni=(0,e.createElementVNode)("div",null,"URL",-1),li={key:0,class:"preview"},ii=["src"],ai={key:0},ri={key:1},ci={key:2},di=(0,e.createTextVNode)("Refresh URL preview"),mi={key:1},ui={class:"dialog-footer"},pi=(0,e.createTextVNode)("Cancel"),hi=(0,e.createTextVNode)("Delete"),gi={components:{Moment:rt},props:{specId:{type:Number,required:!0}},data:()=>({url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return window.isValidURL=ie,!ie(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},urlMaxLength:()=>window.const.urlMaxLength,autoRefresh(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.createdCallback=e,this.showing=!0,this.$nextTick((()=>{G()("input",this.$refs.urlInput.$el).focus()}))},showEdit(e,t,o){this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=o,this.showing=!0,this.$nextTick((()=>{G()("input",this.$refs.urlInput.$el).focus()}))},submit(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.createdCallback;Ct(this.specId,this.url).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},submitSave(){if(this.disableSubmit)return;this.sending=!0;let e=this.updatedCallback;var t,o;(t=this.urlObject.id,o=this.url,G().post("/ajax/spec/refresh-url",{id:t,url:o}).fail(ee)).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},promptDelete(){this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{this.sending=!0;let e=this.deletedCallback;var t;(t=this.urlObject.id,G().post("/ajax/spec/delete-url",{id:t}).fail(ee)).then((()=>{e&&e(this.urlObject.id),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},ki={components:{EditBlockModal:ei,EditUrlModal:(0,B.Z)(gi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("moment"),r=(0,e.resolveComponent)("el-input"),c=(0,e.resolveComponent)("el-checkbox"),d=(0,e.resolveComponent)("el-button"),m=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createBlock)(m,{title:l.urlObject?"Manage link":"Create link",modelValue:l.showing,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showing=e),width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1,onClosed:o[6]||(o[6]=e=>i.closed()),"custom-class":"spec-edit-url-modal"},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",ui,[(0,e.createVNode)(d,{onClick:o[2]||(o[2]=e=>l.showing=!1)},{default:(0,e.withCtx)((()=>[pi])),_:1}),l.urlObject?((0,e.openBlock)(),(0,e.createBlock)(d,{key:0,onClick:o[3]||(o[3]=e=>i.promptDelete()),type:"danger"},{default:(0,e.withCtx)((()=>[hi])),_:1})):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(d,{onClick:o[4]||(o[4]=e=>i.submit()),type:"primary",disabled:i.disableSubmit},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(l.urlObject?"Save":"Create"),1)])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[l.urlObject?((0,e.openBlock)(),(0,e.createElementBlock)("p",ti,[oi,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.urlObject.created},null,8,["datetime"])]),si,(0,e.createElementVNode)("strong",null,[(0,e.createVNode)(a,{datetime:l.urlObject.updated,offset:!0},null,8,["datetime"])])])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("label",null,[ni,(0,e.createVNode)(r,{ref:"urlInput",modelValue:l.url,"onUpdate:modelValue":o[0]||(o[0]=e=>l.url=e),maxlength:i.urlMaxLength},null,8,["modelValue","maxlength"])]),l.urlObject?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[l.url===l.urlObject.url?((0,e.openBlock)(),(0,e.createElementBlock)("div",li,[l.urlObject.imageData?((0,e.openBlock)(),(0,e.createElementBlock)("img",{key:0,src:l.urlObject.imageData},null,8,ii)):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("div",null,[l.urlObject.title?((0,e.openBlock)(),(0,e.createElementBlock)("h3",ai,(0,e.toDisplayString)(l.urlObject.title.trim()),1)):(0,e.createCommentVNode)("v-if",!0),l.urlObject.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",ri,(0,e.toDisplayString)(l.urlObject.desc.trim()),1)):(0,e.createCommentVNode)("v-if",!0),i.autoRefresh?((0,e.openBlock)(),(0,e.createElementBlock)("p",ci,"URL preview will be updated")):((0,e.openBlock)(),(0,e.createBlock)(c,{key:3,modelValue:l.refresh,"onUpdate:modelValue":o[1]||(o[1]=e=>l.refresh=e)},{default:(0,e.withCtx)((()=>[di])),_:1},8,["modelValue"]))])])):((0,e.openBlock)(),(0,e.createElementBlock)("p",mi,"Link will be updated with new URL"))],2112)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["title","modelValue","width"])}]])},props:{spec:Object,subspec:Object,enableEditing:Boolean},emits:["rendered","open-community","url-updated","url-deleted","play-video","prompt-nav-spec"],data(){return{autoscroller:null,eventBus:{all:e=e||new Map,on:function(t,o){var s=e.get(t);s?s.push(o):e.set(t,[o])},off:function(t,o){var s=e.get(t);s&&(o?s.splice(s.indexOf(o)>>>0,1):e.set(t,[]))},emit:function(t,o){var s=e.get(t);s&&s.slice().map((function(e){e(o)})),(s=e.get("*"))&&s.slice().map((function(e){e(t,o)}))}}};var e},computed:{dragging(){return this.$store.state.dragging},specId(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId(){return this.subspec?this.subspec.id:null},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},dragAndDropEnabled(){return this.enableEditing&&!this.$store.getters.mobileViewport}},watch:{dragAndDropEnabled(e){e?this.mountDragAndDrop():this.drake&&(this.drake.destroy(),this.drake=null)},dragging(e){e?this.autoscroller=function(){const e=70,t=G()(window);let o=null,s=null;function n(e){s=e.clientY}return t.on("mousemove",n),o=window.requestAnimationFrame((function n(){if(null!==s){let o=t.height(),n=0;s<e?n=-((e-s)/e*8+1):s>o-e&&(n=(s-(o-e))/e*8+1),0!==n&&t.scrollTop(t.scrollTop()+n)}o=window.requestAnimationFrame(n)})),{stop:function(){t.off("mousemove",n),o&&(window.cancelAnimationFrame(o),o=null)}}}():this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null)}},mounted(){if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";let e;if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var t=0;t<e.length;t++)this.insertBlock(e[t]);this.$nextTick((()=>{this.$emit("rendered")})),this.mountDragAndDrop();let o=this.eventBus;o.on("open-community",this.openBlockCommunity),o.on("open-edit",this.openEditBlock),o.on("prompt-add-subblock",this.promptAddSubblock),o.on("prompt-delete",this.promptDeleteBlock),o.on("start-moving",this.startMovingBlocks),o.on("add-to-moving",this.addToMovingBlocks),o.on("remove-from-moving",this.removeFromMovingBlocks),o.on("prompt-nav-spec",this.promptNavSpec),o.on("move-before",this.moveBeforeBlock),o.on("move-into",this.moveIntoBlock),o.on("move-after",this.moveAfterBlock),o.on("cancel-moving",this.cancelMovingBlocks),o.on("play-video",this.playVideo)},beforeDestroy(){this.drake&&(this.drake.destroy(),this.drake=null),this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null),this.$store.getters.currentlyMovingBlocks&&this.$store.state.movingBlocksSourceSubspecId===this.subspecId&&this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.getFinalMovingBlockIds()}),this.eventBus.all.clear(),this.eventBus=null,G()("[data-spec-block]",this.$refs.list).each(((e,t)=>{G()(t).data("destroy")()}))},methods:{transitRelativeScrollFirst(){let e=G()(window).scrollTop();G()("[data-spec-block]",this.$refs.list).each(((t,o)=>{let s=G()(o),n=s.offset();if(n.top>e){let t=n.top-e;return this.$nextTick((()=>{G()(window).scrollTop(s.offset().top-t)})),!1}}))},transitRelativeScroll(e){let t=G()(window).scrollTop(),o=G()('[data-spec-block="'+e+'"]',this.$refs.list),s=o.offset().top-t;this.$nextTick((()=>{G()(window).scrollTop(o.offset().top-s)}))},insertBlock(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{vNode:n,destroy:l,el:i}=function(t){let{props:o,children:s,element:n,app:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n,a=(0,e.createVNode)(t,o,s);l&&l._context&&(a.appContext=l._context),i?(0,e.render)(a,i):"undefined"!=typeof document&&(0,e.render)(a,i=document.createElement("div"));const r=()=>{i&&(0,e.render)(null,i),i=null,a=null};return{vNode:a,destroy:r,el:i}}(Hn,{props:{block:t,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:s},app:Ee}),a=n.component.ctx,r=G()(G()(i).find(">li")).data("vc",a).data("destroy",l);if(t.subblocks)for(var c=0;c<t.subblocks.length;c++){let e=t.subblocks[c],o=this.insertBlock(e,!1);G()(">ul.spec-block-list",r).append(o)}return o&&r.appendTo(this.$refs.list),r},mountDragAndDrop(){this.dragAndDropEnabled&&(this.drake||zn(Fn).then((e=>{console.debug("create drake"),this.drake=e({isContainer:e=>G()(e).is(".spec-block-list"),accepts:(e,t,o,s)=>!G()(t).closest(".gu-transit").length,moves:(e,t,o,s)=>G()(o).is(".drag-handle"),mirrorContainer:this.$refs.mirrorList}).on("drag",((e,t)=>{this.$store.commit("startDragging"),this.transitRelativeScroll(G()(e).attr("data-spec-block"))})).on("dragend",(e=>{this.$store.commit("endDragging"),this.transitRelativeScroll(G()(e).attr("data-spec-block"))})).on("drop",((e,t,o,s)=>{let n=G()(e).data("vc").getBlockId(),l=G()(o).closest("[data-spec-block]");l.length&&l.data("vc").updateHasSubblocks();let i=null,a=G()(t).closest("[data-spec-block]");if(a.length){let e=a.data("vc");i=e.getBlockId(),e.updateHasSubblocks()}let r=s?G()(s).data("vc").getBlockId():null;yt([n],this.subspecId,i,r)}))})))},promptAddBlock(){this.$refs.editBlockModal.showAddBlock(null,null,!0,(e=>{let t=this.insertBlock(e,!0,!0);this.panToBlock(t)}))},openBlockCommunity(e){let{blockId:t,onAdjustUnread:o,onAdjustComments:s}=e;this.$emit("open-community",be,t,o,s)},openEditBlock(e){let{blockId:t,callback:o}=e;this.$refs.editBlockModal.showEditBlock(t,o)},promptAddSubblock(e){let{parentId:t,insertBeforeId:o,defaultStyleType:s}=e;this.$refs.editBlockModal.showAddBlock(t,o,s,(e=>{let s=this.insertBlock(e,!1,!0);if(o)s.insertBefore('[data-spec-block="'+o+'"]');else if(t){let e=G()('[data-spec-block="'+t+'"]');s.appendTo(e.find(">ul.spec-block-list")),e.data("vc").updateHasSubblocks()}else s.appendTo(this.$refs.list);this.panToBlock(s)}))},promptDeleteBlock(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{(function(e){return G().post("/ajax/spec/delete-block",{blockId:e}).fail(ee)})(e).then((()=>{G()('[data-spec-block="'+e+'"]').remove(),t&&t()}))})).catch((()=>{}))},startMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:[e]}),this.transitRelativeScroll(e)},addToMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.concat(e)})},removeFromMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.filter((t=>!se(t,e)))})},moveBeforeBlock(e){let t=G()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.parent().closest("[data-spec-block]"),s=o.length?o.attr("data-spec-block"):null,n=e;this.moveBlocks(s,n,(e=>{e.insertBefore(t)}))},moveIntoBlock(e){let t=G()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.attr("data-spec-block"),s=t.find(">ul.spec-block-list");this.moveBlocks(o,null,(e=>{e.appendTo(s)})),t.data("vc").updateHasSubblocks()},moveAfterBlock(e){let t=G()('[data-spec-block="'+e+'"]',this.$refs.list),o=t.parent().closest("[data-spec-block]"),s=o.length?o.attr("data-spec-block"):null,n=t.next("[data-spec-block]"),l=n.length?n.attr("data-spec-block"):null,i=t;this.moveBlocks(s,l,(e=>{e.insertAfter(i),i=e}))},moveBlocksToBottom(){this.moveBlocks(null,null,(e=>{e.appendTo(this.$refs.list)}))},getFinalMovingBlockIds(){if(!this.$store.getters.currentlyMovingBlocks)return[];if(!se(this.$store.state.movingBlocksSourceSubspecId,this.subspecId))return this.$store.state.movingBlockIds;let e=[];return G()("[data-moving-block-id]",this.$refs.list).each(((t,o)=>{let s=G()(o);s.closest(".spec-block-list.moving").length||e.push(s.attr("data-moving-block-id"))})),e},moveBlocks(e,t,o){var s=this;let n=this.getFinalMovingBlockIds();n.length&&yt(n,this.subspecId,e,t).then((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;if(e)for(var l=0;l<e.length;l++){let n=s.insertBlock(e[l],!1,!0);o(n),t||(t=n)}else{let e={};for(let l=0;l<n.length;l++){let i=G()('[data-spec-block="'+n[l]+'"]',s.$refs.list),a=i.parent().closest("[data-spec-block]");o(i),a.length&&(e[a.attr("data-spec-block")]=a.data("vc")),t||(t=i)}for(let t in e)e[t].updateHasSubblocks()}s.$store.commit("endMovingBlocks"),s.panToBlock(t)}))},cancelMovingBlocks(e){this.$store.commit("endMovingBlocks"),this.transitRelativeScroll(e)},openEditUrl(e,t,o){this.$refs.editUrlModal.showEdit(e,(e=>{this.eventBus.emit("url-updated",e),t&&t(e)}),(e=>{this.eventBus.emit("url-deleted",e),o&&o(e)}))},playVideo(e){this.$emit("play-video",e)},promptNavSpec(){this.$emit("prompt-nav-spec")},panToBlock(e){let t=e.find(">.content").offset(),o=G()(window),s=o.scrollTop(),n=o.height();t.top<s+100?o.scrollTop(t.top-100):t.top>s+n-200&&o.scrollTop(t.top-(n-200))}}},bi=(0,B.Z)(ki,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("edit-block-modal"),c=(0,e.resolveComponent)("edit-url-modal");return s.spec||s.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("div",en,[(0,e.createElementVNode)("ul",{ref:"list",class:(0,e.normalizeClass)(["spec-block-list",{dragging:i.dragging}])},[(0,e.createCommentVNode)(" managed programatically ")],2),tn,s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[i.choosingAddPosition?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[0]||(o[0]=e=>i.moveBlocksToBottom()),type:"success"},{default:(0,e.withCtx)((()=>[on,sn])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(a,{key:1,onClick:o[1]||(o[1]=e=>i.promptAddBlock()),type:"primary"},{default:(0,e.withCtx)((()=>[nn])),_:1})),(0,e.createElementVNode)("ul",ln,[(0,e.createCommentVNode)(" holds mirror element when dragging block ")],512),(0,e.createVNode)(r,{ref:"editBlockModal","spec-id":i.specId,"subspec-id":i.subspecId,onOpenEditUrl:i.openEditUrl,onPlayVideo:i.playVideo,onPromptDelete:i.promptDeleteBlock},null,8,["spec-id","subspec-id","onOpenEditUrl","onPlayVideo","onPromptDelete"]),(0,e.createVNode)(c,{ref:"editUrlModal","spec-id":i.specId},null,8,["spec-id"])],64)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0)}]]),fi={components:{SpecView:bi,LoadingMessage:xt},props:{loading:Boolean,spec:Object,enableEditing:Boolean},emits:["rendered","prop-nav-spec","open-community","play-video"],beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter spec-view",e),o()},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate spec-view",e),o()},methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)}}},yi=(0,B.Z)(fi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("spec-view",!0);return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["spec-view-page",{loading:s.loading}])},[s.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Qs,[(0,e.createVNode)(a,{message:"Loading..."})])):s.spec?((0,e.openBlock)(),(0,e.createBlock)(r,{key:s.spec.renderTime,spec:s.spec,"enable-editing":s.enableEditing,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onRendered:o[0]||(o[0]=e=>t.$emit("rendered"))},null,8,["spec","enable-editing","onPromptNavSpec","onOpenCommunity","onPlayVideo"])):((0,e.openBlock)(),(0,e.createElementBlock)("p",Js," Failed to load spec. "))],2)}]]),Ci={class:"subspec-page"},wi={key:0},vi={key:0,class:"right"},Vi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Bi={key:0},Ni={key:1},Ei=(0,e.createElementVNode)("i",{class:"material-icons"},"settings",-1),Si=(0,e.createTextVNode)(" Last modified "),xi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Ti={key:0},Ii={key:1},Pi={class:"name"},Ui={key:1,class:"desc"},Ri={components:{Moment:rt,SpecView:bi},inheritAttrs:!1,props:{enableEditing:Boolean},emits:["prompt-nav-spec","open-community","play-video","open-manage-subspec"],data:()=>({loading:!0,scrollOnRender:!0,subspec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute(){return"subspec"===this.$route.name},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnread(){return this.$store.getters.loggedIn&&this.unreadCount>0}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter subspec",e),o((t=>{t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave subspec"),this.subspec=null,this.unreadCount=0,this.commentsCount=0,le(),o()},methods:{loadSubspec(e,t,o){console.debug("load subspec"),this.loading=!0,function(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return G().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:o})}(e,t,o).then((e=>{console.debug("subspec loaded",e),this.subspec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,le(e.name),this.loading=!1,this.scrollOnRendered()})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{e:"subspec",url:encodeURIComponent(this.$route.fullPath)}})}))},scrollOnRendered(){this.scrollOnRender=!0},handleViewRendered(){this.scrollOnRender&&(this.scrollOnRender=!1,this.restoreScroll())},promptNavSpec(){this.$emit("prompt-nav-spec")},openSubspecCommunity(){this.$emit("open-community",ke,this.subspec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)},openManageSubspec(){this.$emit("open-manage-subspec",this.subspec,(e=>{this.subspec.updated=e.updated,this.subspec.name=e.name,this.subspec.desc=e.desc,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,le(e.name)}))},restoreScroll(){let e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),G()(window).scrollTop(e.top).scrollLeft(e.left))}}},_i=(0,B.Z)(Ri,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button"),r=(0,e.resolveComponent)("moment"),c=(0,e.resolveComponent)("router-view");return(0,e.openBlock)(),(0,e.createElementBlock)("section",Ci,[l.subspec?((0,e.openBlock)(),(0,e.createElementBlock)("header",wi,[i.onSubspecRoute&&!l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("div",vi,[s.enableEditing?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(a,{onClick:o[0]||(o[0]=e=>i.openSubspecCommunity()),type:i.showUnread?"primary":"default",disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Vi,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Bi,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ni,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type","disabled"]),s.enableEditing?((0,e.openBlock)(),(0,e.createBlock)(a,{key:0,onClick:o[1]||(o[1]=e=>i.openManageSubspec()),disabled:i.choosingAddPosition},{default:(0,e.withCtx)((()=>[Ei])),_:1},8,["disabled"])):(0,e.createCommentVNode)("v-if",!0)],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("span",null,[Si,(0,e.createVNode)(r,{datetime:l.subspec.updated,offset:!0},null,8,["datetime"])]),(0,e.createVNode)(a,{onClick:o[2]||(o[2]=e=>i.openSubspecCommunity()),type:i.showUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[xi,i.showUnread?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ti,(0,e.toDisplayString)(l.unreadCount)+" unread",1)):l.commentsCount?((0,e.openBlock)(),(0,e.createElementBlock)("span",Ii,(0,e.toDisplayString)(l.commentsCount),1)):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["type"])],64))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("h3",Pi,(0,e.toDisplayString)(l.subspec.name),1),l.subspec.desc?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ui,(0,e.toDisplayString)(l.subspec.desc),1)):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,null,{default:(0,e.withCtx)((t=>{let{Component:o}=t;return[((0,e.openBlock)(),(0,e.createBlock)((0,e.resolveDynamicComponent)(o),{loading:l.loading,subspec:l.subspec,"enable-editing":s.enableEditing,onRendered:i.handleViewRendered,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo},null,8,["loading","subspec","enable-editing","onRendered","onPromptNavSpec","onOpenCommunity","onPlayVideo"]))]})),_:1})])}]]),Mi={key:0},$i={key:2},Oi={components:{SpecView:bi,LoadingMessage:xt},props:{loading:Boolean,subspec:Object,enableEditing:Boolean},emits:["rendered","prompt-nav-spec","open-community","play-video"],methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,o,s){this.$emit("open-community",e,t,o,s)},playVideo(e){this.$emit("play-video",e)}}},ji=(0,B.Z)(Oi,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("spec-view");return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["subspec-view-page",{loading:s.loading}])},[s.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Mi,[(0,e.createVNode)(a,{message:"Loading..."})])):s.subspec?((0,e.openBlock)(),(0,e.createBlock)(r,{key:s.subspec.renderTime,subspec:s.subspec,"enable-editing":s.enableEditing,onPromptNavSpec:i.promptNavSpec,onOpenCommunity:i.openCommunity,onPlayVideo:i.playVideo,onRendered:o[0]||(o[0]=e=>t.$emit("rendered"))},null,8,["subspec","enable-editing","onPromptNavSpec","onOpenCommunity","onPlayVideo"])):((0,e.openBlock)(),(0,e.createElementBlock)("p",$i," Failed to load subspec. "))],2)}]]),Di={class:"community-review-page"},Ai=(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h2",null,"Community review")],-1),Fi={class:"content-page"},Li={key:0},qi=(0,e.createElementVNode)("h3",null,"Your specs",-1),zi={class:"flex-row"},Yi={class:"flex-row nowrap fill"},Hi={class:"expand"},Zi=(0,e.createElementVNode)("i",{class:"material-icons"},"expand_less",-1),Wi=(0,e.createElementVNode)("i",{class:"material-icons"},"expand_more",-1),Ki=(0,e.createElementVNode)("i",{class:"material-icons"},"filter_center_focus",-1),Gi={class:"name fill"},Xi=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),Qi=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),Ji={key:0,class:"subspecs"},ea={class:"flex-row"},ta={class:"name fill"},oa=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),sa=(0,e.createElementVNode)("i",{class:"material-icons"},"folder",-1),na={key:1},la={key:1},ia=(0,e.createElementVNode)("h3",null,"Your comments",-1),aa={class:"flex-row wrap-reverse"},ra=["textContent"],ca=(0,e.createTextVNode)(" Show only comments with unread replies "),da={class:"flex-row"},ma={class:"fill"},ua=(0,e.createTextVNode)(" updated "),pa=(0,e.createTextVNode)(" posted "),ha=(0,e.createElementVNode)("i",{class:"material-icons"},"forum",-1),ga=["textContent"],ka={key:0},ba=(0,e.createTextVNode)("Load more"),fa={key:1},ya={key:2};function Ca(e){return G().get("/ajax/community-review",e)}const wa={components:{Moment:rt,CommunityModal:zs,PlayVideoModal:Ks,Username:N,LoadingMessage:xt},data:()=>({loading:!0,showUnreadOnly:!1,specs:[],expandedSpecs:{},subspecsBySpecId:{},comments:[],totalComments:0,hasMoreComments:!1,loadingCommentsPage:!1,specId:null}),computed:{commentsPageArgs(){let e={unreadOnly:this.showUnreadOnly};return this.comments.length&&(e.updatedBefore=this.comments[this.comments.length-1].updated),e},formattedCommentsCount(){let e=this.totalComments;return e+" comment"+(1!==e?"s":"")+(this.showUnreadOnly?" with unread replies":"")}},beforeRouteEnter(e,t,o){console.debug("beforeRouteEnter community-review",e),o((e=>{e.initPage()}))},beforeRouteUpdate(e,t,o){console.debug("beforeRouteUpdate community-review",e),this.initPage(),o()},beforeRouteLeave(e,t,o){console.debug("beforeRouteLeave community-review"),this.specs=[],this.expandedSpecs={},this.subspecsBySpecId={},this.comments=[],this.totalComments=0,this.hasMoreComments=!1,this.specId=null,o()},methods:{initPage(){this.showUnreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loading=!0,Ca(G().extend({request:"all"},this.commentsPageArgs)).then((e=>{this.specs=e.specs,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments,this.loading=!1})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},expandSpec(e){var t=this.expandedSpecs[e];this.expandedSpecs[e]=!0,void 0===t&&Ca({request:"subspecs",specId:e}).then((t=>{this.subspecsBySpecId[e]=t.subspecs})).fail((t=>{this.expandedSpecs[e]=!1,ee(t)}))},collapseSpec(e){this.expandedSpecs[e]=!1},reloadComments(){this.loadingCommentsPage=!0,this.comments=[],Ca(G().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,ee(e)}))},loadMoreComments(){this.loadingCommentsPage=!0,Ca(G().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,ee(e)}))},openSpecCommunity(e){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(ge,e,(t=>{for(var o=0;o<this.specs.length;o++)if(se(e,this.specs[o].id)){this.specs[o].unread=this.specs[o].unread+t;break}}),(t=>{for(var o=0;o<this.specs.length;o++)if(se(e,this.specs[o].id)){this.specs[o].total=this.specs[o].total+t;break}}))}))},gotoSpec(e){this.$router.push({name:"spec",params:{specId:e}})},openSubspecCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(ke,t,(o=>{let s=this.subspecsBySpecId[e];for(var n=0;n<s.length;n++)if(se(t,s[n].id)){s[n].unread=s[n].unread+o;break}let l=!1;if(o>0)l=!0;else for(n=0;n<s.length;n++)if(s[n].unread>0||s[n].blockUnread>0){l=!0;break}for(n=0;n<this.specs.length;n++)if(se(e,this.specs[n].id)){this.specs[n].hasUnreadSubspec=l;break}}),(o=>{let s=this.subspecsBySpecId[e];for(var n=0;n<s.length;n++)if(se(t,s[n].id)){s[n].total=s[n].total+o;break}}))}))},gotoSubspec(e,t){this.$router.push({name:"subspec",params:{specId:e,subspecId:t}})},openCommentCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(fe,t,(e=>{for(var o=0;o<this.comments.length;o++)if(se(t,this.comments[o].id)){this.comments[o].unread=this.comments[o].unread+e;break}}),(e=>{for(var o=0;o<this.comments.length;o++)if(se(t,this.comments[o].id)){this.comments[o].total=this.comments[o].total+e;break}}))}))},playVideo(e){this.$refs.playVideoModal.show(e)}}},va=(0,B.Z)(wa,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-button"),c=(0,e.resolveComponent)("router-link"),d=(0,e.resolveComponent)("el-checkbox"),m=(0,e.resolveComponent)("username"),u=(0,e.resolveComponent)("moment"),p=(0,e.resolveComponent)("community-modal"),h=(0,e.resolveComponent)("play-video-modal");return(0,e.openBlock)(),(0,e.createElementBlock)("section",Di,[Ai,(0,e.createElementVNode)("div",Fi,[l.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Li,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("section",null,[qi,l.specs.length?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:0},(0,e.renderList)(l.specs,(t=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:t.id,class:"spec review"},[(0,e.createElementVNode)("div",zi,[(0,e.createElementVNode)("div",Yi,[(0,e.createElementVNode)("div",Hi,[t.hasSubspecs?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[l.expandedSpecs[t.id]?((0,e.openBlock)(),(0,e.createBlock)(r,{key:0,onClick:e=>i.collapseSpec(t.id),type:t.hasUnreadSubspec?"primary":"default",circle:""},{default:(0,e.withCtx)((()=>[Zi])),_:2},1032,["onClick","type"])):((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,onClick:e=>i.expandSpec(t.id),type:t.hasUnreadSubspec?"primary":"default",circle:""},{default:(0,e.withCtx)((()=>[Wi])),_:2},1032,["onClick","type"]))],2112)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createCommentVNode)(" claim same space with hidden button "),(0,e.createVNode)(r,{type:"default",circle:"",style:{visibility:"hidden"}},{default:(0,e.withCtx)((()=>[Ki])),_:1})],2112))]),(0,e.createElementVNode)("div",Gi,[(0,e.createVNode)(c,{to:{name:"spec",params:{specId:t.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(t.name),1)])),_:2},1032,["to"])])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openSpecCommunity(t.id),type:t.unread?"primary":"default"},{default:(0,e.withCtx)((()=>[Xi,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.unread)+" unread ("+(0,e.toDisplayString)(t.total)+" total) ",1)])),_:2},1032,["onClick","type"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.gotoSpec(t.id),type:t.blockUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[Qi,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.blockUnread)+" unread ("+(0,e.toDisplayString)(t.blockTotal)+" total) on blocks ",1)])),_:2},1032,["onClick","type"])])]),l.expandedSpecs[t.id]?((0,e.openBlock)(),(0,e.createElementBlock)("div",Ji,[l.subspecsBySpecId[t.id]?((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,{key:0},(0,e.renderList)(l.subspecsBySpecId[t.id],(o=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:o.id,class:"subspec review"},[(0,e.createElementVNode)("div",ea,[(0,e.createElementVNode)("div",ta,[(0,e.createVNode)(c,{to:{name:"subspec",params:{specId:t.id,subspecId:o.id}}},{default:(0,e.withCtx)((()=>[(0,e.createTextVNode)((0,e.toDisplayString)(o.name),1)])),_:2},1032,["to"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openSubspecCommunity(t.id,o.id),type:o.unread?"primary":"default"},{default:(0,e.withCtx)((()=>[oa,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.unread)+" unread ("+(0,e.toDisplayString)(o.total)+" total) ",1)])),_:2},1032,["onClick","type"])]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.gotoSubspec(t.id,o.id),type:o.blockUnread?"primary":"default"},{default:(0,e.withCtx)((()=>[sa,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.blockUnread)+" unread ("+(0,e.toDisplayString)(o.blockTotal)+" total) on blocks ",1)])),_:2},1032,["onClick","type"])])])])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",na,[(0,e.createVNode)(a)]))])):(0,e.createCommentVNode)("v-if",!0)])))),128)):((0,e.openBlock)(),(0,e.createElementBlock)("p",la,"No specs"))]),(0,e.createElementVNode)("section",null,[ia,(0,e.createElementVNode)("div",aa,[(0,e.createElementVNode)("div",{class:"fill nowraptext",textContent:(0,e.toDisplayString)(i.formattedCommentsCount)},null,8,ra),(0,e.createVNode)(d,{modelValue:l.showUnreadOnly,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showUnreadOnly=e),onChange:o[1]||(o[1]=e=>i.reloadComments())},{default:(0,e.withCtx)((()=>[ca])),_:1},8,["modelValue"])]),l.comments.length?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(l.comments,(o=>((0,e.openBlock)(),(0,e.createElementBlock)("div",{key:o.id,class:"comment review"},[(0,e.createElementVNode)("div",da,[(0,e.createElementVNode)("div",ma,[(0,e.createVNode)(m,{username:t.$store.getters.username},null,8,["username"]),o.updated!==o.created?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[ua,(0,e.createVNode)(u,{datetime:o.updated,offset:!0},null,8,["datetime"])],64)):((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[pa,(0,e.createVNode)(u,{datetime:o.created,offset:!0},null,8,["datetime"])],64))]),(0,e.createElementVNode)("div",null,[(0,e.createVNode)(r,{onClick:e=>i.openCommentCommunity(o.specId,o.id),type:o.unread?"primary":"default",size:"small"},{default:(0,e.withCtx)((()=>[ha,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(o.unread)+" unread ("+(0,e.toDisplayString)(o.total)+" total) ",1)])),_:2},1032,["onClick","type"])])]),(0,e.createElementVNode)("div",{class:"body",textContent:(0,e.toDisplayString)(o.body)},null,8,ga)])))),128)),l.loadingCommentsPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",ka,[(0,e.createVNode)(a,{message:"Loading more comments..."})])):l.hasMoreComments?((0,e.openBlock)(),(0,e.createBlock)(r,{key:1,onClick:o[2]||(o[2]=e=>i.loadMoreComments())},{default:(0,e.withCtx)((()=>[ba])),_:1})):(0,e.createCommentVNode)("v-if",!0)],64)):l.loadingCommentsPage?((0,e.openBlock)(),(0,e.createElementBlock)("p",fa,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createElementBlock)("p",ya,"No comments"))])],64))]),(0,e.createVNode)(p,{ref:"communityModal","spec-id":l.specId,"enable-write":t.$store.getters.loggedIn,onPlayVideo:i.playVideo},null,8,["spec-id","enable-write","onPlayVideo"]),(0,e.createVNode)(h,{ref:"playVideoModal"},null,512)])}]]),Va={class:"admin-page"},Ba=(0,e.createElementVNode)("header",null,[(0,e.createElementVNode)("h2",null,"Admin panel")],-1),Na={class:"content-page"},Ea={key:0},Sa={key:1},xa={key:2},Ta={key:3,class:"signup-requests"},Ia=(0,e.createElementVNode)("h3",null,"Signup requests",-1),Pa={class:"options"},Ua=(0,e.createTextVNode)("Show all"),Ra={key:0},_a=(0,e.createTextVNode)("Approved"),Ma=(0,e.createTextVNode)("Denied"),$a=(0,e.createTextVNode)("Pending"),Oa=(0,e.createTextVNode)(" Review "),ja={key:2},Da={key:3},Aa={class:"users"},Fa=(0,e.createElementVNode)("h3",null,"Users",-1),La={key:0},qa=(0,e.createElementVNode)("td",null,"Request IDâ",-1),za=(0,e.createElementVNode)("td",null,"Createdâ",-1),Ya=(0,e.createElementVNode)("td",null,"Usernameâ",-1),Ha=(0,e.createElementVNode)("td",null,"Email addressâ",-1),Za=(0,e.createElementVNode)("br",null,null,-1),Wa=(0,e.createElementVNode)("br",null,null,-1),Ka=(0,e.createElementVNode)("div",null,"Message",-1),Ga={key:0},Xa={class:"dialog-footer"},Qa=(0,e.createTextVNode)(" Cancel "),Ja=(0,e.createTextVNode)(" Decline "),er=(0,e.createTextVNode)(" Approve "),tr={components:{Moment:rt,Username:N,LoadingMessage:xt},data:()=>({loadingSignupRequests:!0,loadingUsers:!0,error:null,showAllSignupRequests:!1,signupRequests:null,reviewingSignupRequest:null,signupRequestResponse:"",sendingSignupRequestReview:!1,users:[]}),computed:{loading(){return this.loadingSignupRequests},unauthorized(){return!(this.loading||this.error||this.signupRequests)}},watch:{showAllSignupRequests(){this.loadSignupRequests()}},beforeRouteEnter(e,t,o){o((e=>{e.loadAdmin()}))},beforeRouteUpdate(e,t,o){this.loadAdmin(),o()},methods:{loadAdmin(){this.error=null,this.loadSignupRequests(),this.loadUsers()},loadSignupRequests(){this.loadingSignupRequests=!0,$.get("/ajax/admin/signup-requests",{all:this.showAllSignupRequests}).then((e=>{this.loadingSignupRequests=!1,this.signupRequests=e})).fail((e=>{this.loadingSignupRequests=!1,this.error=e.status,ee(e)}))},loadUsers(){this.loadingUsers=!0,$.get("/ajax/admin/users").then((e=>{this.loadingUsers=!1,this.users=e})).fail((e=>{this.loadingUsers=!1,this.error=e.status,ee(e)}))},openReviewSignupRequest(e){this.signupRequestResponse="",this.reviewingSignupRequest=e},cancelReviewSignupRequest(){this.reviewingSignupRequest=null,this.signupRequestResponse=""},submitSignupRequestReview(e){this.reviewingSignupRequest&&(this.sendingSignupRequestReview=!0,$.post("/ajax/admin/review-signup",{requestId:this.reviewingSignupRequest.id,approved:e,message:this.signupRequestResponse}).then((()=>{this.sendingSignupRequestReview=!1;for(var t=0;t<this.signupRequests.length;t++)if(se(this.signupRequests[t].id,this.reviewingSignupRequest.id)){this.showAllSignupRequests?(this.reviewingSignupRequest.reviewed=!0,this.reviewingSignupRequest.approved=e,this.signupRequests.splice(t,1,this.reviewingSignupRequest)):this.signupRequests.splice(t,1);break}this.reviewingSignupRequest=null,this.signupRequestResponse=""})).fail((e=>{this.sendingSignupRequestReview=!1,ee(e)})))}}},or=(0,B.Z)(tr,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("loading-message"),r=(0,e.resolveComponent)("el-checkbox"),c=(0,e.resolveComponent)("el-table-column"),d=(0,e.resolveComponent)("moment"),m=(0,e.resolveComponent)("el-tag"),u=(0,e.resolveComponent)("el-button"),p=(0,e.resolveComponent)("el-table"),h=(0,e.resolveComponent)("username"),g=(0,e.resolveComponent)("el-input"),k=(0,e.resolveComponent)("el-dialog");return(0,e.openBlock)(),(0,e.createElementBlock)("div",Va,[Ba,(0,e.createElementVNode)("div",Na,[i.loading?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ea,[(0,e.createVNode)(a,{message:"Loading..."})])):403===l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",Sa,"Unauthorized")):l.error?((0,e.openBlock)(),(0,e.createElementBlock)("p",xa,"Error "+(0,e.toDisplayString)(l.error),1)):(0,e.createCommentVNode)("v-if",!0),l.signupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("section",Ta,[Ia,(0,e.createElementVNode)("div",Pa,[(0,e.createVNode)(r,{modelValue:l.showAllSignupRequests,"onUpdate:modelValue":o[0]||(o[0]=e=>l.showAllSignupRequests=e)},{default:(0,e.withCtx)((()=>[Ua])),_:1},8,["modelValue"])]),l.loadingSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ra,[(0,e.createVNode)(a,{message:"Loading..."})])):l.signupRequests.length?((0,e.openBlock)(),(0,e.createBlock)(p,{key:1,data:l.signupRequests,"max-height":.8*t.$store.state.windowHeight},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{fixed:"",prop:"id",label:"ID",width:"40"}),(0,e.createVNode)(c,{fixed:"",prop:"username",label:"Username",width:"150"}),(0,e.createVNode)(c,{prop:"email",label:"Email address",width:"300"}),(0,e.createVNode)(c,{label:"Created",width:"200"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(d,{datetime:t.row.created,offset:!0},null,8,["datetime"])])),_:1}),l.showAllSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createVNode)(c,{label:"Status",width:"120"},{default:(0,e.withCtx)((t=>[t.row.reviewed?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[t.row.approved?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0,type:"success"},{default:(0,e.withCtx)((()=>[_a])),_:1})):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1,type:"warning"},{default:(0,e.withCtx)((()=>[Ma])),_:1}))],2112)):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1},{default:(0,e.withCtx)((()=>[$a])),_:1}))])),_:1}),(0,e.createVNode)(c,{prop:"userId",label:"User ID",width:"120"})],64)):(0,e.createCommentVNode)("v-if",!0),(0,e.createVNode)(c,{label:"Actions",width:"200"},{default:(0,e.withCtx)((t=>[t.row.reviewed?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createBlock)(u,{key:0,onClick:e=>i.openReviewSignupRequest(t.row),size:"small"},{default:(0,e.withCtx)((()=>[Oa])),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data","max-height"])):l.showAllSignupRequests?((0,e.openBlock)(),(0,e.createElementBlock)("p",ja,"No data")):((0,e.openBlock)(),(0,e.createElementBlock)("p",Da,"No pending requests"))])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("section",Aa,[Fa,l.loadingUsers?((0,e.openBlock)(),(0,e.createElementBlock)("p",La,[(0,e.createVNode)(a,{message:"Loading..."})])):((0,e.openBlock)(),(0,e.createBlock)(p,{key:1,data:l.users,"max-height":.8*t.$store.state.windowHeight},{default:(0,e.withCtx)((()=>[(0,e.createVNode)(c,{fixed:"",label:"Username",width:"190"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(h,{username:t.row.username,highlight:t.row.highlight},null,8,["username","highlight"])])),_:1}),(0,e.createVNode)(c,{prop:"email",label:"Email address",width:"300"}),(0,e.createVNode)(c,{label:"Created",width:"200"},{default:(0,e.withCtx)((t=>[(0,e.createVNode)(d,{datetime:t.row.created,offset:!0},null,8,["datetime"])])),_:1}),(0,e.createVNode)(c,{prop:"specs",label:"Spec count",width:"100"}),(0,e.createVNode)(c,{label:"Actions",width:"200"})])),_:1},8,["data","max-height"]))])]),l.reviewingSignupRequest?((0,e.openBlock)(),(0,e.createBlock)(k,{key:0,title:"Review signup request","close-on-click-modal":!l.sendingSignupRequestReview,width:t.$store.getters.dialogTinyWidth,visible:""},{footer:(0,e.withCtx)((()=>[(0,e.createElementVNode)("span",Xa,[(0,e.createVNode)(u,{onClick:o[2]||(o[2]=e=>i.cancelReviewSignupRequest()),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Qa])),_:1},8,["disabled"]),(0,e.createVNode)(u,{type:"warning",onClick:o[3]||(o[3]=e=>i.submitSignupRequestReview(!1)),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[Ja])),_:1},8,["disabled"]),(0,e.createVNode)(u,{type:"primary",onClick:o[4]||(o[4]=e=>i.submitSignupRequestReview(!0)),disabled:l.sendingSignupRequestReview},{default:(0,e.withCtx)((()=>[er])),_:1},8,["disabled"])])])),default:(0,e.withCtx)((()=>[(0,e.createElementVNode)("table",null,[(0,e.createElementVNode)("tr",null,[qa,(0,e.createElementVNode)("td",null,(0,e.toDisplayString)(l.reviewingSignupRequest.id),1)]),(0,e.createElementVNode)("tr",null,[za,(0,e.createElementVNode)("td",null,[(0,e.createVNode)(d,{datetime:l.reviewingSignupRequest.created},null,8,["datetime"])])]),(0,e.createElementVNode)("tr",null,[Ya,(0,e.createElementVNode)("td",null,[(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(l.reviewingSignupRequest.username),1)])]),(0,e.createElementVNode)("tr",null,[Ha,(0,e.createElementVNode)("td",null,[(0,e.createElementVNode)("strong",null,(0,e.toDisplayString)(l.reviewingSignupRequest.email),1)])])]),Za,Wa,(0,e.createElementVNode)("label",null,[Ka,(0,e.createVNode)(g,{type:"textarea",modelValue:l.signupRequestResponse,"onUpdate:modelValue":o[1]||(o[1]=e=>l.signupRequestResponse=e),autosize:{minRows:2},readonly:l.sendingSignupRequestReview},null,8,["modelValue","readonly"])]),l.sendingSignupRequestReview?((0,e.openBlock)(),(0,e.createElementBlock)("p",Ga,[(0,e.createVNode)(a,{message:"Sending..."})])):(0,e.createCommentVNode)("v-if",!0)])),_:1},8,["close-on-click-modal","width"])):(0,e.createCommentVNode)("v-if",!0)])}]]),sr={class:"ajax-error-page content-page"},nr={key:0},lr={key:1},ir={key:2},ar={key:3},rr={key:4},cr=(0,e.createTextVNode)("Retry"),dr={computed:{url(){return decodeURIComponent(this.$route.query.url)},errorType(){return this.$route.query.e||!1},statusCode(){return parseInt(this.$route.params.code,10)||0},specForbidden(){return 403===this.statusCode&&"spec"===this.errorType},subspecForbidden(){return 403===this.statusCode&&"subspec"===this.errorType}},methods:{retry(){this.$router.replace(this.url)}}},mr=(0,B.Z)(dr,[["render",function(t,o,s,n,l,i){const a=(0,e.resolveComponent)("el-button");return(0,e.openBlock)(),(0,e.createElementBlock)("div",sr,[0===i.statusCode?((0,e.openBlock)(),(0,e.createElementBlock)("p",nr,"Could not connect to server")):503===i.statusCode?((0,e.openBlock)(),(0,e.createElementBlock)("p",lr,"CrowdSpec is currently offline for database upgrades")):i.specForbidden?((0,e.openBlock)(),(0,e.createElementBlock)("p",ir,"You do not have access to the requested spec.")):i.subspecForbidden?((0,e.openBlock)(),(0,e.createElementBlock)("p",ar,"You do not have access to the requested subspec.")):((0,e.openBlock)(),(0,e.createElementBlock)("p",rr,"Request failed with error code "+(0,e.toDisplayString)(i.statusCode),1)),i.url?((0,e.openBlock)(),(0,e.createBlock)(a,{key:5,onClick:o[0]||(o[0]=e=>i.retry())},{default:(0,e.withCtx)((()=>[cr])),_:1})):(0,e.createCommentVNode)("v-if",!0)])}]]),ur={class:"content-page"},pr={},hr=(0,B.Z)(pr,[["render",function(t,o,s,n,l,i){return(0,e.openBlock)(),(0,e.createElementBlock)("div",ur," Not found ")}]]),gr=(0,pe.createRouter)({history:(0,pe.createWebHashHistory)(),routes:[{name:"index",path:"/",component:It},{path:"/spec/:specId",component:Xs,children:[{name:"spec",path:"",component:yi},{path:"subspec/:subspecId",component:_i,children:[{name:"subspec",path:"",component:ji}]}]},{name:"community-review",path:"/community-review",component:va},{name:"admin",path:"/admin",component:or},{name:"ajax-error",path:"/ajax-error/:code",component:mr},{path:"/:pathMatch(.*)",component:hr}],scrollBehavior:(e,t,o)=>(xe.commit("setSavedScrollPosition",o),o||{left:0,top:0})});gr.beforeEach(((e,t,o)=>{t&&(xe.getters.currentSpecId&&e.params.specId&&se(e.params.specId,xe.getters.currentSpecId)?xe.commit("saveCurrentSpecScrollTop"):(xe.commit("clearCurrentSpec"),xe.commit("endMovingBlocks"))),o()})),gr.afterEach(((e,t)=>{console.debug("afterEach"),xe.commit("clearSavedScrollPosition")}));const kr=gr,br=(0,e.createApp)(ue);Ee=br,window.app=br,br.use(s(),{locale:l()}),br.use(kr),br.use(xe),br.mount("#app")})()})();