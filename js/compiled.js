(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=Vue;var s=e.n(t),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app"},[s("header",[s("h1",{on:{click:function(t){return e.gotoIndex()}}},[e._v("CrowdSpec")]),e._v(" "),s("div",[s("el-button",{staticClass:"username-button",attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openEditProfile()}}},[s("username",{attrs:{username:e.username,highlight:e.$store.getters.userSettings.userProfile.highlightUsername}})],1),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.logout()}}},[e._v("Log out")])],1)]),e._v(" "),s("router-view",{staticClass:"page-area"}),e._v(" "),s("edit-profile-modal",{ref:"editProfileModal"})],1)};n._withStripped=!0;const i=jQuery;var o=e.n(i);const r=Vuex;var l=e.n(r),c=/^VersionStamp: (.+)$/m;function a(e){console.error(e);var t=null;e&&(0===e.readyState?t="Could not connect to server.":e.readyState&&e.status?t="Request failed with HTTP error code "+e.status+".":e.message?t=e.message:"string"==typeof e&&(t=e)),t||(t="An error occurred."),e&&e.responseText&&c.test(e.responseText)&&c.exec(e.responseText)[1]!==window.appVersion&&(t+=" (A new version is available. Reload this page to use the latest client code.)"),s().prototype.$alert(t,"Error",{confirmButtonText:"Ok",type:"error"})}function u(e,t){return parseInt(e,10)===parseInt(t,10)}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(e?" | ":"")+e}function p(e){if(window.URL)try{return new URL(e),!0}catch(e){return!1}return!(!e||!e.trim())}var h=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function f(e){return h.test(e)}s().use(l());var b=o()(window),m=new(l().Store)({state:{currentTime:Date.now(),windowWidth:b.width(),dragging:!1,movingBlockId:null,savedScrollPosition:null,currentSpecId:null,currentSpecScrollTop:null,userSettings:window.user.settings},getters:{userID:function(e){return window.user.id},username:function(e){return window.user.username},userSettings:function(e){return o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"}},e.userSettings)},dialogTinyWidth:function(e){return e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(e){return e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(e){return e.windowWidth<=991?"95%":"90%"}},mutations:{setWindowWidth:function(e,t){e.windowWidth=t},setUserSettings:function(e,t){e.userSettings=t},startDragging:function(e){e.dragging=!0},endDragging:function(e){e.dragging=!1},startMovingBlock:function(e,t){e.movingBlockId=t},endMovingBlock:function(e){e.movingBlockId=null},setSavedScrollPosition:function(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition:function(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpecScrollTop:function(e,t){console.debug("saveCurrentSpecScrollTop"),e.currentSpecId=t,e.currentSpecScrollTop=b.scrollTop()},clearCurrentSpec:function(e){e.currentSpecId=null,e.currentSpecScrollTop=null},updateCurrentTime:function(e){e.currentTime=Date.now()}}});const v=m;b.on("resize",(function(){m.commit("setWindowWidth",b.width())})),setTimeout((function e(){m.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const g=VueRouter;var _=e.n(g),w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index-page"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.promptCreateSpec()}}},[e._v("New spec")]),e._v(" "),s("div",{staticClass:"user-specs"},[s("h2",[e._v("Your specs")]),e._v(" "),e.loading?s("p",[e._v("Loading...")]):e.userSpecs&&e.userSpecs.length?s("ul",{staticClass:"specs-list"},e._l(e.userSpecs,(function(t){return s("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"status",class:{public:t.public}},[t.public?[s("i",{staticClass:"el-icon-umbrella"}),e._v(" Public")]:[s("i",{staticClass:"el-icon-lock"}),e._v(" Private")]],2)]),e._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[e._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?s("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):s("p",[e._v("You do not have any specs.")])]),e._v(" "),s("div",{staticClass:"public-specs",class:{"adjust-margin":!!e.userSpecs.length}},[s("h2",[e._v("Public specs")]),e._v(" "),e.loading?s("p",[e._v("Loading...")]):e.publicSpecs&&e.publicSpecs.length?s("ul",{staticClass:"specs-list"},e._l(e.publicSpecs,(function(t){return s("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[s("div",{staticClass:"info"},[s("username",{attrs:{username:t.username,highlight:t.username===e.$store.getters.username?e.$store.getters.userSettings.userProfile.highlightUsername:t.highlight}})],1),e._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[e._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?s("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):s("p",[e._v("There are no public specs......")])]),e._v(" "),s("edit-spec-modal",{ref:"editSpecModal"})],1)};w._withStripped=!0;var k=function(){var e=this,t=e.$createElement;return(e._self._c||t)("span",[e._v(e._s(e.output))])};k._withStripped=!0;const y=moment;var S=e.n(y);function I(e,t,s,n,i,o,r,l){var c,a="function"==typeof e?e.options:e;if(t&&(a.render=t,a.staticRenderFns=s,a._compiled=!0),n&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),r?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},a._ssrRegister=c):i&&(c=l?function(){i.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(a.functional){a._injectStyles=c;var u=a.render;a.render=function(e,t){return c.call(t),u(e,t)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:a}}var C=I({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return S().parseZone(this.datetime).local()},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},k,[],!1,null,null,null);C.options.__file="src/widgets/moment.vue";const P=C.exports;var T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"username"},[s("i",{staticClass:"el-icon-user",style:e.style}),e._v(" "),s("span",[e._v(e._s(e.username))])])};function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}T._withStripped=!0;var j=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,E=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,O=/^#[0-9a-f]{6}$/i;function B(e){if(e&&"object"===x(e)){if(e.hsl)return R(e);if(e.rgb)return e}else if("string"==typeof e){if(j.test(e)){var t=j.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(O.test(e)){var s=function(e){e=e.toLowerCase();for(var t=0,s=0;s<e.length;s++){var n=e.charCodeAt(e.length-1-s);n>=48&&n<=57?t+=(n-48)*Math.pow(16,s):n>=97&&n<=122&&(t+=(n-97+10)*Math.pow(16,s))}return t};return{r:s(e.substr(1,2)),g:s(e.substr(3,2)),b:s(e.substr(5,2)),rgb:!0}}if(E.test(e))return R(e)}return{r:0,g:0,b:0,rgb:!0}}function U(e){if(e&&"object"===x(e)){if(e.hsl)return e;if(e.rgb)return M(e)}else if("string"==typeof e){if(E.test(e)){var t=E.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(j.test(e)||O.test(e))return M(e)}return{h:0,s:0,l:0,hsl:!0}}function R(e){if(e&&"object"===x(e)&&e.rgb)return e;var t,s,n,i=(e=U(e)).h,o=e.s/100,r=e.l/100,l=(1-Math.abs(2*r-1))*o,c=l*(1-Math.abs(i/60%2-1)),a=r-l/2;return 0<=i&&i<60?(t=l,s=c,n=0):60<=i&&i<120?(t=c,s=l,n=0):120<=i&&i<180?(t=0,s=l,n=c):180<=i&&i<240?(t=0,s=c,n=l):240<=i&&i<300?(t=c,s=0,n=l):300<=i&&i<360&&(t=l,s=0,n=c),{r:Math.round(255*(t+a)),g:Math.round(255*(s+a)),b:Math.round(255*(n+a)),rgb:!0}}function M(e){if(e&&"object"===x(e)&&e.hsl)return e;var t,s=(e=B(e)).r/255,n=e.g/255,i=e.b/255,o=Math.min(s,n,i),r=Math.max(s,n,i),l=r-o;t=0==l?0:r==s?(n-i)/l%6:r==n?(i-s)/l+2:(s-n)/l+4;var c=(r+o)/2;return{h:(t=Math.round(60*t))<0?t+360:t,s:+(100*(0==l?0:l/(1-Math.abs(2*c-1)))).toFixed(1),l:+(100*c).toFixed(1),hsl:!0}}function F(e){var t=B(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}var A=I({props:{username:{type:String,required:!0},highlight:String},computed:{style:function(){if(!this.highlight)return null;var e,t=F(((e=U(this.highlight)).l<=25?e.l=75:e.l<=50?e.l=100:e.l<=75?e.l=0:e.l=25,e));return{color:F(this.highlight),"text-shadow":"-1px -1px 0 "+t+", 1px -1px 0 "+t+", -1px 1px 0 "+t+", 1px 1px 0 "+t}}}},T,[],!1,null,null,null);A.options.__file="src/widgets/username.vue";const D=A.exports;var N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:e.spec?"Manage spec":"Create spec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.spec?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.spec.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("label",[e._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),s("el-checkbox",{model:{value:e.isPublic,callback:function(t){e.isPublic=t},expression:"isPublic"}},[e._v("Allow public access and community features")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.spec?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSpec()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.spec?"Save":"Create"))])],1)],1)};function L(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function z(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?L(Object(s),!0).forEach((function(t){V(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):L(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function V(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function W(e,t,s,n){return o().post("/ajax/spec/move-block",{blockId:e,subspecId:t,parentId:s,insertBeforeId:n}).fail(a)}N._withStripped=!0;var Y=I({components:{Moment:P},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var s=this;this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n,i=this.callback;(t=this.name,s=this.desc,n=this.isPublic,o().post("/ajax/spec/create-spec",{name:t,desc:s,isPublic:n}).fail(a)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,s,n,i,r=this.callback;(t=this.spec.id,s=this.name,n=this.desc,i=this.isPublic,o().post("/ajax/spec/save-spec",{specId:t,name:s,desc:n,isPublic:i}).fail(a)).then((function(t){r(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSpec:function(){var e=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.spec.id,o().post("/ajax/spec/delete-spec",{specId:t}).fail(a)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"index"})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},N,[],!1,null,null,null);Y.options.__file="src/spec/edit-spec-modal.vue";const q=Y.exports;var H=I({components:{Moment:P,Username:D,EditSpecModal:q},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(e,t,s){this.reloadSpecs(),s()},methods:{reloadSpecs:function(){var e=this;this.loading=!0,o().get("/ajax/home").then((function(t){e.userSpecs=t.userSpecs,e.publicSpecs=t.publicSpecs,e.loading=!1})).fail((function(t){e.loading=!1,a(t)}))},promptCreateSpec:function(){var e=this;this.$refs.editSpecModal.showCreate((function(t){e.$router.push({name:"spec",params:{specId:t}})}))}}},w,[],!1,null,null,null);H.options.__file="src/pages/index.vue";const G=H.exports;var X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"spec-page"},[e.spec?s("header",[e.loading?e._e():s("div",{staticClass:"right"},[e.currentUserOwns?s("span",[e._v("You own this")]):s("span",[e._v("\n\t\t\t\tOwned by\n\t\t\t\t"),e.spec.username?s("username",{attrs:{username:e.spec.username,highlight:e.spec.highlight}}):[e._v(e._s(e.spec.ownerType)+" "+e._s(e.spec.ownerId))]],2),e._v(" "),e.onSpecRoute?[e.enableEditing?[e.spec.public?s("span",[e._v("\n\t\t\t\t\t\tPublic\n\t\t\t\t\t")]):s("span",[s("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[s("i",{staticClass:"el-icon-lock"})])],1),e._v(" "),s("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSpec()}}})]:s("span",[e._v("\n\t\t\t\t\tLast modified "),s("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)]:e._e(),e._v(" "),s("el-button",{attrs:{size:"mini",icon:"el-icon-folder"},on:{click:function(t){return e.promptNavSpec()}}})],2),e._v(" "),s("h2",{on:{click:function(t){return e.gotoSpec()}}},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()]):e._e(),e._v(" "),s("router-view",{ref:"view",attrs:{loading:e.loading,spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":function(t){return e.promptNavSpec()}}}),e._v(" "),e.enableEditing?s("edit-spec-modal",{ref:"editSpecModal"}):e._e(),e._v(" "),s("nav-spec-modal",{ref:"navSpecModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId}})],1)};X._withStripped=!0;var Z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"nav-spec-modal",attrs:{title:"Navigate spec",visible:e.showing,width:e.$store.getters.dialogTinyWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.loading?s("p",[e._v("Loading...")]):e.subspecs.length?[s("el-select",{attrs:{placeholder:"Choose subspec"},model:{value:e.selectedSubspecId,callback:function(t){e.selectedSubspecId=t},expression:"selectedSubspecId"}},e._l(e.subspecs,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?s("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:s("p",[e._v("No subspecs.")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")]),e._v(" "),e.subspecId?s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.goToSpec()}}},[e._v("\n\t\t\tGo to spec\n\t\t")]):e._e(),e._v(" "),e.subspecs.length?s("el-button",{attrs:{type:"primary",disabled:e.disableGoToSubspec},on:{click:function(t){return e.goToSubspec()}}},[e._v("\n\t\t\tGo to subspec\n\t\t")]):e._e()],1)],2)};Z._withStripped=!0;var J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-subspec"},[s("div",[s("div",{staticClass:"title"},[e._m(0),e._v(" "),s("router-link",{attrs:{to:{name:"subspec",params:{specId:e.item.specId,subspecId:e.item.id}}}},[e._v("\n\t\t\t\t"+e._s(e.item.name.trim())+"\n\t\t\t")])],1),e._v(" "),e.item.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};J._withStripped=!0;var Q=I({props:{item:Object}},J,[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[s("i",{staticClass:"el-icon-s-unfold"}),e._v(" Subspec")])}],!1,null,null,null);Q.options.__file="src/spec/ref-subspec.vue";const K=Q.exports;var ee=I({components:{RefSubspec:K},props:{specId:Number,subspecId:Number},data:function(){return{subspecs:[],selectedSubspecId:null,loading:!1,showing:!1}},computed:{disableGoToSubspec:function(){return this.loading||!this.subspecs.length||!this.selectedSubspecId},selectedSubspec:function(){if(this.selectedSubspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.selectedSubspecId)return this.subspecs[e];return null}},methods:{show:function(){var e=this;this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((function(t){e.subspecs=t,e.loading=!1})).fail((function(t){e.loading=!1,e.showing=!1,a(t)}))},goToSpec:function(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},goToSubspec:function(){"subspec"===this.$route.name&&u(this.$route.params.subspecId,this.selectedSubspecId)||this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:this.selectedSubspecId}}),this.showing=!1},closed:function(){this.loading=!1,this.subspecs=[],this.selectedSubspecId=null}}},Z,[],!1,null,null,null);ee.options.__file="src/spec/nav-spec-modal.vue";const te=ee.exports;var se="url",ne="subspec",ie=I({components:{Username:D,Moment:P,EditSpecModal:q,NavSpecModal:te},data:function(){return{loading:!0,spec:null}},computed:{specId:function(){return parseInt(this.$route.params.specId,10)},subspecId:function(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute:function(){return"spec"===this.$route.name},currentUserOwns:function(){return this.spec&&"user"===this.spec.ownerType&&this.$store.getters.userID===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns},choosingAddPosition:function(){return!!this.$store.state.movingBlockId}},beforeRouteEnter:function(e,t,s){console.debug("beforeRouteEnter spec",e),s((function(t){t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate:function(e,t,s){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),s()},beforeRouteLeave:function(e,t,s){console.debug("beforeRouteLeave spec"),this.spec=null,d(),s()},methods:{loadSpec:function(e,t){var s=this;console.debug("load spec"),this.loading=!0,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return o().get("/ajax/spec",{specId:e,loadBlocks:t}).fail(a)}(e,t).then((function(e){console.debug("spec loaded",e),s.spec=e,d(e.name),s.loading=!1,s.$refs.view.$once("rendered",s.restoreScroll)})).fail((function(e){s.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(s.$route.fullPath)}})}))},gotoSpec:function(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec:function(){var e=this;this.$refs.editSpecModal.showEdit(this.spec,(function(t){e.spec.updated=t.updated,e.spec.name=t.name,e.spec.desc=t.desc,e.spec.public=t.public,d(t.name)}))},promptNavSpec:function(){this.$refs.navSpecModal.show()},restoreScroll:function(e){if(this.onSpecRoute){var t=this.$store.state.savedScrollPosition;t?(console.debug("restoreScroll spec"),o()(window).scrollTop(t.y).scrollLeft(t.x)):u(this.$store.state.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),o()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},X,[],!1,null,null,null);ie.options.__file="src/pages/spec.vue";const oe=ie.exports;var re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"spec-view-page",class:{loading:e.loading}},[e.loading?s("p",[e._v("Loading...")]):e.spec?s("spec-view",{key:e.spec.renderTime,attrs:{spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};re._withStripped=!0;var le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.spec||e.subspec?s("div",{staticClass:"spec-view"},[s("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:e.dragging}}),e._v(" "),e.enableEditing?[e.choosingAddPosition?s("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-top"},on:{click:function(t){return e.placeBlockBottom()}}},[e._v("Move block here")]):s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.promptAddBlock()}}},[e._v("Add block")]),e._v(" "),s("ul",{ref:"mirrorList",staticClass:"mirror-list"}),e._v(" "),s("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId},on:{"open-edit-url":e.openEditUrl,"play-video":e.playVideo,"prompt-delete":e.promptDeleteBlock}}),e._v(" "),s("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":e.specId}})]:e._e(),e._v(" "),s("play-video-modal",{ref:"playVideoModal"})],2):e._e()};le._withStripped=!0;const ce=dragula;var ae=e.n(ce),ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"spec-block",class:e.classes,attrs:{"data-spec-block":e.block.id}},[s("div",{staticClass:"content",class:{"mobile-adjust":e.showActions}},[s("div",{staticClass:"bg"}),e._v(" "),s("div",{staticClass:"layover",on:{mouseleave:function(t){return e.mouseLeaveLayover()}}},[e.enableEditing?[s("div",{staticClass:"expand-control",class:{hide:e.showActions}},[e.unreadSubmissionsCount?s("el-button",{attrs:{type:e.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t"+e._s(e.submissionsCount)+"\n\t\t\t\t\t")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(t){e.focusActions=!0}}})],1),e._v(" "),s("div",{staticClass:"actions",class:{show:e.showActions}},[e.choosingAddPosition?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelChooseAddPosition()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.addBeforeThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.addIntoThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.addAfterThis()}}})]:e.movingThis?[s("el-button",{attrs:{size:"mini",icon:"el-icon-folder-add"},on:{click:function(t){return e.promptNavSpec()}}},[e._v("Change context")]),e._v(" "),s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.cancelMoving()}}},[e._v("Cancel move")])]:e.movingAnother?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelMoving()}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.moveBeforeThis()}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.moveIntoThis()}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.moveAfterThis()}}})]:[s("el-button",{attrs:{type:e.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.submissionsCount)+"\n\t\t\t\t\t\t")]),e._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editBlock()}}}),e._v(" "),e.showDeleteButton?s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDeleteBlock()}}}):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.enterChooseAddPosition()}}}),e._v(" "),s("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(t){return e.startMoving()}}}),e._v(" "),s("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(t){return e.startMoving()}}})]],2)]:s("div",{staticClass:"visitor-actions"},[s("el-button",{attrs:{type:e.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t"+e._s(e.submissionsCount)+"\n\t\t\t\t")])],1)],2),e._v(" "),e.hasTitle?s("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.hasRefItem?[e.refType===e.REF_TYPE_URL?s("ref-url",{staticClass:"ref-item",attrs:{item:e.refItem},on:{play:function(t){return e.raisePlayVideo(e.refItem)}}}):e.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec",{staticClass:"ref-item",attrs:{item:e.refItem}}):e._e()]:e.refItemMissing?s("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?s("div",{staticClass:"body"},[e._v(e._s(e.body))]):e._e()],2),e._v(" "),s("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:e.movingThis}})])};ue._withStripped=!0;var de=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-url"},[e.item.imageData?s("img",{attrs:{src:e.item.imageData}}):e._e(),e._v(" "),s("div",[e.showEdit||e.showPlay?s("div",{staticClass:"right"},[e.showEdit?s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.$emit("edit")}}}):e._e(),e._v(" "),e.showPlay?s("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$emit("play")}}},[e._v("Play")]):e._e()],1):e._e(),e._v(" "),s("div",{staticClass:"title"},[e._m(0),e._v(" "),s("a",{attrs:{href:e.item.url,target:"_blank"}},[e._v(e._s(e.item.title&&e.item.title.trim()||e.item.url))])]),e._v(" "),e.item.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};de._withStripped=!0;var pe=I({props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return f(this.item.url)}}},de,[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[s("i",{staticClass:"el-icon-link"}),e._v(" URL")])}],!1,null,null,null);pe.options.__file="src/spec/ref-url.vue";const he=pe.exports;function fe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var be=I({components:{RefUrl:he,RefSubspec:K},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{REF_TYPE_URL:function(){return se},REF_TYPE_SUBSPEC:function(){return ne},showDeleteButton:function(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!(!this.body||!this.body.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},classes:function(){var e;return fe(e={},this.styleType,!0),fe(e,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),fe(e,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),e},movingThis:function(){return this.$store.state.movingBlockId===this.block.id},movingAnother:function(){return this.$store.state.movingBlockId&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother},unreadSubmissionsCount:function(){return 0},submissionsCount:function(){return 0}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var e=o()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId:function(){var e=o()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock:function(){var e=this;this.raiseOpenEdit({id:this.block.id,created:this.block.created,updated:this.updated,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(t){e.updated=t.updated,e.styleType=t.styleType,e.contentType=t.contentType,e.refType=t.refType,e.refId=t.refId,e.refItem=t.refItem,e.title=t.title,e.body=t.body}))},raiseOpenEdit:function(e,t){this.$emit("open-edit",e,t)},promptDeleteBlock:function(){this.$emit("prompt-delete",this.block.id)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t)},addIntoThis:function(){var e=this.block.id;this.raisePromptAddSubblock(e,null)},addAfterThis:function(){var e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t)},raisePromptAddSubblock:function(e,t){this.$emit("prompt-add-subblock",e,t)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},promptNavSpec:function(){this.$emit("prompt-nav-spec")},moveBeforeThis:function(){var e=this,t=this.$store.state.movingBlockId,s=this.getParentId(),n=this.block.id;W(t,this.subspecId,s,n).then((function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(s){var n=e.$parent.insertBlock(s,!1,!0);n.insertBefore(e.$el)}else{var i=o()('[data-spec-block="'+t+'"]'),r=i.closest(".spec-block-list").closest("[data-spec-block]");i.insertBefore(e.$el),r.length&&r.data("vc").updateHasSubblocks()}e.$store.commit("endMovingBlock")}))},moveIntoThis:function(){var e=this,t=this.$store.state.movingBlockId,s=this.block.id;W(t,this.subspecId,s,null).then((function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(s){var n=e.$parent.insertBlock(s,!1,!0);n.appendTo(e.$refs.sublist)}else{var i=o()('[data-spec-block="'+t+'"]'),r=i.closest(".spec-block-list").closest("[data-spec-block]");i.appendTo(e.$refs.sublist),r.length&&r.data("vc").updateHasSubblocks()}e.updateHasSubblocks(),e.$store.commit("endMovingBlock")}))},moveAfterThis:function(){var e=this,t=this.$store.state.movingBlockId,s=this.getParentId(),n=this.getFollowingBlockId();W(t,this.subspecId,s,n).then((function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(s){var n=e.$parent.insertBlock(s,!1,!0);n.insertAfter(e.$el)}else{var i=o()('[data-spec-block="'+t+'"]'),r=i.closest(".spec-block-list").closest("[data-spec-block]");i.insertAfter(e.$el),r.length&&r.data("vc").updateHasSubblocks()}e.$store.commit("endMovingBlock")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(e){this.refType===se&&e.id===this.refId&&(this.refItem=e)},urlDeleted:function(e){this.refType===se&&e===this.refId&&(this.refItem=null)},raisePlayVideo:function(e){this.$emit("play-video",e)},openCommunity:function(){this.$alert("Unimplemented")},updateHasSubblocks:function(){this.hasSubblocks=this.$refs.sublist.childElementCount>0}}},ue,[],!1,null,null,null);be.options.__file="src/spec/block.vue";const me=be.exports;var ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:e.block?"Edit block":"Add block",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.block?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.block.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.block.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("el-radio-group",{model:{value:e.styleType,callback:function(t){e.styleType=t},expression:"styleType"}},[s("el-radio",{attrs:{label:"bullet"}},[e._v("Bullet point")]),e._v(" "),s("el-radio",{attrs:{label:"numbered"}},[e._v("Numbered point")]),e._v(" "),s("el-radio",{attrs:{label:"none"}},[e._v("Indented block")])],1),e._v(" "),s("label",[e._v("\n\t\tTitle\n\t\t"),s("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),s("label",[e._v("\n\t\tBody\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),s("el-radio-group",{model:{value:e.refType,callback:function(t){e.refType=t},expression:"refType"}},[s("el-radio",{attrs:{label:null}},[e._v("No media")]),e._v(" "),s("el-radio",{attrs:{label:e.REF_TYPE_SUBSPEC}},[e._v("Subspec")]),e._v(" "),s("el-radio",{attrs:{label:e.REF_TYPE_URL}},[e._v("URL")])],1),e._v(" "),e.refType===e.REF_TYPE_URL?s("ref-url-form",{attrs:{"spec-id":e.specId,"initial-url-object":e.existingUrlRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t},"open-edit-url":e.openEditUrl,"play-video":e.raisePlayVideo}}):e.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec-form",{attrs:{"spec-id":e.specId,"initial-subspec":e.existingSubspecRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t}}}):e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.block?s("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.promotDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v("\n\t\t\t"+e._s(e.block?"Save":"Add")+"\n\t\t")])],1)],1)};ve._withStripped=!0;var ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-url-form"},[e.creating?s("el-card",[s("label",[e._v("\n\t\t\tNew link URL\n\t\t\t"),s("el-input",{attrs:{clearable:""},model:{value:e.newUrl,callback:function(t){e.newUrl=t},expression:"newUrl"}}),e._v(" "),e.newUrl&&!e.isValid?s("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):e.newUrlIsVideo?s("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):e._e()],1),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!0}}},[e._v("\n\t\t\tSelect an existing link\n\t\t")]):e._e(),e._v(" "),e.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?s("p",[e._v("Loading links...")]):e.urlObjects&&e.urlObjects.length?[s("el-select",{attrs:{filterable:"","filter-method":e.filterUrls,placeholder:"Select link"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.filteredUrlObjects,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.title||e.url}})})),1),e._v(" "),e.selectedUrlObject?s("ref-url",{attrs:{item:e.selectedUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.selectedUrlObject)},play:function(t){return e.raisePlayVideo(e.selectedUrlObject)}}}):e._e()]:e._e(),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new link\n\t\t")]),e._v(" "),e.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()]:[e.initialUrlObject?s("ref-url",{attrs:{item:e.initialUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.initialUrlObject)},play:function(t){return e.raisePlayVideo(e.initialUrlObject)}}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new link\n\t\t\t")]),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):e._e()],1)]],2)};ge._withStripped=!0;var _e=I({components:{RefUrl:he},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var e=this.filter.toLowerCase(),t=[],s=0;s<this.urlObjects.length;s++){var n=this.urlObjects[s];(n.url.toLowerCase().indexOf(e)>=0||n.title&&n.title.toLowerCase().indexOf(e)>=0)&&t.push(n)}return t}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.refId)return this.urlObjects[e];return null},newUrlIsVideo:function(){return p(this.newUrl)&&f(this.newUrl)},isValid:function(){return this.creating?p(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadLinks()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadLinks:function(){var e,t=this;this.urlObjects||this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/urls",{specId:e}).fail(a)).then((function(e){t.urlObjects=e,e.length||(t.selecting=!1,t.initialUrlObject||(t.creating=!0)),t.loading=!1})).fail((function(){t.urlObjects=[],t.selecting=!1,t.initialUrlObject||(t.creating=!0),t.loading=!1})))},filterUrls:function(e){var t=this;e?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function n(){t=null,e.apply(this,arguments)}return function(){return t&&clearTimeout(t),t=setTimeout(n.bind.apply(n,[this].concat(Array.prototype.slice.call(arguments))),s)}}((function(e){t.filter=e}))),this.debouncedUpdateFilter(e)):this.filter=""},openEditUrl:function(e){var t=this;this.$emit("open-edit-url",e,(function(s){if(t.urlObjects)for(var n=0;n<t.urlObjects.length;n++)if(t.urlObjects[n].id===e.id){t.urlObjects.splice(n,1,s);break}}),(function(){if(t.urlObjects)for(var s=0;s<t.urlObjects.length;s++)if(t.urlObjects[s].id===e.id){t.urlObjects.splice(s,1);break}t.refId===e.id&&(t.refId=null)}))},raisePlayVideo:function(e){this.$emit("play-video",e)}}},ge,[],!1,null,null,null);_e.options.__file="src/spec/ref-url-form.vue";const we=_e.exports;var ke=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-subspec-form"},[e.creating?s("el-card",[s("label",[e._v("\n\t\t\tNew subspec name\n\t\t\t"),s("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:e.subspecName,callback:function(t){e.subspecName=t},expression:"subspecName"}})],1),e._v(" "),s("label",[e._v("\n\t\t\tDescription\n\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.subspecDesc,callback:function(t){e.subspecDesc=t},expression:"subspecDesc"}})],1),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?s("p",[e._v("Loading subspecs...")]):e.subspecs&&e.subspecs.length?[s("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.subspecs,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?s("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:e._e(),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new subspec\n\t\t")])]:[e.initialSubspec?s("ref-subspec",{attrs:{item:e.initialSubspec}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):e._e()],1)]],2)};ke._withStripped=!0;var ye=I({components:{RefSubspec:K},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.refId)return this.subspecs[e];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadSubspecs:function(){var e,t=this;this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/subspecs",{specId:e}).fail(a)).then((function(e){t.subspecs=e,e.length||(t.creating=!0),t.loading=!1})).fail((function(){t.subspecs=[],t.creating=!0,t.loading=!1})))}}},ke,[],!1,null,null,null);ye.options.__file="src/spec/ref-subspec-form.vue";var Se=I({components:{Moment:P,RefUrlForm:we,RefSubspecForm:ye.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return se},REF_TYPE_SUBSPEC:function(){return ne},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&this.block.refType===se&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&this.block.refType===ne&&this.block.refItem||null}},watch:{refType:function(e){this.refFields=null}},methods:{showAdd:function(e,t,s){this.parentId=e,this.insertBeforeId=t,this.callback=s,this.showing=!0,this.focusTitleInput()},showEdit:function(e,t){this.block=e,this.styleType=e.styleType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var e=this;this.$nextTick((function(){o()("input",e.$refs.titleInput.$el).focus()}))},openEditUrl:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(function(e){t.existingUrlRefItem&&e.id===t.existingUrlRefItem.id&&(t.block.refItem=e),s&&s(e)}),(function(e){t.existingUrlRefItem&&e===t.existingUrlRefItem.id&&(t.block.refType=null,t.block.refId=null,t.block.refItem=null),n&&n(e)}))},raisePlayVideo:function(e){this.$emit("play-video",e)},promotDelete:function(){var e=this;this.$emit("prompt-delete",this.block.id,(function(){e.showing=!1}))},submit:function(){var e=this;if(!this.disableSubmit){var t,s,n,i,r,l,c,u=this.createSendingSpinner(),d=this.callback;this.block?(t=this.specId,s=this.block.id,n=this.styleType,"plaintext",i=this.title,r=this.body,l=this.refType,c=this.refFields,c=c||{},o().post("/ajax/spec/save-block",z({specId:t,blockId:s,styleType:n,contentType:"plaintext",title:i,body:r,refType:l},c)).fail(a)).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()})):function(e,t,s,n,i,r,l,c,u,d){return d=d||{},o().post("/ajax/spec/create-block",z({specId:e,subspecId:t,parentId:s,insertBeforeId:n,styleType:i,contentType:"plaintext",title:l,body:c,refType:u},d)).fail(a)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,0,this.title,this.body,this.refType,this.refFields).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},ve,[],!1,null,null,null);Se.options.__file="src/spec/edit-block-modal.vue";const Ie=Se.exports;var $e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:e.urlObject?"Manage link":"Create link",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.urlObject?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.urlObject.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.urlObject.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tURL\n\t\t"),s("el-input",{ref:"urlInput",model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1),e._v(" "),e.urlObject?[e.url===e.urlObject.url?s("div",{staticClass:"preview"},[e.urlObject.imageData?s("img",{attrs:{src:e.urlObject.imageData}}):e._e(),e._v(" "),s("div",[e.urlObject.title?s("h3",[e._v(e._s(e.urlObject.title.trim()))]):e._e(),e._v(" "),e.urlObject.desc?s("div",[e._v(e._s(e.urlObject.desc.trim()))]):e._e(),e._v(" "),e.autoRefresh?s("p",[e._v("URL preview will be updated")]):s("el-checkbox",{model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}},[e._v("Refresh URL preview")])],1)]):s("p",[e._v("Link will be updated with new URL")])]:e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.urlObject?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.urlObject?"Save":"Create"))])],1)],2)};$e._withStripped=!0;var Ce=I({components:{Moment:P},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=p,!p(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.createdCallback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.urlInput.$el).focus()}))},showEdit:function(e,t,s){var n=this;this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=s,this.showing=!0,this.$nextTick((function(){o()("input",n.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n=this.createdCallback;(t=this.specId,s=this.url,o().post("/ajax/spec/create-url",{specId:t,url:s}).fail(a)).then((function(t){n(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n=this.updatedCallback;(t=this.urlObject.id,s=this.url,o().post("/ajax/spec/refresh-url",{id:t,url:s}).fail(a)).then((function(t){n(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},promptDelete:function(){var e=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){e.sending=!0;var t,s=e.deletedCallback;(t=e.urlObject.id,o().post("/ajax/spec/delete-url",{id:t}).fail(a)).then((function(){s&&s(e.urlObject.id),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},$e,[],!1,null,null,null);Ce.options.__file="src/spec/edit-url-modal.vue";const Pe=Ce.exports;var Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"play-video-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogSmallWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.vid?s("div",{staticClass:"embed-responsive"},["youtube"===e.vid.type?s("iframe",{attrs:{src:"https://www.youtube.com/embed/"+e.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===e.vid.type?s("iframe",{attrs:{src:"https://player.vimeo.com/video/"+e.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):e._e()]):e._e()])};Te._withStripped=!0;var xe=I({data:function(){return{vid:null,showing:!1}},methods:{show:function(e){var t,s,n=(t=e.url,(s=h.exec(t))?t.indexOf("youtube.com")||t.indexOf("youtu.be")?{type:"youtube",id:s[1]}:t.indexOf("vimeo.com")?{type:"vimeo",id:s[1]}:null:null);n&&(this.vid=n,this.showing=!0)},closed:function(){this.vid=null}}},Te,[],!1,null,null,null);xe.options.__file="src/spec/play-video-modal.vue";const je=xe.exports;var Ee=s().extend(me),Oe=I({components:{EditBlockModal:Ie,EditUrlModal:Pe,PlayVideoModal:je},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new(s())}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null},choosingAddPosition:function(){return!!this.$store.state.movingBlockId}},watch:{dragging:function(e){e?this.autoscroller=function(){var e=70,t=o()(window),s=null,n=null;function i(e){n=e.clientY}return t.on("mousemove",i),s=window.requestAnimationFrame((function i(){if(null!==n){var o=t.height(),r=0;n<e?r=-((e-n)/e*8+1):n>o-e&&(r=(n-(o-e))/e*8+1),0!==r&&t.scrollTop(t.scrollTop()+r)}s=window.requestAnimationFrame(i)})),{stop:function(){t.off("mousemove",i),s&&(window.cancelAnimationFrame(s),s=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var e,t=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var s=0;s<e.length;s++)this.insertBlock(e[s]);this.$nextTick((function(){t.$emit("rendered")})),this.enableEditing&&(this.drake=ae()({isContainer:function(e){return o()(e).is(".spec-block-list")},accepts:function(e,t,s,n){return!o()(t).closest(".gu-transit").length},moves:function(e,t,s,n){return o()(s).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(e,s){t.$store.commit("startDragging"),t.transitRelativeScroll(o()(e).attr("data-spec-block"))})).on("dragend",(function(e){t.$store.commit("endDragging"),t.transitRelativeScroll(o()(e).attr("data-spec-block"))})).on("drop",(function(e,s,n,i){var r=o()(n).closest("[data-spec-block]");r.length&&r.data("vc").updateHasSubblocks();var l=null,c=o()(s).closest("[data-spec-block]");if(c.length){var a=c.data("vc");l=a.getBlockId(),a.updateHasSubblocks()}var u=i?o()(i).data("vc").getBlockId():null;W(o()(e).data("vc").getBlockId(),t.subspecId,l,u)})))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,o()("[data-spec-block]",this.$refs.list).each((function(e,t){o()(t).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var e=this,t=o()(window).scrollTop();o()("[data-spec-block]",this.$refs.list).each((function(s,n){var i=o()(n).offset();if(i.top>t){var r=i.top-t;return e.$nextTick((function(){o()(window).scrollTop(o()(n).offset().top-r)})),!1}}))},transitRelativeScroll:function(e){var t=o()(window).scrollTop(),s=o()('[data-spec-block="'+e+'"]',this.$refs.list),n=s.offset().top-t;this.$nextTick((function(){o()(window).scrollTop(s.offset().top-n)}))},insertBlock:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new Ee({parent:this,store:v,router:Je,propsData:{block:e,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:s}}).$mount();n.$on("open-edit",this.openEdit),n.$on("prompt-add-subblock",this.promptAddSubblock),n.$on("prompt-delete",this.promptDeleteBlock),n.$on("start-moving",this.startMovingBlock),n.$on("end-moving",this.endMovingBlock),n.$on("play-video",this.playVideo),n.$on("prompt-nav-spec",this.promptNavSpec);var i=o()(n.$el).data("vc",n);if(e.subblocks)for(var r=0;r<e.subblocks.length;r++){var l=e.subblocks[r],c=this.insertBlock(l,!1);o()(">ul.spec-block-list",i).append(c)}return t&&i.appendTo(this.$refs.list),i},promptAddBlock:function(){var e=this;this.$refs.editBlockModal.showAdd(null,null,(function(t){e.insertBlock(t,!0,!0)}))},openEdit:function(e,t){this.$refs.editBlockModal.showEdit(e,t)},promptAddSubblock:function(e,t){var s=this;this.$refs.editBlockModal.showAdd(e,t,(function(n){var i=s.insertBlock(n,!1,!0);if(t)i.insertBefore('[data-spec-block="'+t+'"]');else if(e){var r=o()('[data-spec-block="'+e+'"]');i.appendTo(r.find(">ul.spec-block-list")),r.data("vc").updateHasSubblocks()}else i.appendTo(s.$refs.list)}))},promptDeleteBlock:function(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(e){return o().post("/ajax/spec/delete-block",{blockId:e}).fail(a)})(e).then((function(){o()('[data-spec-block="'+e+'"]').remove(),t&&t()})).fail(a)})).catch((function(){}))},startMovingBlock:function(e){this.$store.commit("startMovingBlock",e),this.transitRelativeScroll(e)},placeBlockBottom:function(){var e=this,t=this.$store.state.movingBlockId;t&&W(t,this.subspecId,null,null).then((function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(s)e.insertBlock(s,!0,!1);else{var n=o()('[data-spec-block="'+t+'"]'),i=n.closest(".spec-block-list").closest("[data-spec-block]");n.appendTo(e.$refs.list),i.length&&i.data("vc").updateHasSubblocks()}e.$store.commit("endMovingBlock")}))},endMovingBlock:function(e){this.$store.commit("endMovingBlock"),this.transitRelativeScroll(e)},openEditUrl:function(e,t,s){var n=this;this.$refs.editUrlModal.showEdit(e,(function(e){n.eventBus.$emit("url-updated",e),t&&t(e)}),(function(e){n.eventBus.$emit("url-deleted",e),s&&s(e)}))},playVideo:function(e){this.$refs.playVideoModal.show(e)},promptNavSpec:function(){this.$emit("prompt-nav-spec")}}},le,[],!1,null,null,null);Oe.options.__file="src/spec/view.vue";const Be=Oe.exports;var Ue=I({props:{loading:Boolean,spec:Object,enableEditing:Boolean},components:{SpecView:Be},beforeRouteEnter:function(e,t,s){console.debug("beforeRouteEnter spec-view",e),s()},beforeRouteUpdate:function(e,t,s){console.debug("beforeRouteUpdate spec-view",e),s()},methods:{promptNavSpec:function(){this.$emit("prompt-nav-spec")}}},re,[],!1,null,null,null);Ue.options.__file="src/pages/spec-view.vue";const Re=Ue.exports;var Me=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"subspec-page"},[e.subspec?s("header",[e.onSubspecRoute&&!e.loading?s("div",{staticClass:"right"},[e.enableEditing?s("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSubspec()}}}):s("span",[e._v("\n\t\t\t\tLast modified "),s("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)],1):e._e(),e._v(" "),s("h3",[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()]):e._e(),e._v(" "),s("router-view",{ref:"view",attrs:{loading:e.loading,subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":function(t){return e.promptNavSpec()}}}),e._v(" "),e.enableEditing?s("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":e.specId}}):e._e()],1)};Me._withStripped=!0;var Fe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:e.subspec?"Manage subspec":"Create subspec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.subspec?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.subspec.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("label",[e._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.subspec?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSubspec()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.subspec?"Save":"Create"))])],1)])};Fe._withStripped=!0;var Ae=I({components:{Moment:P},props:{specId:Number},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var s=this;this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n,i=this.callback;(t=this.specId,s=this.name,n=this.desc,o().post("/ajax/spec/create-subspec",{specId:t,name:s,desc:n}).fail(a)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,s,n,i=this.callback;(t=this.subspec.id,s=this.name,n=this.desc,o().post("/ajax/spec/save-subspec",{subspecId:t,name:s,desc:n}).fail(a)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSubspec:function(){var e=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.subspec.id,o().post("/ajax/spec/delete-subspec",{subspecId:t}).fail(a)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"spec",params:{specId:e.specId}})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},Fe,[],!1,null,null,null);Ae.options.__file="src/spec/edit-subspec-modal.vue";var De=I({components:{Moment:P,SpecView:Be,EditSubspecModal:Ae.exports},inheritAttrs:!1,props:{enableEditing:Boolean},data:function(){return{loading:!0,subspec:null}},computed:{specId:function(){return parseInt(this.$route.params.specId,10)},subspecId:function(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute:function(){return"subspec"===this.$route.name},choosingAddPosition:function(){return!!this.$store.state.movingBlockId}},beforeRouteEnter:function(e,t,s){console.debug("beforeRouteEnter subspec",e),s((function(t){t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate:function(e,t,s){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),s()},beforeRouteLeave:function(e,t,s){console.debug("beforeRouteLeave subspec"),this.subspec=null,d(),s()},methods:{loadSubspec:function(e,t,s){var n=this;console.debug("load subspec"),this.loading=!0,function(e,t){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:s}).fail(a)}(e,t,s).then((function(e){console.debug("subspec loaded",e),n.subspec=e,d(e.name),n.loading=!1,n.$refs.view.$once("rendered",n.restoreScroll)})).fail((function(e){n.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(n.$route.fullPath)}})}))},promptNavSpec:function(){this.$emit("prompt-nav-spec")},openManageSubspec:function(){var e=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(t){e.subspec.updated=t.updated,e.subspec.name=t.name,e.subspec.desc=t.desc,d(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),o()(window).scrollTop(e.y).scrollLeft(e.x))}}},Me,[],!1,null,null,null);De.options.__file="src/pages/subspec.vue";const Ne=De.exports;var Le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"subspec-view-page",class:{loading:e.loading}},[e.loading?s("p",[e._v("Loading...")]):e.subspec?s("spec-view",{key:e.subspec.renderTime,attrs:{subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};Le._withStripped=!0;var ze=I({props:{loading:Boolean,subspec:Object,enableEditing:Boolean},components:{SpecView:Be},methods:{promptNavSpec:function(){this.$emit("prompt-nav-spec")}}},Le,[],!1,null,null,null);ze.options.__file="src/pages/subspec-view.vue";const Ve=ze.exports;var We=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ajax-error-page content-page"},[0===parseInt(e.$route.params.code,10)?s("p",[e._v("\n\t\tCould not connect to server\n\t")]):s("p",[e._v("\n\t\tRequest failed with error code "+e._s(e.$route.params.code)+"\n\t")]),e._v(" "),e.url?s("el-button",{on:{click:function(t){return e.retry()}}},[e._v("Retry")]):e._e()],1)};We._withStripped=!0;var Ye=I({computed:{url:function(){return decodeURIComponent(this.$route.query.url)}},methods:{retry:function(){this.$router.replace(this.url)}}},We,[],!1,null,null,null);Ye.options.__file="src/pages/ajax-error.vue";const qe=Ye.exports;var He=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"content-page"},[e._v("\n\tNot found\n")])};He._withStripped=!0;var Ge=I({},He,[],!1,null,null,null);Ge.options.__file="src/pages/not-found.vue";const Xe=Ge.exports;var Ze=new(_())({mode:"history",routes:[{name:"index",path:"/",component:G},{path:"/spec/:specId",component:oe,children:[{name:"spec",path:"",component:Re},{path:"subspec/:subspecId",component:Ne,children:[{name:"subspec",path:"",component:Ve}]}]},{name:"ajax-error",path:"/ajax-error/:code",component:qe},{path:"*",component:Xe}],scrollBehavior:function(e,t,s){return v.commit("setSavedScrollPosition",s),s||{x:0,y:0}}});Ze.beforeEach((function(e,t,s){t&&(!v.state.currentSpecId||e.params.specId&&u(e.params.specId,v.state.currentSpecId)?"spec"===t.name&&v.commit("saveCurrentSpecScrollTop",t.params.specId):(v.commit("clearCurrentSpec"),v.commit("endMovingBlock"))),s()})),Ze.afterEach((function(e,t){console.debug("afterEach"),v.commit("clearSavedScrollPosition")}));const Je=Ze;var Qe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"edit-profile-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogTinyWidth,"close-on-click-modal":null===e.mode},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.clearMode()}}},[s("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n\t\tAccount options for\n\t\t"),s("username",{attrs:{username:e.username,highlight:e.$store.getters.userSettings.userProfile.highlightUsername}})],1),e._v(" "),e.changePasswordMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.changePasswordForm,rules:e.changePasswordRules,"label-position":"top"}},[s("el-form-item",{attrs:{label:"Current password",prop:"oldPass"}},[s("el-input",{ref:"oldPass",attrs:{type:"password",name:"old_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.oldPass)}},model:{value:e.changePasswordForm.oldPass,callback:function(t){e.$set(e.changePasswordForm,"oldPass",t)},expression:"changePasswordForm.oldPass"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[s("el-input",{ref:"newPass",attrs:{type:"password",name:"new_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass)}},model:{value:e.changePasswordForm.newPass,callback:function(t){e.$set(e.changePasswordForm,"newPass",t)},expression:"changePasswordForm.newPass"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[s("el-input",{ref:"newPass2",attrs:{type:"password",name:"verify_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass2)}},model:{value:e.changePasswordForm.newPass2,callback:function(t){e.$set(e.changePasswordForm,"newPass2",t)},expression:"changePasswordForm.newPass2"}})],1),e._v(" "),s("el-form-item",[s("el-alert",{attrs:{type:"info",closable:!1}},[s("p",[e._v("Your password is sent through HTTPS to Google Cloud Platform in Montral and encrypted server-side using "),s("a",{attrs:{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"}},[e._v("bcrypt")]),e._v(".")]),e._v(" "),s("p",[e._v("Please use a good password so your account is less likely to be hijacked and used to cause trouble.")]),e._v(" "),s("p",[e._v("\n\t\t\t\t\tFor your security, you should not use the same passwords that you use for important services such as email and online banking on other websites.\n\t\t\t\t\tIf one website gets hacked, you can lose access to every other site where you use the same password.\n\t\t\t\t\tIs is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service.\n\t\t\t\t")])])],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitChangePassword()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):e.updateSettingsMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.settingsForm,"label-position":"top"}},[s("el-form-item",[s("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Profile")]),e._v(" "),s("div",{staticClass:"flex-input"},[s("el-color-picker",{attrs:{predefine:e.predefinedUsernameHighlights,"color-format":"rgb"},model:{value:e.settingsForm.userProfile.highlightUsername,callback:function(t){e.$set(e.settingsForm.userProfile,"highlightUsername",t)},expression:"settingsForm.userProfile.highlightUsername"}}),e._v(" "),e.settingsForm.userProfile.highlightUsername?s("el-button",{attrs:{size:"mini",icon:"el-icon-close"},on:{click:function(t){e.settingsForm.userProfile.highlightUsername=null}}}):e._e(),e._v(" "),s("username",{attrs:{username:"Username colour",highlight:e.settingsForm.userProfile.highlightUsername}})],1)]),e._v(" "),s("el-form-item",[s("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Block editing")]),e._v(" "),s("el-select",{model:{value:e.settingsForm.blockEditing.deleteButton,callback:function(t){e.$set(e.settingsForm.blockEditing,"deleteButton",t)},expression:"settingsForm.blockEditing.deleteButton"}},[s("el-option",{attrs:{label:"Show delete button only in edit block modal",value:"modal"}}),e._v(" "),s("el-option",{attrs:{label:"Show delete button on newly added blocks",value:"recent"}}),e._v(" "),s("el-option",{attrs:{label:"Show delete button on all blocks",value:"all"}})],1)],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitSettings()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):s("div",{staticClass:"options"},[s("el-button",{on:{click:function(t){return e.enterChangePasswordMode()}}},[e._v("\n\t\t\tChange password\n\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.enterUpdateSettingsMode()}}},[e._v("\n\t\t\tUpdate settings\n\t\t")])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],1)};Qe._withStripped=!0;var Ke=4e3,et=I({components:{Username:D},data:function(){return{showing:!1,mode:null,changePasswordForm:{oldPass:"",newPass:"",newPass2:""},settingsForm:{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"}},waiting:!1}},computed:{userID:function(){return this.$store.getters.userID},username:function(){return this.$store.getters.username},changePasswordMode:function(){return 1===this.mode},updateSettingsMode:function(){return 2===this.mode},changePasswordRules:function(){var e=this;return{oldPass:[{validator:function(e,t,s){t.trim()?s():s(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:function(t,s,n){s.trim().length<5?n(new Error("Password minimum length is 5 digits")):(e.changePasswordForm.newPass2.trim()&&e.$refs.changePasswordForm.validateField("newPass2"),n())},trigger:"blur"}],newPass2:[{validator:function(t,s,n){s.trim()?s!==e.changePasswordForm.newPass?n(new Error("Passwords do not match")):n():n(new Error("Repeat new password"))},trigger:"blur"}]}},predefinedUsernameHighlights:function(){return["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"]}},methods:{show:function(){this.showing=!0},enterChangePasswordMode:function(){this.mode=1,this.selectOldPassword()},enterUpdateSettingsMode:function(){var e=this;this.mode=2,this.waiting=!0,o().get("/ajax/settings").then((function(t){e.settingsForm=o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"}},t),e.waiting=!1})).fail((function(){e.waiting=!1,e.clearMode(),e.$alert("Failed to load settings",{confirmButtonText:"Close",type:"error"})}))},handleChangePasswordReturn:function(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():o()("input",this.$refs.newPass2.$el).focus().select():o()("input",this.$refs.newPass.$el).focus().select():o()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword:function(){var e=this;this.$refs.changePasswordForm.validate((function(t){t&&(e.waiting=!0,o().post("/ajax/user/change-password",{old:e.changePasswordForm.oldPass,new:e.changePasswordForm.newPass,new2:e.changePasswordForm.newPass2}).then((function(){e.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),e.clearMode()})).fail((function(t){if(t&&t.readyState)switch(t.status){case 400:e.$message({message:"New password rejected",type:"error",showClose:!0,duration:Ke});break;case 403:e.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:Ke}),e.selectOldPassword();break;default:a(t)}else a(t)})).always((function(){e.waiting=!1})))}))},selectOldPassword:function(){var e=this;this.$nextTick((function(){e.$refs.oldPass&&o()("input",e.$refs.oldPass.$el).focus().select()}))},submitSettings:function(){var e=this;o().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((function(t){e.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),e.clearMode(),e.$store.commit("setUserSettings",t)})).fail((function(){e.$message({message:"Failed to update settings",type:"error",showClose:!0,duration:Ke})}))},clearMode:function(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},Qe,[],!1,null,null,null);et.options.__file="src/widgets/edit-profile-modal.vue";const tt=et.exports;var st=I({store:v,router:Je,components:{Username:D,EditProfileModal:tt},computed:{username:function(){return this.$store.getters.username}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"},openEditProfile:function(){this.$refs.editProfileModal.show()}}},n,[],!1,null,null,null);st.options.__file="src/app.vue";const nt=st.exports;ELEMENT.locale(ELEMENT.lang.en),new(s())(nt).$mount("#app")})();