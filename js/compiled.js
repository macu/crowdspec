(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=Vue;var n=e.n(t),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app"},[n("header",[n("h1",{on:{click:function(t){return e.gotoIndex()}}},[e._v("CrowdSpec")]),e._v(" "),n("div",[n("el-button",{staticClass:"username-button",attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openEditProfile()}}},[n("username",{attrs:{username:e.username,highlight:e.highlight}})],1),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.logout()}}},[e._v("Log out")])],1)]),e._v(" "),n("router-view",{staticClass:"page-area"}),e._v(" "),n("edit-profile-modal",{ref:"editProfileModal"})],1)};s._withStripped=!0;const i=jQuery;var o=e.n(i);const r=Vuex;var c=e.n(r),l=/^VersionStamp: (.+)$/m;function a(e){console.error(e);var t=null;e&&(0===e.readyState?t="Could not connect to server.":e.readyState&&e.status?t="Request failed with HTTP error code "+e.status+".":e.message?t=e.message:"string"==typeof e&&(t=e)),t||(t="An error occurred."),e&&e.responseText&&l.test(e.responseText)&&l.exec(e.responseText)[1]!==window.appVersion&&(t+=" (A new version is available. Reload this page to use the latest client code.)"),n().prototype.$alert(t,"Error",{confirmButtonText:"Ok",type:"error"})}function u(e,t){return parseInt(e,10)===parseInt(t,10)}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(e?" | ":"")+e}function p(e){if(window.URL)try{return new URL(e),!0}catch(e){return!1}return!(!e||!e.trim())}var m=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function h(e){return m.test(e)}function f(e){if(!e)return"";switch(e){case"url":return"URL"}return e.charAt(0).toUpperCase()+e.slice(1)}var b="spec",v="subspec",g="block",_="comment",y="url",w="subspec",k="user";n().use(c());var S=o()(window),C=new(c().Store)({state:{currentTime:Date.now(),windowWidth:S.width(),dragging:!1,movingBlockId:null,savedScrollPosition:null,currentSpec:null,currentSpecScrollTop:null,userSettings:window.user.settings},getters:{currentUserId:function(e){return window.user.id},username:function(e){return window.user.username},userSettings:function(e){return o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"}},e.userSettings)},dialogTinyWidth:function(e){return e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(e){return e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(e){return e.windowWidth<=991?"95%":"90%"},currentSpecId:function(e){return e.currentSpec?e.currentSpec.id:null},currentSpecOwnedByUser:function(e,t){return!!e.currentSpec&&e.currentSpec.ownerType===k&&u(e.currentSpec.ownerId,t.currentUserId)}},mutations:{setWindowWidth:function(e,t){e.windowWidth=t},setUserSettings:function(e,t){e.userSettings=t},startDragging:function(e){e.dragging=!0},endDragging:function(e){e.dragging=!1},startMovingBlock:function(e,t){e.movingBlockId=t},endMovingBlock:function(e){e.movingBlockId=null},setSavedScrollPosition:function(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition:function(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpec:function(e,t){console.debug("saveCurrentSpec"),e.currentSpec&&!u(e.currentSpec.id,t.id)&&(console.debug("saveCurrentSpec clear currentSpecScrollTop"),e.currentSpecScrollTop=null),e.currentSpec=t},saveCurrentSpecScrollTop:function(e){console.debug("saveCurrentSpecScrollTop"),e.currentSpecScrollTop=S.scrollTop()},clearCurrentSpec:function(e){e.currentSpec=null,e.currentSpecScrollTop=null},updateCurrentTime:function(e){e.currentTime=Date.now()}}});const I=C;S.on("resize",(function(){C.commit("setWindowWidth",S.width())})),setTimeout((function e(){C.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const T=VueRouter;var P=e.n(T),x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"index-page"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.promptCreateSpec()}}},[e._v("New spec")]),e._v(" "),n("div",{staticClass:"user-specs"},[n("h2",[e._v("Your specs")]),e._v(" "),e.loading?n("p",[e._v("Loading...")]):e.userSpecs&&e.userSpecs.length?n("ul",{staticClass:"specs-list"},e._l(e.userSpecs,(function(t){return n("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[n("div",{staticClass:"info"},[n("span",{staticClass:"status",class:{public:t.public}},[t.public?[n("i",{staticClass:"el-icon-umbrella"}),e._v(" Public")]:[n("i",{staticClass:"el-icon-lock"}),e._v(" Private")]],2)]),e._v(" "),n("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),n("div",{staticClass:"info"},[n("span",{staticClass:"updated"},[e._v("Last modified "),n("strong",[n("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?n("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):n("p",[e._v("You do not have any specs.")])]),e._v(" "),n("div",{staticClass:"public-specs",class:{"adjust-margin":!!e.userSpecs.length}},[n("h2",[e._v("Public specs")]),e._v(" "),e.loading?n("p",[e._v("Loading...")]):e.publicSpecs&&e.publicSpecs.length?n("ul",{staticClass:"specs-list"},e._l(e.publicSpecs,(function(t){return n("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[n("div",{staticClass:"info"},[n("username",{attrs:{username:t.username,highlight:t.highlight}})],1),e._v(" "),n("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),n("div",{staticClass:"info"},[n("span",{staticClass:"updated"},[e._v("Last modified "),n("strong",[n("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),n("div",{staticClass:"tags"},[n("el-tag",{attrs:{size:"mini",closable:!1,type:"success"}},[e._v("dsf")]),e._v(" "),n("el-tag",{attrs:{size:"mini",closable:!1,type:"primary"}},[e._v("d")]),e._v(" "),n("el-tag",{attrs:{size:"mini",closable:!1}},[e._v("asdfsadf")]),e._v(" "),n("el-tag",{attrs:{size:"mini",closable:!1}},[e._v("asd")]),e._v(" "),n("el-tag",{attrs:{size:"mini",closable:!1}},[e._v("fghfdghsdfg")]),e._v(" "),n("el-tag",{attrs:{size:"mini",closable:!1}},[e._v("rtrgegrae")])],1),e._v(" "),t.desc?n("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):n("p",[e._v("There are no public specs......")])]),e._v(" "),n("edit-spec-modal",{ref:"editSpecModal"})],1)};x._withStripped=!0;var E=function(){var e=this,t=e.$createElement;return(e._self._c||t)("span",[e._v(e._s(e.output))])};E._withStripped=!0;const j=moment;var B=e.n(j);function U(e,t,n,s,i,o,r,c){var l,a="function"==typeof e?e.options:e;if(t&&(a.render=t,a.staticRenderFns=n,a._compiled=!0),s&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),r?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},a._ssrRegister=l):i&&(l=c?function(){i.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(a.functional){a._injectStyles=l;var u=a.render;a.render=function(e,t){return l.call(t),u(e,t)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:a}}var O=U({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return B().parseZone(this.datetime).local()},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},E,[],!1,null,null,null);O.options.__file="src/widgets/moment.vue";const R=O.exports;var M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"username"},[n("i",{staticClass:"el-icon-user",style:e.style}),e._v(" "),n("span",[e._v(e._s(e.username))])])};function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}M._withStripped=!0;var F=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,D=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,z=/^#[0-9a-f]{6}$/i;function L(e){if(e&&"object"===A(e)){if(e.hsl)return V(e);if(e.rgb)return e}else if("string"==typeof e){if(F.test(e)){var t=F.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(z.test(e)){var n=function(e){e=e.toLowerCase();for(var t=0,n=0;n<e.length;n++){var s=e.charCodeAt(e.length-1-n);s>=48&&s<=57?t+=(s-48)*Math.pow(16,n):s>=97&&s<=122&&(t+=(s-97+10)*Math.pow(16,n))}return t};return{r:n(e.substr(1,2)),g:n(e.substr(3,2)),b:n(e.substr(5,2)),rgb:!0}}if(D.test(e))return V(e)}return{r:0,g:0,b:0,rgb:!0}}function N(e){if(e&&"object"===A(e)){if(e.hsl)return e;if(e.rgb)return Y(e)}else if("string"==typeof e){if(D.test(e)){var t=D.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(F.test(e)||z.test(e))return Y(e)}return{h:0,s:0,l:0,hsl:!0}}function V(e){if(e&&"object"===A(e)&&e.rgb)return e;var t,n,s,i=(e=N(e)).h,o=e.s/100,r=e.l/100,c=(1-Math.abs(2*r-1))*o,l=c*(1-Math.abs(i/60%2-1)),a=r-c/2;return 0<=i&&i<60?(t=c,n=l,s=0):60<=i&&i<120?(t=l,n=c,s=0):120<=i&&i<180?(t=0,n=c,s=l):180<=i&&i<240?(t=0,n=l,s=c):240<=i&&i<300?(t=l,n=0,s=c):300<=i&&i<360&&(t=c,n=0,s=l),{r:Math.round(255*(t+a)),g:Math.round(255*(n+a)),b:Math.round(255*(s+a)),rgb:!0}}function Y(e){if(e&&"object"===A(e)&&e.hsl)return e;var t,n=(e=L(e)).r/255,s=e.g/255,i=e.b/255,o=Math.min(n,s,i),r=Math.max(n,s,i),c=r-o;t=0==c?0:r==n?(s-i)/c%6:r==s?(i-n)/c+2:(n-s)/c+4;var l=(r+o)/2;return{h:(t=Math.round(60*t))<0?t+360:t,s:+(100*(0==c?0:c/(1-Math.abs(2*l-1)))).toFixed(1),l:+(100*l).toFixed(1),hsl:!0}}function W(e){var t=L(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}var q=U({props:{username:{type:String,required:!0},highlight:String},computed:{style:function(){var e=this.username===this.$store.getters.username?this.$store.getters.userSettings.userProfile.highlightUsername:this.highlight;if(!e)return null;var t,n=W(e),s=W(((t=N(e)).l<=25?t.l=75:t.l<=50?t.l=100:t.l<=75?t.l=0:t.l=25,t));return{color:n,"text-shadow":"-1px -1px 0 "+s+", 1px -1px 0 "+s+", -1px 1px 0 "+s+", 1px 1px 0 "+s}}}},M,[],!1,null,null,null);q.options.__file="src/widgets/username.vue";const G=q.exports;var H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:e.spec?"Manage spec":"Create spec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.spec?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.spec.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("label",[e._v("\n\t\tName\n\t\t"),n("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),n("label",[e._v("\n\t\tDescription\n\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),n("el-checkbox",{model:{value:e.isPublic,callback:function(t){e.isPublic=t},expression:"isPublic"}},[e._v("Allow public access and community features")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.spec?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSpec()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.spec?"Save":"Create"))])],1)],1)};function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e,t,n,s){return o().post("/ajax/spec/move-block",{blockId:e,subspecId:t,parentId:n,insertBeforeId:s}).fail(a)}H._withStripped=!0;var Q=U({components:{Moment:R},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var n=this;this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",n.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s,i=this.callback;(t=this.name,n=this.desc,s=this.isPublic,o().post("/ajax/spec/create-spec",{name:t,desc:n,isPublic:s}).fail(a)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,n,s,i,r=this.callback;(t=this.spec.id,n=this.name,s=this.desc,i=this.isPublic,o().post("/ajax/spec/save-spec",{specId:t,name:n,desc:s,isPublic:i}).fail(a)).then((function(t){r(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSpec:function(){var e=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.spec.id,o().post("/ajax/spec/delete-spec",{specId:t}).fail(a)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"index"})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},H,[],!1,null,null,null);Q.options.__file="src/spec/edit-spec-modal.vue";const ee=Q.exports;var te=U({components:{Moment:R,Username:G,EditSpecModal:ee},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(e,t,n){this.reloadSpecs(),n()},methods:{reloadSpecs:function(){var e=this;this.loading=!0,o().get("/ajax/home").then((function(t){e.userSpecs=t.userSpecs,e.publicSpecs=t.publicSpecs,e.loading=!1})).fail((function(t){e.loading=!1,a(t)}))},promptCreateSpec:function(){var e=this;this.$refs.editSpecModal.showCreate((function(t){e.$router.push({name:"spec",params:{specId:t}})}))}}},x,[],!1,null,null,null);te.options.__file="src/pages/index.vue";const ne=te.exports;var se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"spec-page"},[e.spec?n("header",[e.loading?e._e():n("div",{staticClass:"right"},[e.currentUserOwns?n("span",[e._v("You own this")]):n("span",[e._v("\n\t\t\t\tOwned by\n\t\t\t\t"),e.spec.username?n("username",{attrs:{username:e.spec.username,highlight:e.spec.highlight}}):[e._v(e._s(e.spec.ownerType)+" "+e._s(e.spec.ownerId))]],2),e._v(" "),e.onSpecRoute?[e.enableEditing?[e.spec.public?n("span",[e._v("\n\t\t\t\t\t\tPublic\n\t\t\t\t\t")]):n("span",[n("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[n("i",{staticClass:"el-icon-lock"})])],1),e._v(" "),n("el-button",{attrs:{type:e.unreadCount?"primary":"default",disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSpecCommunity()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2),e._v(" "),n("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSpec()}}})]:[n("span",[e._v("\n\t\t\t\t\t\tLast modified "),n("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1),e._v(" "),n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSpecCommunity()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2)]]:e._e(),e._v(" "),n("el-button",{attrs:{size:"mini",icon:"el-icon-folder"},on:{click:function(t){return e.promptNavSpec()}}})],2),e._v(" "),n("h2",{on:{click:function(t){return e.gotoSpec()}}},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()]):e._e(),e._v(" "),n("router-view",{ref:"view",attrs:{loading:e.loading,spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo}}),e._v(" "),e.enableEditing?n("edit-spec-modal",{ref:"editSpecModal"}):e._e(),e._v(" "),n("nav-spec-modal",{ref:"navSpecModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId}}),e._v(" "),n("community-modal",{ref:"communityModal",attrs:{"spec-id":e.specId},on:{"play-video":e.playVideo}}),e._v(" "),n("play-video-modal",{ref:"playVideoModal"})],1)};se._withStripped=!0;var ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"nav-spec-modal",attrs:{title:"Navigate spec",visible:e.showing,width:e.$store.getters.dialogTinyWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.loading?n("p",[e._v("Loading...")]):e.subspecs.length?[n("el-select",{attrs:{placeholder:"Choose subspec"},model:{value:e.selectedSubspecId,callback:function(t){e.selectedSubspecId=t},expression:"selectedSubspecId"}},e._l(e.subspecs,(function(e){return n("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?n("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:n("p",[e._v("No subspecs.")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")]),e._v(" "),e.subspecId?n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.goToSpec()}}},[e._v("\n\t\t\tGo to spec\n\t\t")]):e._e(),e._v(" "),e.subspecs.length?n("el-button",{attrs:{type:"primary",disabled:e.disableGoToSubspec},on:{click:function(t){return e.goToSubspec()}}},[e._v("\n\t\t\tGo to subspec\n\t\t")]):e._e()],1)],2)};ie._withStripped=!0;var oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-subspec"},[n("div",[n("div",{staticClass:"title"},[e._m(0),e._v(" "),n("router-link",{attrs:{to:{name:"subspec",params:{specId:e.item.specId,subspecId:e.item.id}}}},[e._v("\n\t\t\t\t"+e._s(e.item.name.trim())+"\n\t\t\t")])],1),e._v(" "),e.item.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};oe._withStripped=!0;var re=U({props:{item:Object}},oe,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("i",{staticClass:"el-icon-s-unfold"}),e._v(" Subspec")])}],!1,null,null,null);re.options.__file="src/spec/ref-subspec.vue";const ce=re.exports;var le=U({components:{RefSubspec:ce},props:{specId:Number,subspecId:Number},data:function(){return{subspecs:[],selectedSubspecId:null,loading:!1,showing:!1}},computed:{disableGoToSubspec:function(){return this.loading||!this.subspecs.length||!this.selectedSubspecId},selectedSubspec:function(){if(this.selectedSubspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.selectedSubspecId)return this.subspecs[e];return null}},methods:{show:function(){var e=this;this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((function(t){e.subspecs=t,e.loading=!1})).fail((function(t){e.loading=!1,e.showing=!1,a(t)}))},goToSpec:function(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},goToSubspec:function(){"subspec"===this.$route.name&&u(this.$route.params.subspecId,this.selectedSubspecId)||this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:this.selectedSubspecId}}),this.showing=!1},closed:function(){this.loading=!1,this.subspecs=[],this.selectedSubspecId=null}}},ie,[],!1,null,null,null);le.options.__file="src/spec/nav-spec-modal.vue";const ae=le.exports;var ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-block-community-modal",attrs:{title:e.modalTitle,visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[n("context-stack",{ref:"contextStack",on:{"pop-stack":e.popStack}}),e._v(" "),e.loading?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):e.target?[e.targetType===e.TARGET_TYPE_SPEC?n("preview-spec",{attrs:{spec:e.target}}):e.targetType===e.TARGET_TYPE_SUBSPEC?n("preview-subspec",{attrs:{subspec:e.target}}):e.targetType===e.TARGET_TYPE_BLOCK?n("preview-block",{attrs:{block:e.target},on:{"play-video":e.raisePlayVideo}}):e.targetType===e.TARGET_TYPE_COMMENT?n("preview-comment",{ref:"previewComment",attrs:{"spec-id":e.specId,comment:e.target},on:{deleted:e.commentDeleted}}):e._e(),e._v(" "),n("div",{domProps:{textContent:e._s(e.formattedCommentsCount)}}),e._v(" "),n("div",{staticClass:"new-comment-area"},[e.sendingComment?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Posting comment...")]):e.addingComment?[e.addingComment?n("el-input",{ref:"newCommentInput",attrs:{type:"textarea",autosize:{minRows:2},placeholder:"Type comment here"},model:{value:e.newCommentBody,callback:function(t){e.newCommentBody=t},expression:"newCommentBody"}}):e._e(),e._v(" "),n("div",[n("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(t){return e.cancelAddComment()}}},[e._v("\n\t\t\t\t\t\tCancel\n\t\t\t\t\t")]),e._v(" "),n("el-button",{attrs:{disabled:e.disablePostComment,type:"primary",size:"small"},on:{click:function(t){return e.addComment()}}},[e._v("\n\t\t\t\t\t\tPost\n\t\t\t\t\t")])],1)]:n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addComment()}}},[e._v("\n\t\t\t\tAdd comment\n\t\t\t")])],2),e._v(" "),e.comments.length?[e._l(e.comments,(function(t){return n("preview-comment",{key:t.id,ref:"comments",refInFor:!0,attrs:{"spec-id":e.specId,comment:t,"show-community":!0},on:{"open-comments":e.openComments,"update-unread":e.adjustUnread,deleted:e.commentDeleted}})})),e._v(" "),e.loadingPage?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading more comments...")]):e.hasMoreComments?n("el-button",{on:{click:function(t){return e.loadMoreComments()}}},[e._v("\n\t\t\t\tLoad more\n\t\t\t")]):e._e()]:e._e()]:e._e(),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],2)};ue._withStripped=!0;var de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"community-context-stack",class:{empty:e.empty}},e._l(e.stack,(function(t,s){return n("transition",{key:t.targetType+"-"+t.target.id,attrs:{name:"fade",appear:""},on:{"after-leave":e.checkEmpty}},[n("stack-bar",{attrs:{target:t.target,"target-type":t.targetType},nativeOn:{click:function(t){return e.jumpStack(s)}}})],1)})),1)};de._withStripped=!0;var pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"community-context-stack-bar",class:e.targetType},[n("el-button",{attrs:{size:"mini",icon:"el-icon-top-left",type:"primary",circle:""}}),e._v(" "),n("span",{staticClass:"bar"},[n("span",{staticClass:"label"},[e._v(e._s(e.label))]),e._v(" "),n("span",{staticClass:"content",domProps:{textContent:e._s(e.content)}})])],1)};pe._withStripped=!0;var me=U({props:{target:Object,targetType:String},computed:{label:function(){var e=f(this.targetType);return this.targetType===g&&this.target.refType&&(e+=" ("+f(this.target.refType)+")"),e},content:function(){switch(this.targetType){case b:case v:return this.target.name;case g:var e;if(e=(this.target.title||"").trim())return e;if(e=(this.target.body||"").trim())return e;if(this.target.refItem)switch(this.target.refType){case w:return this.target.refItem.name;case"video":case y:return this.target.refItem.title||this.target.refItem.url}return"";case _:return this.target.body}}}},pe,[],!1,null,null,null);me.options.__file="src/spec/community-context-stack-bar.vue";var he=U({components:{StackBar:me.exports},data:function(){return{stack:[],empty:!0}},computed:{available:function(){return this.stack.length}},methods:{pushStack:function(e,t,n){this.empty=!1,this.stack.push({targetType:e,target:t,onAdjustUnread:n})},popStack:function(){return this.stack.length?this.jumpStack(this.stack.length-1):null},jumpStack:function(e){var t=this.stack[e];return this.$emit("pop-stack",t.targetType,t.target.id,t.onAdjustUnread),this.stack=this.stack.slice(0,e),t},clearStack:function(){this.stack=[]},checkEmpty:function(){this.empty=!this.stack.length}}},de,[],!1,null,null,null);he.options.__file="src/spec/community-context-stack.vue";const fe=he.exports;var be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-preview community-target-preview"},[n("div",{staticClass:"name"},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()])};be._withStripped=!0;var ve=U({props:{spec:Object}},be,[],!1,null,null,null);ve.options.__file="src/spec/preview-spec.vue";const ge=ve.exports;var _e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-subspec-preview community-target-preview"},[n("div",{staticClass:"name"},[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()])};_e._withStripped=!0;var ye=U({props:{subspec:Object}},_e,[],!1,null,null,null);ye.options.__file="src/spec/preview-subspec.vue";const we=ye.exports;var ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"spec-block-preview community-target-preview",attrs:{"data-block-preview-id":e.blockId}},[n("li",[e.hasTitle?n("div",{staticClass:"title"},[e._v(e._s(e.block.title))]):e._e(),e._v(" "),e.hasRefItem?[e.block.refType===e.REF_TYPE_URL?n("ref-url",{staticClass:"ref-item",attrs:{item:e.block.refItem},on:{play:function(t){return e.raisePlayVideo(e.block.refItem)}}}):e.block.refType===e.REF_TYPE_SUBSPEC?n("ref-subspec",{staticClass:"ref-item",attrs:{item:e.block.refItem}}):e._e()]:e.refItemMissing?n("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?n("div",{staticClass:"body"},[e._v(e._s(e.block.body))]):e._e(),e._v(" "),n("dynamic-stylesheet",{attrs:{rules:e.blockPreviewRules}})],2)])};ke._withStripped=!0;var Se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-url"},[e.item.imageData?n("img",{attrs:{src:e.item.imageData}}):e._e(),e._v(" "),n("div",[e.showEdit||e.showPlay?n("div",{staticClass:"right"},[e.showEdit?n("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.$emit("edit")}}}):e._e(),e._v(" "),e.showPlay?n("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$emit("play")}}},[e._v("Play")]):e._e()],1):e._e(),e._v(" "),n("div",{staticClass:"title"},[e._m(0),e._v(" "),n("a",{attrs:{href:e.item.url,target:"_blank"}},[e._v(e._s(e.item.title&&e.item.title.trim()||e.item.url))])]),e._v(" "),e.item.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};Se._withStripped=!0;var Ce=U({props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return h(this.item.url)}}},Se,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("i",{staticClass:"el-icon-link"}),e._v(" URL")])}],!1,null,null,null);Ce.options.__file="src/spec/ref-url.vue";const Ie=Ce.exports;var $e=function(){var e=this.$createElement;return(this._self._c||e)("span",{staticClass:"dynamic-stylesheet",staticStyle:{display:"none"}})};$e._withStripped=!0;const Te=/^\/\*(?:[^\*]|\*(?!\/))+\*\/$/;function Pe(e,t,n=[],s=0){if(!t||"object"!=typeof t)return 0;let i=0,o=[];const r=()=>{let t=n.join("").trim();if(t){for(let e=0;e<o.length;e++){let t=o[e].trim();t&&!Te.test(t)&&";"!==t.charAt(t.length-1)&&(o[e]=t+";")}o=o.join(""),o&&((e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+o+"}",s+i):(e.styleSheet||e.sheet).addRule(t,o,s+i),i++),o=[]}else o=[]};if(Array.isArray(t))for(let c=0;c<t.length;c++){let l=t[c];l&&("string"==typeof l?o.push(l):"object"==typeof l&&(r(),i+=Pe(e,l,n,s+i)))}else for(let c in t)if(t.hasOwnProperty(c)){let l=t[c];l&&("string"==typeof l?o.push(c+":"+l+";"):"object"==typeof l&&(r(),"&"===c.charAt(0)?c=c.substr(1):[">",":","+","~"," "].indexOf(c.charAt(0))<0&&(c=" "+c),i+=Pe(e,l,n.concat([c]),s+i)))}return r(),i}function xe(e,t=[]){if(!e||"object"!=typeof e)return"";let n="",s=[];const i=()=>{let e=t.join("").trim();if(e){let t=[];for(let e=0;e<s.length;e++){let n=s[e].trim();n?";"===n.charAt(n.length-1)||Te.test(n)?t.push(n):t.push(n+";"):t.push("")}t.length&&(t=t.join("\n\t"),n+="\n"+e+" {\n\t"+t+"\n}")}else for(let e=0;e<s.length;e++){let t=s[e].trim();t&&!Te.test(t)||(n+="\n"+t)}s=[]};if(Array.isArray(e))for(let o=0;o<e.length;o++){let r=e[o];"string"==typeof r?s.push(r):r&&"object"==typeof r&&(i(),n+=xe(r,t.concat([""])))}else for(let o in e)if(e.hasOwnProperty(o)){let r=e[o];if(r)switch(typeof r){case"string":s.push(o+": "+r+";");break;case"object":i(),"&"===o.charAt(0)?o=o.substr(1):[">",":","+","~"," "].indexOf(o.charAt(0))<0&&(o=" "+o),n+=xe(r,t.concat([o]));break;case"boolean":s.push(o)}}return i(),n+(t.length?"":"\n")}function Ee(e,t,n=!1){let s=document.createElement("style");return s.type="text/css",e.appendChild(s),!s.styleSheet&&!s.sheet||n?s.innerHTML=xe(t):Pe(s,t),s}var je=U({props:{rules:[Object,Array],innerMarkupOutput:Boolean},watch:{rules:{deep:!0,handler(){this.recreateSheet()}},innerMarkupOutput(){this.recreateSheet()}},mounted(){this.recreateSheet()},beforeDestroy(){this.removeSheet()},methods:{recreateSheet(){this.removeSheet(),this.rules&&(this.$stylesheet=Ee(this.$el,this.rules,this.innerMarkupOutput))},removeSheet(){this.$stylesheet&&(this.$stylesheet.parentNode.removeChild(this.$stylesheet),this.$stylesheet=null)}}},$e,[],!1,null,null,null);je.options.__file="node_modules/@macu/dynamic-stylesheet-vue/dynamic-stylesheet.vue";const Be=je.exports,Ue=Be;window.Vue&&Vue.component("dynamic-stylesheet",Be);var Oe=U({components:{RefUrl:Ie,RefSubspec:ce,DynamicStylesheet:Ue},props:{block:Object},computed:{blockId:function(){return parseInt(this.block.id,10)||0},blockNumber:function(){return"numbered"===this.block.styleType&&parseInt(this.block.number,10)||0},blockPreviewRules:function(){var e,t,n,s;switch(this.block.styleType){case"bullet":e="'\\2022'";break;case"numbered":e="'"+this.blockNumber+".'";break;default:return null}return t={},s={">li:before":{content:e}},(n='[data-block-preview-id="'+this.blockId+'"]')in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t},REF_TYPE_URL:function(){return y},REF_TYPE_SUBSPEC:function(){return w},hasTitle:function(){return!(!this.block.title||!this.block.title.trim())},hasBody:function(){return!(!this.block.body||!this.block.body.trim())},hasRefItem:function(){return!(!this.block.refType||!this.block.refItem)},refItemMissing:function(){return!!this.block.refType&&!this.block.refItem}},methods:{raisePlayVideo:function(e){this.$emit("play-video",e)}}},ke,[],!1,null,null,null);Oe.options.__file="src/spec/preview-block.vue";const Re=Oe.exports;var Me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-comment-preview community-target-preview",class:{community:e.showCommunity}},[n("div",{staticClass:"info"},[n("div",{staticClass:"right"},[n("el-checkbox",{attrs:{value:e.userRead,disabled:e.sendingRead,size:"mini"},on:{change:e.setUserRead}}),e._v(" "),e.userRead?n("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("\n\t\t\t\tRead\n\t\t\t")]):n("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\n\t\t\t\tUnread\n\t\t\t")]),e._v(" "),e.showCommunity?n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openComments()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2):e._e(),e._v(" "),e.userCanEdit?n("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.edit()}}}):e.userCanDelete?n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDelete()}}}):e._e()],1),e._v(" "),n("username",{attrs:{username:e.comment.username,highlight:e.comment.highlight}}),e._v("\n\t\tposted\n\t\t"),n("moment",{attrs:{datetime:e.comment.created,offset:!0}}),e._v(" "),e.updated!==e.comment.created?[e._v("\n\t\t\t(updated "),n("moment",{attrs:{datetime:e.updated,offset:!0}}),e._v(")\n\t\t")]:e._e()],2),e._v(" "),e.sendingDelete?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v(" Deleting...")]):e.sendingEdit?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v(" Saving...")]):e.editing?n("div",{staticClass:"edit-comment-area"},[n("el-input",{ref:"editCommentInput",attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.editingBody,callback:function(t){e.editingBody=t},expression:"editingBody"}}),e._v(" "),n("div",[n("el-button",{attrs:{disabled:e.disableSaveEdit,type:"warning",size:"small"},on:{click:function(t){return e.cancelEdit()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")]),e._v(" "),n("el-button",{attrs:{disabled:e.disableSaveEdit,type:"primary",size:"small"},on:{click:function(t){return e.saveEdit()}}},[e._v("\n\t\t\t\tSave\n\t\t\t")]),e._v(" "),n("el-button",{attrs:{disabled:e.disableSaveEdit,type:"danger",size:"small"},on:{click:function(t){return e.promptDelete()}}},[e._v("\n\t\t\t\tDelete\n\t\t\t")])],1)],1):n("div",{staticClass:"content"},[e._v(e._s(e.body))])])};Me._withStripped=!0;var Ae=U({components:{Username:G,Moment:R},props:{specId:Number,comment:Object,showCommunity:Boolean},data:function(){return{userRead:this.comment.userRead||!1,sendingRead:!1,editing:!1,updated:this.comment.updated,body:this.comment.body,editingBody:"",sendingEdit:!1,sendingDelete:!1}},computed:{userCanEdit:function(){return this.$store.getters.currentUserId===this.comment.userId},userCanDelete:function(){return this.userCanEdit||this.$store.getters.currentSpecOwnedByUser},disableSaveEdit:function(){return!this.editingBody.trim()||this.sendingEdit},unreadCount:function(){return this.comment.unreadCount||0}},watch:{editing:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.editCommentInput&&o()("textarea",t.$refs.editCommentInput.$el).focus()}))}},methods:{setUserRead:function(e){var t=this;this.sendingRead=!0,function(e,t,n,s){return o().post("/ajax/spec/community/mark-read",{specId:e,targetType:"comment",targetId:n,read:s}).fail(a)}(this.specId,0,this.comment.id,e).then((function(){t.sendingRead=!1,t.userRead=e,t.$emit("update-unread",e?-1:1)})).fail((function(){t.sendingRead=!1}))},openComments:function(){this.$emit("open-comments",this.comment.id)},edit:function(){this.editingBody.trim()||(this.editingBody=this.body),this.editing=!0},cancelEdit:function(){this.editing=!1},saveEdit:function(){var e,t,n,s=this;this.disableSaveEdit||(this.sendingEdit=!0,(e=this.specId,t=this.comment.id,n=this.editingBody,o().post("/ajax/spec/community/update-comment",{specId:e,commentId:t,body:n}).fail(a)).then((function(e){s.sendingEdit=!1,s.editing=!1,s.updated=e.updated,s.body=e.body,s.editingBody=""})).fail((function(){s.sendingEdit=!1})))},promptDelete:function(){var e=this;this.$confirm("Permanently delete this comment?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t,n;e.sendingDelete=!0,(t=e.specId,n=e.comment.id,o().post("/ajax/spec/community/delete-comment",{specId:t,commentId:n}).fail(a)).then((function(){e.sendingDelete=!1,e.$emit("deleted",e.comment.id)})).fail((function(){e.sendingDelete=!1}))})).catch((function(){}))},isUnread:function(){return!this.userRead}}},Me,[],!1,null,null,null);Ae.options.__file="src/spec/preview-comment.vue";var Fe=U({components:{ContextStack:fe,PreviewSpec:ge,PreviewSubspec:we,PreviewBlock:Re,PreviewComment:Ae.exports},props:{specId:Number},data:function(){return{showing:!1,loading:!1,targetType:null,target:null,comments:[],commentsCount:0,hasMoreComments:!1,loadingPage:!1,addingComment:!1,newCommentBody:"",sendingComment:!1,onAdjustUnread:null}},computed:{TARGET_TYPE_SPEC:function(){return b},TARGET_TYPE_SUBSPEC:function(){return v},TARGET_TYPE_BLOCK:function(){return g},TARGET_TYPE_COMMENT:function(){return _},modalTitle:function(){switch(this.targetType){case b:return"Spec community";case v:return"Subspec community";case g:return"Block community";case _:return"Comment community"}return"Community space"},disablePostComment:function(){return!this.newCommentBody.trim()},formattedCommentsCount:function(){return this.commentsCount+(this.targetType===_?" sub":"")+" comment"+(1!==this.commentsCount?"s":"")}},watch:{addingComment:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.newCommentInput&&o()("textarea",t.$refs.newCommentInput.$el).focus().select()}))}},methods:{openCommunity:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.onAdjustUnread=n,this.loadCommunity(e,t),this.showing=!0},loadCommunity:function(e,t){var n=this;this.loading=!0,function(e,t,n){return o().get("/ajax/spec/community",{specId:e,targetType:t,targetId:n}).fail(a)}(this.specId,e,t).then((function(t){switch(n.loading=!1,n.targetType=e,e){case b:n.target=t.spec;break;case v:n.target=t.subspec;break;case g:n.target=t.block;break;case _:n.target=t.comment}n.comments=t.comments,n.commentsCount=t.commentsCount,n.hasMoreComments=t.commentsCount>t.comments.length,n.newCommentBody=""})).fail((function(){n.loading=!1,n.error="Failed to load community."}))},loadMoreComments:function(){var e=this;this.loadingPage=!0;var t=this.comments[this.comments.length-1].updated;(function(e,t,n,s){return o().get("/ajax/spec/community/page",{specId:e,targetType:t,targetId:n,updatedBefore:s}).fail(a)})(this.specId,this.targetType,this.target.id,t).then((function(t){e.loadingPage=!1,e.comments=e.comments.concat(t.comments),e.hasMoreComments=t.hasMore})).fail((function(){e.loadingPage=!1}))},addComment:function(){var e,t,n,s,i=this;this.addingComment?this.disablePostComment||(this.sendingComment=!0,(e=this.specId,t=this.targetType,n=this.target.id,s=this.newCommentBody,o().post("/ajax/spec/community/add-comment",{specId:e,targetType:t,targetId:n,body:s}).fail(a)).then((function(e){i.sendingComment=!1,i.comments.unshift(e),i.commentsCount++,i.addingComment=!1,i.newCommentBody=""})).fail((function(){i.sendingComment=!1}))):this.addingComment=!0},cancelAddComment:function(){this.addingComment=!1},openComments:function(e){this.$refs.contextStack.pushStack(this.targetType,this.target,this.onAdjustUnread),this.onAdjustUnread=null,this.loadCommunity("comment",e)},adjustUnread:function(e){this.onAdjustUnread&&this.onAdjustUnread(e)},commentDeleted:function(e){if(this.targetType===_&&this.target.id===e){var t=this.$refs.previewComment.isUnread(),n=this.$refs.contextStack.popStack();t&&n.onAdjustUnread&&n.onAdjustUnread(-1)}else for(var s=0;s<this.comments.length;s++)if(u(this.comments[s].id,e)){var i=!this.$refs.comments[s].userRead;this.comments.splice(s,1),this.commentsCount--,i&&this.adjustUnread(-1);break}},popStack:function(e,t,n){this.onAdjustUnread=n,this.loadCommunity(e,t)},raisePlayVideo:function(e){this.$emit("play-video",e)},closed:function(){this.targetType=null,this.target=null,this.error=null,this.addingComment=!1,this.newCommentBody="",this.onAdjustUnread=null,this.$refs.contextStack.clearStack()}}},ue,[],!1,null,null,null);Fe.options.__file="src/spec/community-modal.vue";const De=Fe.exports;var ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"play-video-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogSmallWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.vid?n("div",{staticClass:"embed-responsive"},["youtube"===e.vid.type?n("iframe",{attrs:{src:"https://www.youtube.com/embed/"+e.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===e.vid.type?n("iframe",{attrs:{src:"https://player.vimeo.com/video/"+e.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):e._e()]):e._e()])};ze._withStripped=!0;var Le=U({data:function(){return{vid:null,showing:!1}},methods:{show:function(e){var t,n,s=(t=e.url,(n=m.exec(t))?t.indexOf("youtube.com")||t.indexOf("youtu.be")?{type:"youtube",id:n[1]}:t.indexOf("vimeo.com")?{type:"vimeo",id:n[1]}:null:null);s&&(this.vid=s,this.showing=!0)},closed:function(){this.vid=null}}},ze,[],!1,null,null,null);Le.options.__file="src/widgets/play-video-modal.vue";var Ne=U({components:{Username:G,Moment:R,EditSpecModal:ee,NavSpecModal:ae,CommunityModal:De,PlayVideoModal:Le.exports},data:function(){return{loading:!0,spec:null,unreadCount:0}},computed:{specId:function(){return parseInt(this.$route.params.specId,10)},subspecId:function(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute:function(){return"spec"===this.$route.name},currentUserOwns:function(){return this.spec&&this.spec.ownerType===k&&this.$store.getters.currentUserId===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns},choosingAddPosition:function(){return!!this.$store.state.movingBlockId}},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter spec",e),n((function(t){t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),n()},beforeRouteLeave:function(e,t,n){console.debug("beforeRouteLeave spec"),this.spec=null,this.unreadCount=0,d(),n()},methods:{loadSpec:function(e,t){var n=this;console.debug("load spec"),this.loading=!0,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return o().get("/ajax/spec",{specId:e,loadBlocks:t}).fail(a)}(e,t).then((function(e){console.debug("spec loaded",e),n.spec=e,n.unreadCount=e.unreadCount||0,d(e.name),n.loading=!1,n.$refs.view.$once("rendered",n.restoreScroll),n.$store.commit("saveCurrentSpec",e)})).fail((function(e){n.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(n.$route.fullPath)}})}))},gotoSpec:function(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec:function(){var e=this;this.$refs.editSpecModal.showEdit(this.spec,(function(t){e.spec.updated=t.updated,e.spec.name=t.name,e.spec.desc=t.desc,e.spec.public=t.public,e.unreadCount=t.unreadCount||0,d(t.name)}))},openSpecCommunity:function(){var e=this;this.$refs.communityModal.openCommunity(b,this.spec.id,(function(t){e.unreadCount+=t}))},openCommunity:function(e,t,n){this.$refs.communityModal.openCommunity(e,t,n)},playVideo:function(e){this.$refs.playVideoModal.show(e)},promptNavSpec:function(){this.$refs.navSpecModal.show()},restoreScroll:function(e){if(this.onSpecRoute){var t=this.$store.state.savedScrollPosition;t?(console.debug("restoreScroll spec"),o()(window).scrollTop(t.y).scrollLeft(t.x)):u(this.$store.getters.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),o()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},se,[],!1,null,null,null);Ne.options.__file="src/pages/spec.vue";const Ve=Ne.exports;var Ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-view-page",class:{loading:e.loading}},[e.loading?n("p",[e._v("Loading...")]):e.spec?n("spec-view",{key:e.spec.renderTime,attrs:{spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};Ye._withStripped=!0;var We=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.spec||e.subspec?n("div",{staticClass:"spec-view"},[n("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:e.dragging}}),e._v(" "),e.enableEditing?[e.choosingAddPosition?n("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-top"},on:{click:function(t){return e.placeBlockBottom()}}},[e._v("Move block here")]):n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.promptAddBlock()}}},[e._v("Add block")]),e._v(" "),n("ul",{ref:"mirrorList",staticClass:"mirror-list"}),e._v(" "),n("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId},on:{"open-edit-url":e.openEditUrl,"play-video":e.playVideo,"prompt-delete":e.promptDeleteBlock}}),e._v(" "),n("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":e.specId}})]:e._e()],2):e._e()};We._withStripped=!0;const qe=dragula;var Ge=e.n(qe),He=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{staticClass:"spec-block",class:e.classes,attrs:{"data-spec-block":e.block.id},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.clearSelection()}}},[n("div",{staticClass:"content",class:{"mobile-adjust":e.mobileAdjust}},[n("div",{staticClass:"bg"}),e._v(" "),n("div",{staticClass:"layover",on:{mouseleave:function(t){return e.mouseLeaveLayover()}}},[e.enableEditing?[n("div",{staticClass:"expand-control",class:{hide:e.showActions}},[e.unreadCount?n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t"+e._s(e.unreadCount)+"\n\t\t\t\t\t")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(t){e.focusActions=!0}}})],1),e._v(" "),n("div",{staticClass:"actions",class:{show:e.showActions}},[e.choosingAddPosition?[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelChooseAddPosition()}}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.addBeforeThis()}}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.addIntoThis()}}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.addAfterThis()}}})]:e.movingThis?[n("el-button",{attrs:{size:"mini",icon:"el-icon-folder-add"},on:{click:function(t){return e.promptNavSpec()}}},[e._v("Change context")]),e._v(" "),n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.cancelMoving()}}},[e._v("Cancel move")])]:e.movingAnother?[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelMoving()}}}),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.moveBeforeThis()}}}),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.moveIntoThis()}}}),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.moveAfterThis()}}})]:[n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2),e._v(" "),n("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editBlock()}}}),e._v(" "),e.showDeleteButton?n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDeleteBlock()}}}):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.enterChooseAddPosition()}}}),e._v(" "),n("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(t){return e.startMoving()}}}),e._v(" "),n("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(t){return e.startMoving()}}})]],2)]:n("div",{staticClass:"visitor-actions"},[n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2)],1)],2),e._v(" "),e.hasTitle?n("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.hasRefItem?[e.refType===e.REF_TYPE_URL?n("ref-url",{staticClass:"ref-item",attrs:{item:e.refItem},on:{play:function(t){return e.raisePlayVideo(e.refItem)}}}):e.refType===e.REF_TYPE_SUBSPEC?n("ref-subspec",{staticClass:"ref-item",attrs:{item:e.refItem}}):e._e()]:e.refItemMissing?n("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?n("div",{staticClass:"body"},[e._v(e._s(e.body))]):e._e()],2),e._v(" "),n("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:e.movingThis}})])};function Ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}He._withStripped=!0;var Xe=U({components:{RefUrl:Ie,RefSubspec:ce},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,unreadCount:this.block.unreadCount||0,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{REF_TYPE_URL:function(){return y},REF_TYPE_SUBSPEC:function(){return w},showDeleteButton:function(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!(!this.body||!this.body.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},classes:function(){var e;return Ke(e={},this.styleType,!0),Ke(e,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),Ke(e,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),e},movingThis:function(){return this.$store.state.movingBlockId===this.block.id},movingAnother:function(){return this.$store.state.movingBlockId&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother},mobileAdjust:function(){return this.showActions||!!this.unreadCount}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var e=o()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId:function(){var e=o()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock:function(){var e=this;this.raiseOpenEdit({id:this.block.id,created:this.block.created,updated:this.updated,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(t){e.updated=t.updated,e.styleType=t.styleType,e.contentType=t.contentType,e.refType=t.refType,e.refId=t.refId,e.refItem=t.refItem,e.title=t.title,e.body=t.body,e.unreadCount=t.unreadCount||0}))},raiseOpenEdit:function(e,t){this.$emit("open-edit",e,t)},promptDeleteBlock:function(){this.$emit("prompt-delete",this.block.id)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t)},addIntoThis:function(){var e=this.block.id;this.raisePromptAddSubblock(e,null)},addAfterThis:function(){var e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t)},raisePromptAddSubblock:function(e,t){this.$emit("prompt-add-subblock",e,t)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},promptNavSpec:function(){this.$emit("prompt-nav-spec")},moveBeforeThis:function(){var e=this,t=this.$store.state.movingBlockId,n=this.getParentId(),s=this.block.id;J(t,this.subspecId,n,s).then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n){var s=e.$parent.insertBlock(n,!1,!0);s.insertBefore(e.$el)}else{var i=o()('[data-spec-block="'+t+'"]'),r=i.closest(".spec-block-list").closest("[data-spec-block]");i.insertBefore(e.$el),r.length&&r.data("vc").updateHasSubblocks()}e.$store.commit("endMovingBlock")}))},moveIntoThis:function(){var e=this,t=this.$store.state.movingBlockId,n=this.block.id;J(t,this.subspecId,n,null).then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n){var s=e.$parent.insertBlock(n,!1,!0);s.appendTo(e.$refs.sublist)}else{var i=o()('[data-spec-block="'+t+'"]'),r=i.closest(".spec-block-list").closest("[data-spec-block]");i.appendTo(e.$refs.sublist),r.length&&r.data("vc").updateHasSubblocks()}e.updateHasSubblocks(),e.$store.commit("endMovingBlock")}))},moveAfterThis:function(){var e=this,t=this.$store.state.movingBlockId,n=this.getParentId(),s=this.getFollowingBlockId();J(t,this.subspecId,n,s).then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n){var s=e.$parent.insertBlock(n,!1,!0);s.insertAfter(e.$el)}else{var i=o()('[data-spec-block="'+t+'"]'),r=i.closest(".spec-block-list").closest("[data-spec-block]");i.insertAfter(e.$el),r.length&&r.data("vc").updateHasSubblocks()}e.$store.commit("endMovingBlock")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(e){this.refType===y&&e.id===this.refId&&(this.refItem=e)},urlDeleted:function(e){this.refType===y&&e===this.refId&&(this.refItem=null)},raisePlayVideo:function(e){this.$emit("play-video",e)},openCommunity:function(){var e=this;this.$emit("open-community",this.block.id,(function(t){e.unreadCount+=t}))},updateHasSubblocks:function(){this.hasSubblocks=this.$refs.sublist.childElementCount>0},clearSelection:function(){var e=window.getSelection();e&&this.$nextTick((function(){e.removeAllRanges()}))}}},He,[],!1,null,null,null);Xe.options.__file="src/spec/block.vue";const Ze=Xe.exports;var Je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:e.block?"Edit block":"Add block",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.block?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.block.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.block.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("el-radio-group",{model:{value:e.styleType,callback:function(t){e.styleType=t},expression:"styleType"}},[n("el-radio",{attrs:{label:"bullet"}},[e._v("Bullet point")]),e._v(" "),n("el-radio",{attrs:{label:"numbered"}},[e._v("Numbered point")]),e._v(" "),n("el-radio",{attrs:{label:"none"}},[e._v("Indented block")])],1),e._v(" "),n("label",[e._v("\n\t\tTitle\n\t\t"),n("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),n("label",[e._v("\n\t\tBody\n\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),n("el-radio-group",{model:{value:e.refType,callback:function(t){e.refType=t},expression:"refType"}},[n("el-radio",{attrs:{label:null}},[e._v("No media")]),e._v(" "),n("el-radio",{attrs:{label:e.REF_TYPE_SUBSPEC}},[e._v("Subspec")]),e._v(" "),n("el-radio",{attrs:{label:e.REF_TYPE_URL}},[e._v("URL")])],1),e._v(" "),e.refType===e.REF_TYPE_URL?n("ref-url-form",{attrs:{"spec-id":e.specId,"initial-url-object":e.existingUrlRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t},"open-edit-url":e.openEditUrl,"play-video":e.raisePlayVideo}}):e.refType===e.REF_TYPE_SUBSPEC?n("ref-subspec-form",{attrs:{"spec-id":e.specId,"initial-subspec":e.existingSubspecRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t}}}):e._e(),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.block?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.promotDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v("\n\t\t\t"+e._s(e.block?"Save":"Add")+"\n\t\t")])],1)],1)};Je._withStripped=!0;var Qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-url-form"},[e.creating?n("el-card",[n("label",[e._v("\n\t\t\tNew link URL\n\t\t\t"),n("el-input",{attrs:{clearable:""},model:{value:e.newUrl,callback:function(t){e.newUrl=t},expression:"newUrl"}}),e._v(" "),e.newUrl&&!e.isValid?n("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):e.newUrlIsVideo?n("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):e._e()],1),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!0}}},[e._v("\n\t\t\tSelect an existing link\n\t\t")]):e._e(),e._v(" "),e.initialUrlObject?n("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?n("p",[e._v("Loading links...")]):e.urlObjects&&e.urlObjects.length?[n("el-select",{attrs:{filterable:"","filter-method":e.filterUrls,placeholder:"Select link"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.filteredUrlObjects,(function(e){return n("el-option",{key:e.id,attrs:{value:e.id,label:e.title||e.url}})})),1),e._v(" "),e.selectedUrlObject?n("ref-url",{attrs:{item:e.selectedUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.selectedUrlObject)},play:function(t){return e.raisePlayVideo(e.selectedUrlObject)}}}):e._e()]:e._e(),e._v(" "),n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new link\n\t\t")]),e._v(" "),e.initialUrlObject?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()]:[e.initialUrlObject?n("ref-url",{attrs:{item:e.initialUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.initialUrlObject)},play:function(t){return e.raisePlayVideo(e.initialUrlObject)}}}):e._e(),e._v(" "),n("div",[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new link\n\t\t\t")]),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):e._e()],1)]],2)};Qe._withStripped=!0;var et=U({components:{RefUrl:Ie},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var e=this.filter.toLowerCase(),t=[],n=0;n<this.urlObjects.length;n++){var s=this.urlObjects[n];(s.url.toLowerCase().indexOf(e)>=0||s.title&&s.title.toLowerCase().indexOf(e)>=0)&&t.push(s)}return t}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.refId)return this.urlObjects[e];return null},newUrlIsVideo:function(){return p(this.newUrl)&&h(this.newUrl)},isValid:function(){return this.creating?p(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadLinks()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadLinks:function(){var e,t=this;this.urlObjects||this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/urls",{specId:e}).fail(a)).then((function(e){t.urlObjects=e,e.length||(t.selecting=!1,t.initialUrlObject||(t.creating=!0)),t.loading=!1})).fail((function(){t.urlObjects=[],t.selecting=!1,t.initialUrlObject||(t.creating=!0),t.loading=!1})))},filterUrls:function(e){var t=this;e?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function s(){t=null,e.apply(this,arguments)}return function(){return t&&clearTimeout(t),t=setTimeout(s.bind.apply(s,[this].concat(Array.prototype.slice.call(arguments))),n)}}((function(e){t.filter=e}))),this.debouncedUpdateFilter(e)):this.filter=""},openEditUrl:function(e){var t=this;this.$emit("open-edit-url",e,(function(n){if(t.urlObjects)for(var s=0;s<t.urlObjects.length;s++)if(t.urlObjects[s].id===e.id){t.urlObjects.splice(s,1,n);break}}),(function(){if(t.urlObjects)for(var n=0;n<t.urlObjects.length;n++)if(t.urlObjects[n].id===e.id){t.urlObjects.splice(n,1);break}t.refId===e.id&&(t.refId=null)}))},raisePlayVideo:function(e){this.$emit("play-video",e)}}},Qe,[],!1,null,null,null);et.options.__file="src/spec/ref-url-form.vue";const tt=et.exports;var nt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-subspec-form"},[e.creating?n("el-card",[n("label",[e._v("\n\t\t\tNew subspec name\n\t\t\t"),n("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:e.subspecName,callback:function(t){e.subspecName=t},expression:"subspecName"}})],1),e._v(" "),n("label",[e._v("\n\t\t\tDescription\n\t\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.subspecDesc,callback:function(t){e.subspecDesc=t},expression:"subspecDesc"}})],1),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?n("p",[e._v("Loading subspecs...")]):e.subspecs&&e.subspecs.length?[n("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.subspecs,(function(e){return n("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?n("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:e._e(),e._v(" "),n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new subspec\n\t\t")])]:[e.initialSubspec?n("ref-subspec",{attrs:{item:e.initialSubspec}}):e._e(),e._v(" "),n("div",[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):e._e()],1)]],2)};nt._withStripped=!0;var st=U({components:{RefSubspec:ce},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.refId)return this.subspecs[e];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadSubspecs:function(){var e,t=this;this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/subspecs",{specId:e}).fail(a)).then((function(e){t.subspecs=e,e.length||(t.creating=!0),t.loading=!1})).fail((function(){t.subspecs=[],t.creating=!0,t.loading=!1})))}}},nt,[],!1,null,null,null);st.options.__file="src/spec/ref-subspec-form.vue";var it=U({components:{Moment:R,RefUrlForm:tt,RefSubspecForm:st.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return y},REF_TYPE_SUBSPEC:function(){return w},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&this.block.refType===y&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&this.block.refType===w&&this.block.refItem||null}},watch:{refType:function(e){this.refFields=null}},methods:{showAdd:function(e,t,n){this.parentId=e,this.insertBeforeId=t,this.callback=n,this.showing=!0,this.focusTitleInput()},showEdit:function(e,t){this.block=e,this.styleType=e.styleType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var e=this;this.$nextTick((function(){o()("input",e.$refs.titleInput.$el).focus()}))},openEditUrl:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(function(e){t.existingUrlRefItem&&e.id===t.existingUrlRefItem.id&&(t.block.refItem=e),n&&n(e)}),(function(e){t.existingUrlRefItem&&e===t.existingUrlRefItem.id&&(t.block.refType=null,t.block.refId=null,t.block.refItem=null),s&&s(e)}))},raisePlayVideo:function(e){this.$emit("play-video",e)},promotDelete:function(){var e=this;this.$emit("prompt-delete",this.block.id,(function(){e.showing=!1}))},submit:function(){var e=this;if(!this.disableSubmit){var t,n,s,i,r,c,l,u=this.createSendingSpinner(),d=this.callback;this.block?(t=this.specId,n=this.block.id,s=this.styleType,"plaintext",i=this.title,r=this.body,c=this.refType,l=this.refFields,l=l||{},o().post("/ajax/spec/save-block",X({specId:t,blockId:n,styleType:s,contentType:"plaintext",title:i,body:r,refType:c},l)).fail(a)).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()})):function(e,t,n,s,i,r,c,l,u,d){return d=d||{},o().post("/ajax/spec/create-block",X({specId:e,subspecId:t,parentId:n,insertBeforeId:s,styleType:i,contentType:"plaintext",title:c,body:l,refType:u},d)).fail(a)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,0,this.title,this.body,this.refType,this.refFields).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},Je,[],!1,null,null,null);it.options.__file="src/spec/edit-block-modal.vue";const ot=it.exports;var rt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:e.urlObject?"Manage link":"Create link",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.urlObject?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.urlObject.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.urlObject.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("label",[e._v("\n\t\tURL\n\t\t"),n("el-input",{ref:"urlInput",model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1),e._v(" "),e.urlObject?[e.url===e.urlObject.url?n("div",{staticClass:"preview"},[e.urlObject.imageData?n("img",{attrs:{src:e.urlObject.imageData}}):e._e(),e._v(" "),n("div",[e.urlObject.title?n("h3",[e._v(e._s(e.urlObject.title.trim()))]):e._e(),e._v(" "),e.urlObject.desc?n("div",[e._v(e._s(e.urlObject.desc.trim()))]):e._e(),e._v(" "),e.autoRefresh?n("p",[e._v("URL preview will be updated")]):n("el-checkbox",{model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}},[e._v("Refresh URL preview")])],1)]):n("p",[e._v("Link will be updated with new URL")])]:e._e(),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.urlObject?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.urlObject?"Save":"Create"))])],1)],2)};rt._withStripped=!0;var ct=U({components:{Moment:R},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=p,!p(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.createdCallback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.urlInput.$el).focus()}))},showEdit:function(e,t,n){var s=this;this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=n,this.showing=!0,this.$nextTick((function(){o()("input",s.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s=this.createdCallback;(t=this.specId,n=this.url,o().post("/ajax/spec/create-url",{specId:t,url:n}).fail(a)).then((function(t){s(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s=this.updatedCallback;(t=this.urlObject.id,n=this.url,o().post("/ajax/spec/refresh-url",{id:t,url:n}).fail(a)).then((function(t){s(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},promptDelete:function(){var e=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){e.sending=!0;var t,n=e.deletedCallback;(t=e.urlObject.id,o().post("/ajax/spec/delete-url",{id:t}).fail(a)).then((function(){n&&n(e.urlObject.id),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},rt,[],!1,null,null,null);ct.options.__file="src/spec/edit-url-modal.vue";const lt=ct.exports;var at=n().extend(Ze),ut=U({components:{EditBlockModal:ot,EditUrlModal:lt},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new(n())}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null},choosingAddPosition:function(){return!!this.$store.state.movingBlockId}},watch:{dragging:function(e){e?this.autoscroller=function(){var e=70,t=o()(window),n=null,s=null;function i(e){s=e.clientY}return t.on("mousemove",i),n=window.requestAnimationFrame((function i(){if(null!==s){var o=t.height(),r=0;s<e?r=-((e-s)/e*8+1):s>o-e&&(r=(s-(o-e))/e*8+1),0!==r&&t.scrollTop(t.scrollTop()+r)}n=window.requestAnimationFrame(i)})),{stop:function(){t.off("mousemove",i),n&&(window.cancelAnimationFrame(n),n=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var e,t=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var n=0;n<e.length;n++)this.insertBlock(e[n]);this.$nextTick((function(){t.$emit("rendered")})),this.enableEditing&&(this.drake=Ge()({isContainer:function(e){return o()(e).is(".spec-block-list")},accepts:function(e,t,n,s){return!o()(t).closest(".gu-transit").length},moves:function(e,t,n,s){return o()(n).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(e,n){t.$store.commit("startDragging"),t.transitRelativeScroll(o()(e).attr("data-spec-block"))})).on("dragend",(function(e){t.$store.commit("endDragging"),t.transitRelativeScroll(o()(e).attr("data-spec-block"))})).on("drop",(function(e,n,s,i){var r=o()(s).closest("[data-spec-block]");r.length&&r.data("vc").updateHasSubblocks();var c=null,l=o()(n).closest("[data-spec-block]");if(l.length){var a=l.data("vc");c=a.getBlockId(),a.updateHasSubblocks()}var u=i?o()(i).data("vc").getBlockId():null;J(o()(e).data("vc").getBlockId(),t.subspecId,c,u)})))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,o()("[data-spec-block]",this.$refs.list).each((function(e,t){o()(t).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var e=this,t=o()(window).scrollTop();o()("[data-spec-block]",this.$refs.list).each((function(n,s){var i=o()(s).offset();if(i.top>t){var r=i.top-t;return e.$nextTick((function(){o()(window).scrollTop(o()(s).offset().top-r)})),!1}}))},transitRelativeScroll:function(e){var t=o()(window).scrollTop(),n=o()('[data-spec-block="'+e+'"]',this.$refs.list),s=n.offset().top-t;this.$nextTick((function(){o()(window).scrollTop(n.offset().top-s)}))},insertBlock:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=new at({parent:this,store:I,router:xt,propsData:{block:e,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:n}}).$mount();s.$on("open-community",this.openBlockCommunity),s.$on("open-edit",this.openEdit),s.$on("prompt-add-subblock",this.promptAddSubblock),s.$on("prompt-delete",this.promptDeleteBlock),s.$on("start-moving",this.startMovingBlock),s.$on("end-moving",this.endMovingBlock),s.$on("play-video",this.playVideo),s.$on("prompt-nav-spec",this.promptNavSpec);var i=o()(s.$el).data("vc",s);if(e.subblocks)for(var r=0;r<e.subblocks.length;r++){var c=e.subblocks[r],l=this.insertBlock(c,!1);o()(">ul.spec-block-list",i).append(l)}return t&&i.appendTo(this.$refs.list),i},promptAddBlock:function(){var e=this;this.$refs.editBlockModal.showAdd(null,null,(function(t){e.insertBlock(t,!0,!0)}))},openBlockCommunity:function(e,t){this.$emit("open-community",g,e,t)},openEdit:function(e,t){this.$refs.editBlockModal.showEdit(e,t)},promptAddSubblock:function(e,t){var n=this;this.$refs.editBlockModal.showAdd(e,t,(function(s){var i=n.insertBlock(s,!1,!0);if(t)i.insertBefore('[data-spec-block="'+t+'"]');else if(e){var r=o()('[data-spec-block="'+e+'"]');i.appendTo(r.find(">ul.spec-block-list")),r.data("vc").updateHasSubblocks()}else i.appendTo(n.$refs.list)}))},promptDeleteBlock:function(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(e){return o().post("/ajax/spec/delete-block",{blockId:e}).fail(a)})(e).then((function(){o()('[data-spec-block="'+e+'"]').remove(),t&&t()})).fail(a)})).catch((function(){}))},startMovingBlock:function(e){this.$store.commit("startMovingBlock",e),this.transitRelativeScroll(e)},placeBlockBottom:function(){var e=this,t=this.$store.state.movingBlockId;t&&J(t,this.subspecId,null,null).then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n)e.insertBlock(n,!0,!1);else{var s=o()('[data-spec-block="'+t+'"]'),i=s.closest(".spec-block-list").closest("[data-spec-block]");s.appendTo(e.$refs.list),i.length&&i.data("vc").updateHasSubblocks()}e.$store.commit("endMovingBlock")}))},endMovingBlock:function(e){this.$store.commit("endMovingBlock"),this.transitRelativeScroll(e)},openEditUrl:function(e,t,n){var s=this;this.$refs.editUrlModal.showEdit(e,(function(e){s.eventBus.$emit("url-updated",e),t&&t(e)}),(function(e){s.eventBus.$emit("url-deleted",e),n&&n(e)}))},playVideo:function(e){this.$emit("play-video",e)},promptNavSpec:function(){this.$emit("prompt-nav-spec")}}},We,[],!1,null,null,null);ut.options.__file="src/spec/view.vue";const dt=ut.exports;var pt=U({props:{loading:Boolean,spec:Object,enableEditing:Boolean},components:{SpecView:dt},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter spec-view",e),n()},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate spec-view",e),n()},methods:{promptNavSpec:function(){this.$emit("prompt-nav-spec")},openCommunity:function(e,t,n){this.$emit("open-community",e,t,n)},playVideo:function(e){this.$emit("play-video",e)}}},Ye,[],!1,null,null,null);pt.options.__file="src/pages/spec-view.vue";const mt=pt.exports;var ht=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"subspec-page"},[e.subspec?n("header",[e.onSubspecRoute&&!e.loading?n("div",{staticClass:"right"},[e.enableEditing?[n("el-button",{attrs:{type:e.unreadCount?"primary":"default",disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSubspecCommunity()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2),e._v(" "),e.enableEditing?n("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSubspec()}}}):e._e()]:[n("span",[e._v("\n\t\t\t\t\tLast modified "),n("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1),e._v(" "),n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSubspecCommunity()}}},[e.unreadCount?[e._v(e._s(e.unreadCount))]:e._e()],2)]],2):e._e(),e._v(" "),n("h3",[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()]):e._e(),e._v(" "),n("router-view",{ref:"view",attrs:{loading:e.loading,subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo}}),e._v(" "),e.enableEditing?n("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":e.specId}}):e._e()],1)};ht._withStripped=!0;var ft=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:e.subspec?"Manage subspec":"Create subspec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.subspec?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.subspec.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("label",[e._v("\n\t\tName\n\t\t"),n("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),n("label",[e._v("\n\t\tDescription\n\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.subspec?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSubspec()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.subspec?"Save":"Create"))])],1)])};ft._withStripped=!0;var bt=U({components:{Moment:R},props:{specId:Number},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var n=this;this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",n.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s,i=this.callback;(t=this.specId,n=this.name,s=this.desc,o().post("/ajax/spec/create-subspec",{specId:t,name:n,desc:s}).fail(a)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,n,s,i=this.callback;(t=this.subspec.id,n=this.name,s=this.desc,o().post("/ajax/spec/save-subspec",{subspecId:t,name:n,desc:s}).fail(a)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSubspec:function(){var e=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.subspec.id,o().post("/ajax/spec/delete-subspec",{subspecId:t}).fail(a)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"spec",params:{specId:e.specId}})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},ft,[],!1,null,null,null);bt.options.__file="src/spec/edit-subspec-modal.vue";var vt=U({components:{Moment:R,SpecView:dt,EditSubspecModal:bt.exports},inheritAttrs:!1,props:{enableEditing:Boolean},data:function(){return{loading:!0,subspec:null,unreadCount:0}},computed:{specId:function(){return parseInt(this.$route.params.specId,10)},subspecId:function(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute:function(){return"subspec"===this.$route.name},choosingAddPosition:function(){return!!this.$store.state.movingBlockId}},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter subspec",e),n((function(t){t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),n()},beforeRouteLeave:function(e,t,n){console.debug("beforeRouteLeave subspec"),this.subspec=null,this.unreadCount=0,d(),n()},methods:{loadSubspec:function(e,t,n){var s=this;console.debug("load subspec"),this.loading=!0,function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:n}).fail(a)}(e,t,n).then((function(e){console.debug("subspec loaded",e),s.subspec=e,s.unreadCount=e.unreadCount||0,d(e.name),s.loading=!1,s.$refs.view.$once("rendered",s.restoreScroll)})).fail((function(e){s.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(s.$route.fullPath)}})}))},promptNavSpec:function(){this.$emit("prompt-nav-spec")},openSubspecCommunity:function(){var e=this;this.$emit("open-community",v,this.subspec.id,(function(t){e.unreadCount+=t}))},openCommunity:function(e,t,n){this.$emit("open-community",e,t,n)},playVideo:function(e){this.$emit("play-video",e)},openManageSubspec:function(){var e=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(t){e.subspec.updated=t.updated,e.subspec.name=t.name,e.subspec.desc=t.desc,e.unreadCount=t.unreadCount||0,d(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),o()(window).scrollTop(e.y).scrollLeft(e.x))}}},ht,[],!1,null,null,null);vt.options.__file="src/pages/subspec.vue";const gt=vt.exports;var _t=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"subspec-view-page",class:{loading:e.loading}},[e.loading?n("p",[e._v("Loading...")]):e.subspec?n("spec-view",{key:e.subspec.renderTime,attrs:{subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};_t._withStripped=!0;var yt=U({props:{loading:Boolean,subspec:Object,enableEditing:Boolean},components:{SpecView:dt},methods:{promptNavSpec:function(){this.$emit("prompt-nav-spec")},openCommunity:function(e,t,n){this.$emit("open-community",e,t,n)},playVideo:function(e){this.$emit("play-video",e)}}},_t,[],!1,null,null,null);yt.options.__file="src/pages/subspec-view.vue";const wt=yt.exports;var kt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ajax-error-page content-page"},[0===parseInt(e.$route.params.code,10)?n("p",[e._v("\n\t\tCould not connect to server\n\t")]):n("p",[e._v("\n\t\tRequest failed with error code "+e._s(e.$route.params.code)+"\n\t")]),e._v(" "),e.url?n("el-button",{on:{click:function(t){return e.retry()}}},[e._v("Retry")]):e._e()],1)};kt._withStripped=!0;var St=U({computed:{url:function(){return decodeURIComponent(this.$route.query.url)}},methods:{retry:function(){this.$router.replace(this.url)}}},kt,[],!1,null,null,null);St.options.__file="src/pages/ajax-error.vue";const Ct=St.exports;var It=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"content-page"},[e._v("\n\tNot found\n")])};It._withStripped=!0;var $t=U({},It,[],!1,null,null,null);$t.options.__file="src/pages/not-found.vue";const Tt=$t.exports;var Pt=new(P())({mode:"history",routes:[{name:"index",path:"/",component:ne},{path:"/spec/:specId",component:Ve,children:[{name:"spec",path:"",component:mt},{path:"subspec/:subspecId",component:gt,children:[{name:"subspec",path:"",component:wt}]}]},{name:"ajax-error",path:"/ajax-error/:code",component:Ct},{path:"*",component:Tt}],scrollBehavior:function(e,t,n){return I.commit("setSavedScrollPosition",n),n||{x:0,y:0}}});Pt.beforeEach((function(e,t,n){t&&(!I.getters.currentSpecId||e.params.specId&&u(e.params.specId,I.getters.currentSpecId)?"spec"===t.name&&I.commit("saveCurrentSpecScrollTop"):(I.commit("clearCurrentSpec"),I.commit("endMovingBlock"))),n()})),Pt.afterEach((function(e,t){console.debug("afterEach"),I.commit("clearSavedScrollPosition")}));const xt=Pt;var Et=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"edit-profile-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogTinyWidth,"close-on-click-modal":null===e.mode},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.clearMode()}}},[n("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n\t\tAccount options for\n\t\t"),n("username",{attrs:{username:e.username,highlight:e.highlight}})],1),e._v(" "),e.changePasswordMode?n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.changePasswordForm,rules:e.changePasswordRules,"label-position":"top"}},[n("el-form-item",{attrs:{label:"Current password",prop:"oldPass"}},[n("el-input",{ref:"oldPass",attrs:{type:"password",name:"old_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.oldPass)}},model:{value:e.changePasswordForm.oldPass,callback:function(t){e.$set(e.changePasswordForm,"oldPass",t)},expression:"changePasswordForm.oldPass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[n("el-input",{ref:"newPass",attrs:{type:"password",name:"new_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass)}},model:{value:e.changePasswordForm.newPass,callback:function(t){e.$set(e.changePasswordForm,"newPass",t)},expression:"changePasswordForm.newPass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[n("el-input",{ref:"newPass2",attrs:{type:"password",name:"verify_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass2)}},model:{value:e.changePasswordForm.newPass2,callback:function(t){e.$set(e.changePasswordForm,"newPass2",t)},expression:"changePasswordForm.newPass2"}})],1),e._v(" "),n("el-form-item",[n("el-alert",{attrs:{type:"info",closable:!1}},[n("p",[e._v("Your password is sent through HTTPS to Google Cloud Platform in Montréal and encrypted server-side using "),n("a",{attrs:{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"}},[e._v("bcrypt")]),e._v(".")]),e._v(" "),n("p",[e._v("Please use a good password so your account is less likely to be hijacked and used to cause trouble.")]),e._v(" "),n("p",[e._v("\n\t\t\t\t\tFor your security, you should not use the same passwords that you use for important services such as email and online banking on other websites.\n\t\t\t\t\tIf one website gets hacked, you can lose access to every other site where you use the same password.\n\t\t\t\t\tIs is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service.\n\t\t\t\t")])])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitChangePassword()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),n("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):e.updateSettingsMode?n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.settingsForm,"label-position":"top"}},[n("el-form-item",[n("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Profile")]),e._v(" "),n("div",{staticClass:"flex-input"},[n("el-color-picker",{attrs:{predefine:e.predefinedUsernameHighlights,"color-format":"rgb"},model:{value:e.settingsForm.userProfile.highlightUsername,callback:function(t){e.$set(e.settingsForm.userProfile,"highlightUsername",t)},expression:"settingsForm.userProfile.highlightUsername"}}),e._v(" "),e.settingsForm.userProfile.highlightUsername?n("el-button",{attrs:{size:"mini",icon:"el-icon-close"},on:{click:function(t){e.settingsForm.userProfile.highlightUsername=null}}}):e._e(),e._v(" "),n("username",{attrs:{username:"Username colour",highlight:e.settingsForm.userProfile.highlightUsername}})],1)]),e._v(" "),n("el-form-item",[n("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Block editing")]),e._v(" "),n("el-select",{model:{value:e.settingsForm.blockEditing.deleteButton,callback:function(t){e.$set(e.settingsForm.blockEditing,"deleteButton",t)},expression:"settingsForm.blockEditing.deleteButton"}},[n("el-option",{attrs:{label:"Show delete button only in edit block modal",value:"modal"}}),e._v(" "),n("el-option",{attrs:{label:"Show delete button on newly added blocks",value:"recent"}}),e._v(" "),n("el-option",{attrs:{label:"Show delete button on all blocks",value:"all"}})],1)],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitSettings()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),n("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):n("div",{staticClass:"options"},[n("el-button",{on:{click:function(t){return e.enterChangePasswordMode()}}},[e._v("\n\t\t\tChange password\n\t\t")]),e._v(" "),n("el-button",{on:{click:function(t){return e.enterUpdateSettingsMode()}}},[e._v("\n\t\t\tUpdate settings\n\t\t")])],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],1)};Et._withStripped=!0;var jt=4e3,Bt=U({components:{Username:G},data:function(){return{showing:!1,mode:null,changePasswordForm:{oldPass:"",newPass:"",newPass2:""},settingsForm:{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"}},waiting:!1}},computed:{username:function(){return this.$store.getters.username},highlight:function(){return this.$store.getters.userSettings.userProfile.highlightUsername},changePasswordMode:function(){return 1===this.mode},updateSettingsMode:function(){return 2===this.mode},changePasswordRules:function(){var e=this;return{oldPass:[{validator:function(e,t,n){t.trim()?n():n(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:function(t,n,s){n.trim().length<5?s(new Error("Password minimum length is 5 digits")):(e.changePasswordForm.newPass2.trim()&&e.$refs.changePasswordForm.validateField("newPass2"),s())},trigger:"blur"}],newPass2:[{validator:function(t,n,s){n.trim()?n!==e.changePasswordForm.newPass?s(new Error("Passwords do not match")):s():s(new Error("Repeat new password"))},trigger:"blur"}]}},predefinedUsernameHighlights:function(){return["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"]}},methods:{show:function(){this.showing=!0},enterChangePasswordMode:function(){this.mode=1,this.selectOldPassword()},enterUpdateSettingsMode:function(){var e=this;this.mode=2,this.waiting=!0,o().get("/ajax/settings").then((function(t){e.settingsForm=o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"}},t),e.waiting=!1})).fail((function(){e.waiting=!1,e.clearMode(),e.$alert("Failed to load settings",{confirmButtonText:"Close",type:"error"})}))},handleChangePasswordReturn:function(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():o()("input",this.$refs.newPass2.$el).focus().select():o()("input",this.$refs.newPass.$el).focus().select():o()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword:function(){var e=this;this.$refs.changePasswordForm.validate((function(t){t&&(e.waiting=!0,o().post("/ajax/user/change-password",{old:e.changePasswordForm.oldPass,new:e.changePasswordForm.newPass,new2:e.changePasswordForm.newPass2}).then((function(){e.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),e.clearMode()})).fail((function(t){if(t&&t.readyState)switch(t.status){case 400:e.$message({message:"New password rejected",type:"error",showClose:!0,duration:jt});break;case 403:e.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:jt}),e.selectOldPassword();break;default:a(t)}else a(t)})).always((function(){e.waiting=!1})))}))},selectOldPassword:function(){var e=this;this.$nextTick((function(){e.$refs.oldPass&&o()("input",e.$refs.oldPass.$el).focus().select()}))},submitSettings:function(){var e=this;o().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((function(t){e.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),e.clearMode(),e.$store.commit("setUserSettings",t)})).fail((function(){e.$message({message:"Failed to update settings",type:"error",showClose:!0,duration:jt})}))},clearMode:function(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},Et,[],!1,null,null,null);Bt.options.__file="src/widgets/edit-profile-modal.vue";const Ut=Bt.exports;var Ot=U({store:I,router:xt,components:{Username:G,EditProfileModal:Ut},computed:{username:function(){return this.$store.getters.username},highlight:function(){return this.$store.getters.userSettings.userProfile.highlightUsername}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"},openEditProfile:function(){this.$refs.editProfileModal.show()}}},s,[],!1,null,null,null);Ot.options.__file="src/app.vue";const Rt=Ot.exports;ELEMENT.locale(ELEMENT.lang.en),new(n())(Rt).$mount("#app")})();