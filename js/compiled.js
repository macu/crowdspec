(()=>{"use strict";var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=Vue;var s=t.n(e),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app"},[s("header",[s("h1",{on:{click:function(e){return t.gotoIndex()}}},[t._v("CrowdSpec")]),t._v(" "),s("div",[s("span",{staticClass:"username",on:{click:function(e){return t.openEditProfile()}}},[t._v("\n\t\t\t\t"+t._s(t.username)+"\n\t\t\t")]),t._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.logout()}}},[t._v("Log out")])],1)]),t._v(" "),s("router-view",{staticClass:"page-area"}),t._v(" "),s("edit-profile-modal",{ref:"editProfileModal"})],1)};n._withStripped=!0;const i=jQuery;var o=t.n(i);const r=Vuex;var l=t.n(r),c=/^VersionStamp: (.+)$/m;function a(t){console.error(t);var e=null;t&&(0===t.readyState?e="Could not connect to server.":t.readyState&&t.status?e="Request failed with HTTP error code "+t.status+".":t.message?e=t.message:"string"==typeof t&&(e=t)),e||(e="An error occurred."),t&&t.responseText&&c.test(t.responseText)&&c.exec(t.responseText)[1]!==window.appVersion&&(e+=" (A new version is available. Reload this page to use the latest client code.)"),s().prototype.$alert(e,"Error",{confirmButtonText:"Ok",type:"error"})}function u(t,e){return parseInt(t,10)===parseInt(e,10)}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(t?" | ":"")+t}function p(t){if(window.URL)try{return new URL(t),!0}catch(t){return!1}return!(!t||!t.trim())}var f=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function h(t){return f.test(t)}s().use(l());var m=o()(window),b=new(l().Store)({state:{currentTime:Date.now(),windowWidth:m.width(),dragging:!1,moving:null,savedScrollPosition:null,currentSpecId:null,currentSpecScrollTop:null,userSettings:window.user.settings},getters:{userID:function(t){return window.user.id},username:function(t){return window.user.username},userSettings:function(t){return o().extend(!0,{blockEditing:{deleteButton:"all"}},t.userSettings)},dialogTinyWidth:function(t){return t.windowWidth<=767?"80%":t.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(t){return t.windowWidth<=767?"90%":t.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(t){return t.windowWidth<=991?"95%":"90%"}},mutations:{setWindowWidth:function(t,e){t.windowWidth=e},setUserSettings:function(t,e){t.userSettings=e},startDragging:function(t){t.dragging=!0},endDragging:function(t){t.dragging=!1},startMoving:function(t,e){t.moving=e},endMoving:function(t){t.moving=null},setSavedScrollPosition:function(t,e){t.savedScrollPosition=e},clearSavedScrollPosition:function(t){t.savedScrollPosition=null},saveCurrentSpecScrollTop:function(t,e){t.currentSpecId=e,t.currentSpecScrollTop=m.scrollTop()},clearCurrentSpec:function(t){t.currentSpecId=null,t.currentSpecScrollPosition=null},updateCurrentTime:function(t){t.currentTime=Date.now()}}});const v=b;m.on("resize",(function(){b.commit("setWindowWidth",m.width())})),setTimeout((function t(){b.commit("updateCurrentTime"),setTimeout(t,6e4)}),6e4);const g=VueRouter;var _=t.n(g),w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"index-page"},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.promptCreateSpec()}}},[t._v("New spec")]),t._v(" "),s("div",{staticClass:"user-specs"},[s("h2",[t._v("Your specs")]),t._v(" "),t.loading?s("p",[t._v("Loading...")]):t.userSpecs&&t.userSpecs.length?s("ul",{staticClass:"specs-list"},t._l(t.userSpecs,(function(e){return s("router-link",{key:e.id,attrs:{tag:"li",to:{name:"spec",params:{specId:e.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"status",class:{public:e.public}},[e.public?[s("i",{staticClass:"el-icon-umbrella"}),t._v(" Public")]:[s("i",{staticClass:"el-icon-lock"}),t._v(" Private")]],2)]),t._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:e.id}}}},[t._v(t._s(e.name))]),t._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[t._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:e.updated,offset:!0}})],1)])]),t._v(" "),e.desc?s("div",{staticClass:"desc"},[t._v(t._s(e.desc))]):t._e()],1)})),1):s("p",[t._v("You do not have any specs.")])]),t._v(" "),s("div",{staticClass:"public-specs",class:{"adjust-margin":!!t.userSpecs.length}},[s("h2",[t._v("Public specs")]),t._v(" "),t.loading?s("p",[t._v("Loading...")]):t.publicSpecs&&t.publicSpecs.length?s("ul",{staticClass:"specs-list"},t._l(t.publicSpecs,(function(e){return s("router-link",{key:e.id,attrs:{tag:"li",to:{name:"spec",params:{specId:e.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"username"},[s("i",{staticClass:"el-icon-user"}),t._v("\n\t\t\t\t\t\t"+t._s(e.username)+"\n\t\t\t\t\t")])]),t._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:e.id}}}},[t._v(t._s(e.name))]),t._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[t._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:e.updated,offset:!0}})],1)])]),t._v(" "),e.desc?s("div",{staticClass:"desc"},[t._v(t._s(e.desc))]):t._e()],1)})),1):s("p",[t._v("There are no public specs......")])]),t._v(" "),s("edit-spec-modal",{ref:"editSpecModal"})],1)};w._withStripped=!0;var k=function(){var t=this,e=t.$createElement;return(t._self._c||e)("span",[t._v(t._s(t.output))])};k._withStripped=!0;const y=moment;var S=t.n(y);function C(t,e,s,n,i,o,r,l){var c,a="function"==typeof t?t.options:t;if(e&&(a.render=e,a.staticRenderFns=s,a._compiled=!0),n&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),r?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},a._ssrRegister=c):i&&(c=l?function(){i.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(a.functional){a._injectStyles=c;var u=a.render;a.render=function(t,e){return c.call(e),u(t,e)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:a}}var I=C({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return S().parseZone(this.datetime)},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},k,[],!1,null,null,null);I.options.__file="src/widgets/moment.vue";const $=I.exports;var P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:t.spec?"Manage spec":"Create spec",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.spec?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.spec.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.spec.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("label",[t._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),s("label",[t._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}})],1),t._v(" "),s("el-checkbox",{model:{value:t.isPublic,callback:function(e){t.isPublic=e},expression:"isPublic"}},[t._v("Allow public access and community features")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.spec?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDeleteSpec()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.spec?"Save":"Create"))])],1)],1)};function T(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function x(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?T(Object(s),!0).forEach((function(e){j(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function j(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function O(t){return o().get("/ajax/spec",{specId:t}).fail(a)}function E(t,e){return o().get("/ajax/spec/subspec",{specId:t,subspecId:e}).fail(a)}function U(t,e,s,n){return o().post("/ajax/spec/move-block",{blockId:t,subspecId:e,parentId:s,insertBeforeId:n}).fail(a)}P._withStripped=!0;var B=C({components:{Moment:$},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",e.$refs.nameInput.$el).focus()}))},showEdit:function(t,e){var s=this;this.spec=t,this.name=t.name,this.desc=t.desc,this.isPublic=t.public,this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,n,i=this.callback;(e=this.name,s=this.desc,n=this.isPublic,o().post("/ajax/spec/create-spec",{name:e,desc:s,isPublic:n}).fail(a)).then((function(e){i(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;this.sending=!0;var e,s,n,i,r=this.callback;(e=this.spec.id,s=this.name,n=this.desc,i=this.isPublic,o().post("/ajax/spec/save-spec",{specId:e,name:s,desc:n,isPublic:i}).fail(a)).then((function(e){r(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))},promptDeleteSpec:function(){var t=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var e;t.sending=!0,(e=t.spec.id,o().post("/ajax/spec/delete-spec",{specId:e}).fail(a)).then((function(){t.sending=!1,t.showing=!1,t.$nextTick((function(){t.$router.push({name:"index"})}))})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},P,[],!1,null,null,null);B.options.__file="src/spec/edit-spec-modal.vue";const R=B.exports;var M=C({components:{Moment:$,EditSpecModal:R},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(t,e,s){this.reloadSpecs(),s()},methods:{reloadSpecs:function(){var t=this;this.loading=!0,o().get("/ajax/home").then((function(e){t.userSpecs=e.userSpecs,t.publicSpecs=e.publicSpecs,t.loading=!1})).fail((function(e){t.loading=!1,a(e)}))},promptCreateSpec:function(){var t=this;this.$refs.editSpecModal.showCreate((function(e){t.$router.push({name:"spec",params:{specId:e}})}))}}},w,[],!1,null,null,null);M.options.__file="src/pages/index.vue";const F=M.exports;var D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.spec?s("section",{staticClass:"spec-page"},[s("header",[s("div",{staticClass:"right"},[t.currentUserOwns?s("span",[t._v("You own this")]):s("span",[t._v("\n\t\t\t\tOwned by\n\t\t\t\t"),t.spec.username?[t._v(t._s(t.spec.username))]:[t._v(t._s(t.spec.ownerType)+" "+t._s(t.spec.ownerId))]],2),t._v(" "),t.enableEditing?[t.spec.public?s("span",[t._v("\n\t\t\t\t\tPublic\n\t\t\t\t")]):s("span",[s("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[s("i",{staticClass:"el-icon-lock"})])],1),t._v(" "),s("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(e){return t.openManageSpec()}}})]:s("span",[t._v("\n\t\t\t\tLast modified "),s("moment",{attrs:{datetime:t.spec.updated,offset:!0}})],1)],2),t._v(" "),s("h2",[t._v(t._s(t.spec.name))]),t._v(" "),t.spec.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.spec.desc))]):t._e()]),t._v(" "),s("spec-view",{key:t.spec.id,attrs:{spec:t.spec,"enable-editing":t.enableEditing}}),t._v(" "),t.enableEditing?s("edit-spec-modal",{ref:"editSpecModal"}):t._e()],1):t._e()};D._withStripped=!0;var A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.spec||t.subspec?s("div",{staticClass:"spec-view"},[s("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:t.dragging}}),t._v(" "),t.enableEditing?[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.promptAddBlock()}}},[t._v("Add block")]),t._v(" "),s("ul",{ref:"mirrorList",staticClass:"mirror-list"}),t._v(" "),s("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":t.specId,"subspec-id":t.subspecId},on:{"open-edit-url":t.openEditUrl,"play-video":t.playVideo,"prompt-delete":t.promptDeleteBlock}}),t._v(" "),s("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":t.specId}})]:t._e(),t._v(" "),s("play-video-modal",{ref:"playVideoModal"})],2):t._e()};A._withStripped=!0;const L=dragula;var z=t.n(L),V=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",{staticClass:"spec-block",class:t.classes,attrs:{"data-spec-block":t.block.id}},[s("div",{staticClass:"content",class:{"mobile-adjust":t.showActions}},[s("div",{staticClass:"bg"}),t._v(" "),s("div",{staticClass:"layover",on:{mouseleave:function(e){return t.mouseLeaveLayover()}}},[t.enableEditing?[s("div",{staticClass:"expand-control",class:{hide:t.showActions}},[t.unreadSubmissionsCount?s("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t\t")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(e){t.focusActions=!0}}})],1),t._v(" "),s("div",{staticClass:"actions",class:{show:t.showActions}},[t.choosingAddPosition?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(e){return t.cancelChooseAddPosition()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(e){return t.addBeforeThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(e){return t.addIntoThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.addAfterThis()}}})]:t.movingThis?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(e){return t.cancelMoving()}}},[t._v("Cancel move")])]:t.movingAnother?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(e){return t.cancelMoving()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(e){return t.moveBeforeThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(e){return t.moveIntoThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.moveAfterThis()}}})]:[s("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t\t\t")]),t._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.editBlock()}}}),t._v(" "),t.showDeleteButton?s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.promptDeleteBlock()}}}):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.enterChooseAddPosition()}}}),t._v(" "),s("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(e){return t.startMoving()}}}),t._v(" "),s("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(e){return t.startMoving()}}})]],2)]:s("div",{staticClass:"visitor-actions"},[s("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t")])],1)],2),t._v(" "),t.hasTitle?s("div",{staticClass:"title"},[t._v(t._s(t.title))]):t._e(),t._v(" "),t.hasRefItem?[t.refType===t.REF_TYPE_URL?s("ref-url",{staticClass:"ref-item",attrs:{item:t.refItem},on:{play:function(e){return t.raisePlayVideo(t.refItem)}}}):t.refType===t.REF_TYPE_SUBSPEC?s("ref-subspec",{staticClass:"ref-item",attrs:{item:t.refItem}}):t._e()]:t.refItemMissing?s("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):t._e(),t._v(" "),t.hasBody?s("div",{staticClass:"body"},[t._v(t._s(t.body))]):t._e()],2),t._v(" "),s("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:t.movingThis}})])};V._withStripped=!0;var N=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-url"},[t.item.imageData?s("img",{attrs:{src:t.item.imageData}}):t._e(),t._v(" "),s("div",[t.showEdit||t.showPlay?s("div",{staticClass:"right"},[t.showEdit?s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.$emit("edit")}}}):t._e(),t._v(" "),t.showPlay?s("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.$emit("play")}}},[t._v("Play")]):t._e()],1):t._e(),t._v(" "),s("div",{staticClass:"title"},[t._m(0),t._v(" "),s("a",{attrs:{href:t.item.url,target:"_blank"}},[t._v(t._s(t.item.title&&t.item.title.trim()||t.item.url))])]),t._v(" "),t.item.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.item.desc.trim()))]):t._e()])])};N._withStripped=!0;var W=C({props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return h(this.item.url)}}},N,[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[s("i",{staticClass:"el-icon-link"}),t._v(" URL")])}],!1,null,null,null);W.options.__file="src/spec/ref-url.vue";const Y=W.exports;var q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-subspec"},[s("div",[s("div",{staticClass:"title"},[t._m(0),t._v(" "),s("router-link",{attrs:{to:{name:"subspec",params:{specId:t.item.specId,subspecId:t.item.id}}}},[t._v("\n\t\t\t\t"+t._s(t.item.name.trim())+"\n\t\t\t")])],1),t._v(" "),t.item.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.item.desc.trim()))]):t._e()])])};q._withStripped=!0;var H=C({props:{item:Object}},q,[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[s("i",{staticClass:"el-icon-s-unfold"}),t._v(" Subspec")])}],!1,null,null,null);H.options.__file="src/spec/ref-subspec.vue";const G=H.exports;var X="url",Z="subspec",J="user";function Q(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var K=C({components:{RefUrl:Y,RefSubspec:G},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{REF_TYPE_URL:function(){return X},REF_TYPE_SUBSPEC:function(){return Z},showDeleteButton:function(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;case"all":return!0}},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!(!this.body||!this.body.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},classes:function(){var t;return Q(t={},this.styleType,!0),Q(t,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),Q(t,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),t},movingThis:function(){return this.$store.state.moving===this.block.id},movingAnother:function(){return this.$store.state.moving&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother},unreadSubmissionsCount:function(){return 0},submissionsCount:function(){return 0}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var t=o()(this.$el).parent().closest("[data-spec-block]");return t.length?t.attr("data-spec-block"):null},getFollowingBlockId:function(){var t=o()(this.$el).next("[data-spec-block]");return t.length?t.attr("data-spec-block"):null},editBlock:function(){var t=this;this.raiseOpenEdit({id:this.block.id,created:this.block.created,updated:this.updated,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(e){t.updated=e.updated,t.styleType=e.styleType,t.contentType=e.contentType,t.refType=e.refType,t.refId=e.refId,t.refItem=e.refItem,t.title=e.title,t.body=e.body}))},raiseOpenEdit:function(t,e){this.$emit("open-edit",t,e)},promptDeleteBlock:function(){this.$emit("prompt-delete",this.block.id)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var t=this.getParentId(),e=this.block.id;this.raisePromptAddSubblock(t,e)},addIntoThis:function(){var t=this.block.id;this.raisePromptAddSubblock(t,null)},addAfterThis:function(){var t=this.getParentId(),e=this.getFollowingBlockId();this.raisePromptAddSubblock(t,e)},raisePromptAddSubblock:function(t,e){this.$emit("prompt-add-subblock",t,e)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},moveBeforeThis:function(){var t=this,e=this.$store.state.moving,s=this.getParentId(),n=this.block.id;U(e,this.subspecId,s,n).then((function(){var s=o()('[data-spec-block="'+e+'"]'),n=s.closest(".spec-block-list").closest("[data-spec-block]");s.insertBefore(t.$el),n.length&&n.data("vc").updateHasSubblocks(),t.$store.commit("endMoving")}))},moveIntoThis:function(){var t=this,e=this.$store.state.moving,s=this.block.id;U(e,this.subspecId,s,null).then((function(){var s=o()('[data-spec-block="'+e+'"]'),n=s.closest(".spec-block-list").closest("[data-spec-block]");s.appendTo(t.$refs.sublist),n.length&&n.data("vc").updateHasSubblocks(),t.updateHasSubblocks(),t.$store.commit("endMoving")}))},moveAfterThis:function(){var t=this,e=this.$store.state.moving,s=this.getParentId(),n=this.getFollowingBlockId();U(e,this.subspecId,s,n).then((function(){var s=o()('[data-spec-block="'+e+'"]'),n=s.closest(".spec-block-list").closest("[data-spec-block]");s.insertAfter(t.$el),n.length&&n.data("vc").updateHasSubblocks(),t.$store.commit("endMoving")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(t){this.refType===X&&t.id===this.refId&&(this.refItem=t)},urlDeleted:function(t){this.refType===X&&t===this.refId&&(this.refItem=null)},raisePlayVideo:function(t){this.$emit("play-video",t)},openCommunity:function(){this.$alert("Unimplemented")},updateHasSubblocks:function(){this.hasSubblocks=this.$refs.sublist.childElementCount>0}}},V,[],!1,null,null,null);K.options.__file="src/spec/block.vue";const tt=K.exports;var et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:t.block?"Edit block":"Add block",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.block?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.block.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.block.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("el-radio-group",{model:{value:t.styleType,callback:function(e){t.styleType=e},expression:"styleType"}},[s("el-radio",{attrs:{label:"bullet"}},[t._v("Bullet point")]),t._v(" "),s("el-radio",{attrs:{label:"numbered"}},[t._v("Numbered point")]),t._v(" "),s("el-radio",{attrs:{label:"none"}},[t._v("Indented block")])],1),t._v(" "),s("label",[t._v("\n\t\tTitle\n\t\t"),s("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),s("label",[t._v("\n\t\tBody\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}})],1),t._v(" "),s("el-radio-group",{model:{value:t.refType,callback:function(e){t.refType=e},expression:"refType"}},[s("el-radio",{attrs:{label:null}},[t._v("No media")]),t._v(" "),s("el-radio",{attrs:{label:t.REF_TYPE_SUBSPEC}},[t._v("Subspec")]),t._v(" "),s("el-radio",{attrs:{label:t.REF_TYPE_URL}},[t._v("URL")])],1),t._v(" "),t.refType===t.REF_TYPE_URL?s("ref-url-form",{attrs:{"spec-id":t.specId,"initial-url-object":t.existingUrlRefItem,valid:t.refFieldsValid,fields:t.refFields},on:{"update:valid":function(e){t.refFieldsValid=e},"update:fields":function(e){t.refFields=e},"open-edit-url":t.openEditUrl,"play-video":t.raisePlayVideo}}):t.refType===t.REF_TYPE_SUBSPEC?s("ref-subspec-form",{attrs:{"spec-id":t.specId,"initial-subspec":t.existingSubspecRefItem,valid:t.refFieldsValid,fields:t.refFields},on:{"update:valid":function(e){t.refFieldsValid=e},"update:fields":function(e){t.refFields=e}}}):t._e(),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.block?s("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.promotDelete()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v("\n\t\t\t"+t._s(t.block?"Save":"Add")+"\n\t\t")])],1)],1)};et._withStripped=!0;var st=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-url-form"},[t.creating?s("el-card",[s("label",[t._v("\n\t\t\tNew link URL\n\t\t\t"),s("el-input",{attrs:{clearable:""},model:{value:t.newUrl,callback:function(e){t.newUrl=e},expression:"newUrl"}}),t._v(" "),t.newUrl&&!t.isValid?s("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):t.newUrlIsVideo?s("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):t._e()],1),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(){t.creating=!1,t.selecting=!0}}},[t._v("\n\t\t\tSelect an existing link\n\t\t")]):t._e(),t._v(" "),t.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(){t.creating=!1,t.selecting=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()],1):t.selecting?[t.loading?s("p",[t._v("Loading links...")]):t.urlObjects&&t.urlObjects.length?[s("el-select",{attrs:{filterable:"","filter-method":t.filterUrls,placeholder:"Select link"},model:{value:t.refId,callback:function(e){t.refId=e},expression:"refId"}},t._l(t.filteredUrlObjects,(function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.title||t.url}})})),1),t._v(" "),t.selectedUrlObject?s("ref-url",{attrs:{item:t.selectedUrlObject,"show-edit":""},on:{edit:function(e){return t.openEditUrl(t.selectedUrlObject)},play:function(e){return t.raisePlayVideo(t.selectedUrlObject)}}}):t._e()]:t._e(),t._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\tCreate new link\n\t\t")]),t._v(" "),t.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()]:[t.initialUrlObject?s("ref-url",{attrs:{item:t.initialUrlObject,"show-edit":""},on:{edit:function(e){return t.openEditUrl(t.initialUrlObject)},play:function(e){return t.raisePlayVideo(t.initialUrlObject)}}}):t._e(),t._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\t\tCreate new link\n\t\t\t")]),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!0}}},[t._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):t._e()],1)]],2)};st._withStripped=!0;var nt=C({components:{RefUrl:Y},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var t=this.filter.toLowerCase(),e=[],s=0;s<this.urlObjects.length;s++){var n=this.urlObjects[s];(n.url.toLowerCase().indexOf(t)>=0||n.title&&n.title.toLowerCase().indexOf(t)>=0)&&e.push(n)}return e}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===this.refId)return this.urlObjects[t];return null},newUrlIsVideo:function(){return p(this.newUrl)&&h(this.newUrl)},isValid:function(){return this.creating?p(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null}},watch:{selecting:{immediate:!0,handler:function(t){t&&this.loadLinks()}},isValid:{immediate:!0,handler:function(t){this.$emit("update:valid",t)}},refFields:{immediate:!0,handler:function(t){this.$emit("update:fields",t)}}},methods:{loadLinks:function(){var t,e=this;this.urlObjects||this.loading||(this.loading=!0,(t=this.specId,o().get("/ajax/spec/urls",{specId:t}).fail(a)).then((function(t){e.urlObjects=t,t.length||(e.selecting=!1,e.initialUrlObject||(e.creating=!0)),e.loading=!1})).fail((function(){e.urlObjects=[],e.selecting=!1,e.initialUrlObject||(e.creating=!0),e.loading=!1})))},filterUrls:function(t){var e=this;t?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(t){var e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function n(){e=null,t.apply(this,arguments)}return function(){return e&&clearTimeout(e),e=setTimeout(n.bind.apply(n,[this].concat(Array.prototype.slice.call(arguments))),s)}}((function(t){e.filter=t}))),this.debouncedUpdateFilter(t)):this.filter=""},openEditUrl:function(t){var e=this;this.$emit("open-edit-url",t,(function(s){if(e.urlObjects)for(var n=0;n<e.urlObjects.length;n++)if(e.urlObjects[n].id===t.id){e.urlObjects.splice(n,1,s);break}}),(function(){if(e.urlObjects)for(var s=0;s<e.urlObjects.length;s++)if(e.urlObjects[s].id===t.id){e.urlObjects.splice(s,1);break}e.refId===t.id&&(e.refId=null)}))},raisePlayVideo:function(t){this.$emit("play-video",t)}}},st,[],!1,null,null,null);nt.options.__file="src/spec/ref-url-form.vue";const it=nt.exports;var ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-subspec-form"},[t.creating?s("el-card",[s("label",[t._v("\n\t\t\tNew subspec name\n\t\t\t"),s("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:t.subspecName,callback:function(e){t.subspecName=e},expression:"subspecName"}})],1),t._v(" "),s("label",[t._v("\n\t\t\tDescription\n\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.subspecDesc,callback:function(e){t.subspecDesc=e},expression:"subspecDesc"}})],1),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()],1):t.selecting?[t.loading?s("p",[t._v("Loading subspecs...")]):t.subspecs&&t.subspecs.length?[s("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:t.refId,callback:function(e){t.refId=e},expression:"refId"}},t._l(t.subspecs,(function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1),t._v(" "),t.selectedSubspec?s("ref-subspec",{attrs:{item:t.selectedSubspec}}):t._e()]:t._e(),t._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\tCreate new subspec\n\t\t")])]:[t.initialSubspec?s("ref-subspec",{attrs:{item:t.initialSubspec}}):t._e(),t._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!0}}},[t._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):t._e()],1)]],2)};ot._withStripped=!0;var rt=C({components:{RefSubspec:G},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var t=0;t<this.subspecs.length;t++)if(this.subspecs[t].id===this.refId)return this.subspecs[t];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(t){t&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(t){this.$emit("update:valid",t)}},refFields:{immediate:!0,handler:function(t){this.$emit("update:fields",t)}}},methods:{loadSubspecs:function(){var t,e=this;this.loading||(this.loading=!0,(t=this.specId,o().get("/ajax/spec/subspecs",{specId:t}).fail(a)).then((function(t){e.subspecs=t,t.length||(e.creating=!0),e.loading=!1})).fail((function(){e.subspecs=[],e.creating=!0,e.loading=!1})))}}},ot,[],!1,null,null,null);rt.options.__file="src/spec/ref-subspec-form.vue";var lt=C({components:{Moment:$,RefUrlForm:it,RefSubspecForm:rt.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return X},REF_TYPE_SUBSPEC:function(){return Z},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&this.block.refType===X&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&this.block.refType===Z&&this.block.refItem||null}},watch:{refType:function(t){this.refFields=null}},methods:{showAdd:function(t,e,s){this.parentId=t,this.insertBeforeId=e,this.callback=s,this.showing=!0,this.focusTitleInput()},showEdit:function(t,e){this.block=t,this.styleType=t.styleType,this.title=t.title||"",this.body=t.body||"",this.refType=t.refType,this.callback=e,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var t=this;this.$nextTick((function(){o()("input",t.$refs.titleInput.$el).focus()}))},openEditUrl:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",t,(function(t){e.existingUrlRefItem&&t.id===e.existingUrlRefItem.id&&(e.block.refItem=t),s&&s(t)}),(function(t){e.existingUrlRefItem&&t===e.existingUrlRefItem.id&&(e.block.refType=null,e.block.refId=null,e.block.refItem=null),n&&n(t)}))},raisePlayVideo:function(t){this.$emit("play-video",t)},promotDelete:function(){var t=this;this.$emit("prompt-delete",this.block.id,(function(){t.showing=!1}))},submit:function(){var t=this;if(!this.disableSubmit){var e,s,n,i,r,l,c,u=this.createSendingSpinner(),d=this.callback;this.block?(e=this.specId,s=this.block.id,n=this.styleType,"plaintext",i=this.title,r=this.body,l=this.refType,c=this.refFields,c=c||{},o().post("/ajax/spec/save-block",x({specId:e,blockId:s,styleType:n,contentType:"plaintext",title:i,body:r,refType:l},c)).fail(a)).then((function(e){d(e),t.showing=!1,u.close()})).fail((function(){u.close()})):function(t,e,s,n,i,r,l,c,u,d){return d=d||{},o().post("/ajax/spec/create-block",x({specId:t,subspecId:e,parentId:s,insertBeforeId:n,styleType:i,contentType:"plaintext",title:l,body:c,refType:u},d)).fail(a)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,0,this.title,this.body,this.refType,this.refFields).then((function(e){d(e),t.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},et,[],!1,null,null,null);lt.options.__file="src/spec/edit-block-modal.vue";const ct=lt.exports;var at=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:t.urlObject?"Manage link":"Create link",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.urlObject?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.urlObject.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.urlObject.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("label",[t._v("\n\t\tURL\n\t\t"),s("el-input",{ref:"urlInput",model:{value:t.url,callback:function(e){t.url=e},expression:"url"}})],1),t._v(" "),t.urlObject?[t.url===t.urlObject.url?s("div",{staticClass:"preview"},[t.urlObject.imageData?s("img",{attrs:{src:t.urlObject.imageData}}):t._e(),t._v(" "),s("div",[t.urlObject.title?s("h3",[t._v(t._s(t.urlObject.title.trim()))]):t._e(),t._v(" "),t.urlObject.desc?s("div",[t._v(t._s(t.urlObject.desc.trim()))]):t._e(),t._v(" "),t.autoRefresh?s("p",[t._v("URL preview will be updated")]):s("el-checkbox",{model:{value:t.refresh,callback:function(e){t.refresh=e},expression:"refresh"}},[t._v("Refresh URL preview")])],1)]):s("p",[t._v("Link will be updated with new URL")])]:t._e(),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.urlObject?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDelete()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.urlObject?"Save":"Create"))])],1)],2)};at._withStripped=!0;var ut=C({components:{Moment:$},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=p,!p(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.createdCallback=t,this.showing=!0,this.$nextTick((function(){o()("input",e.$refs.urlInput.$el).focus()}))},showEdit:function(t,e,s){var n=this;this.urlObject=t,this.url=t.url,this.refresh=!0,this.updatedCallback=e,this.deletedCallback=s,this.showing=!0,this.$nextTick((function(){o()("input",n.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,n=this.createdCallback;(e=this.specId,s=this.url,o().post("/ajax/spec/create-url",{specId:e,url:s}).fail(a)).then((function(e){n(e),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,n=this.updatedCallback;(e=this.urlObject.id,s=this.url,o().post("/ajax/spec/refresh-url",{id:e,url:s}).fail(a)).then((function(e){n(e),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))}},promptDelete:function(){var t=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){t.sending=!0;var e,s=t.deletedCallback;(e=t.urlObject.id,o().post("/ajax/spec/delete-url",{id:e}).fail(a)).then((function(){s&&s(t.urlObject.id),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},at,[],!1,null,null,null);ut.options.__file="src/spec/edit-url-modal.vue";const dt=ut.exports;var pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"play-video-modal",attrs:{visible:t.showing,width:t.$store.getters.dialogSmallWidth},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.vid?s("div",{staticClass:"embed-responsive"},["youtube"===t.vid.type?s("iframe",{attrs:{src:"https://www.youtube.com/embed/"+t.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===t.vid.type?s("iframe",{attrs:{src:"https://player.vimeo.com/video/"+t.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):t._e()]):t._e()])};pt._withStripped=!0;var ft=C({data:function(){return{vid:null,showing:!1}},methods:{show:function(t){var e,s,n=(e=t.url,(s=f.exec(e))?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:s[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:s[1]}:null:null);n&&(this.vid=n,this.showing=!0)},closed:function(){this.vid=null}}},pt,[],!1,null,null,null);ft.options.__file="src/spec/play-video-modal.vue";const ht=ft.exports;var mt=s().extend(tt),bt=C({components:{EditBlockModal:ct,EditUrlModal:dt,PlayVideoModal:ht},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new(s())}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null}},watch:{dragging:function(t){t?this.autoscroller=function(){var t=70,e=o()(window),s=null,n=null;function i(t){n=t.clientY}return e.on("mousemove",i),s=window.requestAnimationFrame((function i(){if(null!==n){var o=e.height(),r=0;n<t?r=-((t-n)/t*8+1):n>o-t&&(r=(n-(o-t))/t*8+1),0!==r&&e.scrollTop(e.scrollTop()+r)}s=window.requestAnimationFrame(i)})),{stop:function(){e.off("mousemove",i),s&&(window.cancelAnimationFrame(s),s=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var t,e=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)t=this.spec.blocks;else{if(!this.subspec)return;t=this.subspec.blocks}if(t)for(var s=function t(s,n){for(var i=0;i<n.length;i++){var r=n[i],l=e.insertBlock(r,!1);o()(">ul.spec-block-list",s).append(l),r.subblocks&&t(l,r.subblocks)}},n=0;n<t.length;n++){var i=t[n],r=this.insertBlock(i);i.subblocks&&s(r,i.subblocks)}this.enableEditing&&(this.drake=z()({isContainer:function(t){return o()(t).is(".spec-block-list")},accepts:function(t,e,s,n){return!o()(e).closest(".gu-transit").length},moves:function(t,e,s,n){return o()(s).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(t,s){e.$store.commit("startDragging"),e.transitRelativeScroll(o()(t).attr("data-spec-block"))})).on("dragend",(function(t){e.$store.commit("endDragging"),e.transitRelativeScroll(o()(t).attr("data-spec-block"))})).on("drop",(function(t,s,n,i){var r=o()(n).closest("[data-spec-block]");r.length&&r.data("vc").updateHasSubblocks();var l=null,c=o()(s).closest("[data-spec-block]");if(c.length){var a=c.data("vc");l=a.getBlockId(),a.updateHasSubblocks()}var u=i?o()(i).data("vc").getBlockId():null;U(o()(t).data("vc").getBlockId(),e.subspecId,l,u)})))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,o()("[data-spec-block]",this.$refs.list).each((function(t,e){o()(e).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var t=this,e=o()(window).scrollTop();o()("[data-spec-block]",this.$refs.list).each((function(s,n){var i=o()(n).offset();if(i.top>e){var r=i.top-e;return t.$nextTick((function(){o()(window).scrollTop(o()(n).offset().top-r)})),!1}}))},transitRelativeScroll:function(t){var e=o()(window).scrollTop(),s=o()('[data-spec-block="'+t+'"]',this.$refs.list),n=s.offset().top-e;this.$nextTick((function(){o()(window).scrollTop(s.offset().top-n)}))},insertBlock:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new mt({parent:this,store:v,router:Et,propsData:{block:t,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:s}}).$mount();n.$on("open-edit",this.openEdit),n.$on("prompt-add-subblock",this.promptAddSubblock),n.$on("prompt-delete",this.promptDeleteBlock),n.$on("start-moving",this.startMovingBlock),n.$on("end-moving",this.endMovingBlock),n.$on("play-video",this.playVideo);var i=o()(n.$el).data("vc",n);return e&&i.appendTo(this.$refs.list),i},promptAddBlock:function(){var t=this;this.$refs.editBlockModal.showAdd(null,null,(function(e){t.insertBlock(e,!0,!0)}))},openEdit:function(t,e){this.$refs.editBlockModal.showEdit(t,e)},promptAddSubblock:function(t,e){var s=this;this.$refs.editBlockModal.showAdd(t,e,(function(n){var i=s.insertBlock(n,!1,!0);if(e)i.insertBefore('[data-spec-block="'+e+'"]');else if(t){var r=o()('[data-spec-block="'+t+'"]');i.appendTo(r.find(">ul.spec-block-list")),r.data("vc").updateHasSubblocks()}else i.appendTo(s.$refs.list)}))},promptDeleteBlock:function(t,e){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(t){return o().post("/ajax/spec/delete-block",{blockId:t}).fail(a)})(t).then((function(){o()('[data-spec-block="'+t+'"]').remove(),e&&e()})).fail(a)})).catch((function(){}))},startMovingBlock:function(t){this.$store.commit("startMoving",t),this.transitRelativeScroll(t)},endMovingBlock:function(t){this.$store.commit("endMoving"),this.transitRelativeScroll(t)},openEditUrl:function(t,e,s){var n=this;this.$refs.editUrlModal.showEdit(t,(function(t){n.eventBus.$emit("url-updated",t),e&&e(t)}),(function(t){n.eventBus.$emit("url-deleted",t),s&&s(t)}))},playVideo:function(t){this.$refs.playVideoModal.show(t)}}},A,[],!1,null,null,null);bt.options.__file="src/spec/view.vue";const vt=bt.exports;var gt=C({components:{Moment:$,SpecView:vt,EditSpecModal:R},data:function(){return{spec:null}},computed:{currentUserOwns:function(){return this.spec.ownerType===J&&this.$store.getters.userID===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(t,e,s){O(t.params.specId).then((function(t){s((function(e){e.setSpec(t)}))})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteUpdate:function(t,e,s){var n=this;O(t.params.specId).then((function(t){n.setSpec(t),s()})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteLeave:function(t,e,s){d(),s()},methods:{setSpec:function(t){this.spec=t,d(t.name),this.$nextTick(this.restoreScroll)},openManageSpec:function(){var t=this;this.$refs.editSpecModal.showEdit(this.spec,(function(e){t.spec.updated=e.updated,t.spec.name=e.name,t.spec.desc=e.desc,t.spec.public=e.public,d(e.name)}))},restoreScroll:function(){var t=this.$store.state.savedScrollPosition;t?o()(window).scrollTop(t.y).scrollLeft(t.x):u(this.$store.state.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&o()(window).scrollTop(this.$store.state.currentSpecScrollTop)}}},D,[],!1,null,null,null);gt.options.__file="src/pages/spec.vue";const _t=gt.exports;var wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.subspec?s("section",{staticClass:"subspec-page"},[s("header",[s("div",{staticClass:"spec",on:{click:function(e){return t.gotoSpec()}}},[s("h2",[t._v("\n\t\t\t\t"+t._s(t.subspec.specName)+"\n\t\t\t")])]),t._v(" "),s("div",{staticClass:"subspec"},[s("div",{staticClass:"right"},[t.enableEditing?s("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(e){return t.openManageSubspec()}}}):s("span",[t._v("\n\t\t\t\t\tLast modified "),s("moment",{attrs:{datetime:t.subspec.updated,offset:!0}})],1)],1),t._v(" "),s("h3",[t._v(t._s(t.subspec.name))]),t._v(" "),t.subspec.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.subspec.desc))]):t._e()])]),t._v(" "),s("spec-view",{key:t.subspec.id,attrs:{subspec:t.subspec,"enable-editing":t.enableEditing}}),t._v(" "),t.enableEditing?s("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":t.subspec.specId}}):t._e()],1):t._e()};wt._withStripped=!0;var kt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:t.subspec?"Manage subspec":"Create subspec",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.subspec?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.subspec.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.subspec.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("label",[t._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),s("label",[t._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}})],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.subspec?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDeleteSubspec()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.subspec?"Save":"Create"))])],1)])};kt._withStripped=!0;var yt=C({components:{Moment:$},props:{specId:{type:Number,required:!0}},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",e.$refs.nameInput.$el).focus()}))},showEdit:function(t,e){var s=this;this.subspec=t,this.name=t.name,this.desc=t.desc,this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,n,i=this.callback;(e=this.specId,s=this.name,n=this.desc,o().post("/ajax/spec/create-subspec",{specId:e,name:s,desc:n}).fail(a)).then((function(e){i(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;this.sending=!0;var e,s,n,i=this.callback;(e=this.subspec.id,s=this.name,n=this.desc,o().post("/ajax/spec/save-subspec",{subspecId:e,name:s,desc:n}).fail(a)).then((function(e){i(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))},promptDeleteSubspec:function(){var t=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var e;t.sending=!0,(e=t.subspec.id,o().post("/ajax/spec/delete-subspec",{subspecId:e}).fail(a)).then((function(){t.sending=!1,t.showing=!1,t.$nextTick((function(){t.$router.push({name:"spec",params:{specId:t.specId}})}))})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},kt,[],!1,null,null,null);yt.options.__file="src/spec/edit-subspec-modal.vue";var St=C({components:{Moment:$,SpecView:vt,EditSubspecModal:yt.exports},data:function(){return{subspec:null}},computed:{currentUserOwns:function(){return this.subspec.ownerType===J&&this.$store.getters.userID===this.subspec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(t,e,s){E(t.params.specId,t.params.subspecId).then((function(t){s((function(e){e.setSubspec(t)}))})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteUpdate:function(t,e,s){var n=this;E(t.params.specId,t.params.subspecId).then((function(t){n.setSubspec(t),s(),n.$nextTick(n.restoreScroll)})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteLeave:function(t,e,s){d(),s()},methods:{setSubspec:function(t){this.subspec=t,d(t.name),this.$nextTick(this.restoreScroll)},gotoSpec:function(){this.$router.push({name:"spec",params:{specId:this.subspec.specId}})},openManageSubspec:function(){var t=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(e){t.subspec.updated=e.updated,t.subspec.name=e.name,t.subspec.desc=e.desc,d(e.name)}))},restoreScroll:function(){var t=this.$store.state.savedScrollPosition;t&&o()(window).scrollTop(t.y).scrollLeft(t.x)}}},wt,[],!1,null,null,null);St.options.__file="src/pages/subspec.vue";const Ct=St.exports;var It=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ajax-error-page"},[0===parseInt(t.$route.params.code,10)?s("p",[t._v("\n\t\tCould not connect to server\n\t")]):s("p",[t._v("\n\t\tRequest failed with error code "+t._s(t.$route.params.code)+"\n\t")]),t._v(" "),t.url?s("el-button",{on:{click:function(e){return t.retry()}}},[t._v("Retry")]):t._e()],1)};It._withStripped=!0;var $t=C({computed:{url:function(){return decodeURIComponent(this.$route.query.url)}},methods:{retry:function(){this.$router.replace(this.url)}}},It,[],!1,null,null,null);$t.options.__file="src/pages/ajax-error.vue";const Pt=$t.exports;var Tt=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",[t._v("\n\tNot found\n")])};Tt._withStripped=!0;var xt=C({},Tt,[],!1,null,null,null);xt.options.__file="src/pages/not-found.vue";const jt=xt.exports;var Ot=new(_())({mode:"history",routes:[{name:"index",path:"/",component:F},{name:"spec",path:"/spec/:specId",component:_t},{name:"subspec",path:"/spec/:specId/subspec/:subspecId",component:Ct},{name:"ajax-error",path:"/ajax-error/:code",component:Pt},{path:"*",component:jt}],scrollBehavior:function(t,e,s){return v.commit("setSavedScrollPosition",s),t.hash?{selector:t.hash}:s||{x:0,y:0}}});Ot.beforeEach((function(t,e,s){e&&(!v.state.currentSpecId||t.params.specId&&u(t.params.specId,v.state.currentSpecId)?"spec"===e.name&&v.commit("saveCurrentSpecScrollTop",e.params.specId):v.commit("clearCurrentSpec")),s()})),Ot.afterEach((function(t,e){v.commit("clearSavedScrollPosition")}));const Et=Ot;var Ut=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"edit-profile-modal",attrs:{title:"Your username is "+t.username,visible:t.showing,width:t.$store.getters.dialogTinyWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.clearMode()}}},[t.changePasswordMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:t.changePasswordForm,rules:t.changePasswordRules,"label-position":"top"}},[s("el-form-item",{attrs:{label:"Current password",prop:"oldPass"}},[s("el-input",{ref:"oldPass",attrs:{type:"password",name:"old_password",autocomplete:"off"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleChangePasswordReturn(t.$refs.oldPass)}},model:{value:t.changePasswordForm.oldPass,callback:function(e){t.$set(t.changePasswordForm,"oldPass",e)},expression:"changePasswordForm.oldPass"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[s("el-input",{ref:"newPass",attrs:{type:"password",name:"new_password",autocomplete:"off"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleChangePasswordReturn(t.$refs.newPass)}},model:{value:t.changePasswordForm.newPass,callback:function(e){t.$set(t.changePasswordForm,"newPass",e)},expression:"changePasswordForm.newPass"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[s("el-input",{ref:"newPass2",attrs:{type:"password",name:"verify_password",autocomplete:"off"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleChangePasswordReturn(t.$refs.newPass2)}},model:{value:t.changePasswordForm.newPass2,callback:function(e){t.$set(t.changePasswordForm,"newPass2",e)},expression:"changePasswordForm.newPass2"}})],1),t._v(" "),s("el-form-item",[s("el-alert",{attrs:{type:"info",closable:!1}},[s("p",[t._v("Your password is sent through HTTPS to Google Cloud Platform in Montréal and encrypted server-side using "),s("a",{attrs:{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"}},[t._v("bcrypt")]),t._v(".")]),t._v(" "),s("p",[t._v("Please use a good password so your account is less likely to be hijacked and used to cause trouble.")]),t._v(" "),s("p",[t._v("\n\t\t\t\t\tFor your security, you should not use the same passwords that you use for important services such as email and online banking on other websites.\n\t\t\t\t\tIf one website gets hacked, you can lose access to every other site where you use the same password.\n\t\t\t\t\tThe best setup is to use a password manager with two-factor authentication and distinct long random passwords for every important service.\n\t\t\t\t")])])],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitChangePassword()}}},[t._v("\n\t\t\t\tUpdate\n\t\t\t")]),t._v(" "),s("el-button",{on:{click:function(e){return t.clearMode()}}},[t._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):t.updateSettingsMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:t.settingsForm,"label-position":"top"}},[s("el-form-item",[s("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[t._v("Block editing")]),t._v(" "),s("el-form-item",{attrs:{label:"Delete button"}},[s("el-select",{model:{value:t.settingsForm.blockEditing.deleteButton,callback:function(e){t.$set(t.settingsForm.blockEditing,"deleteButton",e)},expression:"settingsForm.blockEditing.deleteButton"}},[s("el-option",{attrs:{label:"Show delete button only in edit block modal",value:"modal"}}),t._v(" "),s("el-option",{attrs:{label:"Only show delete button on newly added blocks",value:"recent"}}),t._v(" "),s("el-option",{attrs:{label:"Show delete button on all blocks",value:"all"}})],1)],1)],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitSettings()}}},[t._v("\n\t\t\t\tUpdate\n\t\t\t")]),t._v(" "),s("el-button",{on:{click:function(e){return t.clearMode()}}},[t._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):s("div",{staticClass:"options"},[s("el-button",{on:{click:function(e){return t.enterChangePasswordMode()}}},[t._v("\n\t\t\tChange password\n\t\t")]),t._v(" "),s("el-button",{on:{click:function(e){return t.enterUpdateSettingsMode()}}},[t._v("\n\t\t\tUpdate settings\n\t\t")])],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Close")])],1)],1)};Ut._withStripped=!0;var Bt=4e3,Rt=C({data:function(){return{showing:!1,mode:null,changePasswordForm:{oldPass:"",newPass:"",newPass2:""},settingsForm:{blockEditing:{deleteButton:"all"}},waiting:!1}},computed:{userID:function(){return this.$store.getters.userID},username:function(){return this.$store.getters.username},changePasswordMode:function(){return 1===this.mode},updateSettingsMode:function(){return 2===this.mode},changePasswordRules:function(){var t=this;return{oldPass:[{validator:function(t,e,s){e.trim()?s():s(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:function(e,s,n){s.trim().length<5?n(new Error("Password minimum length is 5 digits")):(t.changePasswordForm.newPass2.trim()&&t.$refs.changePasswordForm.validateField("newPass2"),n())},trigger:"blur"}],newPass2:[{validator:function(e,s,n){s.trim()?s!==t.changePasswordForm.newPass?n(new Error("Passwords do not match")):n():n(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show:function(){this.showing=!0},enterChangePasswordMode:function(){this.mode=1,this.selectOldPassword()},enterUpdateSettingsMode:function(){var t=this;this.mode=2,this.waiting=!0,o().get("/ajax/settings").then((function(e){t.settingsForm=o().extend(!0,{blockEditing:{deleteButton:"all"}},e),t.waiting=!1})).fail((function(){t.waiting=!1,t.clearMode(),t.$alert("Failed to load settings",{confirmButtonText:"Close",type:"error"})}))},handleChangePasswordReturn:function(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():o()("input",this.$refs.newPass2.$el).focus().select():o()("input",this.$refs.newPass.$el).focus().select():o()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword:function(){var t=this;this.$refs.changePasswordForm.validate((function(e){e&&(t.waiting=!0,o().post("/ajax/user/change-password",{old:t.changePasswordForm.oldPass,new:t.changePasswordForm.newPass,new2:t.changePasswordForm.newPass2}).then((function(){t.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),t.clearMode()})).fail((function(e){if(e&&e.readyState)switch(e.status){case 400:t.$message({message:"New password rejected",type:"error",showClose:!0,duration:Bt});break;case 403:t.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:Bt}),t.selectOldPassword();break;default:a(e)}else a(e)})).always((function(){t.waiting=!1})))}))},selectOldPassword:function(){var t=this;this.$nextTick((function(){t.$refs.oldPass&&o()("input",t.$refs.oldPass.$el).focus().select()}))},submitSettings:function(){var t=this;o().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((function(e){t.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),t.clearMode(),t.$store.commit("setUserSettings",e)})).fail((function(){t.$message({message:"Failed to update settings",type:"error",showClose:!0,duration:Bt})}))},clearMode:function(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},Ut,[],!1,null,null,null);Rt.options.__file="src/widgets/edit-profile-modal.vue";const Mt=Rt.exports;var Ft=C({store:v,router:Et,components:{EditProfileModal:Mt},computed:{username:function(){return this.$store.getters.username}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"},openEditProfile:function(){this.$refs.editProfileModal.show()}}},n,[],!1,null,null,null);Ft.options.__file="src/app.vue";const Dt=Ft.exports;ELEMENT.locale(ELEMENT.lang.en),new(s())(Dt).$mount("#app")})();