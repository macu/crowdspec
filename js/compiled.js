!function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=23)}([function(e,t){e.exports=jQuery},function(e,t){e.exports=Vue},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t){e.exports=Vuex},function(e,t){e.exports=VueRouter},function(e,t){e.exports=moment},function(e,t){e.exports=dragula},function(e,t,s){e.exports=s(42)},function(e,t,s){},function(e,t,s){"use strict";var n=s(2);s.n(n).a},function(e,t,s){"use strict";var n=s(3);s.n(n).a},function(e,t,s){"use strict";var n=s(4);s.n(n).a},function(e,t,s){"use strict";var n=s(5);s.n(n).a},function(e,t,s){"use strict";var n=s(6);s.n(n).a},function(e,t,s){"use strict";var n=s(7);s.n(n).a},function(e,t,s){"use strict";var n=s(8);s.n(n).a},function(e,t,s){"use strict";var n=s(9);s.n(n).a},function(e,t,s){"use strict";var n=s(10);s.n(n).a},function(e,t,s){"use strict";var n=s(11);s.n(n).a},function(e,t,s){"use strict";var n=s(12);s.n(n).a},function(e,t,s){"use strict";var n=s(13);s.n(n).a},function(e,t,s){"use strict";var n=s(14);s.n(n).a},function(e,t,s){"use strict";var n=s(15);s.n(n).a},function(e,t,s){"use strict";var n=s(16);s.n(n).a},function(e,t,s){"use strict";var n=s(17);s.n(n).a},function(e,t,s){"use strict";var n=s(18);s.n(n).a},function(e,t,s){"use strict";s.r(t);s(24);var n=s(1),i=s.n(n),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app"},[s("header",[s("h1",{on:{click:function(t){return e.gotoIndex()}}},[e._v("CrowdSpec")]),e._v(" "),s("div",[s("span",{staticClass:"username",on:{click:function(t){return e.openEditProfile()}}},[e._v("\n\t\t\t\t"+e._s(e.username)+"\n\t\t\t")]),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.logout()}}},[e._v("Log out")])],1)]),e._v(" "),s("router-view",{staticClass:"page-area"}),e._v(" "),s("edit-profile-modal",{ref:"editProfileModal"})],1)};o._withStripped=!0;var r=s(0),l=s.n(r),c=s(19),a=s.n(c);i.a.use(a.a);var u=l()(window),d=new a.a.Store({state:{currentTime:Date.now(),windowWidth:u.width(),dragging:!1,moving:null,savedScrollPosition:null,currentSpecId:null,currentSpecScrollTop:null},getters:{userID:function(e){return window.user.id},username:function(e){return window.user.username},dialogTinyWidth:function(e){return e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(e){return e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(e){return e.windowWidth<=991?"95%":"90%"}},mutations:{setWindowWidth:function(e,t){e.windowWidth=t},startDragging:function(e){e.dragging=!0},endDragging:function(e){e.dragging=!1},startMoving:function(e,t){e.moving=t},endMoving:function(e){e.moving=null},setSavedScrollPosition:function(e,t){e.savedScrollPosition=t},clearSavedScrollPosition:function(e){e.savedScrollPosition=null},saveCurrentSpecScrollTop:function(e,t){e.currentSpecId=t,e.currentSpecScrollTop=u.scrollTop()},clearCurrentSpec:function(e){e.currentSpecId=null,e.currentSpecScrollPosition=null},updateCurrentTime:function(e){e.currentTime=Date.now()}}}),p=d;u.on("resize",(function(){d.commit("setWindowWidth",u.width())}));setTimeout((function e(){d.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);var f=s(20),h=s.n(f),m=/^VersionStamp: (.+)$/m;function b(e){console.error(e);var t=null;(e&&(0===e.readyState?t="Could not connect to server.":e.readyState&&e.status?t="Request failed with HTTP error code "+e.status+".":e.message?t=e.message:"string"==typeof e&&(t=e)),t||(t="An error occurred."),e&&e.responseText&&m.test(e.responseText))&&(m.exec(e.responseText)[1]!==window.appVersion&&(t+=" (A new version is available. Reload this page to use the latest client code.)"));i.a.prototype.$alert(t,"Error",{confirmButtonText:"Ok",type:"error"})}function v(e,t){return parseInt(e,10)===parseInt(t,10)}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(e?" | ":"")+e}function _(e){if(window.URL)try{return new URL(e),!0}catch(e){return!1}return!(!e||!e.trim())}var w=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function k(e){return w.test(e)}var y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index-page"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.promptCreateSpec()}}},[e._v("New spec")]),e._v(" "),s("div",{staticClass:"user-specs"},[s("h2",[e._v("Your specs")]),e._v(" "),e.loading?s("p",[e._v("Loading...")]):e.userSpecs&&e.userSpecs.length?s("ul",{staticClass:"specs-list"},e._l(e.userSpecs,(function(t){return s("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"status",class:{public:t.public}},[t.public?[s("i",{staticClass:"el-icon-umbrella"}),e._v(" Public")]:[s("i",{staticClass:"el-icon-lock"}),e._v(" Private")]],2)]),e._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[e._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?s("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):s("p",[e._v("You do not have any specs.")])]),e._v(" "),s("div",{staticClass:"public-specs",class:{"adjust-margin":!!e.userSpecs.length}},[s("h2",[e._v("Public specs")]),e._v(" "),e.loading?s("p",[e._v("Loading...")]):e.publicSpecs&&e.publicSpecs.length?s("ul",{staticClass:"specs-list"},e._l(e.publicSpecs,(function(t){return s("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"username"},[s("i",{staticClass:"el-icon-user"}),e._v("\n\t\t\t\t\t\t"+e._s(t.username)+"\n\t\t\t\t\t")])]),e._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[e._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?s("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):s("p",[e._v("There are no public specs......")])]),e._v(" "),s("edit-spec-modal",{ref:"editSpecModal"})],1)};y._withStripped=!0;var S=function(){var e=this.$createElement;return(this._self._c||e)("span",[this._v(this._s(this.output))])};S._withStripped=!0;var I=s(21),C=s.n(I);function P(e,t,s,n,i,o,r,l){var c,a="function"==typeof e?e.options:e;if(t&&(a.render=t,a.staticRenderFns=s,a._compiled=!0),n&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),r?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},a._ssrRegister=c):i&&(c=l?function(){i.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(a.functional){a._injectStyles=c;var u=a.render;a.render=function(e,t){return c.call(t),u(e,t)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:a}}var $=P({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return C.a.parseZone(this.datetime)},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},S,[],!1,null,null,null);$.options.__file="src/widgets/moment.vue";var T=$.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:e.spec?"Manage spec":"Create spec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.spec?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.spec.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("label",[e._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),s("el-checkbox",{model:{value:e.isPublic,callback:function(t){e.isPublic=t},expression:"isPublic"}},[e._v("Allow public access and community features")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.spec?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSpec()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.spec?"Save":"Create"))])],1)],1)};function j(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function O(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?j(Object(s),!0).forEach((function(t){E(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):j(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function E(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function U(e){return l.a.get("/ajax/spec",{specId:e}).fail(b)}function R(e,t){return l.a.get("/ajax/spec/subspec",{specId:e,subspecId:t}).fail(b)}function B(e,t,s,n){return l.a.post("/ajax/spec/move-block",{blockId:e,subspecId:t,parentId:s,insertBeforeId:n}).fail(b)}x._withStripped=!0;var M={components:{Moment:T},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){l()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var s=this;this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((function(){l()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n,i=this.callback;(t=this.name,s=this.desc,n=this.isPublic,l.a.post("/ajax/spec/create-spec",{name:t,desc:s,isPublic:n}).fail(b)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,s,n,i,o=this.callback;(t=this.spec.id,s=this.name,n=this.desc,i=this.isPublic,l.a.post("/ajax/spec/save-spec",{specId:t,name:s,desc:n,isPublic:i}).fail(b)).then((function(t){o(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSpec:function(){var e=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.spec.id,l.a.post("/ajax/spec/delete-spec",{specId:t}).fail(b)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"index"})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},F=(s(25),P(M,x,[],!1,null,null,null));F.options.__file="src/spec/edit-spec-modal.vue";var D=F.exports,A={components:{Moment:T,EditSpecModal:D},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(e,t,s){this.reloadSpecs(),s()},methods:{reloadSpecs:function(){var e=this;this.loading=!0,l.a.get("/ajax/home").then((function(t){e.userSpecs=t.userSpecs,e.publicSpecs=t.publicSpecs,e.loading=!1})).fail((function(t){e.loading=!1,b(t)}))},promptCreateSpec:function(){var e=this;this.$refs.editSpecModal.showCreate((function(t){e.$router.push({name:"spec",params:{specId:t}})}))}}},L=(s(26),P(A,y,[],!1,null,null,null));L.options.__file="src/pages/index.vue";var z=L.exports,V=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.spec?s("section",{staticClass:"spec-page"},[s("header",[s("div",{staticClass:"right"},[e.currentUserOwns?s("span",[e._v("You own this")]):s("span",[e._v("\n\t\t\t\tOwned by\n\t\t\t\t"),e.spec.username?[e._v(e._s(e.spec.username))]:[e._v(e._s(e.spec.ownerType)+" "+e._s(e.spec.ownerId))]],2),e._v(" "),e.enableEditing?[e.spec.public?s("span",[e._v("\n\t\t\t\t\tPublic\n\t\t\t\t")]):s("span",[s("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[s("i",{staticClass:"el-icon-lock"})])],1),e._v(" "),s("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSpec()}}})]:s("span",[e._v("\n\t\t\t\tLast modified "),s("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)],2),e._v(" "),s("h2",[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()]),e._v(" "),s("spec-view",{key:e.spec.id,attrs:{spec:e.spec,"enable-editing":e.enableEditing}}),e._v(" "),e.enableEditing?s("edit-spec-modal",{ref:"editSpecModal"}):e._e()],1):e._e()};V._withStripped=!0;var N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.spec||e.subspec?s("div",{staticClass:"spec-view"},[s("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:e.dragging}}),e._v(" "),e.enableEditing?[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.promptAddBlock()}}},[e._v("Add block")]),e._v(" "),s("ul",{ref:"mirrorList",staticClass:"mirror-list"}),e._v(" "),s("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId},on:{"open-edit-url":e.openEditUrl,"play-video":e.playVideo}}),e._v(" "),s("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":e.specId}})]:e._e(),e._v(" "),s("play-video-modal",{ref:"playVideoModal"})],2):e._e()};N._withStripped=!0;var W=s(22),Y=s.n(W),q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"spec-block",class:e.classes,attrs:{"data-spec-block":e.block.id}},[s("div",{staticClass:"content",class:{"mobile-adjust":e.showActions}},[s("div",{staticClass:"bg"}),e._v(" "),s("div",{staticClass:"layover",on:{mouseleave:function(t){return e.mouseLeaveLayover()}}},[e.enableEditing?[s("div",{staticClass:"expand-control",class:{hide:e.showActions}},[e.unreadSubmissionsCount?s("el-button",{attrs:{type:e.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t"+e._s(e.submissionsCount)+"\n\t\t\t\t\t")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(t){e.focusActions=!0}}})],1),e._v(" "),s("div",{staticClass:"actions",class:{show:e.showActions}},[e.choosingAddPosition?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelChooseAddPosition()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.addBeforeThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.addIntoThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.addAfterThis()}}})]:e.movingThis?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.cancelMoving()}}},[e._v("Cancel move")])]:e.movingAnother?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelMoving()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.moveBeforeThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.moveIntoThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.moveAfterThis()}}})]:[s("el-button",{attrs:{type:e.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.submissionsCount)+"\n\t\t\t\t\t\t")]),e._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editBlock()}}}),e._v(" "),s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDeleteBlock()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.enterChooseAddPosition()}}}),e._v(" "),s("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(t){return e.startMoving()}}}),e._v(" "),s("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(t){return e.startMoving()}}})]],2)]:s("div",{staticClass:"visitor-actions"},[s("el-button",{attrs:{type:e.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t"+e._s(e.submissionsCount)+"\n\t\t\t\t")])],1)],2),e._v(" "),e.hasTitle?s("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.hasRefItem?[e.refType===e.REF_TYPE_URL?s("ref-url",{staticClass:"ref-item",attrs:{item:e.refItem},on:{play:function(t){return e.raisePlayVideo(e.refItem)}}}):e.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec",{staticClass:"ref-item",attrs:{item:e.refItem}}):e._e()]:e.refItemMissing?s("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?s("div",{staticClass:"body"},[e._v(e._s(e.body))]):e._e()],2),e._v(" "),s("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:e.movingThis}})])};q._withStripped=!0;var H=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-url"},[e.item.imageData?s("img",{attrs:{src:e.item.imageData}}):e._e(),e._v(" "),s("div",[e.showEdit||e.showPlay?s("div",{staticClass:"right"},[e.showEdit?s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.$emit("edit")}}}):e._e(),e._v(" "),e.showPlay?s("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$emit("play")}}},[e._v("Play")]):e._e()],1):e._e(),e._v(" "),s("div",{staticClass:"title"},[e._m(0),e._v(" "),s("a",{attrs:{href:e.item.url,target:"_blank"}},[e._v(e._s(e.item.title&&e.item.title.trim()||e.item.url))])]),e._v(" "),e.item.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};H._withStripped=!0;var G={props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return k(this.item.url)}}},X=(s(27),P(G,H,[function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("i",{staticClass:"el-icon-link"}),this._v(" URL")])}],!1,null,null,null));X.options.__file="src/spec/ref-url.vue";var Z=X.exports,Q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-subspec"},[s("div",[s("div",{staticClass:"title"},[e._m(0),e._v(" "),s("router-link",{attrs:{to:{name:"subspec",params:{specId:e.item.specId,subspecId:e.item.id}}}},[e._v("\n\t\t\t\t"+e._s(e.item.name.trim())+"\n\t\t\t")])],1),e._v(" "),e.item.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};Q._withStripped=!0;var J={props:{item:Object}},K=(s(28),P(J,Q,[function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("i",{staticClass:"el-icon-s-unfold"}),this._v(" Subspec")])}],!1,null,null,null));K.options.__file="src/spec/ref-subspec.vue";var ee=K.exports;function te(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var se={components:{RefUrl:Z,RefSubspec:ee},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!(!this.body||!this.body.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},classes:function(){var e;return te(e={},this.styleType,!0),te(e,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),te(e,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),e},movingThis:function(){return this.$store.state.moving===this.block.id},movingAnother:function(){return this.$store.state.moving&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother},unreadSubmissionsCount:function(){return 0},submissionsCount:function(){return 0}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var e=l()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId:function(){var e=l()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock:function(){var e=this;this.raiseOpenEdit({id:this.block.id,created:this.block.created,updated:this.updated,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(t){e.updated=t.updated,e.styleType=t.styleType,e.contentType=t.contentType,e.refType=t.refType,e.refId=t.refId,e.refItem=t.refItem,e.title=t.title,e.body=t.body}))},raiseOpenEdit:function(e,t){this.$emit("open-edit",e,t)},promptDeleteBlock:function(){var e=this;this.raisePromptDeleteBlock(this.block.id,(function(){l()(e.$el).remove()}))},raisePromptDeleteBlock:function(e,t){this.$emit("prompt-delete-block",e,t)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t)},addIntoThis:function(){var e=this.block.id;this.raisePromptAddSubblock(e,null)},addAfterThis:function(){var e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t)},raisePromptAddSubblock:function(e,t){this.$emit("prompt-add-subblock",e,t)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},moveBeforeThis:function(){var e=this,t=this.$store.state.moving,s=this.getParentId(),n=this.block.id;B(t,this.subspecId,s,n).then((function(){var s=l()('[data-spec-block="'+t+'"]'),n=s.closest(".spec-block-list").closest("[data-spec-block]");s.insertBefore(e.$el),n.length&&n.data("vc").updateHasSubblocks(),e.$store.commit("endMoving")}))},moveIntoThis:function(){var e=this,t=this.$store.state.moving,s=this.block.id;B(t,this.subspecId,s,null).then((function(){var s=l()('[data-spec-block="'+t+'"]'),n=s.closest(".spec-block-list").closest("[data-spec-block]");s.appendTo(e.$refs.sublist),n.length&&n.data("vc").updateHasSubblocks(),e.updateHasSubblocks(),e.$store.commit("endMoving")}))},moveAfterThis:function(){var e=this,t=this.$store.state.moving,s=this.getParentId(),n=this.getFollowingBlockId();B(t,this.subspecId,s,n).then((function(){var s=l()('[data-spec-block="'+t+'"]'),n=s.closest(".spec-block-list").closest("[data-spec-block]");s.insertAfter(e.$el),n.length&&n.data("vc").updateHasSubblocks(),e.$store.commit("endMoving")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(e){"url"===this.refType&&e.id===this.refId&&(this.refItem=e)},urlDeleted:function(e){"url"===this.refType&&e===this.refId&&(this.refItem=null)},raisePlayVideo:function(e){this.$emit("play-video",e)},openCommunity:function(){this.$alert("Unimplemented")},updateHasSubblocks:function(){this.hasSubblocks=this.$refs.sublist.childElementCount>0}}},ne=(s(29),P(se,q,[],!1,null,null,null));ne.options.__file="src/spec/block.vue";var ie=ne.exports,oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:e.block?"Edit block":"Add block",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.block?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.block.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.block.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("el-radio-group",{model:{value:e.styleType,callback:function(t){e.styleType=t},expression:"styleType"}},[s("el-radio",{attrs:{label:"bullet"}},[e._v("Bullet point")]),e._v(" "),s("el-radio",{attrs:{label:"numbered"}},[e._v("Numbered point")]),e._v(" "),s("el-radio",{attrs:{label:"none"}},[e._v("Indented block")])],1),e._v(" "),s("label",[e._v("\n\t\tTitle\n\t\t"),s("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),s("label",[e._v("\n\t\tBody\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),s("el-radio-group",{model:{value:e.refType,callback:function(t){e.refType=t},expression:"refType"}},[s("el-radio",{attrs:{label:null}},[e._v("No media")]),e._v(" "),s("el-radio",{attrs:{label:e.REF_TYPE_SUBSPEC}},[e._v("Subspec")]),e._v(" "),s("el-radio",{attrs:{label:e.REF_TYPE_URL}},[e._v("URL")])],1),e._v(" "),e.refType===e.REF_TYPE_URL?s("ref-url-form",{attrs:{"spec-id":e.specId,"initial-url-object":e.existingUrlRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t},"open-edit-url":e.openEditUrl,"play-video":e.raisePlayVideo}}):e.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec-form",{attrs:{"spec-id":e.specId,"initial-subspec":e.existingSubspecRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t}}}):e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v("\n\t\t\t"+e._s(e.block?"Save":"Add")+"\n\t\t")])],1)],1)};oe._withStripped=!0;var re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-url-form"},[e.creating?s("el-card",[s("label",[e._v("\n\t\t\tNew link URL\n\t\t\t"),s("el-input",{attrs:{clearable:""},model:{value:e.newUrl,callback:function(t){e.newUrl=t},expression:"newUrl"}}),e._v(" "),e.newUrl&&!e.isValid?s("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):e.newUrlIsVideo?s("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):e._e()],1),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!0}}},[e._v("\n\t\t\tSelect an existing link\n\t\t")]):e._e(),e._v(" "),e.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?s("p",[e._v("Loading links...")]):e.urlObjects&&e.urlObjects.length?[s("el-select",{attrs:{filterable:"","filter-method":e.filterUrls,placeholder:"Select link"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.filteredUrlObjects,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.title||e.url}})})),1),e._v(" "),e.selectedUrlObject?s("ref-url",{attrs:{item:e.selectedUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.selectedUrlObject)},play:function(t){return e.raisePlayVideo(e.selectedUrlObject)}}}):e._e()]:e._e(),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new link\n\t\t")]),e._v(" "),e.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()]:[e.initialUrlObject?s("ref-url",{attrs:{item:e.initialUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.initialUrlObject)},play:function(t){return e.raisePlayVideo(e.initialUrlObject)}}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new link\n\t\t\t")]),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):e._e()],1)]],2)};re._withStripped=!0;var le={components:{RefUrl:Z},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var e=this.filter.toLowerCase(),t=[],s=0;s<this.urlObjects.length;s++){var n=this.urlObjects[s];(n.url.toLowerCase().indexOf(e)>=0||n.title&&n.title.toLowerCase().indexOf(e)>=0)&&t.push(n)}return t}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.refId)return this.urlObjects[e];return null},newUrlIsVideo:function(){return _(this.newUrl)&&k(this.newUrl)},isValid:function(){return this.creating?_(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadLinks()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadLinks:function(){var e,t=this;this.urlObjects||this.loading||(this.loading=!0,(e=this.specId,l.a.get("/ajax/spec/urls",{specId:e}).fail(b)).then((function(e){t.urlObjects=e,e.length||(t.selecting=!1,t.initialUrlObject||(t.creating=!0)),t.loading=!1})).fail((function(){t.urlObjects=[],t.selecting=!1,t.initialUrlObject||(t.creating=!0),t.loading=!1})))},filterUrls:function(e){var t=this;e?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function n(){t=null,e.apply(this,arguments)}return function(){return t&&clearTimeout(t),t=setTimeout(n.bind.apply(n,[this].concat(Array.prototype.slice.call(arguments))),s)}}((function(e){t.filter=e}))),this.debouncedUpdateFilter(e)):this.filter=""},openEditUrl:function(e){var t=this;this.$emit("open-edit-url",e,(function(s){if(t.urlObjects)for(var n=0;n<t.urlObjects.length;n++)if(t.urlObjects[n].id===e.id){t.urlObjects.splice(n,1,s);break}}),(function(){if(t.urlObjects)for(var s=0;s<t.urlObjects.length;s++)if(t.urlObjects[s].id===e.id){t.urlObjects.splice(s,1);break}t.refId===e.id&&(t.refId=null)}))},raisePlayVideo:function(e){this.$emit("play-video",e)}}},ce=(s(30),P(le,re,[],!1,null,null,null));ce.options.__file="src/spec/ref-url-form.vue";var ae=ce.exports,ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-subspec-form"},[e.creating?s("el-card",[s("label",[e._v("\n\t\t\tNew subspec name\n\t\t\t"),s("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:e.subspecName,callback:function(t){e.subspecName=t},expression:"subspecName"}})],1),e._v(" "),s("label",[e._v("\n\t\t\tDescription\n\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.subspecDesc,callback:function(t){e.subspecDesc=t},expression:"subspecDesc"}})],1),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?s("p",[e._v("Loading subspecs...")]):e.subspecs&&e.subspecs.length?[s("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.subspecs,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?s("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:e._e(),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new subspec\n\t\t")])]:[e.initialSubspec?s("ref-subspec",{attrs:{item:e.initialSubspec}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):e._e()],1)]],2)};ue._withStripped=!0;var de={components:{RefSubspec:ee},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.refId)return this.subspecs[e];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadSubspecs:function(){var e,t=this;this.loading||(this.loading=!0,(e=this.specId,l.a.get("/ajax/spec/subspecs",{specId:e}).fail(b)).then((function(e){t.subspecs=e,e.length||(t.creating=!0),t.loading=!1})).fail((function(){t.subspecs=[],t.creating=!0,t.loading=!1})))}}},pe=(s(31),P(de,ue,[],!1,null,null,null));pe.options.__file="src/spec/ref-subspec-form.vue";var fe={components:{Moment:T,RefUrlForm:ae,RefSubspecForm:pe.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&"url"===this.block.refType&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&"subspec"===this.block.refType&&this.block.refItem||null}},watch:{refType:function(e){this.refFields=null}},methods:{showAdd:function(e,t,s){this.parentId=e,this.insertBeforeId=t,this.callback=s,this.showing=!0,this.focusTitleInput()},showEdit:function(e,t){this.block=e,this.styleType=e.styleType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var e=this;this.$nextTick((function(){l()("input",e.$refs.titleInput.$el).focus()}))},openEditUrl:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(function(e){t.existingUrlRefItem&&e.id===t.existingUrlRefItem.id&&(t.block.refItem=e),s&&s(e)}),(function(e){t.existingUrlRefItem&&e===t.existingUrlRefItem.id&&(t.block.refType=null,t.block.refId=null,t.block.refItem=null),n&&n(e)}))},raisePlayVideo:function(e){this.$emit("play-video",e)},submit:function(){var e=this;if(!this.disableSubmit){var t,s,n,i,o,r,c,a,u=this.createSendingSpinner(),d=this.callback;this.block?(t=this.specId,s=this.block.id,n=this.styleType,i="plaintext",o=this.title,r=this.body,c=this.refType,a=this.refFields,a=a||{},l.a.post("/ajax/spec/save-block",O({specId:t,blockId:s,styleType:n,contentType:i,title:o,body:r,refType:c},a)).fail(b)).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()})):function(e,t,s,n,i,o,r,c,a,u){return u=u||{},l.a.post("/ajax/spec/create-block",O({specId:e,subspecId:t,parentId:s,insertBeforeId:n,styleType:i,contentType:o,title:r,body:c,refType:a},u)).fail(b)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,"plaintext",this.title,this.body,this.refType,this.refFields).then((function(t){d(t),e.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},he=(s(32),P(fe,oe,[],!1,null,null,null));he.options.__file="src/spec/edit-block-modal.vue";var me=he.exports,be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:e.urlObject?"Manage link":"Create link",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.urlObject?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.urlObject.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.urlObject.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tURL\n\t\t"),s("el-input",{ref:"urlInput",model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1),e._v(" "),e.urlObject?[e.url===e.urlObject.url?s("div",{staticClass:"preview"},[e.urlObject.imageData?s("img",{attrs:{src:e.urlObject.imageData}}):e._e(),e._v(" "),s("div",[e.urlObject.title?s("h3",[e._v(e._s(e.urlObject.title.trim()))]):e._e(),e._v(" "),e.urlObject.desc?s("div",[e._v(e._s(e.urlObject.desc.trim()))]):e._e(),e._v(" "),e.autoRefresh?s("p",[e._v("URL preview will be updated")]):s("el-checkbox",{model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}},[e._v("Refresh URL preview")])],1)]):s("p",[e._v("Link will be updated with new URL")])]:e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.urlObject?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.urlObject?"Save":"Create"))])],1)],2)};be._withStripped=!0;var ve={components:{Moment:T},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=_,!_(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(e){var t=this;this.createdCallback=e,this.showing=!0,this.$nextTick((function(){l()("input",t.$refs.urlInput.$el).focus()}))},showEdit:function(e,t,s){var n=this;this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=s,this.showing=!0,this.$nextTick((function(){l()("input",n.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n=this.createdCallback;(t=this.specId,s=this.url,l.a.post("/ajax/spec/create-url",{specId:t,url:s}).fail(b)).then((function(t){n(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n=this.updatedCallback;(t=this.urlObject.id,s=this.url,l.a.post("/ajax/spec/refresh-url",{id:t,url:s}).fail(b)).then((function(t){n(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},promptDelete:function(){var e=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){e.sending=!0;var t,s=e.deletedCallback;(t=e.urlObject.id,l.a.post("/ajax/spec/delete-url",{id:t}).fail(b)).then((function(){s&&s(e.urlObject.id),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},ge=(s(33),P(ve,be,[],!1,null,null,null));ge.options.__file="src/spec/edit-url-modal.vue";var _e=ge.exports,we=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"play-video-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogSmallWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.vid?s("div",{staticClass:"embed-responsive"},["youtube"===e.vid.type?s("iframe",{attrs:{src:"https://www.youtube.com/embed/"+e.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===e.vid.type?s("iframe",{attrs:{src:"https://player.vimeo.com/video/"+e.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):e._e()]):e._e()])};we._withStripped=!0;var ke={data:function(){return{vid:null,showing:!1}},methods:{show:function(e){var t,s,n=(t=e.url,(s=w.exec(t))?t.indexOf("youtube.com")||t.indexOf("youtu.be")?{type:"youtube",id:s[1]}:t.indexOf("vimeo.com")?{type:"vimeo",id:s[1]}:null:null);n&&(this.vid=n,this.showing=!0)},closed:function(){this.vid=null}}},ye=(s(34),P(ke,we,[],!1,null,null,null));ye.options.__file="src/spec/play-video-modal.vue";var Se=ye.exports,Ie=i.a.extend(ie),Ce={components:{EditBlockModal:me,EditUrlModal:_e,PlayVideoModal:Se},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new i.a}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null}},watch:{dragging:function(e){e?this.autoscroller=function(){var e=l()(window),t=null,s=null;function n(e){s=e.clientY}return e.on("mousemove",n),t=window.requestAnimationFrame((function n(){if(null!==s){var i=e.height(),o=0;if(s<70)o=-(8*((70-s)/70)+1);else if(s>i-70){o=8*((s-(i-70))/70)+1}0!==o&&e.scrollTop(e.scrollTop()+o)}t=window.requestAnimationFrame(n)})),{stop:function(){e.off("mousemove",n),t&&(window.cancelAnimationFrame(t),t=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var e,t=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var s=function e(s,n){for(var i=0;i<n.length;i++){var o=n[i],r=t.insertBlock(o,!1);l()(">ul.spec-block-list",s).append(r),o.subblocks&&e(r,o.subblocks)}},n=0;n<e.length;n++){var i=e[n],o=this.insertBlock(i);i.subblocks&&s(o,i.subblocks)}this.enableEditing&&(this.drake=Y()({isContainer:function(e){return l()(e).is(".spec-block-list")},accepts:function(e,t,s,n){return!l()(t).closest(".gu-transit").length},moves:function(e,t,s,n){return l()(s).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(e,s){t.$store.commit("startDragging"),t.transitRelativeScroll(l()(e).attr("data-spec-block"))})).on("dragend",(function(e){t.$store.commit("endDragging"),t.transitRelativeScroll(l()(e).attr("data-spec-block"))})).on("drop",(function(e,s,n,i){var o=l()(n).closest("[data-spec-block]");o.length&&o.data("vc").updateHasSubblocks();var r=null,c=l()(s).closest("[data-spec-block]");if(c.length){var a=c.data("vc");r=a.getBlockId(),a.updateHasSubblocks()}var u=i?l()(i).data("vc").getBlockId():null;B(l()(e).data("vc").getBlockId(),t.subspecId,r,u)})))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,l()("[data-spec-block]",this.$refs.list).each((function(e,t){l()(t).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var e=this,t=l()(window).scrollTop();l()("[data-spec-block]",this.$refs.list).each((function(s,n){var i=l()(n).offset();if(i.top>t){var o=i.top-t;return e.$nextTick((function(){l()(window).scrollTop(l()(n).offset().top-o)})),!1}}))},transitRelativeScroll:function(e){var t=l()(window).scrollTop(),s=l()('[data-spec-block="'+e+'"]',this.$refs.list),n=s.offset().top-t;this.$nextTick((function(){l()(window).scrollTop(s.offset().top-n)}))},insertBlock:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=new Ie({parent:this,store:p,router:qe,propsData:{block:e,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing}}).$mount();s.$on("open-edit",this.openEdit),s.$on("prompt-add-subblock",this.promptAddSubblock),s.$on("prompt-delete-block",this.promptDeleteBlock),s.$on("start-moving",this.startMovingBlock),s.$on("end-moving",this.endMovingBlock),s.$on("play-video",this.playVideo);var n=l()(s.$el).data("vc",s);return t&&n.appendTo(this.$refs.list),n},promptAddBlock:function(){this.$refs.editBlockModal.showAdd(null,null,this.insertBlock)},openEdit:function(e,t){this.$refs.editBlockModal.showEdit(e,t)},promptAddSubblock:function(e,t){var s=this;this.$refs.editBlockModal.showAdd(e,t,(function(n){var i=s.insertBlock(n,!1);t?i.insertBefore('[data-spec-block="'+t+'"]'):e?i.appendTo('[data-spec-block="'+e+'"]>ul.spec-block-list'):i.appendTo(s.$refs.list)}))},promptDeleteBlock:function(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(e){return l.a.post("/ajax/spec/delete-block",{blockId:e}).fail(b)})(e).then(t)})).catch((function(){}))},startMovingBlock:function(e){this.$store.commit("startMoving",e),this.transitRelativeScroll(e)},endMovingBlock:function(e){this.$store.commit("endMoving"),this.transitRelativeScroll(e)},openEditUrl:function(e,t,s){var n=this;this.$refs.editUrlModal.showEdit(e,(function(e){n.eventBus.$emit("url-updated",e),t&&t(e)}),(function(e){n.eventBus.$emit("url-deleted",e),s&&s(e)}))},playVideo:function(e){this.$refs.playVideoModal.show(e)}}},Pe=(s(35),P(Ce,N,[],!1,null,null,null));Pe.options.__file="src/spec/view.vue";var $e=Pe.exports,Te={components:{Moment:T,SpecView:$e,EditSpecModal:D},data:function(){return{spec:null}},computed:{currentUserOwns:function(){return"user"===this.spec.ownerType&&this.$store.getters.userID===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(e,t,s){U(e.params.specId).then((function(e){s((function(t){t.setSpec(e)}))})).fail((function(t){s({name:"ajax-error",params:{code:t.status},query:{url:encodeURIComponent(e.fullPath)},replace:!0})}))},beforeRouteUpdate:function(e,t,s){var n=this;U(e.params.specId).then((function(e){n.setSpec(e),s()})).fail((function(t){s({name:"ajax-error",params:{code:t.status},query:{url:encodeURIComponent(e.fullPath)},replace:!0})}))},beforeRouteLeave:function(e,t,s){g(),s()},methods:{setSpec:function(e){this.spec=e,g(e.name),this.$nextTick(this.restoreScroll)},openManageSpec:function(){var e=this;this.$refs.editSpecModal.showEdit(this.spec,(function(t){e.spec.updated=t.updated,e.spec.name=t.name,e.spec.desc=t.desc,e.spec.public=t.public,g(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e?l()(window).scrollTop(e.y).scrollLeft(e.x):v(this.$store.state.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&l()(window).scrollTop(this.$store.state.currentSpecScrollTop)}}},xe=(s(36),P(Te,V,[],!1,null,null,null));xe.options.__file="src/pages/spec.vue";var je=xe.exports,Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.subspec?s("section",{staticClass:"subspec-page"},[s("header",[s("div",{staticClass:"spec",on:{click:function(t){return e.gotoSpec()}}},[s("h2",[e._v("\n\t\t\t\t"+e._s(e.subspec.specName)+"\n\t\t\t")])]),e._v(" "),s("div",{staticClass:"subspec"},[s("div",{staticClass:"right"},[e.enableEditing?s("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSubspec()}}}):s("span",[e._v("\n\t\t\t\t\tLast modified "),s("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)],1),e._v(" "),s("h3",[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()])]),e._v(" "),s("spec-view",{key:e.subspec.id,attrs:{subspec:e.subspec,"enable-editing":e.enableEditing}}),e._v(" "),e.enableEditing?s("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":e.subspec.specId}}):e._e()],1):e._e()};Oe._withStripped=!0;var Ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:e.subspec?"Manage subspec":"Create subspec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.subspec?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.subspec.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("label",[e._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.subspec?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSubspec()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.subspec?"Save":"Create"))])],1)])};Ee._withStripped=!0;var Ue={components:{Moment:T},props:{specId:{type:Number,required:!0}},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){l()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var s=this;this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((function(){l()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,s,n,i=this.callback;(t=this.specId,s=this.name,n=this.desc,l.a.post("/ajax/spec/create-subspec",{specId:t,name:s,desc:n}).fail(b)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,s,n,i=this.callback;(t=this.subspec.id,s=this.name,n=this.desc,l.a.post("/ajax/spec/save-subspec",{subspecId:t,name:s,desc:n}).fail(b)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSubspec:function(){var e=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.subspec.id,l.a.post("/ajax/spec/delete-subspec",{subspecId:t}).fail(b)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"spec",params:{specId:e.specId}})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},Re=(s(37),P(Ue,Ee,[],!1,null,null,null));Re.options.__file="src/spec/edit-subspec-modal.vue";var Be={components:{Moment:T,SpecView:$e,EditSubspecModal:Re.exports},data:function(){return{subspec:null}},computed:{currentUserOwns:function(){return"user"===this.subspec.ownerType&&this.$store.getters.userID===this.subspec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(e,t,s){R(e.params.specId,e.params.subspecId).then((function(e){s((function(t){t.setSubspec(e)}))})).fail((function(t){s({name:"ajax-error",params:{code:t.status},query:{url:encodeURIComponent(e.fullPath)},replace:!0})}))},beforeRouteUpdate:function(e,t,s){var n=this;R(e.params.specId,e.params.subspecId).then((function(e){n.setSubspec(e),s(),n.$nextTick(n.restoreScroll)})).fail((function(t){s({name:"ajax-error",params:{code:t.status},query:{url:encodeURIComponent(e.fullPath)},replace:!0})}))},beforeRouteLeave:function(e,t,s){g(),s()},methods:{setSubspec:function(e){this.subspec=e,g(e.name),this.$nextTick(this.restoreScroll)},gotoSpec:function(){this.$router.push({name:"spec",params:{specId:this.subspec.specId}})},openManageSubspec:function(){var e=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(t){e.subspec.updated=t.updated,e.subspec.name=t.name,e.subspec.desc=t.desc,g(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e&&l()(window).scrollTop(e.y).scrollLeft(e.x)}}},Me=(s(38),P(Be,Oe,[],!1,null,null,null));Me.options.__file="src/pages/subspec.vue";var Fe=Me.exports,De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ajax-error-page"},[0===parseInt(e.$route.params.code,10)?s("p",[e._v("\n\t\tCould not connect to server\n\t")]):s("p",[e._v("\n\t\tRequest failed with error code "+e._s(e.$route.params.code)+"\n\t")]),e._v(" "),e.url?s("el-button",{on:{click:function(t){return e.retry()}}},[e._v("Retry")]):e._e()],1)};De._withStripped=!0;var Ae={computed:{url:function(){return decodeURIComponent(this.$route.query.url)}},methods:{retry:function(){this.$router.replace(this.url)}}},Le=(s(39),P(Ae,De,[],!1,null,null,null));Le.options.__file="src/pages/ajax-error.vue";var ze=Le.exports,Ve=function(){var e=this.$createElement;return(this._self._c||e)("div",[this._v("\n\tNot found\n")])};Ve._withStripped=!0;var Ne=P({},Ve,[],!1,null,null,null);Ne.options.__file="src/pages/not-found.vue";var We=Ne.exports,Ye=new h.a({mode:"history",routes:[{name:"index",path:"/",component:z},{name:"spec",path:"/spec/:specId",component:je},{name:"subspec",path:"/spec/:specId/subspec/:subspecId",component:Fe},{name:"ajax-error",path:"/ajax-error/:code",component:ze},{path:"*",component:We}],scrollBehavior:function(e,t,s){return p.commit("setSavedScrollPosition",s),e.hash?{selector:e.hash}:s||{x:0,y:0}}});Ye.beforeEach((function(e,t,s){t&&(!p.state.currentSpecId||e.params.specId&&v(e.params.specId,p.state.currentSpecId)?"spec"===t.name&&p.commit("saveCurrentSpecScrollTop",t.params.specId):p.commit("clearCurrentSpec")),s()})),Ye.afterEach((function(e,t){p.commit("clearSavedScrollPosition")}));var qe=Ye,He=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"edit-profile-modal",attrs:{title:"Your username is "+e.username,visible:e.showing,width:e.$store.getters.dialogTinyWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.clearMode()}}},[e.changePasswordMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],ref:"changePasswordForm",attrs:{model:e.changePasswordForm,rules:e.changePasswordRules,"label-position":"top"}},[s("el-form-item",{attrs:{label:"Current password",prop:"oldPass"}},[s("el-input",{ref:"oldPass",attrs:{type:"password",name:"old_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.oldPass)}},model:{value:e.changePasswordForm.oldPass,callback:function(t){e.$set(e.changePasswordForm,"oldPass",t)},expression:"changePasswordForm.oldPass"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[s("el-input",{ref:"newPass",attrs:{type:"password",name:"new_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass)}},model:{value:e.changePasswordForm.newPass,callback:function(t){e.$set(e.changePasswordForm,"newPass",t)},expression:"changePasswordForm.newPass"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[s("el-input",{ref:"newPass2",attrs:{type:"password",name:"verify_password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass2)}},model:{value:e.changePasswordForm.newPass2,callback:function(t){e.$set(e.changePasswordForm,"newPass2",t)},expression:"changePasswordForm.newPass2"}})],1),e._v(" "),s("el-form-item",[s("el-alert",{attrs:{type:"info",closable:!1}},[s("p",[e._v("Your password is sent through HTTPS to Google Cloud Platform in Montréal and encrypted server-side using "),s("a",{attrs:{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"}},[e._v("bcrypt")]),e._v(".")]),e._v(" "),s("p",[e._v("Please use a good password so your account is less likely to be hijacked and used to cause trouble.")]),e._v(" "),s("p",[e._v("\n\t\t\t\t\tFor your security, you should not use the same passwords that you use for important services such as email and online banking on other websites.\n\t\t\t\t\tIf one website gets hacked, you can lose access to every other site where you use the same password.\n\t\t\t\t\tThe best setup is to use a password manager with two-factor authentication and distinct long random passwords for every important service.\n\t\t\t\t")])])],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitChangePassword()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):s("el-button",{staticClass:"change-password",on:{click:function(t){return e.enterChangePasswordMode()}}},[e._v("\n\t\tChange password\n\t")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],1)};He._withStripped=!0;var Ge={data:function(){return{showing:!1,mode:null,changePasswordForm:{oldPass:"",newPass:"",newPass2:""},sending:!1}},computed:{userID:function(){return this.$store.getters.userID},username:function(){return this.$store.getters.username},changePasswordMode:function(){return 1===this.mode},changePasswordRules:function(){var e=this;return{oldPass:[{validator:function(e,t,s){t.trim()?s():s(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:function(t,s,n){s.trim().length<5?n(new Error("Password minimum length is 5 digits")):(e.changePasswordForm.newPass2.trim()&&e.$refs.changePasswordForm.validateField("newPass2"),n())},trigger:"blur"}],newPass2:[{validator:function(t,s,n){s.trim()?s!==e.changePasswordForm.newPass?n(new Error("Passwords do not match")):n():n(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show:function(){this.showing=!0},enterChangePasswordMode:function(){this.mode=1,this.selectOldPassword()},handleChangePasswordReturn:function(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():l()("input",this.$refs.newPass2.$el).focus().select():l()("input",this.$refs.newPass.$el).focus().select():l()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword:function(){var e=this;this.$refs.changePasswordForm.validate((function(t){t&&(e.sending=!0,l.a.post("/ajax/user/change-password",{old:e.changePasswordForm.oldPass,new:e.changePasswordForm.newPass,new2:e.changePasswordForm.newPass2}).then((function(){e.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),e.clearMode()})).fail((function(t){if(t&&t.readyState)switch(t.status){case 400:e.$message({message:"New password rejected",type:"error",showClose:!0,duration:4e3});break;case 403:e.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:4e3}),e.selectOldPassword();break;default:b(t)}else b(t)})).always((function(){e.sending=!1})))}))},selectOldPassword:function(){var e=this;this.$nextTick((function(){e.$refs.oldPass&&l()("input",e.$refs.oldPass.$el).focus().select()}))},clearMode:function(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},Xe=(s(40),P(Ge,He,[],!1,null,null,null));Xe.options.__file="src/widgets/edit-profile-modal.vue";var Ze=Xe.exports,Qe={store:p,router:qe,components:{EditProfileModal:Ze},computed:{username:function(){return this.$store.getters.username}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"},openEditProfile:function(){this.$refs.editProfileModal.show()}}},Je=(s(41),P(Qe,o,[],!1,null,null,null));Je.options.__file="src/app.vue";var Ke=Je.exports;ELEMENT.locale(ELEMENT.lang.en),new i.a(Ke).$mount("#app")}]);