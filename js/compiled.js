(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=Vue;var n=e.n(t),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app"},[n("header",[n("h1",{on:{click:function(t){return e.gotoIndex()}}},[e._v("CrowdSpec")]),e._v(" "),n("div",[n("el-button",{staticClass:"username-button",attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openEditProfile()}}},[n("username",{attrs:{username:e.username,highlight:e.highlight}})],1),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.logout()}}},[e._v("Log out")])],1)]),e._v(" "),n("router-view",{staticClass:"page-area"}),e._v(" "),n("edit-profile-modal",{ref:"editProfileModal"})],1)};s._withStripped=!0;const i=jQuery;var o=e.n(i);const r=Vuex;var a=e.n(r);const c=moment;var l=e.n(c),u=/^VersionStamp: (.+)$/m;function d(e){console.error(e);var t=null;e&&(0===e.readyState?t="Could not connect to server.":e.readyState&&e.status?t=503===e.status?"CrowdSpec is currently offline for database upgrades. Please try again in a bit.":"Request failed with HTTP error code "+e.status+".":e.message?t=e.message:"string"==typeof e&&(t=e)),t||(t="An error occurred."),e&&e.responseText&&u.test(e.responseText)&&u.exec(e.responseText)[1]!==window.const.appVersion&&(t+=" (A new version is available. Reload this page to use the latest client code.)"),n().prototype.$alert(t,"Error",{confirmButtonText:"Ok",type:"error"})}function p(e,t){return null===e&&null===t||parseInt(e,10)===parseInt(t,10)}function m(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function s(){t=null,e.apply(this,arguments)}return function(){return t&&clearTimeout(t),t=setTimeout(s.bind.apply(s,[this].concat(Array.prototype.slice.call(arguments))),n)}}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;document.title="CrowdSpec"+(e?" | "+e:"")}function f(e){if(window.URL)try{return new URL(e),!0}catch(e){return!1}return!(!e||!e.trim())}var v=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function g(e){return v.test(e)}function b(e){if(!e)return"";switch(e){case"url":return"URL"}return e.charAt(0).toUpperCase()+e.slice(1)}var _="spec",y="subspec",w="block",k="comment",C="bullet",S="plaintext",T="markdown",I="url",P="subspec",x="user";n().use(a());var E=o()(window),R=new(a().Store)({state:function(){return{currentTime:Date.now(),windowWidth:E.width(),windowHeight:E.height(),dragging:!1,movingBlockIds:[],movingBlocksSourceSubspecId:null,savedScrollPosition:null,currentSpec:null,currentSpecScrollTop:null,userSettings:window.user.settings}},getters:{currentUserId:function(e){return window.user.id},username:function(e){return window.user.username},emailAddress:function(e){return window.user.email},userSettings:function(e){return o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e.userSettings)},userIsAdmin:function(e){return window.user.admin},mobileViewport:function(e){return e.windowWidth<=767},dialogTinyWidth:function(e){return e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(e){return e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(e){return e.windowWidth<=991?"95%":"90%"},currentlyMovingBlocks:function(e){return e.movingBlockIds.length>0},currentlyMovingBlock:function(e){return function(t){return e.movingBlockIds.indexOf(t)>=0}},currentSpecId:function(e){return e.currentSpec?e.currentSpec.id:null},currentSpecOwnedByUser:function(e,t){return!!e.currentSpec&&e.currentSpec.ownerType===x&&p(e.currentSpec.ownerId,t.currentUserId)}},mutations:{updateWindowDimensions:function(e){e.windowWidth=E.width(),e.windowHeight=E.height()},setUserSettings:function(e,t){e.userSettings=t},startDragging:function(e){e.dragging=!0},endDragging:function(e){e.dragging=!1},setMovingBlocks:function(e,t){e.movingBlocksSourceSubspecId=t.subspecId,e.movingBlockIds=t.blockIds},endMovingBlocks:function(e){e.movingBlocksSourceSubspecId=null,e.movingBlockIds=[]},setSavedScrollPosition:function(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition:function(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpec:function(e,t){console.debug("saveCurrentSpec"),e.currentSpec&&!p(e.currentSpec.id,t.id)&&(console.debug("saveCurrentSpec clear currentSpecScrollTop"),e.currentSpecScrollTop=null),e.currentSpec=t},saveCurrentSpecScrollTop:function(e){console.debug("saveCurrentSpecScrollTop"),e.currentSpecScrollTop=E.scrollTop()},clearCurrentSpec:function(e){e.currentSpec=null,e.currentSpecScrollTop=null},updateCurrentTime:function(e){e.currentTime=Date.now()}}});const O=R;E.on("resize",(function(){R.commit("updateWindowDimensions")})),setTimeout((function e(){R.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const B=VueRouter;var j=e.n(B),U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"index-page"},[n("div",{staticClass:"actions"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.promptCreateSpec()}}},[e._v("\n\t\t\tNew spec\n\t\t")]),e._v(" "),n("el-button",{attrs:{type:"default"},on:{click:function(t){return e.$router.push({name:"community-review"})}}},[e._v("\n\t\t\tCommunity review\n\t\t")]),e._v(" "),e.$store.getters.userIsAdmin?n("el-button",{staticClass:"admin-access",on:{click:function(t){return e.$router.push({name:"admin"})}}},[e._v("\n\t\t\tAdmin\n\t\t")]):e._e()],1),e._v(" "),n("div",{staticClass:"user-specs"},[n("h2",[e._v("Your specs")]),e._v(" "),e.loading?n("p",[e._v("Loading...")]):e.userSpecs&&e.userSpecs.length?n("ul",{staticClass:"specs-list"},e._l(e.userSpecs,(function(t){return n("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[n("div",{staticClass:"info"},[n("span",{staticClass:"status",class:{public:t.public}},[t.public?[n("i",{staticClass:"el-icon-umbrella"}),e._v(" Public")]:[n("i",{staticClass:"el-icon-lock"}),e._v(" Private")]],2)]),e._v(" "),n("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),n("div",{staticClass:"info"},[n("span",{staticClass:"updated"},[e._v("Last modified "),n("strong",[n("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?n("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):n("p",[e._v("You do not have any specs.")])]),e._v(" "),n("div",{staticClass:"public-specs",class:{"adjust-margin":!!e.userSpecs.length}},[n("h2",[e._v("Public specs")]),e._v(" "),e.loading?n("p",[e._v("Loading...")]):e.publicSpecs&&e.publicSpecs.length?n("ul",{staticClass:"specs-list"},e._l(e.publicSpecs,(function(t){return n("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[n("div",{staticClass:"info"},[n("username",{attrs:{username:t.username,highlight:t.highlight}})],1),e._v(" "),n("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),n("div",{staticClass:"info"},[n("span",{staticClass:"updated"},[e._v("Last modified "),n("strong",[n("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?n("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):n("p",[e._v("There are no public specs......")])]),e._v(" "),n("edit-spec-modal",{ref:"editSpecModal"})],1)};U._withStripped=!0;var M=function(){var e=this,t=e.$createElement;return(e._self._c||t)("span",[e._v(e._s(e.output))])};function A(e,t,n,s,i,o,r,a){var c,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=n,l._compiled=!0),s&&(l.functional=!0),o&&(l._scopeId="data-v-"+o),r?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},l._ssrRegister=c):i&&(c=a?function(){i.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(l.functional){l._injectStyles=c;var u=l.render;l.render=function(e,t){return c.call(t),u(e,t)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:l}}M._withStripped=!0;var N=A({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return l().parseZone(this.datetime).local()},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},M,[],!1,null,null,null);N.options.__file="src/widgets/moment.vue";const L=N.exports;var F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"username"},[n("i",{staticClass:"el-icon-user",style:e.style}),e._v(" "),n("span",[e._v(e._s(e.username))])])};function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}F._withStripped=!0;var q=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,z=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,V=/^#[0-9a-f]{6}$/i;function Y(e){if(e&&"object"===D(e)){if(e.hsl)return W(e);if(e.rgb)return e}else if("string"==typeof e){if(q.test(e)){var t=q.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(V.test(e)){function n(e){e=e.toLowerCase();for(var t=0,n=0;n<e.length;n++){var s=e.charCodeAt(e.length-1-n);s>=48&&s<=57?t+=(s-48)*Math.pow(16,n):s>=97&&s<=122&&(t+=(s-97+10)*Math.pow(16,n))}return t}return{r:n(e.substr(1,2)),g:n(e.substr(3,2)),b:n(e.substr(5,2)),rgb:!0}}if(z.test(e))return W(e)}return{r:0,g:0,b:0,rgb:!0}}function H(e){if(e&&"object"===D(e)){if(e.hsl)return e;if(e.rgb)return G(e)}else if("string"==typeof e){if(z.test(e)){var t=z.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(q.test(e)||V.test(e))return G(e)}return{h:0,s:0,l:0,hsl:!0}}function W(e){if(e&&"object"===D(e)&&e.rgb)return e;var t,n,s,i=(e=H(e)).h,o=e.s/100,r=e.l/100,a=(1-Math.abs(2*r-1))*o,c=a*(1-Math.abs(i/60%2-1)),l=r-a/2;return 0<=i&&i<60?(t=a,n=c,s=0):60<=i&&i<120?(t=c,n=a,s=0):120<=i&&i<180?(t=0,n=a,s=c):180<=i&&i<240?(t=0,n=c,s=a):240<=i&&i<300?(t=c,n=0,s=a):300<=i&&i<360&&(t=a,n=0,s=c),{r:Math.round(255*(t+l)),g:Math.round(255*(n+l)),b:Math.round(255*(s+l)),rgb:!0}}function G(e){if(e&&"object"===D(e)&&e.hsl)return e;var t,n=(e=Y(e)).r/255,s=e.g/255,i=e.b/255,o=Math.min(n,s,i),r=Math.max(n,s,i),a=r-o;t=0==a?0:r==n?(s-i)/a%6:r==s?(i-n)/a+2:(n-s)/a+4;var c=(r+o)/2;return{h:(t=Math.round(60*t))<0?t+360:t,s:+(100*(0==a?0:a/(1-Math.abs(2*c-1)))).toFixed(1),l:+(100*c).toFixed(1),hsl:!0}}function X(e){var t=Y(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}var K=A({props:{username:{type:String,required:!0},highlight:String},computed:{style:function(){var e=this.username===this.$store.getters.username?this.$store.getters.userSettings.userProfile.highlightUsername:this.highlight;if(!e)return null;var t,n=X(e),s=X(((t=H(e)).l<=25?t.l=75:t.l<=50?t.l=90:t.l<=75?t.l=10:t.l=25,t));return{color:n,"text-shadow":"-1px -1px 0 "+s+", 1px -1px 0 "+s+", -1px 1px 0 "+s+", 1px 1px 0 "+s}}}},F,[],!1,null,null,null);K.options.__file="src/widgets/username.vue";const J=K.exports;var Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:e.spec?"Manage spec":"Create spec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.spec?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.spec.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("label",[e._v("\n\t\tName\n\t\t"),n("el-input",{ref:"nameInput",attrs:{maxlength:e.nameMaxLength,clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),n("label",[e._v("\n\t\tDescription\n\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),n("el-checkbox",{model:{value:e.isPublic,callback:function(t){e.isPublic=t},expression:"isPublic"}},[e._v("Allow public access and community features")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.spec?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSpec()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.spec?"Save":"Create"))])],1)],1)};function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e,t,n,s){for(var i=0;i<e.length;i++)e[i]=parseInt(e[i],10);return e=JSON.stringify(e),o().post("/ajax/spec/move-blocks",{blockIds:e,subspecId:t,parentId:n,insertBeforeId:s}).fail(d)}function se(e,t,n,s,i){return o().get("/ajax/spec/community",{specId:e,targetType:t,targetId:n,unreadOnly:s,loadStack:i}).fail(d)}function ie(e,t,n,s,i){return o().get("/ajax/spec/community/page",{specId:e,targetType:t,targetId:n,updatedBefore:s,unreadOnly:i}).fail(d)}Z._withStripped=!0;var oe=A({components:{Moment:L},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()},nameMaxLength:function(){return window.const.specNameMaxLength}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var n=this;this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",n.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s,i=this.callback;(t=this.name,n=this.desc,s=this.isPublic,o().post("/ajax/spec/create-spec",{name:t,desc:n,isPublic:s}).fail(d)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,n,s,i,r=this.callback;(t=this.spec.id,n=this.name,s=this.desc,i=this.isPublic,o().post("/ajax/spec/save-spec",{specId:t,name:n,desc:s,isPublic:i}).fail(d)).then((function(t){r(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSpec:function(){var e=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.spec.id,o().post("/ajax/spec/delete-spec",{specId:t}).fail(d)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"index"})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},Z,[],!1,null,null,null);oe.options.__file="src/spec/edit-spec-modal.vue";const re=oe.exports;var ae=A({components:{Moment:L,Username:J,EditSpecModal:re},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(e,t,n){this.reloadSpecs(),n()},methods:{reloadSpecs:function(){var e=this;this.loading=!0,o().get("/ajax/home").then((function(t){e.userSpecs=t.userSpecs,e.publicSpecs=t.publicSpecs,e.loading=!1})).fail((function(t){e.loading=!1,d(t)}))},promptCreateSpec:function(){var e=this;this.$refs.editSpecModal.showCreate((function(t){e.$router.push({name:"spec",params:{specId:t}})}))}}},U,[],!1,null,null,null);ae.options.__file="src/pages/index.vue";const ce=ae.exports;var le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"spec-page"},[e.spec?n("header",[e.loading?e._e():n("div",{staticClass:"right"},[e.currentUserOwns?n("span",[e._v("You own this")]):n("span",[e._v("\n\t\t\t\tOwned by\n\t\t\t\t"),e.spec.username?n("username",{attrs:{username:e.spec.username,highlight:e.spec.highlight}}):[e._v(e._s(e.spec.ownerType)+" "+e._s(e.spec.ownerId))]],2),e._v(" "),e.onSpecRoute?[e.enableEditing?[e.spec.public?n("span",[e._v("\n\t\t\t\t\t\tPublic\n\t\t\t\t\t")]):n("span",[n("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[n("i",{staticClass:"el-icon-lock"})])],1),e._v(" "),n("el-button",{attrs:{type:e.unreadCount?"primary":"default",disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSpecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2),e._v(" "),n("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSpec()}}})]:[n("span",[e._v("\n\t\t\t\t\t\tLast modified "),n("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1),e._v(" "),n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSpecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2)]]:e._e(),e._v(" "),n("el-button",{attrs:{size:"mini",icon:"el-icon-folder"},on:{click:function(t){return e.promptNavSpec()}}})],2),e._v(" "),n("h2",{staticClass:"name",on:{click:function(t){return e.gotoSpec()}}},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()]):e._e(),e._v(" "),n("router-view",{ref:"view",attrs:{loading:e.loading,spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo}}),e._v(" "),e.enableEditing?n("edit-spec-modal",{ref:"editSpecModal"}):e._e(),e._v(" "),n("nav-spec-modal",{ref:"navSpecModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId}}),e._v(" "),n("community-modal",{ref:"communityModal",attrs:{"spec-id":e.specId},on:{"play-video":e.playVideo}}),e._v(" "),n("play-video-modal",{ref:"playVideoModal"})],1)};le._withStripped=!0;var ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"nav-spec-modal",attrs:{title:"Navigate spec",visible:e.showing,width:e.$store.getters.dialogTinyWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.loading?n("p",[e._v("Loading...")]):e.subspecs.length?[n("el-select",{attrs:{placeholder:"Choose subspec"},model:{value:e.selectedSubspecId,callback:function(t){e.selectedSubspecId=t},expression:"selectedSubspecId"}},e._l(e.subspecs,(function(e){return n("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?n("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:n("p",[e._v("No subspecs.")]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")]),e._v(" "),e.subspecId?n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.goToSpec()}}},[e._v("\n\t\t\tGo to spec\n\t\t")]):e._e(),e._v(" "),e.subspecs.length?n("el-button",{attrs:{type:"primary",disabled:e.disableGoToSubspec},on:{click:function(t){return e.goToSubspec()}}},[e._v("\n\t\t\tGo to subspec\n\t\t")]):e._e()],1)],2)};ue._withStripped=!0;var de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-subspec"},[n("div",[n("div",{staticClass:"title"},[e._m(0),e._v(" "),n("router-link",{attrs:{to:{name:"subspec",params:{specId:e.item.specId,subspecId:e.item.id}}}},[e._v("\n\t\t\t\t"+e._s(e.item.name.trim())+"\n\t\t\t")])],1),e._v(" "),e.item.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};de._withStripped=!0;var pe=A({props:{item:Object}},de,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("i",{staticClass:"el-icon-s-unfold"}),e._v(" Subspec")])}],!1,null,null,null);pe.options.__file="src/spec/ref-subspec.vue";const me=pe.exports;var he=A({components:{RefSubspec:me},props:{specId:Number,subspecId:Number},data:function(){return{subspecs:[],selectedSubspecId:null,loading:!1,showing:!1}},computed:{disableGoToSubspec:function(){return this.loading||!this.subspecs.length||!this.selectedSubspecId},selectedSubspec:function(){if(this.selectedSubspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.selectedSubspecId)return this.subspecs[e];return null}},methods:{show:function(){var e=this;this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((function(t){e.subspecs=t,e.loading=!1})).fail((function(t){e.loading=!1,e.showing=!1,d(t)}))},goToSpec:function(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},goToSubspec:function(){"subspec"===this.$route.name&&p(this.$route.params.subspecId,this.selectedSubspecId)||this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:this.selectedSubspecId}}),this.showing=!1},closed:function(){this.loading=!1,this.subspecs=[],this.selectedSubspecId=null}}},ue,[],!1,null,null,null);he.options.__file="src/spec/nav-spec-modal.vue";const fe=he.exports;var ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-block-community-modal",attrs:{title:e.modalTitle,visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[n("context-stack",{ref:"contextStack",on:{"pop-stack":e.popStack}}),e._v(" "),e.loading?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):e.error?n("p",[e._v(e._s(e.error))]):e.target?[e.targetType===e.TARGET_TYPE_SPEC?n("preview-spec",{attrs:{spec:e.target}}):e.targetType===e.TARGET_TYPE_SUBSPEC?n("preview-subspec",{attrs:{subspec:e.target}}):e.targetType===e.TARGET_TYPE_BLOCK?n("preview-block",{attrs:{block:e.target},on:{"play-video":e.raisePlayVideo}}):e.targetType===e.TARGET_TYPE_COMMENT?n("preview-comment",{ref:"previewComment",attrs:{"spec-id":e.specId,comment:e.target},on:{deleted:e.commentDeleted,"update-unread":e.contextUpdateUnread}}):e._e(),e._v(" "),n("div",{staticClass:"flex-row wrap-reverse"},[n("div",{staticClass:"fill nowraptext",domProps:{textContent:e._s(e.formattedCommentsCount)}}),e._v(" "),n("el-checkbox",{on:{change:function(t){return e.reloadCommunity()}},model:{value:e.unreadOnly,callback:function(t){e.unreadOnly=t},expression:"unreadOnly"}},[e._v("\n\t\t\t\tShow only unread comments\n\t\t\t")])],1),e._v(" "),n("div",{staticClass:"new-comment-area"},[e.sendingComment?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Posting comment...")]):e.addingComment?[e.addingComment?n("el-input",{ref:"newCommentInput",attrs:{type:"textarea",autosize:{minRows:2},placeholder:"Type comment here"},model:{value:e.newCommentBody,callback:function(t){e.newCommentBody=t},expression:"newCommentBody"}}):e._e(),e._v(" "),n("div",[n("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(t){return e.cancelAddComment()}}},[e._v("\n\t\t\t\t\t\tCancel\n\t\t\t\t\t")]),e._v(" "),n("el-button",{attrs:{disabled:e.disablePostComment,type:"primary",size:"small"},on:{click:function(t){return e.addComment()}}},[e._v("\n\t\t\t\t\t\tPost\n\t\t\t\t\t")])],1)]:n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addComment()}}},[e._v("\n\t\t\t\tAdd comment\n\t\t\t")])],2),e._v(" "),e.reloadingComments?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Reloading...")]):e.comments.length?[e._l(e.comments,(function(t){return n("preview-comment",{key:t.id,ref:"comments",refInFor:!0,attrs:{"spec-id":e.specId,comment:t,"show-community":!0,"show-unread-only":e.unreadOnly},on:{"open-comments":e.openComments,"update-unread":e.adjustUnread,deleted:e.commentDeleted}})})),e._v(" "),e.loadingPage?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading more comments...")]):e.hasMoreComments?n("el-button",{on:{click:function(t){return e.loadMoreComments()}}},[e._v("\n\t\t\t\tLoad more\n\t\t\t")]):e._e()]:e._e()]:e._e(),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],2)};ve._withStripped=!0;var ge=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"community-context-stack",class:{empty:e.empty}},e._l(e.stack,(function(t,s){return n("transition",{key:t.targetType+"-"+t.target.id,attrs:{name:"fade",appear:""},on:{"after-leave":e.checkEmpty}},[n("stack-bar",{attrs:{target:t.target,"target-type":t.targetType},nativeOn:{click:function(t){return e.jumpStack(s)}}})],1)})),1)};ge._withStripped=!0;var be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"community-context-stack-bar",class:e.targetType},[n("el-button",{attrs:{size:"mini",icon:"el-icon-top-left",type:"primary",circle:""}}),e._v(" "),n("span",{staticClass:"bar"},[n("span",{staticClass:"label"},[e._v(e._s(e.label||"..."))]),e._v(" "),n("span",{staticClass:"content",domProps:{textContent:e._s(e.content||"...")}})])],1)};be._withStripped=!0;var _e=A({props:{target:Object,targetType:String},computed:{label:function(){var e=b(this.targetType);return this.targetType===w&&this.target.refType&&(e+=" ("+b(this.target.refType)+")"),e},content:function(){switch(this.targetType){case _:case y:return this.target.name;case w:var e;if(e=(this.target.title||"").trim())return e;if(e=(this.target.body||"").trim())return e;if(this.target.refItem)switch(this.target.refType){case P:return this.target.refItem.name;case"video":case I:return this.target.refItem.title||this.target.refItem.url}return"";case k:return this.target.body}}}},be,[],!1,null,null,null);_e.options.__file="src/spec/community-context-stack-bar.vue";var ye=A({components:{StackBar:_e.exports},data:function(){return{stack:[],empty:!0,cachedContext:[]}},computed:{available:function(){return this.stack.length}},methods:{replaceStack:function(e){this.stack=e,this.cachedContext=[],this.checkEmpty()},pushStack:function(e,t,n,s){this.empty=!1,this.stack.push({targetType:e,target:t,onAdjustUnread:n,onAdjustComments:s})},popStack:function(){if(this.stack.length){var e=this.stack.splice(this.stack.length-1,1)[0];return this.$emit("pop-stack",e.targetType,e.target.id,e.onAdjustUnread,e.onAdjustComments),this.cacheItemHandlers(e),e}return null},jumpStack:function(e){var t=this.stack.splice(e,this.stack.length-e),n=t[0];for(this.$emit("pop-stack",n.targetType,n.target.id,n.onAdjustUnread,n.onAdjustComments),e=0;e<t.length;e++)this.cacheItemHandlers(t[e]);return n},cacheItemHandlers:function(e){for(var t=0;t<this.cachedContext.length;t++){var n=this.cachedContext[t];if(n.targetType===e.targetType&&p(n.target.id,e.target.id)){this.cachedContext.splice(t,1);break}}(e.onAdjustUnread||e.onAdjustComments)&&this.cachedContext.push(e)},retrieveCachedHandlers:function(e,t){for(var n=0;n<this.cachedContext.length;n++){var s=this.cachedContext[n];if(s.targetType===e&&p(s.target.id,t))return this.cachedContext.splice(n,1)[0]}return null},getParentContext:function(){return this.stack.length?this.stack[this.stack.length-1]:null},clearStack:function(){this.stack=[],this.cachedContext=[]},checkEmpty:function(){return this.empty=!this.stack.length}}},ge,[],!1,null,null,null);ye.options.__file="src/spec/community-context-stack.vue";const we=ye.exports;var ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-preview community-target-preview"},[n("div",{staticClass:"name"},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()])};ke._withStripped=!0;var Ce=A({props:{spec:Object}},ke,[],!1,null,null,null);Ce.options.__file="src/spec/preview-spec.vue";const Se=Ce.exports;var Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-subspec-preview community-target-preview"},[n("div",{staticClass:"name"},[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()])};Te._withStripped=!0;var Ie=A({props:{subspec:Object}},Te,[],!1,null,null,null);Ie.options.__file="src/spec/preview-subspec.vue";const $e=Ie.exports;var Pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"spec-block-preview community-target-preview",attrs:{"data-block-preview-id":e.blockId}},[n("li",[e.hasTitle?n("div",{staticClass:"title"},[e._v(e._s(e.block.title))]):e._e(),e._v(" "),e.hasRefItem?[e.block.refType===e.REF_TYPE_URL?n("ref-url",{staticClass:"ref-item",attrs:{item:e.block.refItem},on:{play:function(t){return e.raisePlayVideo(e.block.refItem)}}}):e.block.refType===e.REF_TYPE_SUBSPEC?n("ref-subspec",{staticClass:"ref-item",attrs:{item:e.block.refItem}}):e._e()]:e.refItemMissing?n("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?[e.block.contentType===e.CONTENT_TYPE_PLAIN?n("div",{staticClass:"body plain",domProps:{textContent:e._s(e.block.body)}}):e.block.contentType===e.CONTENT_TYPE_MARKDOWN?n("div",{staticClass:"body markdown",domProps:{innerHTML:e._s(e.block.html)}}):e._e()]:e._e(),e._v(" "),n("dynamic-stylesheet",{attrs:{rules:e.blockPreviewRules}})],2)])};Pe._withStripped=!0;var xe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-url"},[e.item.imageData?n("img",{attrs:{src:e.item.imageData}}):e._e(),e._v(" "),n("div",[e.showEdit||e.showPlay?n("div",{staticClass:"right"},[e.showEdit?n("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.$emit("edit")}}}):e._e(),e._v(" "),e.showPlay?n("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$emit("play")}}},[e._v("Play")]):e._e()],1):e._e(),e._v(" "),n("div",{staticClass:"title"},[e._m(0),e._v(" "),n("a",{attrs:{href:e.item.url,target:"_blank"},on:{click:function(e){e.stopPropagation()}}},[e._v(e._s(e.item.title&&e.item.title.trim()||e.item.url))])]),e._v(" "),e.item.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};xe._withStripped=!0;var Ee=A({props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return g(this.item.url)}}},xe,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("i",{staticClass:"el-icon-link"}),e._v(" URL")])}],!1,null,null,null);Ee.options.__file="src/spec/ref-url.vue";const Re=Ee.exports;var Oe=function(){var e=this.$createElement;return(this._self._c||e)("span",{staticClass:"dynamic-stylesheet",staticStyle:{display:"none"}})};Oe._withStripped=!0;const Be=/^\/\*(?:[^\*]|\*(?!\/))+\*\/$/;function je(e,t,n=[],s=0){if(!t||"object"!=typeof t)return 0;let i=0,o=[];const r=()=>{let t=n.join("").trim();if(t){for(let e=0;e<o.length;e++){let t=o[e].trim();t&&!Be.test(t)&&";"!==t.charAt(t.length-1)&&(o[e]=t+";")}o=o.join(""),o&&((e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+o+"}",s+i):(e.styleSheet||e.sheet).addRule(t,o,s+i),i++),o=[]}else o=[]};if(Array.isArray(t))for(let a=0;a<t.length;a++){let c=t[a];c&&("string"==typeof c?o.push(c):"object"==typeof c&&(r(),i+=je(e,c,n,s+i)))}else for(let a in t)if(t.hasOwnProperty(a)){let c=t[a];c&&("string"==typeof c?o.push(a+":"+c+";"):"object"==typeof c&&(r(),"&"===a.charAt(0)?a=a.substr(1):[">",":","+","~"," "].indexOf(a.charAt(0))<0&&(a=" "+a),i+=je(e,c,n.concat([a]),s+i)))}return r(),i}function Ue(e,t=[]){if(!e||"object"!=typeof e)return"";let n="",s=[];const i=()=>{let e=t.join("").trim();if(e){let t=[];for(let e=0;e<s.length;e++){let n=s[e].trim();n?";"===n.charAt(n.length-1)||Be.test(n)?t.push(n):t.push(n+";"):t.push("")}t.length&&(t=t.join("\n\t"),n+="\n"+e+" {\n\t"+t+"\n}")}else for(let e=0;e<s.length;e++){let t=s[e].trim();t&&!Be.test(t)||(n+="\n"+t)}s=[]};if(Array.isArray(e))for(let o=0;o<e.length;o++){let r=e[o];"string"==typeof r?s.push(r):r&&"object"==typeof r&&(i(),n+=Ue(r,t.concat([""])))}else for(let o in e)if(e.hasOwnProperty(o)){let r=e[o];if(r)switch(typeof r){case"string":s.push(o+": "+r+";");break;case"object":i(),"&"===o.charAt(0)?o=o.substr(1):[">",":","+","~"," "].indexOf(o.charAt(0))<0&&(o=" "+o),n+=Ue(r,t.concat([o]));break;case"boolean":s.push(o)}}return i(),n+(t.length?"":"\n")}function Me(e,t,n=!1){let s=document.createElement("style");return s.type="text/css",e.appendChild(s),!s.styleSheet&&!s.sheet||n?s.innerHTML=Ue(t):je(s,t),s}var Ae=A({props:{rules:[Object,Array],innerMarkupOutput:Boolean},watch:{rules:{deep:!0,handler(){this.recreateSheet()}},innerMarkupOutput(){this.recreateSheet()}},mounted(){this.recreateSheet()},beforeDestroy(){this.removeSheet()},methods:{recreateSheet(){this.removeSheet(),this.rules&&(this.$stylesheet=Me(this.$el,this.rules,this.innerMarkupOutput))},removeSheet(){this.$stylesheet&&(this.$stylesheet.parentNode.removeChild(this.$stylesheet),this.$stylesheet=null)}}},Oe,[],!1,null,null,null);Ae.options.__file="node_modules/@macu/dynamic-stylesheet-vue/dynamic-stylesheet.vue";const Ne=Ae.exports,Le=Ne;window.Vue&&Vue.component("dynamic-stylesheet",Ne);var Fe=A({components:{RefUrl:Re,RefSubspec:me,DynamicStylesheet:Le},props:{block:Object},computed:{CONTENT_TYPE_PLAIN:function(){return S},CONTENT_TYPE_MARKDOWN:function(){return T},REF_TYPE_URL:function(){return I},REF_TYPE_SUBSPEC:function(){return P},blockId:function(){return parseInt(this.block.id,10)||0},blockNumber:function(){return"numbered"===this.block.styleType&&parseInt(this.block.number,10)||0},blockPreviewRules:function(){var e,t,n,s;switch(this.block.styleType){case"bullet":e="'\\2022'";break;case"numbered":e="'"+this.blockNumber+".'";break;default:return null}return t={},s={">li:before":{content:e}},(n='[data-block-preview-id="'+this.blockId+'"]')in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t},hasTitle:function(){return!(!this.block.title||!this.block.title.trim())},hasRefItem:function(){return!(!this.block.refType||!this.block.refItem)},hasBody:function(){return!!(this.block.body&&this.block.body.trim()||this.block.html&&this.block.html.trim())},refItemMissing:function(){return!!this.block.refType&&!this.block.refItem}},methods:{raisePlayVideo:function(e){this.$emit("play-video",e)}}},Pe,[],!1,null,null,null);Fe.options.__file="src/spec/preview-block.vue";const De=Fe.exports;var qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-comment-preview community-target-preview",class:{community:e.showCommunity}},[n("div",{staticClass:"info"},[n("div",{staticClass:"right"},[n("el-checkbox",{attrs:{value:e.userRead,disabled:e.sendingRead,size:"mini"},on:{change:e.setUserRead}}),e._v(" "),e.userRead?n("el-tag",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.setUserRead(!1)}}},[e._v("\n\t\t\t\tRead\n\t\t\t")]):n("el-tag",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.setUserRead(!0)}}},[e._v("\n\t\t\t\tUnread\n\t\t\t")]),e._v(" "),e.showCommunity?n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openComments()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2):e._e(),e._v(" "),e.userCanEdit?n("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.edit()}}}):e.userCanDelete?n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDelete()}}}):e._e()],1),e._v(" "),n("username",{attrs:{username:e.comment.username,highlight:e.comment.highlight}}),e._v("\n\t\tposted\n\t\t"),n("moment",{attrs:{datetime:e.comment.created,offset:!0}}),e._v(" "),e.updated!==e.comment.created?[e._v("\n\t\t\t(updated "),n("moment",{attrs:{datetime:e.updated,offset:!0}}),e._v(")\n\t\t")]:e._e()],2),e._v(" "),e.sendingDelete?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v(" Deleting...")]):e.sendingEdit?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v(" Saving...")]):e.editing?n("div",{staticClass:"edit-comment-area"},[n("el-input",{ref:"editCommentInput",attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.editingBody,callback:function(t){e.editingBody=t},expression:"editingBody"}}),e._v(" "),n("div",[n("el-button",{attrs:{disabled:e.disableSaveEdit,type:"warning",size:"small"},on:{click:function(t){return e.cancelEdit()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")]),e._v(" "),n("el-button",{attrs:{disabled:e.disableSaveEdit,type:"primary",size:"small"},on:{click:function(t){return e.saveEdit()}}},[e._v("\n\t\t\t\tSave\n\t\t\t")]),e._v(" "),n("el-button",{attrs:{disabled:e.disableSaveEdit,type:"danger",size:"small"},on:{click:function(t){return e.promptDelete()}}},[e._v("\n\t\t\t\tDelete\n\t\t\t")])],1)],1):n("div",{staticClass:"body"},[e._v(e._s(e.body))])])};qe._withStripped=!0;var ze=A({components:{Username:J,Moment:L},props:{specId:Number,comment:Object,showCommunity:Boolean,showUnreadOnly:Boolean},data:function(){return{userRead:this.comment.userRead||!1,sendingRead:!1,editing:!1,updated:this.comment.updated,body:this.comment.body,editingBody:"",sendingEdit:!1,sendingDelete:!1}},computed:{userCanEdit:function(){return this.$store.getters.currentUserId===this.comment.userId},userCanDelete:function(){return this.userCanEdit||this.$store.getters.currentSpecOwnedByUser},disableSaveEdit:function(){return!this.editingBody.trim()||this.sendingEdit},unreadCount:function(){return this.comment.unreadCount||0},commentsCount:function(){return this.comment.commentsCount||0}},watch:{editing:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.editCommentInput&&o()("textarea",t.$refs.editCommentInput.$el).focus()}))}},methods:{setUserRead:function(e){var t=this;this.sendingRead=!0,function(e,t,n,s){return o().post("/ajax/spec/community/mark-read",{specId:e,targetType:"comment",targetId:n,read:s}).fail(d)}(this.specId,0,this.comment.id,e).then((function(){t.sendingRead=!1,t.userRead=e,t.$emit("update-unread",e?-1:1)})).fail((function(){t.sendingRead=!1}))},openComments:function(){this.$emit("open-comments",this.comment.id)},edit:function(){this.editingBody.trim()||(this.editingBody=this.body),this.editing=!0},cancelEdit:function(){this.editing=!1},saveEdit:function(){var e,t,n,s=this;this.disableSaveEdit||(this.sendingEdit=!0,(e=this.specId,t=this.comment.id,n=this.editingBody,o().post("/ajax/spec/community/update-comment",{specId:e,commentId:t,body:n}).fail(d)).then((function(e){s.sendingEdit=!1,s.editing=!1,s.updated=e.updated,s.body=e.body,s.editingBody=""})).fail((function(){s.sendingEdit=!1})))},promptDelete:function(){var e=this;this.$confirm("Permanently delete this comment?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t,n;e.sendingDelete=!0,(t=e.specId,n=e.comment.id,o().post("/ajax/spec/community/delete-comment",{specId:t,commentId:n}).fail(d)).then((function(){e.sendingDelete=!1,e.$emit("deleted",e.comment.id)})).fail((function(){e.sendingDelete=!1}))})).catch((function(){}))},isUnread:function(){return!this.userRead}}},qe,[],!1,null,null,null);ze.options.__file="src/spec/preview-comment.vue";var Ve=A({components:{ContextStack:we,PreviewSpec:Se,PreviewSubspec:$e,PreviewBlock:De,PreviewComment:ze.exports},props:{specId:Number},data:function(){return{showing:!1,loading:!1,error:null,targetType:null,target:null,comments:[],unreadCount:0,commentsCount:0,hasMoreComments:!1,loadingPage:!1,addingComment:!1,newCommentBody:"",sendingComment:!1,onAdjustUnread:null,onAdjustComments:null,unreadOnly:!1,reloadingComments:!1}},computed:{TARGET_TYPE_SPEC:function(){return _},TARGET_TYPE_SUBSPEC:function(){return y},TARGET_TYPE_BLOCK:function(){return w},TARGET_TYPE_COMMENT:function(){return k},modalTitle:function(){switch(this.targetType){case _:return"Spec community";case y:return"Subspec community";case w:return"Block community";case k:return"Comment community"}return"Community space"},disablePostComment:function(){return!this.newCommentBody.trim()},formattedCommentsCount:function(){var e=this.unreadOnly?this.unreadCount:this.commentsCount;return e+(this.unreadOnly?" unread":"")+(this.targetType===k?" sub":"")+" comment"+(1!==e?"s":"")}},watch:{addingComment:function(e){var t=this;e&&this.$nextTick((function(){t.$refs.newCommentInput&&o()("textarea",t.$refs.newCommentInput.$el).focus().select()}))}},methods:{openCommunity:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=n,this.onAdjustComments=s,this.unreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loadCommunity(e,t),this.showing=!0},openCommunityReview:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.onAdjustUnread=n,this.onAdjustComments=s,this.unreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loadCommunity(e,t,!0),this.showing=!0},loadCommunity:function(e,t){var n=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.loading=!0,this.error=null,se(this.specId,e,t,this.unreadOnly,s).then((function(i){switch(n.loading=!1,n.targetType=e,e){case _:n.target=i.spec;break;case y:n.target=i.subspec;break;case w:n.target=i.block;break;case k:n.target=i.comment}s&&i.stack&&n.$refs.contextStack.replaceStack(i.stack),n.comments=i.comments,n.unreadCount=i.unreadCount,n.commentsCount=i.commentsCount,n.hasMoreComments=i.commentsCount>i.comments.length,n.newCommentBody="";var o=n.$refs.contextStack.retrieveCachedHandlers(e,t);o&&(n.onAdjustUnread=o.onAdjustUnread,n.onAdjustComments=o.onAdjustComments)})).fail((function(){n.loading=!1,n.error="Failed to load community.",n.$refs.contextStack.checkEmpty()&&(n.showing=!1)}))},reloadCommunity:function(){var e=this;this.reloadingComments=!0,ie(this.specId,this.targetType,this.target.id,null,this.unreadOnly).then((function(t){e.reloadingComments=!1,e.comments=t.comments,e.unreadCount=t.unreadCount,e.commentsCount=t.commentsCount,e.hasMoreComments=t.hasMore})).fail((function(){e.reloadingComments=!1}))},loadMoreComments:function(){var e=this;this.loadingPage=!0;var t=this.comments[this.comments.length-1].updated;ie(this.specId,this.targetType,this.target.id,t,this.unreadOnly).then((function(t){e.loadingPage=!1,e.comments=e.comments.concat(t.comments),e.hasMoreComments=t.hasMore})).fail((function(){e.loadingPage=!1}))},addComment:function(){var e,t,n,s,i=this;this.addingComment?this.disablePostComment||(this.sendingComment=!0,(e=this.specId,t=this.targetType,n=this.target.id,s=this.newCommentBody,o().post("/ajax/spec/community/add-comment",{specId:e,targetType:t,targetId:n,body:s}).fail(d)).then((function(e){i.sendingComment=!1,i.comments.unshift(e),i.adjustComments(1),i.addingComment=!1,i.newCommentBody=""})).fail((function(){i.sendingComment=!1}))):this.addingComment=!0},cancelAddComment:function(){this.addingComment=!1},openComments:function(e){this.$refs.contextStack.pushStack(this.targetType,this.target,this.onAdjustUnread,this.onAdjustComments),this.onAdjustUnread=null,this.onAdjustComments=null,this.loadCommunity("comment",e)},adjustUnread:function(e){this.unreadCount+=e,this.onAdjustUnread&&this.onAdjustUnread(e)},adjustComments:function(e){this.commentsCount+=e,this.onAdjustComments&&this.onAdjustComments(e)},commentDeleted:function(e){if(this.targetType===k&&this.target.id===e){var t=this.$refs.previewComment.isUnread(),n=this.$refs.contextStack.popStack();t&&n.onAdjustUnread&&n.onAdjustUnread(-1),n.onAdjustComments&&n.onAdjustComments(-1)}else for(var s=0;s<this.comments.length;s++)if(p(this.comments[s].id,e)){var i=!this.$refs.comments[s].userRead;this.comments.splice(s,1),i&&this.adjustUnread(-1),this.adjustComments(-1);break}},contextUpdateUnread:function(e){var t=this.$refs.contextStack.getParentContext();t&&t.onAdjustUnread&&t.onAdjustUnread(e)},popStack:function(e,t,n,s){this.$refs.contextStack.cacheItemHandlers({targetType:this.targetType,target:this.target,onAdjustUnread:this.onAdjustUnread,onAdjustComments:this.onAdjustComments}),this.onAdjustUnread=n,this.onAdjustComments=s,this.loadCommunity(e,t)},raisePlayVideo:function(e){this.$emit("play-video",e)},closed:function(){this.targetType=null,this.target=null,this.error=null,this.addingComment=!1,this.newCommentBody="",this.onAdjustUnread=null,this.onAdjustComments=null,this.$refs.contextStack.clearStack()}}},ve,[],!1,null,null,null);Ve.options.__file="src/spec/community-modal.vue";const Ye=Ve.exports;var He=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"play-video-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogSmallWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.vid?n("div",{staticClass:"embed-responsive"},["youtube"===e.vid.type?n("iframe",{attrs:{src:"https://www.youtube.com/embed/"+e.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===e.vid.type?n("iframe",{attrs:{src:"https://player.vimeo.com/video/"+e.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):e._e()]):e._e()])};He._withStripped=!0;var We=A({data:function(){return{vid:null,showing:!1}},methods:{show:function(e){var t,n,s=(t=e.url,(n=v.exec(t))?t.indexOf("youtube.com")||t.indexOf("youtu.be")?{type:"youtube",id:n[1]}:t.indexOf("vimeo.com")?{type:"vimeo",id:n[1]}:null:null);s&&(this.vid=s,this.showing=!0)},closed:function(){this.vid=null}}},He,[],!1,null,null,null);We.options.__file="src/widgets/play-video-modal.vue";const Ge=We.exports;var Xe=A({components:{Username:J,Moment:L,EditSpecModal:re,NavSpecModal:fe,CommunityModal:Ye,PlayVideoModal:Ge},data:function(){return{loading:!0,spec:null,unreadCount:0,commentsCount:0}},computed:{specId:function(){return parseInt(this.$route.params.specId,10)},subspecId:function(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute:function(){return"spec"===this.$route.name},currentUserOwns:function(){return this.spec&&this.spec.ownerType===x&&this.$store.getters.currentUserId===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns},choosingAddPosition:function(){return this.$store.getters.currentlyMovingBlocks},showUnreadOnly:function(){return this.$store.getters.userSettings.community.unreadOnly}},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter spec",e),n((function(t){t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),n()},beforeRouteLeave:function(e,t,n){console.debug("beforeRouteLeave spec"),this.spec=null,this.unreadCount=0,this.commentsCount=0,h(),n()},methods:{loadSpec:function(e,t){var n=this;console.debug("load spec"),this.loading=!0,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return o().get("/ajax/spec",{specId:e,loadBlocks:t}).fail(d)}(e,t).then((function(e){console.debug("spec loaded",e),n.spec=e,n.unreadCount=e.unreadCount||0,n.commentsCount=e.commentsCount||0,h(e.name),n.loading=!1,n.$refs.view.$once("rendered",n.restoreScroll),n.$store.commit("saveCurrentSpec",e)})).fail((function(e){n.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(n.$route.fullPath)}})}))},gotoSpec:function(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec:function(){var e=this;this.$refs.editSpecModal.showEdit(this.spec,(function(t){e.spec.updated=t.updated,e.spec.name=t.name,e.spec.desc=t.desc,e.spec.public=t.public,e.unreadCount=t.unreadCount||0,e.commentsCount=t.commentsCount||0,h(t.name)}))},openSpecCommunity:function(){var e=this;this.$refs.communityModal.openCommunity(_,this.spec.id,(function(t){e.unreadCount+=t}),(function(t){e.commentsCount+=t}))},openCommunity:function(e,t,n,s){this.$refs.communityModal.openCommunity(e,t,n,s)},playVideo:function(e){this.$refs.playVideoModal.show(e)},promptNavSpec:function(){this.$refs.navSpecModal.show()},restoreScroll:function(){if(this.onSpecRoute){var e=this.$store.state.savedScrollPosition;e?(console.debug("restoreScroll spec"),o()(window).scrollTop(e.y).scrollLeft(e.x)):p(this.$store.getters.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),o()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},le,[],!1,null,null,null);Xe.options.__file="src/pages/spec.vue";const Ke=Xe.exports;var Je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"spec-view-page",class:{loading:e.loading}},[e.loading?n("p",[e._v("Loading...")]):e.spec?n("spec-view",{key:e.spec.renderTime,attrs:{spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};Je._withStripped=!0;var Ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.spec||e.subspec?n("div",{staticClass:"spec-view"},[n("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:e.dragging}}),e._v(" "),e.enableEditing?[e.choosingAddPosition?n("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-top"},on:{click:function(t){return e.moveBlocksToBottom()}}},[e._v("Move block here")]):n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.promptAddBlock()}}},[e._v("Add block")]),e._v(" "),n("ul",{ref:"mirrorList",staticClass:"mirror-list"}),e._v(" "),n("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId},on:{"open-edit-url":e.openEditUrl,"play-video":e.playVideo,"prompt-delete":e.promptDeleteBlock}}),e._v(" "),n("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":e.specId}})]:e._e()],2):e._e()};Ze._withStripped=!0;const Qe=dragula;var et=e.n(Qe),tt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{staticClass:"spec-block",class:e.classes,attrs:{"data-spec-block":e.block.id},on:{touchstart:e.touchstart,selectstart:e.selectstart}},[n("div",{staticClass:"content",class:{"clear-ref":e.clearRef,"mobile-adjust":e.mobileAdjust}},[n("div",{staticClass:"bg"}),e._v(" "),n("div",{staticClass:"layover",on:{mouseleave:function(t){return e.mouseLeaveLayover()}}},[e.enableEditing?[n("div",{staticClass:"expand-control",class:{hide:e.showActions}},[e.showUnreadOnly&&e.unreadCount?n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t"+e._s(e.unreadCount)+" unread\n\t\t\t\t\t")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(t){e.focusActions=!0}}})],1),e._v(" "),n("div",{staticClass:"actions",class:{show:e.showActions}},[e.choosingAddPosition?[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelChooseAddPosition()}}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.addBeforeThis()}}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.addIntoThis()}}}),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.addAfterThis()}}})]:e.movingThis?[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.cancelMoving()}}},[e.$store.getters.mobileViewport?[e._v("Cancel")]:[e._v("Cancel move")]],2),e._v(" "),n("el-button",{attrs:{size:"mini",icon:"el-icon-folder-add"},on:{click:function(t){return e.promptNavSpec()}}},[e.$store.getters.mobileViewport?[e._v("Context")]:[e._v("Change context")]],2),e._v(" "),n("el-checkbox",{attrs:{"data-moving-block-id":e.block.id,value:!0,size:"mini"},nativeOn:{click:function(t){return e.removeThisFromMovingBlocks()}}})]:e.movingOtherBlocks?[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelMoving()}}}),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.moveBeforeThis()}}}),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.moveIntoThis()}}}),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.moveAfterThis()}}}),e._v(" "),e.showAddToMoving?n("el-checkbox",{attrs:{value:!1,size:"mini"},nativeOn:{click:function(t){return e.addThisToMovingBlocks()}}}):e._e()]:[n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2),e._v(" "),n("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editBlock()}}}),e._v(" "),e.showDeleteButton?n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDeleteBlock()}}}):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.enterChooseAddPosition()}}}),e._v(" "),n("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(t){return e.startMoving()}}}),e._v(" "),n("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(t){return e.startMoving()}}})]],2)]:n("div",{staticClass:"visitor-actions"},[n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2)],1)],2),e._v(" "),e.currentlyMovingBlocks?n("div",{staticClass:"layover parent-moving-layover"},[n("el-checkbox",{attrs:{value:!0,disabled:"",size:"mini"}})],1):e._e(),e._v(" "),e.hasTitle?n("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.hasRefItem?[e.refType===e.REF_TYPE_URL?n("ref-url",{staticClass:"ref-item",attrs:{item:e.refItem},on:{play:function(t){return e.raisePlayVideo(e.refItem)}}}):e.refType===e.REF_TYPE_SUBSPEC?n("ref-subspec",{staticClass:"ref-item",attrs:{item:e.refItem}}):e._e()]:e.refItemMissing?n("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?[e.contentType===e.CONTENT_TYPE_PLAIN?n("div",{staticClass:"body plain",domProps:{textContent:e._s(e.body)}}):e.contentType===e.CONTENT_TYPE_MARKDOWN?n("div",{staticClass:"body markdown",domProps:{innerHTML:e._s(e.renderedHtml)}}):e._e()]:e._e()],2),e._v(" "),n("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:e.movingThis}})])};function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}tt._withStripped=!0;var st=A({components:{RefUrl:Re,RefSubspec:me},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,renderedHtml:this.block.html,refItem:this.block.refItem,unreadCount:this.block.unreadCount||0,commentsCount:this.block.commentsCount||0,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{CONTENT_TYPE_PLAIN:function(){return S},CONTENT_TYPE_MARKDOWN:function(){return T},REF_TYPE_URL:function(){return I},REF_TYPE_SUBSPEC:function(){return P},showDeleteButton:function(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!!(this.body&&this.body.trim()||this.renderedHtml&&this.renderedHtml.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},classes:function(){var e;return nt(e={},this.styleType,!0),nt(e,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),nt(e,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),e},currentlyMovingBlocks:function(){return this.$store.getters.currentlyMovingBlocks},movingThis:function(){return this.$store.getters.currentlyMovingBlock(this.block.id)},movingOtherBlocks:function(){return this.currentlyMovingBlocks&&!this.movingThis},showAddToMoving:function(){return this.movingOtherBlocks&&p(this.$store.state.movingBlocksSourceSubspecId,this.subspecId)},showActions:function(){return this.focusActions||this.currentlyMovingBlocks},showUnreadOnly:function(){return this.$store.getters.userSettings.community.unreadOnly},clearRef:function(){return!!this.unreadCount},mobileAdjust:function(){return this.showActions||!!this.unreadCount||!this.showUnreadOnly&&!!this.commentsCount}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getStyleType:function(){return this.styleType},getParentId:function(){var e=o()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId:function(){var e=o()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock:function(){var e=this;this.raiseOpenEdit(this.block.id,(function(t){e.updated=t.updated,e.styleType=t.styleType,e.contentType=t.contentType,e.refType=t.refType,e.refId=t.refId,e.refItem=t.refItem,e.title=t.title,e.body=t.body,e.renderedHtml=t.html,e.unreadCount=t.unreadCount||0,e.commentsCount=t.commentsCount||0}))},raiseOpenEdit:function(e,t){this.$emit("open-edit",e,t)},promptDeleteBlock:function(){this.$emit("prompt-delete",this.block.id)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t,this.styleType)},addIntoThis:function(){var e=this.block.id;this.raisePromptAddSubblock(e,null,!0)},addAfterThis:function(){var e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t,this.styleType)},raisePromptAddSubblock:function(e,t,n){this.$emit("prompt-add-subblock",e,t,n)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},addThisToMovingBlocks:function(){this.$emit("add-to-moving",this.block.id)},removeThisFromMovingBlocks:function(){this.$emit("remove-from-moving",this.block.id)},promptNavSpec:function(){this.$emit("prompt-nav-spec")},cancelMoving:function(){this.$emit("cancel-moving",this.block.id)},moveBeforeThis:function(){this.$emit("move-before",this.block.id)},moveIntoThis:function(){this.$emit("move-into",this.block.id)},moveAfterThis:function(){this.$emit("move-after",this.block.id)},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(e){this.refType===I&&e.id===this.refId&&(this.refItem=e)},urlDeleted:function(e){this.refType===I&&e===this.refId&&(this.refItem=null)},raisePlayVideo:function(e){this.$emit("play-video",e)},openCommunity:function(){var e=this;this.$emit("open-community",this.block.id,(function(t){e.unreadCount+=t}),(function(t){e.commentsCount+=t}))},updateHasSubblocks:function(){this.hasSubblocks=this.$refs.sublist.childElementCount>0},touchstart:function(e){this.lastTouchStartTime=Date.now()},selectstart:function(e){this.lastTouchStartTime&&Date.now()-this.lastTouchStartTime<200&&(e.preventDefault(),e.stopPropagation())}}},tt,[],!1,null,null,null);st.options.__file="src/spec/block.vue";const it=st.exports;var ot=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:e.loading||e.block?"Edit block":"Add block",visible:e.showing,width:e.$store.getters.dialogLargeWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.loading?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):e.error?[n("p",[e._v(e._s(e.error))]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)]:[e.block?n("p",[e._v("\n\t\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.block.created}})],1),e._v(";\n\t\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.block.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("section",[n("el-radio-group",{model:{value:e.styleType,callback:function(t){e.styleType=t},expression:"styleType"}},[n("el-radio",{attrs:{label:e.STYLE_TYPE_BULLET}},[e._v("Bullet point")]),e._v(" "),n("el-radio",{attrs:{label:e.STYLE_TYPE_NUMBERED}},[e._v("Numbered point")]),e._v(" "),n("el-radio",{attrs:{label:e.STYLE_TYPE_NONE}},[e._v("Indented block")])],1),e._v(" "),n("label",[e._v("\n\t\t\t\tTitle\n\t\t\t\t"),n("el-input",{ref:"titleInput",attrs:{maxlength:e.titleMaxLength,clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1),e._v(" "),n("section",[n("el-radio-group",{model:{value:e.refType,callback:function(t){e.refType=t},expression:"refType"}},[n("el-radio",{attrs:{label:null}},[e._v("No media")]),e._v(" "),n("el-radio",{attrs:{label:e.REF_TYPE_SUBSPEC}},[e._v("Subspec")]),e._v(" "),n("el-radio",{attrs:{label:e.REF_TYPE_URL}},[e._v("URL")])],1),e._v(" "),e.refType===e.REF_TYPE_URL?n("ref-url-form",{attrs:{"spec-id":e.specId,"initial-url-object":e.existingUrlRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t},"open-edit-url":e.openEditUrl,"play-video":e.raisePlayVideo}}):e.refType===e.REF_TYPE_SUBSPEC?n("ref-subspec-form",{attrs:{"spec-id":e.specId,"initial-subspec":e.existingSubspecRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t}}}):e._e()],1),e._v(" "),n("section",[n("el-radio-group",{model:{value:e.contentType,callback:function(t){e.contentType=t},expression:"contentType"}},[n("el-radio",{attrs:{label:e.CONTENT_TYPE_PLAIN}},[e._v("Plain text")]),e._v(" "),n("el-radio",{attrs:{label:e.CONTENT_TYPE_MARKDOWN}},[e._v("Markdown")])],1),e._v(" "),e.contentType===e.CONTENT_TYPE_MARKDOWN?[n("div",{staticClass:"split-even"},[n("label",[e._v("\n\t\t\t\t\t\tBody\n\t\t\t\t\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),n("label",[e._v("\n\t\t\t\t\t\tPreview\n\t\t\t\t\t\t"),e.previewError?n("div",{staticClass:"error"},[e._v(e._s(e.previewError))]):n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingPreview,expression:"loadingPreview"}],staticClass:"markdown",domProps:{innerHTML:e._s(e.previewHtml)}})])])]:n("label",[e._v("\n\t\t\t\tBody\n\t\t\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1)],2),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.block?n("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.promotDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("\n\t\t\t\t"+e._s(e.block?"Save":"Add")+"\n\t\t\t")])],1)]],2)};ot._withStripped=!0;var rt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-url-form"},[e.creating?n("el-card",[n("label",[e._v("\n\t\t\tNew link URL\n\t\t\t"),n("el-input",{attrs:{maxlength:e.urlMaxLength,clearable:""},model:{value:e.newUrl,callback:function(t){e.newUrl=t},expression:"newUrl"}}),e._v(" "),e.newUrl&&!e.isValid?n("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):e.newUrlIsVideo?n("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):e._e()],1),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!0}}},[e._v("\n\t\t\tSelect an existing link\n\t\t")]):e._e(),e._v(" "),e.initialUrlObject?n("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?n("p",[e._v("Loading links...")]):e.urlObjects&&e.urlObjects.length?[n("el-select",{attrs:{filterable:"","filter-method":e.filterUrls,placeholder:"Select link"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.filteredUrlObjects,(function(e){return n("el-option",{key:e.id,attrs:{value:e.id,label:e.title||e.url}})})),1),e._v(" "),e.selectedUrlObject?n("ref-url",{attrs:{item:e.selectedUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.selectedUrlObject)},play:function(t){return e.raisePlayVideo(e.selectedUrlObject)}}}):e._e()]:e._e(),e._v(" "),n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new link\n\t\t")]),e._v(" "),e.initialUrlObject?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()]:[e.initialUrlObject?n("ref-url",{attrs:{item:e.initialUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.initialUrlObject)},play:function(t){return e.raisePlayVideo(e.initialUrlObject)}}}):e._e(),e._v(" "),n("div",[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new link\n\t\t\t")]),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):e._e()],1)]],2)};rt._withStripped=!0;var at=A({components:{RefUrl:Re},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var e=this.filter.toLowerCase(),t=[],n=0;n<this.urlObjects.length;n++){var s=this.urlObjects[n];(s.url.toLowerCase().indexOf(e)>=0||s.title&&s.title.toLowerCase().indexOf(e)>=0)&&t.push(s)}return t}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.refId)return this.urlObjects[e];return null},newUrlIsVideo:function(){return f(this.newUrl)&&g(this.newUrl)},isValid:function(){return this.creating?f(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null},urlMaxLength:function(){return window.const.urlMaxLength}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadLinks()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadLinks:function(){var e,t=this;this.urlObjects||this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/urls",{specId:e}).fail(d)).then((function(e){t.urlObjects=e,e.length||(t.selecting=!1,t.initialUrlObject||(t.creating=!0)),t.loading=!1})).fail((function(){t.urlObjects=[],t.selecting=!1,t.initialUrlObject||(t.creating=!0),t.loading=!1})))},filterUrls:function(e){var t=this;e?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=m((function(e){t.filter=e}))),this.debouncedUpdateFilter(e)):this.filter=""},openEditUrl:function(e){var t=this;this.$emit("open-edit-url",e,(function(n){if(t.urlObjects)for(var s=0;s<t.urlObjects.length;s++)if(t.urlObjects[s].id===e.id){t.urlObjects.splice(s,1,n);break}}),(function(){if(t.urlObjects)for(var n=0;n<t.urlObjects.length;n++)if(t.urlObjects[n].id===e.id){t.urlObjects.splice(n,1);break}t.refId===e.id&&(t.refId=null)}))},raisePlayVideo:function(e){this.$emit("play-video",e)}}},rt,[],!1,null,null,null);at.options.__file="src/spec/ref-url-form.vue";const ct=at.exports;var lt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ref-subspec-form"},[e.creating?n("el-card",[n("label",[e._v("\n\t\t\tNew subspec name\n\t\t\t"),n("el-input",{ref:"newSubspecNameInput",attrs:{maxlength:e.nameMaxLength,clearable:""},model:{value:e.subspecName,callback:function(t){e.subspecName=t},expression:"subspecName"}})],1),e._v(" "),n("label",[e._v("\n\t\t\tDescription\n\t\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.subspecDesc,callback:function(t){e.subspecDesc=t},expression:"subspecDesc"}})],1),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?n("p",[e._v("Loading subspecs...")]):e.subspecs&&e.subspecs.length?[n("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.subspecs,(function(e){return n("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?n("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:e._e(),e._v(" "),n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new subspec\n\t\t")])]:[e.initialSubspec?n("ref-subspec",{attrs:{item:e.initialSubspec}}):e._e(),e._v(" "),n("div",[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),e._v(" "),e.selectModeAvailable?n("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):e._e()],1)]],2)};lt._withStripped=!0;var ut=A({components:{RefSubspec:me},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.refId)return this.subspecs[e];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}},nameMaxLength:function(){return window.const.specNameMaxLength}},watch:{selecting:{immediate:!0,handler:function(e){e&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler:function(e){this.$emit("update:fields",e)}}},methods:{loadSubspecs:function(){var e,t=this;this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/subspecs",{specId:e}).fail(d)).then((function(e){t.subspecs=e,e.length||(t.creating=!0),t.loading=!1})).fail((function(){t.subspecs=[],t.creating=!0,t.loading=!1})))}}},lt,[],!1,null,null,null);ut.options.__file="src/spec/ref-subspec-form.vue";var dt=A({components:{Moment:L,RefUrlForm:ct,RefSubspecForm:ut.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:C,contentType:S,title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,loading:!1,error:null,loadingPreview:!1,previewHtml:"",previewXhr:null,previewError:null}},computed:{STYLE_TYPE_NONE:function(){return"none"},STYLE_TYPE_BULLET:function(){return C},STYLE_TYPE_NUMBERED:function(){return"numbered"},CONTENT_TYPE_PLAIN:function(){return S},CONTENT_TYPE_MARKDOWN:function(){return T},REF_TYPE_URL:function(){return I},REF_TYPE_SUBSPEC:function(){return P},titleMaxLength:function(){return window.const.blockTitleMaxLength},existingUrlRefItem:function(){return this.block&&this.block.refType===I&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&this.block.refType===P&&this.block.refItem||null}},watch:{refType:function(){this.refFields=null},body:function(){this.renderMarkdownPreview()},contentType:function(){this.renderMarkdownPreview()}},methods:{renderMarkdownPreview:function(){var e=this;this.contentType===T&&(this.body.trim()?(this.debouncedBodyRender||(this.debouncedBodyRender=m((function(t){e.loadingPreview=!0,e.previewError=null,e.previewXhr&&e.previewXhr.abort();var n=function(e){var t=o().post("/ajax/render-markdown",{markdown:e});return t.fail((function(e){0===e.status&&"abort"===e.statusText||d(e)})),t}(t);e.previewXhr=n,n.then((function(t){e.previewXhr===n&&(t.error?e.previewError=t.error:e.previewHtml=t.html,e.loadingPreview=!1,e.previewXhr=null)})).fail((function(){e.previewXhr===n&&(e.previewError="Error generating preview.",e.loadingPreview=!1,e.previewXhr=null)}))}),1e3)),this.debouncedBodyRender(this.body)):this.previewHtml="")},showAdd:function(e,t,n,s){if(!0===n)if(t){var i=o()('[data-spec-block="'+t+'"]',".spec-view"),r=i.prev("[data-spec-block]");n=r.length?r.data("vc").getStyleType():i.data("vc").getStyleType()}else if(e){var a=o()('[data-spec-block="'+e+'"]',".spec-view"),c=o()(">ul>[data-spec-block]:last-child",a);c.length&&(n=c.data("vc").getStyleType())}else{var l=o()(">ul>[data-spec-block]:last-child",".spec-view");l.length&&(n=l.data("vc").getStyleType())}"string"==typeof n&&(this.styleType=n),this.parentId=e,this.insertBeforeId=t,this.callback=s,this.showing=!0,this.focusTitleInput()},showEdit:function(e,t){var n=this;this.loading=!0,this.error=null,this.showing=!0,function(e,t){return o().get("/ajax/spec/load-edit-block",{specId:e,blockId:t}).fail(d)}(this.specId,e).then((function(e){n.loading=!1,n.block=e,n.styleType=e.styleType,n.contentType=e.contentType,n.title=e.title||"",n.body=e.body||"",n.refType=e.refType,n.callback=t,n.focusTitleInput()})).fail((function(){n.error="Error loading block",n.loading=!1}))},focusTitleInput:function(){var e=this;this.$nextTick((function(){o()("input",e.$refs.titleInput.$el).focus()}))},openEditUrl:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",e,(function(e){t.existingUrlRefItem&&e.id===t.existingUrlRefItem.id&&(t.block.refItem=e),n&&n(e)}),(function(e){t.existingUrlRefItem&&e===t.existingUrlRefItem.id&&(t.block.refType=null,t.block.refId=null,t.block.refItem=null),s&&s(e)}))},raisePlayVideo:function(e){this.$emit("play-video",e)},promotDelete:function(){var e=this;this.$emit("prompt-delete",this.block.id,(function(){e.showing=!1}))},submit:function(){var e=this;if(!this.refType||this.refFieldsValid&&this.refFields)if(this.contentType===T&&this.previewError)this.$alert("Error rendering preview. Please check your HTML syntax.",{type:"error"});else if(this.title.trim()||this.body.trim()){var t,n,s,i,r,a,c,l,u=this.createSendingSpinner(),p=this.callback;this.block?(t=this.specId,n=this.block.id,s=this.styleType,i=this.contentType,r=this.title,a=this.body,c=this.refType,l=this.refFields,l=l||{},o().post("/ajax/spec/save-block",ee({specId:t,blockId:n,styleType:s,contentType:i,title:r,body:a,refType:c},l)).fail(d)).then((function(t){p(t),e.showing=!1,u.close()})).fail((function(){u.close()})):function(e,t,n,s,i,r,a,c,l,u){return u=u||{},o().post("/ajax/spec/create-block",ee({specId:e,subspecId:t,parentId:n,insertBeforeId:s,styleType:i,contentType:r,title:a,body:c,refType:l},u)).fail(d)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,this.contentType,this.title,this.body,this.refType,this.refFields).then((function(t){p(t),e.showing=!1,u.close()})).fail((function(){u.close()}))}else this.$alert("A title, body, or attachment is required.",{type:"error"});else this.$alert('Please specify the attachment or choose "No media".',{type:"error"})},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.styleType=C,this.contentType=S,this.block=null,this.error=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1,this.previewHtml="",this.previewError=null}}},ot,[],!1,null,null,null);dt.options.__file="src/spec/edit-block-modal.vue";const pt=dt.exports;var mt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:e.urlObject?"Manage link":"Create link",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.urlObject?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.urlObject.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.urlObject.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("label",[e._v("\n\t\tURL\n\t\t"),n("el-input",{ref:"urlInput",attrs:{maxlength:e.urlMaxLength},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1),e._v(" "),e.urlObject?[e.url===e.urlObject.url?n("div",{staticClass:"preview"},[e.urlObject.imageData?n("img",{attrs:{src:e.urlObject.imageData}}):e._e(),e._v(" "),n("div",[e.urlObject.title?n("h3",[e._v(e._s(e.urlObject.title.trim()))]):e._e(),e._v(" "),e.urlObject.desc?n("div",[e._v(e._s(e.urlObject.desc.trim()))]):e._e(),e._v(" "),e.autoRefresh?n("p",[e._v("URL preview will be updated")]):n("el-checkbox",{model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}},[e._v("Refresh URL preview")])],1)]):n("p",[e._v("Link will be updated with new URL")])]:e._e(),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.urlObject?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.urlObject?"Save":"Create"))])],1)],2)};mt._withStripped=!0;var ht=A({components:{Moment:L},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=f,!f(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},urlMaxLength:function(){return window.const.urlMaxLength},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.createdCallback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.urlInput.$el).focus()}))},showEdit:function(e,t,n){var s=this;this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=n,this.showing=!0,this.$nextTick((function(){o()("input",s.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s=this.createdCallback;(t=this.specId,n=this.url,o().post("/ajax/spec/create-url",{specId:t,url:n}).fail(d)).then((function(t){s(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s=this.updatedCallback;(t=this.urlObject.id,n=this.url,o().post("/ajax/spec/refresh-url",{id:t,url:n}).fail(d)).then((function(t){s(t),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))}},promptDelete:function(){var e=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){e.sending=!0;var t,n=e.deletedCallback;(t=e.urlObject.id,o().post("/ajax/spec/delete-url",{id:t}).fail(d)).then((function(){n&&n(e.urlObject.id),e.sending=!1,e.showing=!1})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},mt,[],!1,null,null,null);ht.options.__file="src/spec/edit-url-modal.vue";const ft=ht.exports;var vt=n().extend(it),gt=A({components:{EditBlockModal:pt,EditUrlModal:ft},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new(n())}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null},choosingAddPosition:function(){return this.$store.getters.currentlyMovingBlocks},dragAndDropEnabled:function(){return this.enableEditing&&!this.$store.getters.mobileViewport}},watch:{dragAndDropEnabled:function(e){e?this.mountDragAndDrop():this.drake&&(this.drake.destroy(),this.drake=null)},dragging:function(e){e?this.autoscroller=function(){var e=70,t=o()(window),n=null,s=null;function i(e){s=e.clientY}return t.on("mousemove",i),n=window.requestAnimationFrame((function i(){if(null!==s){var o=t.height(),r=0;s<e?r=-((e-s)/e*8+1):s>o-e&&(r=(s-(o-e))/e*8+1),0!==r&&t.scrollTop(t.scrollTop()+r)}n=window.requestAnimationFrame(i)})),{stop:function(){t.off("mousemove",i),n&&(window.cancelAnimationFrame(n),n=null)}}}():this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null)}},mounted:function(){var e,t=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var n=0;n<e.length;n++)this.insertBlock(e[n]);this.$nextTick((function(){t.$emit("rendered")})),this.mountDragAndDrop()},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null),this.$store.getters.currentlyMovingBlocks&&this.$store.state.movingBlocksSourceSubspecId===this.subspecId&&this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.getFinalMovingBlockIds()}),this.eventBus.$destroy(),this.eventBus=null,o()("[data-spec-block]",this.$refs.list).each((function(e,t){o()(t).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var e=this,t=o()(window).scrollTop();o()("[data-spec-block]",this.$refs.list).each((function(n,s){var i=o()(s),r=i.offset();if(r.top>t){var a=r.top-t;return e.$nextTick((function(){o()(window).scrollTop(i.offset().top-a)})),!1}}))},transitRelativeScroll:function(e){var t=o()(window).scrollTop(),n=o()('[data-spec-block="'+e+'"]',this.$refs.list),s=n.offset().top-t;this.$nextTick((function(){o()(window).scrollTop(n.offset().top-s)}))},insertBlock:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=new vt({parent:this,store:O,router:zt,propsData:{block:e,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:n}}).$mount();s.$on("open-community",this.openBlockCommunity),s.$on("open-edit",this.openEditBlock),s.$on("prompt-add-subblock",this.promptAddSubblock),s.$on("prompt-delete",this.promptDeleteBlock),s.$on("start-moving",this.startMovingBlocks),s.$on("add-to-moving",this.addToMovingBlocks),s.$on("remove-from-moving",this.removeFromMovingBlocks),s.$on("prompt-nav-spec",this.promptNavSpec),s.$on("move-before",this.moveBeforeBlock),s.$on("move-into",this.moveIntoBlock),s.$on("move-after",this.moveAfterBlock),s.$on("cancel-moving",this.cancelMovingBlocks),s.$on("play-video",this.playVideo);var i=o()(s.$el).data("vc",s);if(e.subblocks)for(var r=0;r<e.subblocks.length;r++){var a=e.subblocks[r],c=this.insertBlock(a,!1);o()(">ul.spec-block-list",i).append(c)}return t&&i.appendTo(this.$refs.list),i},mountDragAndDrop:function(){var e=this;this.dragAndDropEnabled&&(this.drake||(console.debug("create drake"),this.drake=et()({isContainer:function(e){return o()(e).is(".spec-block-list")},accepts:function(e,t,n,s){return!o()(t).closest(".gu-transit").length},moves:function(e,t,n,s){return o()(n).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(t,n){e.$store.commit("startDragging"),e.transitRelativeScroll(o()(t).attr("data-spec-block"))})).on("dragend",(function(t){e.$store.commit("endDragging"),e.transitRelativeScroll(o()(t).attr("data-spec-block"))})).on("drop",(function(t,n,s,i){var r=o()(t).data("vc").getBlockId(),a=o()(s).closest("[data-spec-block]");a.length&&a.data("vc").updateHasSubblocks();var c=null,l=o()(n).closest("[data-spec-block]");if(l.length){var u=l.data("vc");c=u.getBlockId(),u.updateHasSubblocks()}var d=i?o()(i).data("vc").getBlockId():null;ne([r],e.subspecId,c,d)}))))},promptAddBlock:function(){var e=this;this.$refs.editBlockModal.showAdd(null,null,!0,(function(t){var n=e.insertBlock(t,!0,!0);e.panToBlock(n)}))},openBlockCommunity:function(e,t,n){this.$emit("open-community",w,e,t,n)},openEditBlock:function(e,t){this.$refs.editBlockModal.showEdit(e,t)},promptAddSubblock:function(e,t,n){var s=this;this.$refs.editBlockModal.showAdd(e,t,n,(function(n){var i=s.insertBlock(n,!1,!0);if(t)i.insertBefore('[data-spec-block="'+t+'"]');else if(e){var r=o()('[data-spec-block="'+e+'"]');i.appendTo(r.find(">ul.spec-block-list")),r.data("vc").updateHasSubblocks()}else i.appendTo(s.$refs.list);s.panToBlock(i)}))},promptDeleteBlock:function(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(e){return o().post("/ajax/spec/delete-block",{blockId:e}).fail(d)})(e).then((function(){o()('[data-spec-block="'+e+'"]').remove(),t&&t()}))})).catch((function(){}))},startMovingBlocks:function(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:[e]}),this.transitRelativeScroll(e)},addToMovingBlocks:function(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.concat([e])})},removeFromMovingBlocks:function(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.filter((function(t){return!p(t,e)}))})},moveBeforeBlock:function(e){var t=o()('[data-spec-block="'+e+'"]',this.$refs.list),n=t.parent().closest("[data-spec-block]"),s=n.length?n.attr("data-spec-block"):null,i=e;this.moveBlocks(s,i,(function(e){e.insertBefore(t)}))},moveIntoBlock:function(e){var t=o()('[data-spec-block="'+e+'"]',this.$refs.list),n=t.attr("data-spec-block"),s=t.find(">ul.spec-block-list");this.moveBlocks(n,null,(function(e){e.appendTo(s)})),t.data("vc").updateHasSubblocks()},moveAfterBlock:function(e){var t=o()('[data-spec-block="'+e+'"]',this.$refs.list),n=t.parent().closest("[data-spec-block]"),s=n.length?n.attr("data-spec-block"):null,i=t.next("[data-spec-block]"),r=i.length?i.attr("data-spec-block"):null,a=t;this.moveBlocks(s,r,(function(e){e.insertAfter(a),a=e}))},moveBlocksToBottom:function(){var e=this;this.moveBlocks(null,null,(function(t){t.appendTo(e.$refs.list)}))},getFinalMovingBlockIds:function(){if(!this.$store.getters.currentlyMovingBlocks)return[];if(!p(this.$store.state.movingBlocksSourceSubspecId,this.subspecId))return this.$store.state.movingBlockIds;var e=[];return o()("[data-moving-block-id]",this.$refs.list).each((function(t,n){var s=o()(n);s.closest(".spec-block-list.moving").length||e.push(s.attr("data-moving-block-id"))})),e},moveBlocks:function(e,t,n){var s=this,i=this.getFinalMovingBlockIds();i.length&&ne(i,this.subspecId,e,t).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;if(e)for(var r=0;r<e.length;r++){var a=s.insertBlock(e[r],!1,!0);n(a),t||(t=a)}else{for(var c={},l=0;l<i.length;l++){var u=o()('[data-spec-block="'+i[l]+'"]',s.$refs.list),d=u.parent().closest("[data-spec-block]");n(u),d.length&&(c[d.attr("data-spec-block")]=d.data("vc")),t||(t=u)}for(var p in c)c[p].updateHasSubblocks()}s.$store.commit("endMovingBlocks"),s.panToBlock(t)}))},cancelMovingBlocks:function(e){this.$store.commit("endMovingBlocks"),this.transitRelativeScroll(e)},openEditUrl:function(e,t,n){var s=this;this.$refs.editUrlModal.showEdit(e,(function(e){s.eventBus.$emit("url-updated",e),t&&t(e)}),(function(e){s.eventBus.$emit("url-deleted",e),n&&n(e)}))},playVideo:function(e){this.$emit("play-video",e)},promptNavSpec:function(){this.$emit("prompt-nav-spec")},panToBlock:function(e){var t=e.find(">.content").offset(),n=o()(window),s=n.scrollTop(),i=n.height();t.top<s+100?n.scrollTop(t.top-100):t.top>s+i-200&&n.scrollTop(t.top-(i-200))}}},Ze,[],!1,null,null,null);gt.options.__file="src/spec/view.vue";const bt=gt.exports;var _t=A({props:{loading:Boolean,spec:Object,enableEditing:Boolean},components:{SpecView:bt},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter spec-view",e),n()},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate spec-view",e),n()},methods:{promptNavSpec:function(){this.$emit("prompt-nav-spec")},openCommunity:function(e,t,n,s){this.$emit("open-community",e,t,n,s)},playVideo:function(e){this.$emit("play-video",e)}}},Je,[],!1,null,null,null);_t.options.__file="src/pages/spec-view.vue";const yt=_t.exports;var wt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"subspec-page"},[e.subspec?n("header",[e.onSubspecRoute&&!e.loading?n("div",{staticClass:"right"},[e.enableEditing?[n("el-button",{attrs:{type:e.unreadCount?"primary":"default",disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSubspecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2),e._v(" "),e.enableEditing?n("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSubspec()}}}):e._e()]:[n("span",[e._v("\n\t\t\t\t\tLast modified "),n("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1),e._v(" "),n("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSubspecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2)]],2):e._e(),e._v(" "),n("h3",{staticClass:"name"},[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?n("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()]):e._e(),e._v(" "),n("router-view",{ref:"view",attrs:{loading:e.loading,subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo}}),e._v(" "),e.enableEditing?n("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":e.specId}}):e._e()],1)};wt._withStripped=!0;var kt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:e.subspec?"Manage subspec":"Create subspec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.subspec?n("p",[e._v("\n\t\tCreated "),n("strong",[n("moment",{attrs:{datetime:e.subspec.created}})],1),e._v(";\n\t\tlast modified "),n("strong",[n("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)]):e._e(),e._v(" "),n("label",[e._v("\n\t\tName\n\t\t"),n("el-input",{ref:"nameInput",attrs:{maxlength:e.nameMaxLength,clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),n("label",[e._v("\n\t\tDescription\n\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.subspec?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSubspec()}}},[e._v("Delete")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.subspec?"Save":"Create"))])],1)])};kt._withStripped=!0;var Ct=A({components:{Moment:L},props:{specId:Number},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()},nameMaxLength:function(){return window.const.specNameMaxLength}},watch:{sending:function(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy:function(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate:function(e){var t=this;this.callback=e,this.showing=!0,this.$nextTick((function(){o()("input",t.$refs.nameInput.$el).focus()}))},showEdit:function(e,t){var n=this;this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((function(){o()("input",n.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var e=this;if(!this.disableSubmit){this.sending=!0;var t,n,s,i=this.callback;(t=this.specId,n=this.name,s=this.desc,o().post("/ajax/spec/create-subspec",{specId:t,name:n,desc:s}).fail(d)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))}},submitSave:function(){var e=this;this.sending=!0;var t,n,s,i=this.callback;(t=this.subspec.id,n=this.name,s=this.desc,o().post("/ajax/spec/save-subspec",{subspecId:t,name:n,desc:s}).fail(d)).then((function(t){i(t),e.showing=!1,e.sending=!1})).fail((function(){e.sending=!1}))},promptDeleteSubspec:function(){var e=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var t;e.sending=!0,(t=e.subspec.id,o().post("/ajax/spec/delete-subspec",{subspecId:t}).fail(d)).then((function(){e.sending=!1,e.showing=!1,e.$nextTick((function(){e.$router.push({name:"spec",params:{specId:e.specId}})}))})).fail((function(){e.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},kt,[],!1,null,null,null);Ct.options.__file="src/spec/edit-subspec-modal.vue";var St=A({components:{Moment:L,SpecView:bt,EditSubspecModal:Ct.exports},inheritAttrs:!1,props:{enableEditing:Boolean},data:function(){return{loading:!0,subspec:null,unreadCount:0,commentsCount:0}},computed:{specId:function(){return parseInt(this.$route.params.specId,10)},subspecId:function(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute:function(){return"subspec"===this.$route.name},choosingAddPosition:function(){return this.$store.getters.currentlyMovingBlocks},showUnreadOnly:function(){return this.$store.getters.userSettings.community.unreadOnly}},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter subspec",e),n((function(t){t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),n()},beforeRouteLeave:function(e,t,n){console.debug("beforeRouteLeave subspec"),this.subspec=null,this.unreadCount=0,this.commentsCount=0,h(),n()},methods:{loadSubspec:function(e,t,n){var s=this;console.debug("load subspec"),this.loading=!0,function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:n}).fail(d)}(e,t,n).then((function(e){console.debug("subspec loaded",e),s.subspec=e,s.unreadCount=e.unreadCount||0,s.commentsCount=e.commentsCount||0,h(e.name),s.loading=!1,s.$refs.view.$once("rendered",s.restoreScroll)})).fail((function(e){s.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(s.$route.fullPath)}})}))},promptNavSpec:function(){this.$emit("prompt-nav-spec")},openSubspecCommunity:function(){var e=this;this.$emit("open-community",y,this.subspec.id,(function(t){e.unreadCount+=t}),(function(t){e.commentsCount+=t}))},openCommunity:function(e,t,n,s){this.$emit("open-community",e,t,n,s)},playVideo:function(e){this.$emit("play-video",e)},openManageSubspec:function(){var e=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(t){e.subspec.updated=t.updated,e.subspec.name=t.name,e.subspec.desc=t.desc,e.unreadCount=t.unreadCount||0,e.commentsCount=t.commentsCount||0,h(t.name)}))},restoreScroll:function(){var e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),o()(window).scrollTop(e.y).scrollLeft(e.x))}}},wt,[],!1,null,null,null);St.options.__file="src/pages/subspec.vue";const Tt=St.exports;var It=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"subspec-view-page",class:{loading:e.loading}},[e.loading?n("p",[e._v("Loading...")]):e.subspec?n("spec-view",{key:e.subspec.renderTime,attrs:{subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};It._withStripped=!0;var $t=A({props:{loading:Boolean,subspec:Object,enableEditing:Boolean},components:{SpecView:bt},methods:{promptNavSpec:function(){this.$emit("prompt-nav-spec")},openCommunity:function(e,t,n,s){this.$emit("open-community",e,t,n,s)},playVideo:function(e){this.$emit("play-video",e)}}},It,[],!1,null,null,null);$t.options.__file="src/pages/subspec-view.vue";const Pt=$t.exports;var xt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"community-review-page"},[e._m(0),e._v(" "),n("div",{staticClass:"content-page"},[e.loading?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):[n("section",[n("h3",[e._v("Your specs")]),e._v(" "),e.specs.length?e._l(e.specs,(function(t){return n("div",{key:t.id,staticClass:"spec review"},[n("div",{staticClass:"flex-row"},[n("div",{staticClass:"flex-row nowrap fill"},[n("div",{staticClass:"expand"},[t.hasSubspecs?[e.expandedSpecs[t.id]?n("el-button",{attrs:{type:t.hasUnreadSubspec?"primary":"default",size:"mini",icon:"el-icon-arrow-up",circle:""},on:{click:function(n){return e.collapseSpec(t.id)}}}):n("el-button",{attrs:{type:t.hasUnreadSubspec?"primary":"default",size:"mini",icon:"el-icon-arrow-down",circle:""},on:{click:function(n){return e.expandSpec(t.id)}}})]:n("el-button",{staticStyle:{visibility:"hidden"},attrs:{type:"default",size:"mini",icon:"el-icon-aim",circle:""}})],2),e._v(" "),n("div",{staticClass:"name fill"},[n("router-link",{attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(t.name)+"\n\t\t\t\t\t\t\t\t\t")])],1)]),e._v(" "),n("div",[n("el-button",{attrs:{type:t.unread?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(n){return e.openSpecCommunity(t.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.unread)+" unread ("+e._s(t.total)+" total)\n\t\t\t\t\t\t\t\t")])],1),e._v(" "),n("div",[n("el-button",{attrs:{type:t.blockUnread?"primary":"default",size:"mini",icon:"el-icon-folder-opened"},on:{click:function(n){return e.gotoSpec(t.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.blockUnread)+" unread ("+e._s(t.blockTotal)+" total) on blocks\n\t\t\t\t\t\t\t\t")])],1)]),e._v(" "),e.expandedSpecs[t.id]?n("div",{staticClass:"subspecs"},[e.subspecsBySpecId[t.id]?e._l(e.subspecsBySpecId[t.id],(function(s){return n("div",{key:s.id,staticClass:"subspec review"},[n("div",{staticClass:"flex-row"},[n("div",{staticClass:"name fill"},[n("router-link",{attrs:{to:{name:"subspec",params:{specId:t.id,subspecId:s.id}}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+e._s(s.name)+"\n\t\t\t\t\t\t\t\t\t\t\t")])],1),e._v(" "),n("div",[n("el-button",{attrs:{type:s.unread?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(n){return e.openSubspecCommunity(t.id,s.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+e._s(s.unread)+" unread ("+e._s(s.total)+" total)\n\t\t\t\t\t\t\t\t\t\t\t")])],1),e._v(" "),n("div",[n("el-button",{attrs:{type:s.blockUnread?"primary":"default",size:"mini",icon:"el-icon-folder-opened"},on:{click:function(n){return e.gotoSubspec(t.id,s.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+e._s(s.blockUnread)+" unread ("+e._s(s.blockTotal)+" total) on blocks\n\t\t\t\t\t\t\t\t\t\t\t")])],1)])])})):n("p",[n("i",{staticClass:"el-icon-loading"})])],2):e._e()])})):n("p",[e._v("No specs")])],2),e._v(" "),n("section",[n("h3",[e._v("Your comments")]),e._v(" "),n("div",{staticClass:"flex-row wrap-reverse"},[n("div",{staticClass:"fill nowraptext",domProps:{textContent:e._s(e.formattedCommentsCount)}}),e._v(" "),n("el-checkbox",{on:{change:function(t){return e.reloadComments()}},model:{value:e.showUnreadOnly,callback:function(t){e.showUnreadOnly=t},expression:"showUnreadOnly"}},[e._v("\n\t\t\t\t\t\tShow only comments with unread replies\n\t\t\t\t\t")])],1),e._v(" "),e.comments.length?[e._l(e.comments,(function(t){return n("div",{key:t.id,staticClass:"comment review"},[n("div",{staticClass:"flex-row"},[n("div",{staticClass:"fill"},[n("username",{attrs:{username:e.$store.getters.username}}),e._v(" "),t.updated!==t.created?[e._v("\n\t\t\t\t\t\t\t\t\tupdated "),n("moment",{attrs:{datetime:t.updated,offset:!0}})]:[e._v("\n\t\t\t\t\t\t\t\t\tposted "),n("moment",{attrs:{datetime:t.created,offset:!0}})]],2),e._v(" "),n("div",[n("el-button",{attrs:{type:t.unread?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(n){return e.openCommentCommunity(t.specId,t.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.unread)+" unread ("+e._s(t.total)+" total)\n\t\t\t\t\t\t\t\t")])],1)]),e._v(" "),n("div",{staticClass:"body",domProps:{textContent:e._s(t.body)}})])})),e._v(" "),e.loadingCommentsPage?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading more comments...")]):e.hasMoreComments?n("el-button",{on:{click:function(t){return e.loadMoreComments()}}},[e._v("Load more")]):e._e()]:e.loadingCommentsPage?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):n("p",[e._v("No comments")])],2)]],2),e._v(" "),n("community-modal",{ref:"communityModal",attrs:{"spec-id":e.specId},on:{"play-video":e.playVideo}}),e._v(" "),n("play-video-modal",{ref:"playVideoModal"})],1)};function Et(e){return o().get("/ajax/community-review",e)}xt._withStripped=!0;var Rt=A({components:{Moment:L,CommunityModal:Ye,PlayVideoModal:Ge,Username:J},data:function(){return{loading:!0,showUnreadOnly:!1,specs:[],expandedSpecs:{},subspecsBySpecId:{},comments:[],totalComments:0,hasMoreComments:!1,loadingCommentsPage:!1,specId:null}},computed:{commentsPageArgs:function(){var e={unreadOnly:this.showUnreadOnly};return this.comments.length&&(e.updatedBefore=this.comments[this.comments.length-1].updated),e},formattedCommentsCount:function(){var e=this.totalComments;return e+" comment"+(1!==e?"s":"")+(this.showUnreadOnly?" with unread replies":"")}},beforeRouteEnter:function(e,t,n){console.debug("beforeRouteEnter community-review",e),n((function(e){e.initPage()}))},beforeRouteUpdate:function(e,t,n){console.debug("beforeRouteUpdate community-review",e),this.initPage(),n()},beforeRouteLeave:function(e,t,n){console.debug("beforeRouteLeave community-review"),this.specs=[],this.expandedSpecs={},this.subspecsBySpecId={},this.comments=[],this.totalComments=0,this.hasMoreComments=!1,this.specId=null,n()},methods:{initPage:function(){var e=this;this.showUnreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loading=!0,Et(o().extend({request:"all"},this.commentsPageArgs)).then((function(t){e.specs=t.specs,e.comments=t.comments,e.totalComments=t.totalComments,e.hasMoreComments=t.hasMoreComments,e.loading=!1})).fail((function(t){e.$router.replace({name:"ajax-error",params:{code:t.status},query:{url:encodeURIComponent(e.$route.fullPath)}})}))},expandSpec:function(e){var t=this,n=this.expandedSpecs[e];this.$set(this.expandedSpecs,e,!0),void 0===n&&Et({request:"subspecs",specId:e}).then((function(n){t.$set(t.subspecsBySpecId,e,n.subspecs)})).fail((function(n){t.$delete(t.expandedSpecs,e),d(n)}))},collapseSpec:function(e){this.$set(this.expandedSpecs,e,!1)},reloadComments:function(){var e=this;this.loadingCommentsPage=!0,this.comments=[],Et(o().extend({request:"comments"},this.commentsPageArgs)).then((function(t){e.loadingCommentsPage=!1,e.comments=t.comments,e.totalComments=t.totalComments,e.hasMoreComments=t.hasMoreComments})).fail((function(t){e.loadingCommentsPage=!1,d(t)}))},loadMoreComments:function(){var e=this;this.loadingCommentsPage=!0,Et(o().extend({request:"comments"},this.commentsPageArgs)).then((function(t){e.loadingCommentsPage=!1,e.comments=e.comments.concat(t.comments),e.hasMoreComments=t.hasMoreComments})).fail((function(t){e.loadingCommentsPage=!1,d(t)}))},openSpecCommunity:function(e){var t=this;this.specId=e,this.$nextTick((function(){t.$refs.communityModal.openCommunityReview(_,e,(function(n){for(var s=0;s<t.specs.length;s++)if(p(e,t.specs[s].id)){t.$set(t.specs[s],"unread",t.specs[s].unread+n);break}}),(function(n){for(var s=0;s<t.specs.length;s++)if(p(e,t.specs[s].id)){t.$set(t.specs[s],"total",t.specs[s].total+n);break}}))}))},gotoSpec:function(e){this.$router.push({name:"spec",params:{specId:e}})},openSubspecCommunity:function(e,t){var n=this;this.specId=e,this.$nextTick((function(){n.$refs.communityModal.openCommunityReview(y,t,(function(s){for(var i=n.subspecsBySpecId[e],o=0;o<i.length;o++)if(p(t,i[o].id)){n.$set(i[o],"unread",i[o].unread+s);break}var r=!1;if(s>0)r=!0;else for(o=0;o<i.length;o++)if(i[o].unread>0||i[o].blockUnread>0){r=!0;break}for(o=0;o<n.specs.length;o++)if(p(e,n.specs[o].id)){n.$set(n.specs[o],"hasUnreadSubspec",r);break}}),(function(s){for(var i=n.subspecsBySpecId[e],o=0;o<i.length;o++)if(p(t,i[o].id)){n.$set(i[o],"total",i[o].total+s);break}}))}))},gotoSubspec:function(e,t){this.$router.push({name:"subspec",params:{specId:e,subspecId:t}})},openCommentCommunity:function(e,t){var n=this;this.specId=e,this.$nextTick((function(){n.$refs.communityModal.openCommunityReview(k,t,(function(e){for(var s=0;s<n.comments.length;s++)if(p(t,n.comments[s].id)){n.$set(n.comments[s],"unread",n.comments[s].unread+e);break}}),(function(e){for(var s=0;s<n.comments.length;s++)if(p(t,n.comments[s].id)){n.$set(n.comments[s],"total",n.comments[s].total+e);break}}))}))},playVideo:function(e){this.$refs.playVideoModal.show(e)}}},xt,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",[n("h2",[e._v("Community review")])])}],!1,null,null,null);Rt.options.__file="src/pages/community-review.vue";const Ot=Rt.exports;var Bt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"admin-page"},[e._m(0),e._v(" "),n("div",{staticClass:"content-page"},[e.loading?n("p",[e._v("Loading...")]):403===e.error?n("p",[e._v("Unauthorized")]):e.error?n("p",[e._v("Error "+e._s(e.error))]):e._e(),e._v(" "),e.signupRequests?n("section",{staticClass:"signup-requests"},[n("h3",[e._v("Signup requests")]),e._v(" "),n("div",{staticClass:"options"},[n("el-checkbox",{model:{value:e.showAllSignupRequests,callback:function(t){e.showAllSignupRequests=t},expression:"showAllSignupRequests"}},[e._v("Show all")])],1),e._v(" "),e.loadingSignupRequests?n("p",[e._v("Loading...")]):e.signupRequests.length?n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.signupRequests,"max-height":.8*e.$store.state.windowHeight}},[n("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:"40"}}),e._v(" "),n("el-table-column",{attrs:{fixed:"",prop:"username",label:"Username",width:"150"}}),e._v(" "),n("el-table-column",{attrs:{prop:"email",label:"Email address",width:"300"}}),e._v(" "),n("el-table-column",{attrs:{label:"Created",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("moment",{attrs:{datetime:e.row.created,offset:!0}})]}}],null,!1,2518928277)}),e._v(" "),n("el-table-column",{attrs:{label:"Actions",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reviewed?e._e():n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.openReviewSignupRequest(t.row)}}},[e._v("\n\t\t\t\t\t\t\tReview\n\t\t\t\t\t\t")])]}}],null,!1,812736396)}),e._v(" "),e.showAllSignupRequests?[n("el-table-column",{attrs:{label:"Reviewed",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reviewed?n("el-tag",{attrs:{type:"success"}},[e._v("Yes")]):n("el-tag",{attrs:{type:"warning"}},[e._v("No")])]}}],null,!1,663840288)}),e._v(" "),n("el-table-column",{attrs:{label:"Approved",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reviewed?[t.row.approved?n("el-tag",{attrs:{type:"success"}},[e._v("Yes")]):n("el-tag",{attrs:{type:"warning"}},[e._v("No")])]:e._e()]}}],null,!1,2730911282)}),e._v(" "),n("el-table-column",{attrs:{prop:"userId",label:"User ID",width:"120"}})]:e._e()],2):e.showAllSignupRequests?n("p",[e._v("No data")]):n("p",[e._v("No pending requests")])],1):e._e()]),e._v(" "),e.reviewingSignupRequest?n("el-dialog",{attrs:{title:"Review signup request","close-on-click-modal":!e.sendingSignupRequestReview,width:e.$store.getters.dialogTinyWidth,visible:""}},[n("table",[n("tr",[n("td",[e._v("Request ID")]),e._v(" "),n("td",[e._v(e._s(e.reviewingSignupRequest.id))])]),e._v(" "),n("tr",[n("td",[e._v("Created")]),e._v(" "),n("td",[n("moment",{attrs:{datetime:e.reviewingSignupRequest.created}})],1)]),e._v(" "),n("tr",[n("td",[e._v("Username")]),e._v(" "),n("td",[n("strong",[e._v(e._s(e.reviewingSignupRequest.username))])])]),e._v(" "),n("tr",[n("td",[e._v("Email address")]),e._v(" "),n("td",[n("strong",[e._v(e._s(e.reviewingSignupRequest.email))])])])]),e._v(" "),n("br"),n("br"),e._v(" "),n("label",[e._v("\n\t\t\tMessage\n\t\t\t"),n("el-input",{attrs:{type:"textarea",autosize:{minRows:2},readonly:e.sendingSignupRequestReview},model:{value:e.signupRequestResponse,callback:function(t){e.signupRequestResponse=t},expression:"signupRequestResponse"}})],1),e._v(" "),e.sendingSignupRequestReview?n("p",[n("i",{staticClass:"el-icon-loading"}),e._v(" Sending...\n\t\t")]):e._e(),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{disabled:e.sendingSignupRequestReview},on:{click:function(t){return e.cancelReviewSignupRequest()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")]),e._v(" "),n("el-button",{attrs:{type:"warning",disabled:e.sendingSignupRequestReview},on:{click:function(t){return e.submitSignupRequestReview(!1)}}},[e._v("\n\t\t\t\tDecline\n\t\t\t")]),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:e.sendingSignupRequestReview},on:{click:function(t){return e.submitSignupRequestReview(!0)}}},[e._v("\n\t\t\t\tApprove\n\t\t\t")])],1)]):e._e()],1)};Bt._withStripped=!0;var jt=A({components:{Moment:L},data:function(){return{loadingSignupRequests:!0,error:null,showAllSignupRequests:!1,signupRequests:null,reviewingSignupRequest:null,signupRequestResponse:"",sendingSignupRequestReview:!1}},computed:{loading:function(){return this.loadingSignupRequests},unauthorized:function(){return!(this.loading||this.error||this.signupRequests)}},watch:{showAllSignupRequests:function(){this.loadAdmin()}},beforeRouteEnter:function(e,t,n){n((function(e){e.loadAdmin()}))},beforeRouteUpdate:function(e,t,n){this.loadAdmin(),n()},methods:{loadAdmin:function(){var e=this;this.loadingSignupRequests=!0,this.error=null,$.get("/ajax/admin/signup-requests",{all:this.showAllSignupRequests}).then((function(t){e.loadingSignupRequests=!1,e.signupRequests=t})).fail((function(t){e.loadingSignupRequests=!1,e.error=t.status,d(t)}))},openReviewSignupRequest:function(e){this.signupRequestResponse="",this.reviewingSignupRequest=e},cancelReviewSignupRequest:function(){this.reviewingSignupRequest=null,this.signupRequestResponse=""},submitSignupRequestReview:function(e){var t=this;this.reviewingSignupRequest&&(this.sendingSignupRequestReview=!0,$.post("/ajax/admin/review-signup",{requestId:this.reviewingSignupRequest.id,approved:e,message:this.signupRequestResponse}).then((function(){t.sendingSignupRequestReview=!1;for(var n=0;n<t.signupRequests.length;n++)if(p(t.signupRequests[n].id,t.reviewingSignupRequest.id)){t.showAllSignupRequests?(t.reviewingSignupRequest.reviewed=!0,t.reviewingSignupRequest.approved=e,t.signupRequests.splice(n,1,t.reviewingSignupRequest)):t.signupRequests.splice(n,1);break}t.reviewingSignupRequest=null,t.signupRequestResponse=""})).fail((function(e){t.sendingSignupRequestReview=!1,d(e)})))}}},Bt,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",[n("h2",[e._v("Admin panel")])])}],!1,null,null,null);jt.options.__file="src/pages/admin.vue";const Ut=jt.exports;var Mt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ajax-error-page content-page"},[0===e.statusCode?n("p",[e._v("Could not connect to server")]):503===e.statusCode?n("p",[e._v("CrowdSpec is currently offline for database upgrades")]):n("p",[e._v("Request failed with error code "+e._s(e.statusCode))]),e._v(" "),e.url?n("el-button",{on:{click:function(t){return e.retry()}}},[e._v("Retry")]):e._e()],1)};Mt._withStripped=!0;var At=A({computed:{url:function(){return decodeURIComponent(this.$route.query.url)},statusCode:function(){return parseInt(this.$route.params.code,10)||0}},methods:{retry:function(){this.$router.replace(this.url)}}},Mt,[],!1,null,null,null);At.options.__file="src/pages/ajax-error.vue";const Nt=At.exports;var Lt=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"content-page"},[e._v("\n\tNot found\n")])};Lt._withStripped=!0;var Ft=A({},Lt,[],!1,null,null,null);Ft.options.__file="src/pages/not-found.vue";const Dt=Ft.exports;var qt=new(j())({mode:"history",routes:[{name:"index",path:"/",component:ce},{path:"/spec/:specId",component:Ke,children:[{name:"spec",path:"",component:yt},{path:"subspec/:subspecId",component:Tt,children:[{name:"subspec",path:"",component:Pt}]}]},{name:"community-review",path:"/community-review",component:Ot},{name:"admin",path:"/admin",component:Ut},{name:"ajax-error",path:"/ajax-error/:code",component:Nt},{path:"*",component:Dt}],scrollBehavior:function(e,t,n){return O.commit("setSavedScrollPosition",n),n||{x:0,y:0}}});qt.beforeEach((function(e,t,n){t&&(!O.getters.currentSpecId||e.params.specId&&p(e.params.specId,O.getters.currentSpecId)?"spec"===t.name&&O.commit("saveCurrentSpecScrollTop"):(O.commit("clearCurrentSpec"),O.commit("endMovingBlocks"))),n()})),qt.afterEach((function(e,t){console.debug("afterEach"),O.commit("clearSavedScrollPosition")}));const zt=qt;var Vt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"edit-profile-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogTinyWidth,"close-on-click-modal":null===e.mode},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.clearMode()}}},[n("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n\t\tAccount options for\n\t\t"),n("username",{attrs:{username:e.username,highlight:e.highlight}})],1),e._v(" "),e.changePasswordMode?n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.changePasswordForm,rules:e.changePasswordRules,"label-position":"top"}},[n("el-form-item",{attrs:{label:"Current password",prop:"oldPass"}},[n("el-input",{ref:"oldPass",attrs:{type:"password",name:"old_password",autocomplete:"current-password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.oldPass)}},model:{value:e.changePasswordForm.oldPass,callback:function(t){e.$set(e.changePasswordForm,"oldPass",t)},expression:"changePasswordForm.oldPass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[n("el-input",{ref:"newPass",attrs:{type:"password",name:"new_password",autocomplete:"new-password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass)}},model:{value:e.changePasswordForm.newPass,callback:function(t){e.$set(e.changePasswordForm,"newPass",t)},expression:"changePasswordForm.newPass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[n("el-input",{ref:"newPass2",attrs:{type:"password",name:"verify_password",autocomplete:"new-password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass2)}},model:{value:e.changePasswordForm.newPass2,callback:function(t){e.$set(e.changePasswordForm,"newPass2",t)},expression:"changePasswordForm.newPass2"}})],1),e._v(" "),n("el-form-item",[n("el-alert",{attrs:{type:"info",closable:!1}},[n("p",[e._v("Your password is sent through HTTPS to Google Cloud Platform in Montral and encrypted server-side using "),n("a",{attrs:{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"}},[e._v("bcrypt")]),e._v(".")]),e._v(" "),n("p",[e._v("Please use a good password so your account is less likely to be hijacked and used to cause trouble.")]),e._v(" "),n("p",[e._v("\n\t\t\t\t\tFor your security, you should not use the same passwords that you use for important services such as email and online banking on other websites.\n\t\t\t\t\tIf one website gets hacked, you can lose access to every other site where you use the same password.\n\t\t\t\t\tIs is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service.\n\t\t\t\t")])])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitChangePassword()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),n("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):e.updateSettingsMode?n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.settingsForm,"label-position":"top"}},[n("el-form-item",[n("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Profile")]),e._v(" "),n("div",{staticClass:"flex-input"},[n("el-color-picker",{attrs:{predefine:e.predefinedUsernameHighlights,"color-format":"rgb"},model:{value:e.settingsForm.userProfile.highlightUsername,callback:function(t){e.$set(e.settingsForm.userProfile,"highlightUsername",t)},expression:"settingsForm.userProfile.highlightUsername"}}),e._v(" "),e.settingsForm.userProfile.highlightUsername?n("el-button",{attrs:{size:"mini",icon:"el-icon-close"},on:{click:function(t){e.settingsForm.userProfile.highlightUsername=null}}}):e._e(),e._v(" "),n("username",{attrs:{username:"Username colour",highlight:e.settingsForm.userProfile.highlightUsername}})],1)]),e._v(" "),n("el-form-item",[n("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Block editing")]),e._v(" "),n("el-select",{model:{value:e.settingsForm.blockEditing.deleteButton,callback:function(t){e.$set(e.settingsForm.blockEditing,"deleteButton",t)},expression:"settingsForm.blockEditing.deleteButton"}},[n("el-option",{attrs:{label:"Show delete button only in edit block modal",value:"modal"}}),e._v(" "),n("el-option",{attrs:{label:"Show delete button on newly added blocks",value:"recent"}}),e._v(" "),n("el-option",{attrs:{label:"Show delete button on all blocks",value:"all"}})],1)],1),e._v(" "),n("el-form-item",[n("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Community")]),e._v(" "),n("el-checkbox",{model:{value:e.settingsForm.community.unreadOnly,callback:function(t){e.$set(e.settingsForm.community,"unreadOnly",t)},expression:"settingsForm.community.unreadOnly"}},[e._v("\n\t\t\t\tShow only unread comments by default\n\t\t\t")])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitSettings()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),n("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):n("div",{staticClass:"options"},[n("p",[e._v("Your email address on file is "),n("span",{staticClass:"email"},[e._v(e._s(e.$store.getters.emailAddress))]),e._v(".")]),e._v(" "),n("el-button",{on:{click:function(t){return e.enterChangePasswordMode()}}},[e._v("\n\t\t\tChange password\n\t\t")]),e._v(" "),n("el-button",{on:{click:function(t){return e.enterUpdateSettingsMode()}}},[e._v("\n\t\t\tUpdate settings\n\t\t")])],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],1)};Vt._withStripped=!0;var Yt=A({components:{Username:J},data:function(){return{showing:!1,mode:null,changePasswordForm:{oldPass:"",newPass:"",newPass2:""},settingsForm:{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},waiting:!1}},computed:{username:function(){return this.$store.getters.username},highlight:function(){return this.$store.getters.userSettings.userProfile.highlightUsername},changePasswordMode:function(){return 1===this.mode},updateSettingsMode:function(){return 2===this.mode},changePasswordRules:function(){var e=this;return{oldPass:[{validator:function(e,t,n){t.trim()?n():n(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:function(t,n,s){n.trim().length<window.const.passwordMinLength?s(new Error("Password minimum length is "+window.const.passwordMinLength+" digits")):(e.changePasswordForm.newPass2.trim()&&e.$refs.changePasswordForm.validateField("newPass2"),s())},trigger:"blur"}],newPass2:[{validator:function(t,n,s){n.trim()?n!==e.changePasswordForm.newPass?s(new Error("Passwords do not match")):s():s(new Error("Repeat new password"))},trigger:"blur"}]}},predefinedUsernameHighlights:function(){return["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"]}},methods:{show:function(){this.showing=!0},enterChangePasswordMode:function(){this.mode=1,this.selectOldPassword()},enterUpdateSettingsMode:function(){var e=this;this.mode=2,this.waiting=!0,o().get("/ajax/settings").then((function(t){e.settingsForm=o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},t),e.waiting=!1})).fail((function(t){e.waiting=!1,e.clearMode(),d(t)}))},handleChangePasswordReturn:function(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():o()("input",this.$refs.newPass2.$el).focus().select():o()("input",this.$refs.newPass.$el).focus().select():o()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword:function(){var e=this;this.$refs.changePasswordForm.validate((function(t){t&&(e.waiting=!0,o().post("/ajax/user/change-password",{old:e.changePasswordForm.oldPass,new:e.changePasswordForm.newPass,new2:e.changePasswordForm.newPass2}).then((function(){e.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),e.clearMode()})).fail((function(t){if(t&&t.readyState)switch(t.status){case 400:e.$message({message:"New password rejected",type:"error",showClose:!0,duration:4e3});break;case 403:e.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:4e3}),e.selectOldPassword();break;default:d(t)}else d(t)})).always((function(){e.waiting=!1})))}))},selectOldPassword:function(){var e=this;this.$nextTick((function(){e.$refs.oldPass&&o()("input",e.$refs.oldPass.$el).focus().select()}))},submitSettings:function(){var e=this;this.waiting=!0,o().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((function(t){e.waiting=!1,e.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),e.clearMode(),e.$store.commit("setUserSettings",t)})).fail((function(t){e.waiting=!1,d(t)}))},clearMode:function(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},Vt,[],!1,null,null,null);Yt.options.__file="src/widgets/edit-profile-modal.vue";const Ht=Yt.exports;var Wt=A({store:O,router:zt,components:{Username:J,EditProfileModal:Ht},computed:{username:function(){return this.$store.getters.username},highlight:function(){return this.$store.getters.userSettings.userProfile.highlightUsername}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"},openEditProfile:function(){this.$refs.editProfileModal.show()}}},s,[],!1,null,null,null);Wt.options.__file="src/app.vue";const Gt=Wt.exports;ELEMENT.locale(ELEMENT.lang.en),new(n())(Gt).$mount("#app")})();