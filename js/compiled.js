(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=Vue;var s=e.n(t),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app"},[s("header",[s("h1",{on:{click:function(t){return e.gotoIndex()}}},[e._v("CrowdSpec")]),e._v(" "),s("div",[s("el-button",{staticClass:"username-button",attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openEditProfile()}}},[s("username",{attrs:{username:e.username,highlight:e.highlight}})],1),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.logout()}}},[e._v("Log out")])],1)]),e._v(" "),s("router-view",{staticClass:"page-area"}),e._v(" "),s("edit-profile-modal",{ref:"editProfileModal"})],1)};i._withStripped=!0;const n=jQuery;var o=e.n(n);const r=Vuex;var l=e.n(r);const a=moment;var c=e.n(a);const d=/^VersionStamp: (.+)$/m;function u(e){console.error(e);let t=null;e&&(0===e.readyState?t="Could not connect to server.":e.readyState&&e.status?t=503===e.status?"CrowdSpec is currently offline for database upgrades. Please try again in a bit.":"Request failed with HTTP error code "+e.status+".":e.message?t=e.message:"string"==typeof e&&(t=e)),t||(t="An error occurred."),e&&e.responseText&&d.test(e.responseText)&&d.exec(e.responseText)[1]!==window.const.appVersion&&(t+=" (A new version is available. Reload this page to use the latest client code.)"),s().prototype.$alert(t,"Error",{confirmButtonText:"Ok",type:"error"})}function p(e,t){return null===e&&null===t||parseInt(e,10)===parseInt(t,10)}function h(e,t=500){var s;function i(){s=null,e.apply(this,arguments)}return function(){return s&&clearTimeout(s),s=setTimeout(i.bind(this,...arguments),t)}}function m(e=null){document.title="CrowdSpec"+(e?" | "+e:"")}function g(e){if(window.URL)try{return new URL(e),!0}catch{return!1}return!(!e||!e.trim())}const v=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function b(e){return v.test(e)}function f(e){if(!e)return"";switch(e){case"url":return"URL"}return e.charAt(0).toUpperCase()+e.slice(1)}const _="spec",y="subspec",w="block",k="comment",C="bullet",S="plaintext",T="markdown",I="url",x="subspec",P="user";s().use(l());const E=o()(window),R=new(l().Store)({state:()=>({currentTime:Date.now(),windowWidth:E.width(),windowHeight:E.height(),dragging:!1,movingBlockIds:[],movingBlocksSourceSubspecId:null,savedScrollPosition:null,currentSpec:null,currentSpecScrollTop:null,userSettings:window.user.settings}),getters:{currentUserId:e=>window.user.id,username:e=>window.user.username,emailAddress:e=>window.user.email,userSettings:e=>o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e.userSettings),userIsAdmin:e=>window.user.admin,mobileViewport:e=>e.windowWidth<=767,dialogTinyWidth:e=>e.windowWidth<=767?"80%":e.windowWidth<=991?"50%":"30%",dialogSmallWidth:e=>e.windowWidth<=767?"90%":e.windowWidth<=991?"75%":"50%",dialogLargeWidth:e=>e.windowWidth<=991?"95%":"90%",currentlyMovingBlocks:e=>e.movingBlockIds.length>0,currentlyMovingBlock:e=>t=>e.movingBlockIds.indexOf(t)>=0,currentSpecId:e=>e.currentSpec?e.currentSpec.id:null,currentSpecOwnedByUser:(e,t)=>!!e.currentSpec&&e.currentSpec.ownerType===P&&p(e.currentSpec.ownerId,t.currentUserId)},mutations:{updateWindowDimensions(e){e.windowWidth=E.width(),e.windowHeight=E.height()},setUserSettings(e,t){e.userSettings=t},startDragging(e){e.dragging=!0},endDragging(e){e.dragging=!1},setMovingBlocks(e,t){e.movingBlocksSourceSubspecId=t.subspecId,e.movingBlockIds=t.blockIds},endMovingBlocks(e){e.movingBlocksSourceSubspecId=null,e.movingBlockIds=[]},setSavedScrollPosition(e,t){console.debug("setSavedScrollPosition",t),e.savedScrollPosition=t},clearSavedScrollPosition(e){console.debug("clearSavedScrollPosition"),e.savedScrollPosition=null},saveCurrentSpec(e,t){console.debug("saveCurrentSpec"),e.currentSpec&&!p(e.currentSpec.id,t.id)&&(console.debug("saveCurrentSpec clear currentSpecScrollTop"),e.currentSpecScrollTop=null),e.currentSpec=t},saveCurrentSpecScrollTop(e){console.debug("saveCurrentSpecScrollTop"),e.currentSpecScrollTop=E.scrollTop()},clearCurrentSpec(e){e.currentSpec=null,e.currentSpecScrollTop=null},updateCurrentTime(e){e.currentTime=Date.now()}}}),j=R;E.on("resize",(()=>{R.commit("updateWindowDimensions")})),setTimeout((function e(){R.commit("updateCurrentTime"),setTimeout(e,6e4)}),6e4);const U=VueRouter;var B=e.n(U),M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index-page"},[s("div",{staticClass:"actions"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.promptCreateSpec()}}},[e._v("\n\t\t\tNew spec\n\t\t")]),e._v(" "),s("el-button",{attrs:{type:e.unreadCommunity?"primary":"default"},on:{click:function(t){return e.$router.push({name:"community-review"})}}},[e._v("\n\t\t\tCommunity review\n\t\t\t"),e.unreadCommunity?[e._v("("+e._s(e.unreadCommunity)+" unread)")]:e._e()],2),e._v(" "),e.$store.getters.userIsAdmin?s("el-button",{staticClass:"admin-access",on:{click:function(t){return e.$router.push({name:"admin"})}}},[e._v("\n\t\t\tAdmin\n\t\t")]):e._e()],1),e._v(" "),s("div",{staticClass:"user-specs"},[s("h2",[e._v("Your specs")]),e._v(" "),e.loading?s("p",[e._v("Loading...")]):e.userSpecs&&e.userSpecs.length?s("ul",{staticClass:"specs-list"},e._l(e.userSpecs,(function(t){return s("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"status",class:{public:t.public}},[t.public?[s("i",{staticClass:"el-icon-umbrella"}),e._v(" Public")]:[s("i",{staticClass:"el-icon-lock"}),e._v(" Private")]],2)]),e._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[e._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?s("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):s("p",[e._v("You do not have any specs.")])]),e._v(" "),s("div",{staticClass:"public-specs",class:{"adjust-margin":!!e.userSpecs.length}},[s("h2",[e._v("Public specs")]),e._v(" "),e.loading?s("p",[e._v("Loading...")]):e.publicSpecs&&e.publicSpecs.length?s("ul",{staticClass:"specs-list"},e._l(e.publicSpecs,(function(t){return s("router-link",{key:t.id,attrs:{tag:"li",to:{name:"spec",params:{specId:t.id}}}},[s("div",{staticClass:"info"},[s("username",{attrs:{username:t.username,highlight:t.highlight}})],1),e._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v(e._s(t.name))]),e._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[e._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:t.updated,offset:!0}})],1)])]),e._v(" "),t.desc?s("div",{staticClass:"desc"},[e._v(e._s(t.desc))]):e._e()],1)})),1):s("p",[e._v("There are no public specs......")])]),e._v(" "),s("edit-spec-modal",{ref:"editSpecModal"})],1)};M._withStripped=!0;var O=function(){var e=this,t=e.$createElement;return(e._self._c||t)("span",[e._v(e._s(e.output))])};function A(e,t,s,i,n,o,r,l){var a,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),i&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),r?(a=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=a):n&&(a=l?function(){n.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:n),a)if(c.functional){c._injectStyles=a;var d=c.render;c.render=function(e,t){return a.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,a):[a]}return{exports:e,options:c}}O._withStripped=!0;var N=A({props:{datetime:String,offset:Boolean},data:()=>({timeout:null}),computed:{moment(){return c().parseZone(this.datetime).local()},currentTime(){return this.$store.state.currentTime},output(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},O,[],!1,null,null,null);N.options.__file="src/widgets/moment.vue";const L=N.exports;var F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"username"},[s("i",{staticClass:"el-icon-user",style:e.style}),e._v(" "),s("span",[e._v(e._s(e.username))])])};F._withStripped=!0;const q=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/,D=/^hsl\((\d{1,3}), (\d{1,3})%, (\d{1,3})%\)$/,z=/^#[0-9a-f]{6}$/i;function V(e){if(e&&"object"==typeof e){if(e.hsl)return H(e);if(e.rgb)return e}else if("string"==typeof e){if(q.test(e)){let t=q.exec(e);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),rgb:!0}}if(z.test(e)){function t(e){e=e.toLowerCase();let t=0;for(let s=0;s<e.length;s++){let i=e.charCodeAt(e.length-1-s);i>=48&&i<=57?t+=(i-48)*Math.pow(16,s):i>=97&&i<=122&&(t+=(i-97+10)*Math.pow(16,s))}return t}return{r:t(e.substr(1,2)),g:t(e.substr(3,2)),b:t(e.substr(5,2)),rgb:!0}}if(D.test(e))return H(e)}return{r:0,g:0,b:0,rgb:!0}}function Y(e){if(e&&"object"==typeof e){if(e.hsl)return e;if(e.rgb)return W(e)}else if("string"==typeof e){if(D.test(e)){let t=D.exec(e);return{h:parseInt(t[1],10),s:parseFloat(t[2]),l:parseFloat(t[3]),hsl:!0}}if(q.test(e)||z.test(e))return W(e)}return{h:0,s:0,l:0,hsl:!0}}function H(e){if(e&&"object"==typeof e&&e.rgb)return e;let t,s,i,n=(e=Y(e)).h,o=e.s/100,r=e.l/100,l=(1-Math.abs(2*r-1))*o,a=l*(1-Math.abs(n/60%2-1)),c=r-l/2;return 0<=n&&n<60?(t=l,s=a,i=0):60<=n&&n<120?(t=a,s=l,i=0):120<=n&&n<180?(t=0,s=l,i=a):180<=n&&n<240?(t=0,s=a,i=l):240<=n&&n<300?(t=a,s=0,i=l):300<=n&&n<360&&(t=l,s=0,i=a),{r:Math.round(255*(t+c)),g:Math.round(255*(s+c)),b:Math.round(255*(i+c)),rgb:!0}}function W(e){if(e&&"object"==typeof e&&e.hsl)return e;let t,s=(e=V(e)).r/255,i=e.g/255,n=e.b/255,o=Math.min(s,i,n),r=Math.max(s,i,n),l=r-o;t=0==l?0:r==s?(i-n)/l%6:r==i?(n-s)/l+2:(s-i)/l+4,t=Math.round(60*t);let a=(r+o)/2;return{h:t<0?t+360:t,s:+(100*(0==l?0:l/(1-Math.abs(2*a-1)))).toFixed(1),l:+(100*a).toFixed(1),hsl:!0}}function G(e){let t=V(e);return"rgb("+t.r+", "+t.g+", "+t.b+")"}var K=A({props:{username:{type:String,required:!0},highlight:String},computed:{style(){let e=this.username===this.$store.getters.username?this.$store.getters.userSettings.userProfile.highlightUsername:this.highlight;if(!e)return null;let t=G(e),s=G(function(e){let t=Y(e);return t.l<=25?t.l=75:t.l<=50?t.l=90:t.l<=75?t.l=10:t.l=25,t}(e));return{color:t,"text-shadow":"-1px -1px 0 "+s+", 1px -1px 0 "+s+", -1px 1px 0 "+s+", 1px 1px 0 "+s}}}},F,[],!1,null,null,null);K.options.__file="src/widgets/username.vue";const X=K.exports;var Q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:e.spec?"Manage spec":"Create spec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.spec?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.spec.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{maxlength:e.nameMaxLength,clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("label",[e._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),s("el-checkbox",{model:{value:e.isPublic,callback:function(t){e.isPublic=t},expression:"isPublic"}},[e._v("Allow public access and community features")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.spec?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSpec()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.spec?"Save":"Create"))])],1)],1)};function Z(e,t,s,i){for(var n=0;n<e.length;n++)e[n]=parseInt(e[n],10);return e=JSON.stringify(e),o().post("/ajax/spec/move-blocks",{blockIds:e,subspecId:t,parentId:s,insertBeforeId:i}).fail(u)}function J(e,t,s,i,n){return o().get("/ajax/spec/community/page",{specId:e,targetType:t,targetId:s,updatedBefore:i,unreadOnly:n}).fail(u)}Q._withStripped=!0;var ee=A({components:{Moment:L},data:()=>({name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{o()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.spec=e,this.name=e.name,this.desc=e.desc,this.isPublic=e.public,this.callback=t,this.showing=!0,this.$nextTick((()=>{o()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;var t,s,i;(t=this.name,s=this.desc,i=this.isPublic,o().post("/ajax/spec/create-spec",{name:t,desc:s,isPublic:i}).fail(u)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,s,i,n;(t=this.spec.id,s=this.name,i=this.desc,n=this.isPublic,o().post("/ajax/spec/save-spec",{specId:t,name:s,desc:i,isPublic:n}).fail(u)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSpec(){this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.spec.id,o().post("/ajax/spec/delete-spec",{specId:e}).fail(u)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"index"})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},Q,[],!1,null,null,null);ee.options.__file="src/spec/edit-spec-modal.vue";const te=ee.exports;var se=A({components:{Moment:L,Username:X,EditSpecModal:te},data:()=>({unreadCommunity:0,userSpecs:[],publicSpecs:[],loading:!0}),mounted(){this.reloadSpecs()},beforeRouteUpdate(e,t,s){this.reloadSpecs(),s()},methods:{reloadSpecs(){this.loading=!0,o().get("/ajax/home").then((e=>{this.unreadCommunity=e.unread,this.userSpecs=e.userSpecs,this.publicSpecs=e.publicSpecs,this.loading=!1})).fail((e=>{this.loading=!1,u(e)}))},promptCreateSpec(){this.$refs.editSpecModal.showCreate((e=>{this.$router.push({name:"spec",params:{specId:e}})}))}}},M,[],!1,null,null,null);se.options.__file="src/pages/index.vue";const ie=se.exports;var ne=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"spec-page"},[e.spec?s("header",[e.loading?e._e():s("div",{staticClass:"right"},[e.currentUserOwns?s("span",[e._v("You own this")]):s("span",[e._v("\n\t\t\t\tOwned by\n\t\t\t\t"),e.spec.username?s("username",{attrs:{username:e.spec.username,highlight:e.spec.highlight}}):[e._v(e._s(e.spec.ownerType)+" "+e._s(e.spec.ownerId))]],2),e._v(" "),e.onSpecRoute?[e.enableEditing?[e.spec.public?s("span",[e._v("\n\t\t\t\t\t\tPublic\n\t\t\t\t\t")]):s("span",[s("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[s("i",{staticClass:"el-icon-lock"})])],1),e._v(" "),s("el-button",{attrs:{type:e.unreadCount?"primary":"default",disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSpecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2),e._v(" "),s("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSpec()}}})]:[s("span",[e._v("\n\t\t\t\t\t\tLast modified "),s("moment",{attrs:{datetime:e.spec.updated,offset:!0}})],1),e._v(" "),s("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSpecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2)]]:e._e(),e._v(" "),s("el-button",{attrs:{size:"mini",icon:"el-icon-folder"},on:{click:function(t){return e.promptNavSpec()}}})],2),e._v(" "),s("h2",{staticClass:"name",on:{click:function(t){return e.gotoSpec()}}},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()]):e._e(),e._v(" "),s("router-view",{ref:"view",attrs:{loading:e.loading,spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo}}),e._v(" "),e.enableEditing?s("edit-spec-modal",{ref:"editSpecModal"}):e._e(),e._v(" "),s("nav-spec-modal",{ref:"navSpecModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId}}),e._v(" "),s("community-modal",{ref:"communityModal",attrs:{"spec-id":e.specId},on:{"play-video":e.playVideo}}),e._v(" "),s("play-video-modal",{ref:"playVideoModal"})],1)};ne._withStripped=!0;var oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"nav-spec-modal",attrs:{title:"Navigate spec",visible:e.showing,width:e.$store.getters.dialogTinyWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.loading?s("p",[e._v("Loading...")]):e.subspecs.length?[s("el-select",{attrs:{placeholder:"Choose subspec"},model:{value:e.selectedSubspecId,callback:function(t){e.selectedSubspecId=t},expression:"selectedSubspecId"}},e._l(e.subspecs,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?s("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:s("p",[e._v("No subspecs.")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")]),e._v(" "),e.subspecId?s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.goToSpec()}}},[e._v("\n\t\t\tGo to spec\n\t\t")]):e._e(),e._v(" "),e.subspecs.length?s("el-button",{attrs:{type:"primary",disabled:e.disableGoToSubspec},on:{click:function(t){return e.goToSubspec()}}},[e._v("\n\t\t\tGo to subspec\n\t\t")]):e._e()],1)],2)};oe._withStripped=!0;var re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-subspec ref-item"},[s("div",[s("div",{staticClass:"title"},[e._m(0),e._v(" "),s("router-link",{attrs:{to:{name:"subspec",params:{specId:e.item.specId,subspecId:e.item.id}}}},[e._v("\n\t\t\t\t"+e._s(e.item.name.trim())+"\n\t\t\t")])],1),e._v(" "),e.item.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};re._withStripped=!0;var le=A({props:{item:Object}},re,[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[s("i",{staticClass:"el-icon-s-unfold"}),e._v(" Subspec")])}],!1,null,null,null);le.options.__file="src/spec/ref-subspec.vue";const ae=le.exports;var ce=A({components:{RefSubspec:ae},props:{specId:Number,subspecId:Number},data:()=>({subspecs:[],selectedSubspecId:null,loading:!1,showing:!1}),computed:{disableGoToSubspec(){return this.loading||!this.subspecs.length||!this.selectedSubspecId},selectedSubspec(){if(this.selectedSubspecId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.selectedSubspecId)return this.subspecs[e];return null}},methods:{show(){this.loading=!0,this.showing=!0,$.get("/ajax/spec/subspecs",{specId:this.specId}).then((e=>{this.subspecs=e,this.loading=!1})).fail((e=>{this.loading=!1,this.showing=!1,u(e)}))},goToSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}}),this.showing=!1},goToSubspec(){"subspec"===this.$route.name&&p(this.$route.params.subspecId,this.selectedSubspecId)||this.$router.push({name:"subspec",params:{specId:this.specId,subspecId:this.selectedSubspecId}}),this.showing=!1},closed(){this.loading=!1,this.subspecs=[],this.selectedSubspecId=null}}},oe,[],!1,null,null,null);ce.options.__file="src/spec/nav-spec-modal.vue";const de=ce.exports;var ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-block-community-modal",attrs:{title:e.modalTitle,visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[s("context-stack",{ref:"contextStack",on:{"pop-stack":e.popStack}}),e._v(" "),e.loading?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):e.error?s("p",[e._v(e._s(e.error))]):e.target?[e.targetType!==e.TARGET_TYPE_COMMENT?s("div",{staticClass:"updated"},[e._v("\n\t\t\tLast modified "),s("strong",[s("moment",{attrs:{datetime:e.targetUpdated,offset:!0}})],1)]):e._e(),e._v(" "),e.targetType===e.TARGET_TYPE_SPEC?s("preview-spec",{attrs:{spec:e.target}}):e.targetType===e.TARGET_TYPE_SUBSPEC?s("preview-subspec",{attrs:{subspec:e.target}}):e.targetType===e.TARGET_TYPE_BLOCK?s("preview-block",{attrs:{block:e.target},on:{"play-video":e.raisePlayVideo}}):e.targetType===e.TARGET_TYPE_COMMENT?s("preview-comment",{ref:"previewComment",attrs:{"spec-id":e.specId,comment:e.target},on:{deleted:e.commentDeleted,"update-unread":e.contextUpdateUnread}}):e._e(),e._v(" "),s("div",{staticClass:"new-comment-area"},[e.sendingComment?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Posting comment...")]):e.addingComment?[e.addingComment?s("el-input",{ref:"newCommentInput",attrs:{type:"textarea",autosize:{minRows:2},placeholder:"Type comment here"},model:{value:e.newCommentBody,callback:function(t){e.newCommentBody=t},expression:"newCommentBody"}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(t){return e.cancelAddComment()}}},[e._v("\n\t\t\t\t\t\tCancel\n\t\t\t\t\t")]),e._v(" "),s("el-button",{attrs:{disabled:e.disablePostComment,type:"primary",size:"small"},on:{click:function(t){return e.addComment()}}},[e._v("\n\t\t\t\t\t\tPost\n\t\t\t\t\t")])],1)]:s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addComment()}}},[e._v("\n\t\t\t\tComment on this "+e._s(e.targetType)+"\n\t\t\t")])],2),e._v(" "),s("div",{staticClass:"controls-area flex-row wrap-reverse"},[s("div",{staticClass:"fill nowraptext",domProps:{textContent:e._s(e.formattedCommentsCount)}}),e._v(" "),s("el-checkbox",{on:{change:function(t){return e.reloadCommunity()}},model:{value:e.unreadOnly,callback:function(t){e.unreadOnly=t},expression:"unreadOnly"}},[e._v("\n\t\t\t\tShow only unread comments\n\t\t\t")])],1),e._v(" "),e.reloadingComments?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Reloading...")]):e.comments.length?[e._l(e.comments,(function(t){return s("preview-comment",{key:t.id,ref:"comments",refInFor:!0,attrs:{"spec-id":e.specId,comment:t,"show-community":!0,"show-unread-only":e.unreadOnly},on:{"open-comments":e.openComments,"update-unread":e.adjustUnread,deleted:e.commentDeleted}})})),e._v(" "),e.loadingPage?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Loading more comments...")]):e.hasMoreComments?s("el-button",{on:{click:function(t){return e.loadMoreComments()}}},[e._v("\n\t\t\t\tLoad more\n\t\t\t")]):e._e()]:e._e()]:e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],2)};ue._withStripped=!0;var pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"community-context-stack",class:{empty:e.empty}},e._l(e.stack,(function(t,i){return s("transition",{key:t.targetType+"-"+t.target.id,attrs:{name:"fade",appear:""},on:{"after-leave":e.checkEmpty}},[s("stack-bar",{attrs:{target:t.target,"target-type":t.targetType},nativeOn:{click:function(t){return e.jumpStack(i)}}})],1)})),1)};pe._withStripped=!0;var he=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"community-context-stack-bar",class:e.targetType},[s("el-button",{attrs:{size:"mini",icon:"el-icon-top-left",type:"primary",circle:""}}),e._v(" "),s("span",{staticClass:"bar"},[s("span",{staticClass:"label"},[e._v(e._s(e.label||"..."))]),e._v(" "),s("span",{staticClass:"content",domProps:{textContent:e._s(e.content||"...")}})])],1)};he._withStripped=!0;var me=A({props:{target:Object,targetType:String},computed:{label(){let e=f(this.targetType);return this.targetType===w&&this.target.refType&&(e+=" ("+f(this.target.refType)+")"),e},content(){switch(this.targetType){case _:case y:return this.target.name;case w:let e;if(e=(this.target.title||"").trim())return e;if(e=(this.target.body||"").trim())return e;if(this.target.refItem)switch(this.target.refType){case x:return this.target.refItem.name;case I:return this.target.refItem.title||this.target.refItem.url}return"";case k:return this.target.body}}}},he,[],!1,null,null,null);me.options.__file="src/spec/community-context-stack-bar.vue";var ge=A({components:{StackBar:me.exports},data:()=>({stack:[],empty:!0,cachedContext:[]}),computed:{available(){return this.stack.length}},methods:{replaceStack(e){this.stack=e,this.cachedContext=[],this.checkEmpty()},pushStack(e,t,s,i){this.empty=!1,this.stack.push({targetType:e,target:t,onAdjustUnread:s,onAdjustComments:i})},popStack(){if(this.stack.length){let e=this.stack.splice(this.stack.length-1,1)[0];return this.$emit("pop-stack",e.targetType,e.target.id,e.onAdjustUnread,e.onAdjustComments),this.cacheItemHandlers(e),e}return null},jumpStack(e){let t=this.stack.splice(e,this.stack.length-e),s=t[0];for(this.$emit("pop-stack",s.targetType,s.target.id,s.onAdjustUnread,s.onAdjustComments),e=0;e<t.length;e++)this.cacheItemHandlers(t[e]);return s},cacheItemHandlers(e){for(var t=0;t<this.cachedContext.length;t++){let s=this.cachedContext[t];if(s.targetType===e.targetType&&p(s.target.id,e.target.id)){this.cachedContext.splice(t,1);break}}(e.onAdjustUnread||e.onAdjustComments)&&this.cachedContext.push(e)},retrieveCachedHandlers(e,t){for(var s=0;s<this.cachedContext.length;s++){let i=this.cachedContext[s];if(i.targetType===e&&p(i.target.id,t))return this.cachedContext.splice(s,1)[0]}return null},getParentContext(){return this.stack.length?this.stack[this.stack.length-1]:null},clearStack(){this.stack=[],this.cachedContext=[]},checkEmpty(){return this.empty=!this.stack.length}}},pe,[],!1,null,null,null);ge.options.__file="src/spec/community-context-stack.vue";const ve=ge.exports;var be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"spec-preview community-target-preview"},[s("div",{staticClass:"name"},[e._v(e._s(e.spec.name))]),e._v(" "),e.spec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.spec.desc))]):e._e()])};be._withStripped=!0;var fe=A({props:{spec:Object}},be,[],!1,null,null,null);fe.options.__file="src/spec/preview-spec.vue";const _e=fe.exports;var ye=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"spec-subspec-preview community-target-preview"},[s("div",{staticClass:"name"},[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()])};ye._withStripped=!0;var we=A({props:{subspec:Object}},ye,[],!1,null,null,null);we.options.__file="src/spec/preview-subspec.vue";const ke=we.exports;var Ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",{staticClass:"spec-block-preview community-target-preview",attrs:{"data-block-preview-id":e.blockId}},[s("li",[e.hasTitle?s("div",{staticClass:"title"},[e._v(e._s(e.block.title))]):e._e(),e._v(" "),e.hasRefItem?[e.block.refType===e.REF_TYPE_URL?s("ref-url",{staticClass:"ref-item",attrs:{item:e.block.refItem},on:{play:function(t){return e.raisePlayVideo(e.block.refItem)}}}):e.block.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec",{staticClass:"ref-item",attrs:{item:e.block.refItem}}):e._e()]:e.refItemMissing?s("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?[e.block.contentType===e.CONTENT_TYPE_PLAIN?s("div",{staticClass:"body plain",domProps:{textContent:e._s(e.block.body)}}):e.block.contentType===e.CONTENT_TYPE_MARKDOWN?s("div",{staticClass:"body markdown",domProps:{innerHTML:e._s(e.block.html)}}):e._e()]:e._e(),e._v(" "),s("dynamic-stylesheet",{attrs:{rules:e.blockPreviewRules}})],2)])};Ce._withStripped=!0;var Se=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-url ref-item"},[e.item.imageData?s("img",{attrs:{src:e.item.imageData}}):e._e(),e._v(" "),s("div",[e.showEdit||e.showPlay?s("div",{staticClass:"right"},[e.showEdit?s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.$emit("edit")}}}):e._e(),e._v(" "),e.showPlay?s("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$emit("play")}}},[e._v("Play")]):e._e()],1):e._e(),e._v(" "),s("div",{staticClass:"title"},[s("span",[s("i",{staticClass:"el-icon-link"}),e._v(" "+e._s(e.showPlay?"Video":"URL"))]),e._v(" "),s("a",{attrs:{href:e.item.url,target:"_blank"},on:{click:function(e){e.stopPropagation()}}},[e._v(e._s(e.item.title&&e.item.title.trim()||e.item.url))])]),e._v(" "),e.item.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.item.desc.trim()))]):e._e()])])};Se._withStripped=!0;var Te=A({props:{item:Object,showEdit:Boolean},computed:{showPlay(){return b(this.item.url)}}},Se,[],!1,null,null,null);Te.options.__file="src/spec/ref-url.vue";const Ie=Te.exports;var $e=function(){var e=this.$createElement;return(this._self._c||e)("span",{staticClass:"dynamic-stylesheet",staticStyle:{display:"none"}})};$e._withStripped=!0;const xe=/^\/\*(?:[^\*]|\*(?!\/))+\*\/$/;function Pe(e,t,s=[],i=0){if(!t||"object"!=typeof t)return 0;let n=0,o=[];const r=()=>{let t=s.join("").trim();if(t){for(let e=0;e<o.length;e++){let t=o[e].trim();t&&!xe.test(t)&&";"!==t.charAt(t.length-1)&&(o[e]=t+";")}o=o.join(""),o&&((e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+o+"}",i+n):(e.styleSheet||e.sheet).addRule(t,o,i+n),n++),o=[]}else o=[]};if(Array.isArray(t))for(let l=0;l<t.length;l++){let a=t[l];a&&("string"==typeof a?o.push(a):"object"==typeof a&&(r(),n+=Pe(e,a,s,i+n)))}else for(let l in t)if(t.hasOwnProperty(l)){let a=t[l];a&&("string"==typeof a?o.push(l+":"+a+";"):"object"==typeof a&&(r(),"&"===l.charAt(0)?l=l.substr(1):[">",":","+","~"," "].indexOf(l.charAt(0))<0&&(l=" "+l),n+=Pe(e,a,s.concat([l]),i+n)))}return r(),n}function Ee(e,t=[]){if(!e||"object"!=typeof e)return"";let s="",i=[];const n=()=>{let e=t.join("").trim();if(e){let t=[];for(let e=0;e<i.length;e++){let s=i[e].trim();s?";"===s.charAt(s.length-1)||xe.test(s)?t.push(s):t.push(s+";"):t.push("")}t.length&&(t=t.join("\n\t"),s+="\n"+e+" {\n\t"+t+"\n}")}else for(let e=0;e<i.length;e++){let t=i[e].trim();t&&!xe.test(t)||(s+="\n"+t)}i=[]};if(Array.isArray(e))for(let o=0;o<e.length;o++){let r=e[o];"string"==typeof r?i.push(r):r&&"object"==typeof r&&(n(),s+=Ee(r,t.concat([""])))}else for(let o in e)if(e.hasOwnProperty(o)){let r=e[o];if(r)switch(typeof r){case"string":i.push(o+": "+r+";");break;case"object":n(),"&"===o.charAt(0)?o=o.substr(1):[">",":","+","~"," "].indexOf(o.charAt(0))<0&&(o=" "+o),s+=Ee(r,t.concat([o]));break;case"boolean":i.push(o)}}return n(),s+(t.length?"":"\n")}function Re(e,t,s=!1){let i=document.createElement("style");return i.type="text/css",e.appendChild(i),!i.styleSheet&&!i.sheet||s?i.innerHTML=Ee(t):Pe(i,t),i}var je=A({props:{rules:[Object,Array],innerMarkupOutput:Boolean},watch:{rules:{deep:!0,handler(){this.recreateSheet()}},innerMarkupOutput(){this.recreateSheet()}},mounted(){this.recreateSheet()},beforeDestroy(){this.removeSheet()},methods:{recreateSheet(){this.removeSheet(),this.rules&&(this.$stylesheet=Re(this.$el,this.rules,this.innerMarkupOutput))},removeSheet(){this.$stylesheet&&(this.$stylesheet.parentNode.removeChild(this.$stylesheet),this.$stylesheet=null)}}},$e,[],!1,null,null,null);je.options.__file="node_modules/@macu/dynamic-stylesheet-vue/dynamic-stylesheet.vue";const Ue=je.exports,Be=Ue;window.Vue&&Vue.component("dynamic-stylesheet",Ue);var Me=A({components:{RefUrl:Ie,RefSubspec:ae,DynamicStylesheet:Be},props:{block:Object},computed:{CONTENT_TYPE_PLAIN:()=>S,CONTENT_TYPE_MARKDOWN:()=>T,REF_TYPE_URL:()=>I,REF_TYPE_SUBSPEC:()=>x,blockId(){return parseInt(this.block.id,10)||0},blockNumber(){return"numbered"===this.block.styleType&&parseInt(this.block.number,10)||0},blockPreviewRules(){let e;switch(this.block.styleType){case"bullet":e="'\\2022'";break;case"numbered":e="'"+this.blockNumber+".'";break;default:return null}return{['[data-block-preview-id="'+this.blockId+'"]']:{">li:before":{content:e}}}},hasTitle(){return!(!this.block.title||!this.block.title.trim())},hasRefItem(){return!(!this.block.refType||!this.block.refItem)},hasBody(){return!!(this.block.body&&this.block.body.trim()||this.block.html&&this.block.html.trim())},refItemMissing(){return!!this.block.refType&&!this.block.refItem}},methods:{raisePlayVideo(e){this.$emit("play-video",e)}}},Ce,[],!1,null,null,null);Me.options.__file="src/spec/preview-block.vue";const Oe=Me.exports;var Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"spec-comment-preview community-target-preview",class:{community:e.showCommunity}},[s("div",{staticClass:"info"},[s("div",{staticClass:"right"},[s("el-checkbox",{attrs:{value:e.userRead,disabled:e.sendingRead,size:"mini"},on:{change:e.setUserRead}}),e._v(" "),e.userRead?s("el-tag",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.setUserRead(!1)}}},[e._v("\n\t\t\t\tRead\n\t\t\t")]):s("el-tag",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.setUserRead(!0)}}},[e._v("\n\t\t\t\tUnread\n\t\t\t")]),e._v(" "),e.showCommunity?s("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openComments()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2):e._e(),e._v(" "),e.userCanEdit?s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.edit()}}}):e.userCanDelete?s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDelete()}}}):e._e()],1),e._v(" "),s("username",{attrs:{username:e.comment.username,highlight:e.comment.highlight}}),e._v("\n\t\tposted\n\t\t"),s("moment",{attrs:{datetime:e.comment.created,offset:!0}}),e._v(" "),e.updated!==e.comment.created?[e._v("\n\t\t\t(updated "),s("moment",{attrs:{datetime:e.updated,offset:!0}}),e._v(")\n\t\t")]:e._e()],2),e._v(" "),e.sendingDelete?s("div",[s("i",{staticClass:"el-icon-loading"}),e._v(" Deleting...")]):e.sendingEdit?s("div",[s("i",{staticClass:"el-icon-loading"}),e._v(" Saving...")]):e.editing?s("div",{staticClass:"edit-comment-area"},[s("el-input",{ref:"editCommentInput",attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.editingBody,callback:function(t){e.editingBody=t},expression:"editingBody"}}),e._v(" "),s("div",[s("el-button",{attrs:{disabled:e.disableSaveEdit,type:"warning",size:"small"},on:{click:function(t){return e.cancelEdit()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")]),e._v(" "),s("el-button",{attrs:{disabled:e.disableSaveEdit,type:"primary",size:"small"},on:{click:function(t){return e.saveEdit()}}},[e._v("\n\t\t\t\tSave\n\t\t\t")]),e._v(" "),s("el-button",{attrs:{disabled:e.disableSaveEdit,type:"danger",size:"small"},on:{click:function(t){return e.promptDelete()}}},[e._v("\n\t\t\t\tDelete\n\t\t\t")])],1)],1):s("div",{staticClass:"body"},[e._v(e._s(e.body))])])};Ae._withStripped=!0;var Ne=A({components:{Username:X,Moment:L},props:{specId:Number,comment:Object,showCommunity:Boolean,showUnreadOnly:Boolean},data(){return{userRead:this.comment.userRead||!1,sendingRead:!1,editing:!1,updated:this.comment.updated,body:this.comment.body,editingBody:"",sendingEdit:!1,sendingDelete:!1}},computed:{userCanEdit(){return this.$store.getters.currentUserId===this.comment.userId},userCanDelete(){return this.userCanEdit||this.$store.getters.currentSpecOwnedByUser},disableSaveEdit(){return!this.editingBody.trim()||this.sendingEdit},unreadCount(){return this.comment.unreadCount||0},commentsCount(){return this.comment.commentsCount||0}},watch:{editing(e){e&&this.$nextTick((()=>{this.$refs.editCommentInput&&o()("textarea",this.$refs.editCommentInput.$el).focus()}))}},methods:{setUserRead(e){this.sendingRead=!0,function(e,t,s,i){return o().post("/ajax/spec/community/mark-read",{specId:e,targetType:"comment",targetId:s,read:i}).fail(u)}(this.specId,0,this.comment.id,e).then((()=>{this.sendingRead=!1,this.userRead=e,this.$emit("update-unread",e?-1:1)})).fail((()=>{this.sendingRead=!1}))},openComments(){this.$emit("open-comments",this.comment.id)},edit(){this.editingBody.trim()||(this.editingBody=this.body),this.editing=!0},cancelEdit(){this.editing=!1},saveEdit(){var e,t,s;this.disableSaveEdit||(this.sendingEdit=!0,(e=this.specId,t=this.comment.id,s=this.editingBody,o().post("/ajax/spec/community/update-comment",{specId:e,commentId:t,body:s}).fail(u)).then((e=>{this.sendingEdit=!1,this.editing=!1,this.updated=e.updated,this.body=e.body,this.editingBody=""})).fail((()=>{this.sendingEdit=!1})))},promptDelete(){this.$confirm("Permanently delete this comment?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e,t;this.sendingDelete=!0,(e=this.specId,t=this.comment.id,o().post("/ajax/spec/community/delete-comment",{specId:e,commentId:t}).fail(u)).then((()=>{this.sendingDelete=!1,this.$emit("deleted",this.comment.id)})).fail((()=>{this.sendingDelete=!1}))})).catch((function(){}))},isUnread(){return!this.userRead}}},Ae,[],!1,null,null,null);Ne.options.__file="src/spec/preview-comment.vue";var Le=A({components:{ContextStack:ve,Moment:L,PreviewSpec:_e,PreviewSubspec:ke,PreviewBlock:Oe,PreviewComment:Ne.exports},props:{specId:Number},data:()=>({showing:!1,loading:!1,error:null,targetType:null,target:null,comments:[],unreadCount:0,commentsCount:0,hasMoreComments:!1,loadingPage:!1,addingComment:!1,newCommentBody:"",sendingComment:!1,onAdjustUnread:null,onAdjustComments:null,unreadOnly:!1,reloadingComments:!1}),computed:{TARGET_TYPE_SPEC:()=>_,TARGET_TYPE_SUBSPEC:()=>y,TARGET_TYPE_BLOCK:()=>w,TARGET_TYPE_COMMENT:()=>k,modalTitle(){switch(this.targetType){case _:return"Spec community";case y:return"Subspec community";case w:return"Block community";case k:return"Comment community"}return"Community space"},targetUpdated(){return this.target&&this.targetType!==k?this.target.updated:null},disablePostComment(){return!this.newCommentBody.trim()},formattedCommentsCount(){let e=this.unreadOnly?this.unreadCount:this.commentsCount;return e+(this.unreadOnly?" unread":"")+(this.targetType===k?" sub":"")+" comment"+(1!==e?"s":"")}},watch:{addingComment(e){e&&this.$nextTick((()=>{this.$refs.newCommentInput&&o()("textarea",this.$refs.newCommentInput.$el).focus().select()}))}},methods:{openCommunity(e,t,s=null,i=null){this.onAdjustUnread=s,this.onAdjustComments=i,this.unreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loadCommunity(e,t),this.showing=!0},openCommunityReview(e,t,s=null,i=null){this.onAdjustUnread=s,this.onAdjustComments=i,this.unreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loadCommunity(e,t,!0),this.showing=!0},loadCommunity(e,t,s=!1){this.loading=!0,this.error=null,function(e,t,s,i,n){return o().get("/ajax/spec/community",{specId:e,targetType:t,targetId:s,unreadOnly:i,loadStack:n}).fail(u)}(this.specId,e,t,this.unreadOnly,s).then((i=>{switch(this.loading=!1,this.targetType=e,e){case _:this.target=i.spec;break;case y:this.target=i.subspec;break;case w:this.target=i.block;break;case k:this.target=i.comment}s&&i.stack&&this.$refs.contextStack.replaceStack(i.stack),this.comments=i.comments,this.unreadCount=i.unreadCount,this.commentsCount=i.commentsCount,this.hasMoreComments=i.commentsCount>i.comments.length,this.newCommentBody="";let n=this.$refs.contextStack.retrieveCachedHandlers(e,t);n&&(this.onAdjustUnread=n.onAdjustUnread,this.onAdjustComments=n.onAdjustComments)})).fail((()=>{this.loading=!1,this.error="Failed to load community.",this.$refs.contextStack.checkEmpty()&&(this.showing=!1)}))},reloadCommunity(){this.reloadingComments=!0,J(this.specId,this.targetType,this.target.id,null,this.unreadOnly).then((e=>{this.reloadingComments=!1,this.comments=e.comments,this.unreadCount=e.unreadCount,this.commentsCount=e.commentsCount,this.hasMoreComments=e.hasMore})).fail((()=>{this.reloadingComments=!1}))},loadMoreComments(){this.loadingPage=!0;let e=this.comments[this.comments.length-1].updated;J(this.specId,this.targetType,this.target.id,e,this.unreadOnly).then((e=>{this.loadingPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMore})).fail((()=>{this.loadingPage=!1}))},addComment(){var e,t,s,i;this.addingComment?this.disablePostComment||(this.sendingComment=!0,(e=this.specId,t=this.targetType,s=this.target.id,i=this.newCommentBody,o().post("/ajax/spec/community/add-comment",{specId:e,targetType:t,targetId:s,body:i}).fail(u)).then((e=>{this.sendingComment=!1,this.comments.unshift(e),this.adjustComments(1),this.addingComment=!1,this.newCommentBody=""})).fail((()=>{this.sendingComment=!1}))):this.addingComment=!0},cancelAddComment(){this.addingComment=!1},openComments(e){this.$refs.contextStack.pushStack(this.targetType,this.target,this.onAdjustUnread,this.onAdjustComments),this.onAdjustUnread=null,this.onAdjustComments=null,this.loadCommunity("comment",e)},adjustUnread(e){this.unreadCount+=e,this.onAdjustUnread&&this.onAdjustUnread(e)},adjustComments(e){this.commentsCount+=e,this.onAdjustComments&&this.onAdjustComments(e)},commentDeleted(e){if(this.targetType===k&&this.target.id===e){let e=this.$refs.previewComment.isUnread(),t=this.$refs.contextStack.popStack();e&&t.onAdjustUnread&&t.onAdjustUnread(-1),t.onAdjustComments&&t.onAdjustComments(-1)}else for(var t=0;t<this.comments.length;t++)if(p(this.comments[t].id,e)){let e=!this.$refs.comments[t].userRead;this.comments.splice(t,1),e&&this.adjustUnread(-1),this.adjustComments(-1);break}},contextUpdateUnread(e){let t=this.$refs.contextStack.getParentContext();t&&t.onAdjustUnread&&t.onAdjustUnread(e)},popStack(e,t,s,i){this.$refs.contextStack.cacheItemHandlers({targetType:this.targetType,target:this.target,onAdjustUnread:this.onAdjustUnread,onAdjustComments:this.onAdjustComments}),this.onAdjustUnread=s,this.onAdjustComments=i,this.loadCommunity(e,t)},raisePlayVideo(e){this.$emit("play-video",e)},closed(){this.targetType=null,this.target=null,this.error=null,this.addingComment=!1,this.newCommentBody="",this.onAdjustUnread=null,this.onAdjustComments=null,this.$refs.contextStack.clearStack()}}},ue,[],!1,null,null,null);Le.options.__file="src/spec/community-modal.vue";const Fe=Le.exports;var qe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"play-video-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogSmallWidth},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.vid?s("div",{staticClass:"embed-responsive"},["youtube"===e.vid.type?s("iframe",{attrs:{src:"https://www.youtube.com/embed/"+e.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===e.vid.type?s("iframe",{attrs:{src:"https://player.vimeo.com/video/"+e.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):e._e()]):e._e()])};qe._withStripped=!0;var De=A({data:()=>({vid:null,showing:!1}),methods:{show(e){let t=function(e){let t=v.exec(e);return t?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:t[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:t[1]}:null:null}(e.url);t&&(this.vid=t,this.showing=!0)},closed(){this.vid=null}}},qe,[],!1,null,null,null);De.options.__file="src/widgets/play-video-modal.vue";const ze=De.exports;var Ve=A({components:{Username:X,Moment:L,EditSpecModal:te,NavSpecModal:de,CommunityModal:Fe,PlayVideoModal:ze},data:()=>({loading:!0,spec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)||null},onSpecRoute(){return"spec"===this.$route.name},currentUserOwns(){return this.spec&&this.spec.ownerType===P&&this.$store.getters.currentUserId===this.spec.ownerId},enableEditing(){return this.currentUserOwns},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.userSettings.community.unreadOnly}},beforeRouteEnter(e,t,s){console.debug("beforeRouteEnter spec",e),s((t=>{t.loadSpec(e.params.specId,"spec"===e.name)}))},beforeRouteUpdate(e,t,s){console.debug("beforeRouteUpdate spec",e),this.loadSpec(e.params.specId,"spec"===e.name),s()},beforeRouteLeave(e,t,s){console.debug("beforeRouteLeave spec"),this.spec=null,this.unreadCount=0,this.commentsCount=0,m(),s()},methods:{loadSpec(e,t){console.debug("load spec"),this.loading=!0,function(e,t=!0){return o().get("/ajax/spec",{specId:e,loadBlocks:t}).fail(u)}(e,t).then((e=>{console.debug("spec loaded",e),this.spec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,m(e.name),this.loading=!1,this.$refs.view.$once("rendered",this.restoreScroll),this.$store.commit("saveCurrentSpec",e)})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},gotoSpec(){"spec"!==this.$route.name&&this.$router.push({name:"spec",params:{specId:this.specId}})},openManageSpec(){this.$refs.editSpecModal.showEdit(this.spec,(e=>{this.spec.updated=e.updated,this.spec.name=e.name,this.spec.desc=e.desc,this.spec.public=e.public,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,m(e.name)}))},openSpecCommunity(){this.$refs.communityModal.openCommunity(_,this.spec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,s,i){this.$refs.communityModal.openCommunity(e,t,s,i)},playVideo(e){this.$refs.playVideoModal.show(e)},promptNavSpec(){this.$refs.navSpecModal.show()},restoreScroll(){if(this.onSpecRoute){let e=this.$store.state.savedScrollPosition;e?(console.debug("restoreScroll spec"),o()(window).scrollTop(e.y).scrollLeft(e.x)):p(this.$store.getters.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&(console.debug("restoreScroll spec from currentSpecScrollTop"),o()(window).scrollTop(this.$store.state.currentSpecScrollTop))}}}},ne,[],!1,null,null,null);Ve.options.__file="src/pages/spec.vue";const Ye=Ve.exports;var He=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"spec-view-page",class:{loading:e.loading}},[e.loading?s("p",[e._v("Loading...")]):e.spec?s("spec-view",{key:e.spec.renderTime,attrs:{spec:e.spec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};He._withStripped=!0;var We=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.spec||e.subspec?s("div",{staticClass:"spec-view"},[s("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:e.dragging}}),e._v(" "),e.enableEditing?[e.choosingAddPosition?s("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-top"},on:{click:function(t){return e.moveBlocksToBottom()}}},[e._v("Move block here")]):s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.promptAddBlock()}}},[e._v("Add block")]),e._v(" "),s("ul",{ref:"mirrorList",staticClass:"mirror-list"}),e._v(" "),s("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":e.specId,"subspec-id":e.subspecId},on:{"open-edit-url":e.openEditUrl,"play-video":e.playVideo,"prompt-delete":e.promptDeleteBlock}}),e._v(" "),s("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":e.specId}})]:e._e()],2):e._e()};We._withStripped=!0;var Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"spec-block",class:e.classes,attrs:{"data-spec-block":e.block.id},on:{touchstart:e.touchstart,selectstart:e.selectstart}},[s("div",{staticClass:"content",class:{"clear-ref":e.clearRef,"mobile-adjust":e.mobileAdjust}},[s("div",{staticClass:"bg"}),e._v(" "),s("div",{staticClass:"layover",on:{mouseleave:function(t){return e.mouseLeaveLayover()}}},[e.enableEditing?[s("div",{staticClass:"expand-control",class:{hide:e.showActions}},[e.showUnreadOnly&&e.unreadCount?s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e._v("\n\t\t\t\t\t\t"+e._s(e.unreadCount)+" unread\n\t\t\t\t\t")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(t){e.focusActions=!0}}})],1),e._v(" "),s("div",{staticClass:"actions",class:{show:e.showActions}},[e.choosingAddPosition?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelChooseAddPosition()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.addBeforeThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.addIntoThis()}}}),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.addAfterThis()}}})]:e.movingThis?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.cancelMoving()}}},[e.$store.getters.mobileViewport?[e._v("Cancel")]:[e._v("Cancel move")]],2),e._v(" "),s("el-button",{attrs:{size:"mini",icon:"el-icon-folder-add"},on:{click:function(t){return e.promptNavSpec()}}},[e.$store.getters.mobileViewport?[e._v("Context")]:[e._v("Change context")]],2),e._v(" "),s("el-checkbox",{key:"removeFromMoving",attrs:{"data-moving-block-id":e.block.id,value:!0,size:"mini"},nativeOn:{click:function(t){return e.removeThisFromMovingBlocks()}}})]:e.movingOtherBlocks?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelMoving()}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(t){return e.moveBeforeThis()}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(t){return e.moveIntoThis()}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(t){return e.moveAfterThis()}}}),e._v(" "),e.showAddToMoving?s("el-checkbox",{key:"addToMoving",attrs:{value:!1,size:"mini"},nativeOn:{click:function(t){return e.addThisToMovingBlocks()}}}):e._e()]:[s("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2),e._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editBlock()}}}),e._v(" "),e.showDeleteButton?s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.promptDeleteBlock()}}}):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.enterChooseAddPosition()}}}),e._v(" "),s("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(t){return e.startMoving()}}}),e._v(" "),s("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(t){return e.startMoving()}}})]],2)]:s("div",{staticClass:"visitor-actions"},[s("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2)],1)],2),e._v(" "),e.currentlyMovingBlocks?s("div",{staticClass:"layover parent-moving-layover"},[s("el-checkbox",{attrs:{value:!0,disabled:"",size:"mini"}})],1):e._e(),e._v(" "),e.hasTitle?s("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),e.hasRefItem?[e.refType===e.REF_TYPE_URL?s("ref-url",{staticClass:"ref-item",attrs:{item:e.refItem},on:{play:function(t){return e.raisePlayVideo(e.refItem)}}}):e.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec",{staticClass:"ref-item",attrs:{item:e.refItem}}):e._e()]:e.refItemMissing?s("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):e._e(),e._v(" "),e.hasBody?[e.contentType===e.CONTENT_TYPE_PLAIN?s("div",{staticClass:"body plain",domProps:{textContent:e._s(e.body)}}):e.contentType===e.CONTENT_TYPE_MARKDOWN?s("div",{ref:"renderedHtml",staticClass:"body markdown",domProps:{innerHTML:e._s(e.renderedHtml)}}):e._e()]:e._e()],2),e._v(" "),s("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:e.movingThis}})])};Ge._withStripped=!0;const Ke="highlight",Xe="dragula";let Qe={};function Ze(e){let t=[];for(var s=0;s<e.length;s++){let i=e[s];if(/\.js$/.test(i.src)){let e=document.createElement("script");e.type="text/javascript",e.crossOrigin="anonymous",i.integrity&&(e.integrity=i.integrity);let s=o().Deferred();e.addEventListener("load",(function(){s.resolve()})),e.addEventListener("error",(function(){s.reject()})),t.push(s),e.src=i.src,document.body.appendChild(e)}else if(/\.css$/.test(i.src)){let e=document.createElement("link");e.rel="stylesheet",e.crossOrigin="anonymous",i.integrity&&(e.integrity=i.integrity);let s=o().Deferred();e.addEventListener("load",(function(){s.resolve()})),e.addEventListener("error",(function(){s.reject()})),t.push(s),e.href=i.src,document.body.appendChild(e)}}return o().when.apply(o(),t)}function Je(e){if(Qe[e])return Qe[e];switch(e){case Ke:return Qe[e]=Ze([{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/default.min.css",integrity:"sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js",integrity:"sha512-zol3kFQ5tnYhL7PzGt0LnllHHVWRGt2bTCIywDiScVvLIlaDOVJ6sPdJTVi0m3rA660RT+yZxkkRzMbb1L8Zkw=="}]).then((function(){return console.debug("highlight.js loaded"),window.hljs})).fail((function(){u("Failed to load highlight.js code highlighting library")}));case Xe:return Qe[e]=Ze([{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.css",integrity:"sha512-zlYhSecphd+kwRzeCOyj7/u3HZIQ3Q0NP7AN7ZEKhYTdi0AQOGGbc7eA3I/mUffqjdr8G1/9xoS478h+I0MQGg=="},{src:"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js",integrity:"sha512-NgXVRE+Mxxf647SqmbB9wPS5SEpWiLFp5G7ItUNFi+GVUyQeP+7w4vnKtc2O/Dm74TpTFKXNjakd40pfSKNulg=="}]).then((function(){return console.debug("dragula.js loaded"),window.dragula})).fail((function(){u("Failed to load dragula.js drag and drop library")}))}}var et=A({components:{RefUrl:Ie,RefSubspec:ae},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean,justAdded:Boolean},data(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,renderedHtml:this.block.html,refItem:this.block.refItem,unreadCount:this.block.unreadCount||0,commentsCount:this.block.commentsCount||0,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{CONTENT_TYPE_PLAIN:()=>S,CONTENT_TYPE_MARKDOWN:()=>T,REF_TYPE_URL:()=>I,REF_TYPE_SUBSPEC:()=>x,showDeleteButton(){switch(this.$store.getters.userSettings.blockEditing.deleteButton){case"modal":return!1;case"recent":return this.justAdded;default:return!0}},hasTitle(){return!(!this.title||!this.title.trim())},hasBody(){return!!(this.body&&this.body.trim()||this.renderedHtml&&this.renderedHtml.trim())},hasRefItem(){return!(!this.refType||!this.refItem)},refItemMissing(){return!!this.refType&&!this.refItem},classes(){return{[this.styleType]:!0,"title-only":this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks,"ref-item-only":this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks}},currentlyMovingBlocks(){return this.$store.getters.currentlyMovingBlocks},movingThis(){return this.$store.getters.currentlyMovingBlock(this.block.id)},movingOtherBlocks(){return this.currentlyMovingBlocks&&!this.movingThis},showAddToMoving(){return this.movingOtherBlocks&&p(this.$store.state.movingBlocksSourceSubspecId,this.subspecId)},showActions(){return this.focusActions||this.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.userSettings.community.unreadOnly},clearRef(){return!!this.unreadCount},mobileAdjust(){return this.showActions||!!this.unreadCount||!this.showUnreadOnly&&!!this.commentsCount}},watch:{renderedHtml(){this.addCodeHighlighting()}},mounted(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted),this.addCodeHighlighting()},beforeDestroy(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId(){return this.block.id},getStyleType(){return this.styleType},addCodeHighlighting(){this.contentType===T&&this.renderedHtml&&this.$nextTick((()=>{let e=o()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&Je(Ke).then((t=>{e.each(((e,s)=>{t.highlightBlock(s)}))}))}))},getParentId(){let e=o()(this.$el).parent().closest("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},getFollowingBlockId(){let e=o()(this.$el).next("[data-spec-block]");return e.length?e.attr("data-spec-block"):null},editBlock(){this.raiseOpenEdit(this.block.id,(e=>{this.updated=e.updated,this.styleType=e.styleType,this.contentType=e.contentType,this.refType=e.refType,this.refId=e.refId,this.refItem=e.refItem,this.title=e.title,this.body=e.body,this.renderedHtml=e.html,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0}))},raiseOpenEdit(e,t){this.$emit("open-edit",e,t)},promptDeleteBlock(){this.$emit("prompt-delete",this.block.id)},enterChooseAddPosition(){this.choosingAddPosition=!0},cancelChooseAddPosition(){this.choosingAddPosition=!1},addBeforeThis(){let e=this.getParentId(),t=this.block.id;this.raisePromptAddSubblock(e,t,this.styleType)},addIntoThis(){let e=this.block.id;this.raisePromptAddSubblock(e,null,!0)},addAfterThis(){let e=this.getParentId(),t=this.getFollowingBlockId();this.raisePromptAddSubblock(e,t,this.styleType)},raisePromptAddSubblock(e,t,s){this.$emit("prompt-add-subblock",e,t,s)},startMoving(){this.$emit("start-moving",this.block.id),this.focusActions=!1},addThisToMovingBlocks(){this.$emit("add-to-moving",this.block.id)},removeThisFromMovingBlocks(){this.$emit("remove-from-moving",this.block.id)},promptNavSpec(){this.$emit("prompt-nav-spec")},cancelMoving(){this.$emit("cancel-moving",this.block.id)},moveBeforeThis(){this.$emit("move-before",this.block.id)},moveIntoThis(){this.$emit("move-into",this.block.id)},moveAfterThis(){this.$emit("move-after",this.block.id)},mouseLeaveLayover(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated(e){this.refType===I&&e.id===this.refId&&(this.refItem=e)},urlDeleted(e){this.refType===I&&e===this.refId&&(this.refItem=null)},raisePlayVideo(e){this.$emit("play-video",e)},openCommunity(){this.$emit("open-community",this.block.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},updateHasSubblocks(){this.hasSubblocks=this.$refs.sublist.childElementCount>0},touchstart(e){this.lastTouchStartTime=Date.now()},selectstart(e){this.lastTouchStartTime&&Date.now()-this.lastTouchStartTime<200&&(e.preventDefault(),e.stopPropagation())}}},Ge,[],!1,null,null,null);et.options.__file="src/spec/block.vue";const tt=et.exports;var st=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:e.loading||e.block?"Edit block":"Add block",visible:e.showing,width:e.$store.getters.dialogLargeWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.loading?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):e.error?[s("p",[e._v(e._s(e.error))]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)]:[e.block?s("p",[e._v("\n\t\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.block.created}})],1),e._v(";\n\t\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.block.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("section",[s("el-radio-group",{model:{value:e.styleType,callback:function(t){e.styleType=t},expression:"styleType"}},[s("el-radio",{attrs:{label:e.STYLE_TYPE_BULLET}},[e._v("Bullet point")]),e._v(" "),s("el-radio",{attrs:{label:e.STYLE_TYPE_NUMBERED}},[e._v("Numbered point")]),e._v(" "),s("el-radio",{attrs:{label:e.STYLE_TYPE_NONE}},[e._v("Indented block")])],1),e._v(" "),s("label",[e._v("\n\t\t\t\tTitle\n\t\t\t\t"),s("el-input",{ref:"titleInput",attrs:{maxlength:e.titleMaxLength,clearable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1),e._v(" "),s("section",[s("el-radio-group",{model:{value:e.refType,callback:function(t){e.refType=t},expression:"refType"}},[s("el-radio",{attrs:{label:null}},[e._v("No media")]),e._v(" "),s("el-radio",{attrs:{label:e.REF_TYPE_SUBSPEC}},[e._v("Subspec")]),e._v(" "),s("el-radio",{attrs:{label:e.REF_TYPE_URL}},[e._v("URL")])],1),e._v(" "),e.refType===e.REF_TYPE_URL?s("ref-url-form",{attrs:{"spec-id":e.specId,"initial-url-object":e.existingUrlRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t},"open-edit-url":e.openEditUrl,"play-video":e.raisePlayVideo}}):e.refType===e.REF_TYPE_SUBSPEC?s("ref-subspec-form",{attrs:{"spec-id":e.specId,"initial-subspec":e.existingSubspecRefItem,valid:e.refFieldsValid,fields:e.refFields},on:{"update:valid":function(t){e.refFieldsValid=t},"update:fields":function(t){e.refFields=t}}}):e._e()],1),e._v(" "),s("section",[s("el-radio-group",{model:{value:e.contentType,callback:function(t){e.contentType=t},expression:"contentType"}},[s("el-radio",{attrs:{label:e.CONTENT_TYPE_PLAIN}},[e._v("Plain text")]),e._v(" "),s("el-radio",{attrs:{label:e.CONTENT_TYPE_MARKDOWN}},[e._v("Markdown")])],1),e._v(" "),e.contentType===e.CONTENT_TYPE_MARKDOWN?[s("div",{staticClass:"split-even"},[s("label",[e._v("\n\t\t\t\t\t\tBody\n\t\t\t\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1),e._v(" "),s("label",[e._v("\n\t\t\t\t\t\tPreview\n\t\t\t\t\t\t"),e.previewError?s("div",{staticClass:"error"},[e._v(e._s(e.previewError))]):s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingPreview,expression:"loadingPreview"}],ref:"renderedHtml",staticClass:"markdown",domProps:{innerHTML:e._s(e.previewHtml)}})])])]:s("label",[e._v("\n\t\t\t\tBody\n\t\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}})],1)],2),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.block?s("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.promotDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("\n\t\t\t\t"+e._s(e.block?"Save":"Add")+"\n\t\t\t")])],1)]],2)};st._withStripped=!0;var it=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-url-form"},[e.creating?s("el-card",[s("label",[e._v("\n\t\t\tNew link URL\n\t\t\t"),s("el-input",{attrs:{maxlength:e.urlMaxLength,clearable:""},model:{value:e.newUrl,callback:function(t){e.newUrl=t},expression:"newUrl"}}),e._v(" "),e.newUrl&&!e.isValid?s("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):e.newUrlIsVideo?s("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):e._e()],1),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!0}}},[e._v("\n\t\t\tSelect an existing link\n\t\t")]):e._e(),e._v(" "),e.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(){e.creating=!1,e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?s("p",[e._v("Loading links...")]):e.urlObjects&&e.urlObjects.length?[s("el-select",{attrs:{filterable:"","filter-method":e.filterUrls,placeholder:"Select link"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.filteredUrlObjects,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.title||e.url}})})),1),e._v(" "),e.selectedUrlObject?s("ref-url",{attrs:{item:e.selectedUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.selectedUrlObject)},play:function(t){return e.raisePlayVideo(e.selectedUrlObject)}}}):e._e()]:e._e(),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new link\n\t\t")]),e._v(" "),e.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()]:[e.initialUrlObject?s("ref-url",{attrs:{item:e.initialUrlObject,"show-edit":""},on:{edit:function(t){return e.openEditUrl(e.initialUrlObject)},play:function(t){return e.raisePlayVideo(e.initialUrlObject)}}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new link\n\t\t\t")]),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):e._e()],1)]],2)};it._withStripped=!0;var nt=A({components:{RefUrl:Ie},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects(){if(this.filter&&this.urlObjects){let t=this.filter.toLowerCase(),s=[];for(var e=0;e<this.urlObjects.length;e++){let i=this.urlObjects[e];(i.url.toLowerCase().indexOf(t)>=0||i.title&&i.title.toLowerCase().indexOf(t)>=0)&&s.push(i)}return s}return this.urlObjects},selectModeAvailable(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject(){if(this.urlObjects&&this.refId)for(var e=0;e<this.urlObjects.length;e++)if(this.urlObjects[e].id===this.refId)return this.urlObjects[e];return null},newUrlIsVideo(){return g(this.newUrl)&&b(this.newUrl)},isValid(){return this.creating?g(this.newUrl):!!this.refId},refFields(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null},urlMaxLength:()=>window.const.urlMaxLength},watch:{selecting:{immediate:!0,handler(e){e&&this.loadLinks()}},isValid:{immediate:!0,handler(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler(e){this.$emit("update:fields",e)}}},methods:{loadLinks(){var e;this.urlObjects||this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/urls",{specId:e}).fail(u)).then((e=>{this.urlObjects=e,e.length||(this.selecting=!1,this.initialUrlObject||(this.creating=!0)),this.loading=!1})).fail((()=>{this.urlObjects=[],this.selecting=!1,this.initialUrlObject||(this.creating=!0),this.loading=!1})))},filterUrls(e){e?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=h((e=>{this.filter=e}))),this.debouncedUpdateFilter(e)):this.filter=""},openEditUrl(e){this.$emit("open-edit-url",e,(t=>{if(this.urlObjects)for(var s=0;s<this.urlObjects.length;s++)if(this.urlObjects[s].id===e.id){this.urlObjects.splice(s,1,t);break}}),(()=>{if(this.urlObjects)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===e.id){this.urlObjects.splice(t,1);break}this.refId===e.id&&(this.refId=null)}))},raisePlayVideo(e){this.$emit("play-video",e)}}},it,[],!1,null,null,null);nt.options.__file="src/spec/ref-url-form.vue";const ot=nt.exports;var rt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ref-subspec-form"},[e.creating?s("el-card",[s("label",[e._v("\n\t\t\tNew subspec name\n\t\t\t"),s("el-input",{ref:"newSubspecNameInput",attrs:{maxlength:e.nameMaxLength,clearable:""},model:{value:e.subspecName,callback:function(t){e.subspecName=t},expression:"subspecName"}})],1),e._v(" "),s("label",[e._v("\n\t\t\tDescription\n\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.subspecDesc,callback:function(t){e.subspecDesc=t},expression:"subspecDesc"}})],1),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!1}}},[e._v("\n\t\t\tCancel\n\t\t")]):e._e()],1):e.selecting?[e.loading?s("p",[e._v("Loading subspecs...")]):e.subspecs&&e.subspecs.length?[s("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:e.refId,callback:function(t){e.refId=t},expression:"refId"}},e._l(e.subspecs,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),e.selectedSubspec?s("ref-subspec",{attrs:{item:e.selectedSubspec}}):e._e()]:e._e(),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\tCreate new subspec\n\t\t")])]:[e.initialSubspec?s("ref-subspec",{attrs:{item:e.initialSubspec}}):e._e(),e._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.creating=!0}}},[e._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),e._v(" "),e.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(t){e.selecting=!0}}},[e._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):e._e()],1)]],2)};rt._withStripped=!0;var lt=A({components:{RefSubspec:ae},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable(){return null===this.subspecs||this.subspecs.length},selectedSubspec(){if(this.subspecs&&this.refId)for(var e=0;e<this.subspecs.length;e++)if(this.subspecs[e].id===this.refId)return this.subspecs[e];return null},isValid(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}},nameMaxLength:()=>window.const.specNameMaxLength},watch:{selecting:{immediate:!0,handler(e){e&&this.loadSubspecs()}},isValid:{immediate:!0,handler(e){this.$emit("update:valid",e)}},refFields:{immediate:!0,handler(e){this.$emit("update:fields",e)}}},methods:{loadSubspecs(){var e;this.loading||(this.loading=!0,(e=this.specId,o().get("/ajax/spec/subspecs",{specId:e}).fail(u)).then((e=>{this.subspecs=e,e.length||(this.creating=!0),this.loading=!1})).fail((()=>{this.subspecs=[],this.creating=!0,this.loading=!1})))}}},rt,[],!1,null,null,null);lt.options.__file="src/spec/ref-subspec-form.vue";var at=A({components:{Moment:L,RefUrlForm:ot,RefSubspecForm:lt.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:()=>({styleType:C,contentType:S,title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,loading:!1,error:null,loadingPreview:!1,previewHtml:"",previewXhr:null,previewError:null}),computed:{STYLE_TYPE_NONE:()=>"none",STYLE_TYPE_BULLET:()=>C,STYLE_TYPE_NUMBERED:()=>"numbered",CONTENT_TYPE_PLAIN:()=>S,CONTENT_TYPE_MARKDOWN:()=>T,REF_TYPE_URL:()=>I,REF_TYPE_SUBSPEC:()=>x,titleMaxLength:()=>window.const.blockTitleMaxLength,existingUrlRefItem(){return this.block&&this.block.refType===I&&this.block.refItem||null},existingSubspecRefItem(){return this.block&&this.block.refType===x&&this.block.refItem||null}},watch:{refType(){this.refFields=null},body(){this.renderMarkdownPreview()},contentType(){this.renderMarkdownPreview()},previewHtml(e){this.addCodeHighlighting()}},methods:{renderMarkdownPreview(){this.contentType===T&&(this.body.trim()?(this.debouncedBodyRender||(this.debouncedBodyRender=h((e=>{this.loadingPreview=!0,this.previewError=null,this.previewXhr&&this.previewXhr.abort();let t=function(e){let t=o().post("/ajax/render-markdown",{markdown:e});return t.fail((function(e){0===e.status&&"abort"===e.statusText||u(e)})),t}(e);this.previewXhr=t,t.then((e=>{this.previewXhr===t&&(e.error?this.previewError=e.error:this.previewHtml=e.html,this.loadingPreview=!1,this.previewXhr=null)})).fail((()=>{this.previewXhr===t&&(this.previewError="Error generating preview.",this.loadingPreview=!1,this.previewXhr=null)}))}),1e3)),this.debouncedBodyRender(this.body)):this.previewHtml="")},addCodeHighlighting(){this.previewHtml&&this.$nextTick((()=>{let e=o()('pre>code[class*="language-"]',this.$refs.renderedHtml);e.length&&Je(Ke).then((t=>{e.each(((e,s)=>{t.highlightBlock(s)}))}))}))},showAdd(e,t,s,i){if(!0===s)if(t){let e=o()('[data-spec-block="'+t+'"]',".spec-view"),i=e.prev("[data-spec-block]");s=i.length?i.data("vc").getStyleType():e.data("vc").getStyleType()}else if(e){let t=o()('[data-spec-block="'+e+'"]',".spec-view"),i=o()(">ul>[data-spec-block]:last-child",t);i.length&&(s=i.data("vc").getStyleType())}else{let e=o()(">ul>[data-spec-block]:last-child",".spec-view");e.length&&(s=e.data("vc").getStyleType())}"string"==typeof s&&(this.styleType=s),this.parentId=e,this.insertBeforeId=t,this.callback=i,this.showing=!0,this.focusTitleInput()},showEdit(e,t){this.loading=!0,this.error=null,this.showing=!0,function(e,t){return o().get("/ajax/spec/load-edit-block",{specId:e,blockId:t}).fail(u)}(this.specId,e).then((e=>{this.loading=!1,this.block=e,this.styleType=e.styleType,this.contentType=e.contentType,this.title=e.title||"",this.body=e.body||"",this.refType=e.refType,this.callback=t,this.focusTitleInput()})).fail((()=>{this.error="Error loading block",this.loading=!1}))},focusTitleInput(){this.$nextTick((()=>{o()("input",this.$refs.titleInput.$el).focus()}))},openEditUrl(e,t=null,s=null){this.$emit("open-edit-url",e,(e=>{this.existingUrlRefItem&&e.id===this.existingUrlRefItem.id&&(this.block.refItem=e),t&&t(e)}),(e=>{this.existingUrlRefItem&&e===this.existingUrlRefItem.id&&(this.block.refType=null,this.block.refId=null,this.block.refItem=null),s&&s(e)}))},raisePlayVideo(e){this.$emit("play-video",e)},promotDelete(){this.$emit("prompt-delete",this.block.id,(()=>{this.showing=!1}))},submit(){if(this.refType){if(!this.refFieldsValid||!this.refFields)return void this.$alert('Please specify the attachment or choose "No media".',{type:"error"})}else if(!this.refType&&!this.title.trim()&&!this.body.trim())return void this.$alert("A title, body, or attachment is required.",{type:"error"});if(this.contentType===T&&this.previewError)return void this.$alert("Error rendering preview. Please check your HTML syntax.",{type:"error"});let e=this.createSendingSpinner(),t=this.callback;var s,i,n,r,l,a,c,d;this.block?(s=this.specId,i=this.block.id,n=this.styleType,r=this.contentType,l=this.title,a=this.body,c=this.refType,d=this.refFields,d=d||{},o().post("/ajax/spec/save-block",{specId:s,blockId:i,styleType:n,contentType:r,title:l,body:a,refType:c,...d}).fail(u)).then((s=>{t(s),this.showing=!1,e.close()})).fail((()=>{e.close()})):function(e,t,s,i,n,r,l,a,c,d){return d=d||{},o().post("/ajax/spec/create-block",{specId:e,subspecId:t,parentId:s,insertBeforeId:i,styleType:n,contentType:r,title:l,body:a,refType:c,...d}).fail(u)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,this.contentType,this.title,this.body,this.refType,this.refFields).then((s=>{t(s),this.showing=!1,e.close()})).fail((()=>{e.close()}))},createSendingSpinner(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed(){this.styleType=C,this.contentType=S,this.block=null,this.error=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1,this.previewHtml="",this.previewError=null}}},st,[],!1,null,null,null);at.options.__file="src/spec/edit-block-modal.vue";const ct=at.exports;var dt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:e.urlObject?"Manage link":"Create link",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.urlObject?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.urlObject.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.urlObject.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tURL\n\t\t"),s("el-input",{ref:"urlInput",attrs:{maxlength:e.urlMaxLength},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1),e._v(" "),e.urlObject?[e.url===e.urlObject.url?s("div",{staticClass:"preview"},[e.urlObject.imageData?s("img",{attrs:{src:e.urlObject.imageData}}):e._e(),e._v(" "),s("div",[e.urlObject.title?s("h3",[e._v(e._s(e.urlObject.title.trim()))]):e._e(),e._v(" "),e.urlObject.desc?s("div",[e._v(e._s(e.urlObject.desc.trim()))]):e._e(),e._v(" "),e.autoRefresh?s("p",[e._v("URL preview will be updated")]):s("el-checkbox",{model:{value:e.refresh,callback:function(t){e.refresh=t},expression:"refresh"}},[e._v("Refresh URL preview")])],1)]):s("p",[e._v("Link will be updated with new URL")])]:e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.urlObject?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDelete()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.urlObject?"Save":"Create"))])],1)],2)};dt._withStripped=!0;var ut=A({components:{Moment:L},props:{specId:{type:Number,required:!0}},data:()=>({url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return window.isValidURL=g,!g(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},urlMaxLength:()=>window.const.urlMaxLength,autoRefresh(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.createdCallback=e,this.showing=!0,this.$nextTick((()=>{o()("input",this.$refs.urlInput.$el).focus()}))},showEdit(e,t,s){this.urlObject=e,this.url=e.url,this.refresh=!0,this.updatedCallback=t,this.deletedCallback=s,this.showing=!0,this.$nextTick((()=>{o()("input",this.$refs.urlInput.$el).focus()}))},submit(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.createdCallback;var t,s;(t=this.specId,s=this.url,o().post("/ajax/spec/create-url",{specId:t,url:s}).fail(u)).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},submitSave(){if(this.disableSubmit)return;this.sending=!0;let e=this.updatedCallback;var t,s;(t=this.urlObject.id,s=this.url,o().post("/ajax/spec/refresh-url",{id:t,url:s}).fail(u)).then((t=>{e(t),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))},promptDelete(){this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{this.sending=!0;let e=this.deletedCallback;var t;(t=this.urlObject.id,o().post("/ajax/spec/delete-url",{id:t}).fail(u)).then((()=>{e&&e(this.urlObject.id),this.sending=!1,this.showing=!1})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},dt,[],!1,null,null,null);ut.options.__file="src/spec/edit-url-modal.vue";const pt=ut.exports,ht=s().extend(tt);var mt=A({components:{EditBlockModal:ct,EditUrlModal:pt},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:()=>({autoscroller:null,eventBus:new(s())}),computed:{dragging(){return this.$store.state.dragging},specId(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId(){return this.subspec?this.subspec.id:null},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},dragAndDropEnabled(){return this.enableEditing&&!this.$store.getters.mobileViewport}},watch:{dragAndDropEnabled(e){e?this.mountDragAndDrop():this.drake&&(this.drake.destroy(),this.drake=null)},dragging(e){e?this.autoscroller=function(){const e=70,t=o()(window);let s=null,i=null;function n(e){i=e.clientY}return t.on("mousemove",n),s=window.requestAnimationFrame((function n(){if(null!==i){let s=t.height(),n=0;i<e?n=-((e-i)/e*8+1):i>s-e&&(n=(i-(s-e))/e*8+1),0!==n&&t.scrollTop(t.scrollTop()+n)}s=window.requestAnimationFrame(n)})),{stop:function(){t.off("mousemove",n),s&&(window.cancelAnimationFrame(s),s=null)}}}():this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null)}},mounted(){if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";let e;if(this.spec)e=this.spec.blocks;else{if(!this.subspec)return;e=this.subspec.blocks}if(e)for(var t=0;t<e.length;t++)this.insertBlock(e[t]);this.$nextTick((()=>{this.$emit("rendered")})),this.mountDragAndDrop()},beforeDestroy(){this.drake&&(this.drake.destroy(),this.drake=null),this.autoscroller&&(this.autoscroller.stop(),this.autoscroller=null),this.$store.getters.currentlyMovingBlocks&&this.$store.state.movingBlocksSourceSubspecId===this.subspecId&&this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.getFinalMovingBlockIds()}),this.eventBus.$destroy(),this.eventBus=null,o()("[data-spec-block]",this.$refs.list).each(((e,t)=>{o()(t).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst(){let e=o()(window).scrollTop();o()("[data-spec-block]",this.$refs.list).each(((t,s)=>{let i=o()(s),n=i.offset();if(n.top>e){let t=n.top-e;return this.$nextTick((()=>{o()(window).scrollTop(i.offset().top-t)})),!1}}))},transitRelativeScroll(e){let t=o()(window).scrollTop(),s=o()('[data-spec-block="'+e+'"]',this.$refs.list),i=s.offset().top-t;this.$nextTick((()=>{o()(window).scrollTop(s.offset().top-i)}))},insertBlock(e,t=!0,s=!1){let i=new ht({parent:this,store:j,router:Ft,propsData:{block:e,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing,justAdded:s}}).$mount();i.$on("open-community",this.openBlockCommunity),i.$on("open-edit",this.openEditBlock),i.$on("prompt-add-subblock",this.promptAddSubblock),i.$on("prompt-delete",this.promptDeleteBlock),i.$on("start-moving",this.startMovingBlocks),i.$on("add-to-moving",this.addToMovingBlocks),i.$on("remove-from-moving",this.removeFromMovingBlocks),i.$on("prompt-nav-spec",this.promptNavSpec),i.$on("move-before",this.moveBeforeBlock),i.$on("move-into",this.moveIntoBlock),i.$on("move-after",this.moveAfterBlock),i.$on("cancel-moving",this.cancelMovingBlocks),i.$on("play-video",this.playVideo);let n=o()(i.$el).data("vc",i);if(e.subblocks)for(var r=0;r<e.subblocks.length;r++){let t=e.subblocks[r],s=this.insertBlock(t,!1);o()(">ul.spec-block-list",n).append(s)}return t&&n.appendTo(this.$refs.list),n},mountDragAndDrop(){this.dragAndDropEnabled&&(this.drake||Je(Xe).then((e=>{console.debug("create drake"),this.drake=e({isContainer:e=>o()(e).is(".spec-block-list"),accepts:(e,t,s,i)=>!o()(t).closest(".gu-transit").length,moves:(e,t,s,i)=>o()(s).is(".drag-handle"),mirrorContainer:this.$refs.mirrorList}).on("drag",((e,t)=>{this.$store.commit("startDragging"),this.transitRelativeScroll(o()(e).attr("data-spec-block"))})).on("dragend",(e=>{this.$store.commit("endDragging"),this.transitRelativeScroll(o()(e).attr("data-spec-block"))})).on("drop",((e,t,s,i)=>{let n=o()(e).data("vc").getBlockId(),r=o()(s).closest("[data-spec-block]");r.length&&r.data("vc").updateHasSubblocks();let l=null,a=o()(t).closest("[data-spec-block]");if(a.length){let e=a.data("vc");l=e.getBlockId(),e.updateHasSubblocks()}let c=i?o()(i).data("vc").getBlockId():null;Z([n],this.subspecId,l,c)}))})))},promptAddBlock(){this.$refs.editBlockModal.showAdd(null,null,!0,(e=>{let t=this.insertBlock(e,!0,!0);this.panToBlock(t)}))},openBlockCommunity(e,t,s){this.$emit("open-community",w,e,t,s)},openEditBlock(e,t){this.$refs.editBlockModal.showEdit(e,t)},promptAddSubblock(e,t,s){this.$refs.editBlockModal.showAdd(e,t,s,(s=>{let i=this.insertBlock(s,!1,!0);if(t)i.insertBefore('[data-spec-block="'+t+'"]');else if(e){let t=o()('[data-spec-block="'+e+'"]');i.appendTo(t.find(">ul.spec-block-list")),t.data("vc").updateHasSubblocks()}else i.appendTo(this.$refs.list);this.panToBlock(i)}))},promptDeleteBlock(e,t){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{(function(e){return o().post("/ajax/spec/delete-block",{blockId:e}).fail(u)})(e).then((()=>{o()('[data-spec-block="'+e+'"]').remove(),t&&t()}))})).catch((()=>{}))},startMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:[e]}),this.transitRelativeScroll(e)},addToMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.concat(e)})},removeFromMovingBlocks(e){this.$store.commit("setMovingBlocks",{subspecId:this.subspecId,blockIds:this.$store.state.movingBlockIds.filter((t=>!p(t,e)))})},moveBeforeBlock(e){let t=o()('[data-spec-block="'+e+'"]',this.$refs.list),s=t.parent().closest("[data-spec-block]"),i=s.length?s.attr("data-spec-block"):null,n=e;this.moveBlocks(i,n,(e=>{e.insertBefore(t)}))},moveIntoBlock(e){let t=o()('[data-spec-block="'+e+'"]',this.$refs.list),s=t.attr("data-spec-block"),i=t.find(">ul.spec-block-list");this.moveBlocks(s,null,(e=>{e.appendTo(i)})),t.data("vc").updateHasSubblocks()},moveAfterBlock(e){let t=o()('[data-spec-block="'+e+'"]',this.$refs.list),s=t.parent().closest("[data-spec-block]"),i=s.length?s.attr("data-spec-block"):null,n=t.next("[data-spec-block]"),r=n.length?n.attr("data-spec-block"):null,l=t;this.moveBlocks(i,r,(e=>{e.insertAfter(l),l=e}))},moveBlocksToBottom(){this.moveBlocks(null,null,(e=>{e.appendTo(this.$refs.list)}))},getFinalMovingBlockIds(){if(!this.$store.getters.currentlyMovingBlocks)return[];if(!p(this.$store.state.movingBlocksSourceSubspecId,this.subspecId))return this.$store.state.movingBlockIds;let e=[];return o()("[data-moving-block-id]",this.$refs.list).each(((t,s)=>{let i=o()(s);i.closest(".spec-block-list.moving").length||e.push(i.attr("data-moving-block-id"))})),e},moveBlocks(e,t,s){let i=this.getFinalMovingBlockIds();i.length&&Z(i,this.subspecId,e,t).then(((e=null)=>{let t=null;if(e)for(var n=0;n<e.length;n++){let i=this.insertBlock(e[n],!1,!0);s(i),t||(t=i)}else{let e={};for(let n=0;n<i.length;n++){let r=o()('[data-spec-block="'+i[n]+'"]',this.$refs.list),l=r.parent().closest("[data-spec-block]");s(r),l.length&&(e[l.attr("data-spec-block")]=l.data("vc")),t||(t=r)}for(let t in e)e[t].updateHasSubblocks()}this.$store.commit("endMovingBlocks"),this.panToBlock(t)}))},cancelMovingBlocks(e){this.$store.commit("endMovingBlocks"),this.transitRelativeScroll(e)},openEditUrl(e,t,s){this.$refs.editUrlModal.showEdit(e,(e=>{this.eventBus.$emit("url-updated",e),t&&t(e)}),(e=>{this.eventBus.$emit("url-deleted",e),s&&s(e)}))},playVideo(e){this.$emit("play-video",e)},promptNavSpec(){this.$emit("prompt-nav-spec")},panToBlock(e){let t=e.find(">.content").offset(),s=o()(window),i=s.scrollTop(),n=s.height();t.top<i+100?s.scrollTop(t.top-100):t.top>i+n-200&&s.scrollTop(t.top-(n-200))}}},We,[],!1,null,null,null);mt.options.__file="src/spec/view.vue";const gt=mt.exports;var vt=A({props:{loading:Boolean,spec:Object,enableEditing:Boolean},components:{SpecView:gt},beforeRouteEnter(e,t,s){console.debug("beforeRouteEnter spec-view",e),s()},beforeRouteUpdate(e,t,s){console.debug("beforeRouteUpdate spec-view",e),s()},methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,s,i){this.$emit("open-community",e,t,s,i)},playVideo(e){this.$emit("play-video",e)}}},He,[],!1,null,null,null);vt.options.__file="src/pages/spec-view.vue";const bt=vt.exports;var ft=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"subspec-page"},[e.subspec?s("header",[e.onSubspecRoute&&!e.loading?s("div",{staticClass:"right"},[e.enableEditing?[s("el-button",{attrs:{type:e.unreadCount?"primary":"default",disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSubspecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2),e._v(" "),e.enableEditing?s("el-button",{attrs:{disabled:e.choosingAddPosition,size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.openManageSubspec()}}}):e._e()]:[s("span",[e._v("\n\t\t\t\t\tLast modified "),s("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1),e._v(" "),s("el-button",{attrs:{type:e.unreadCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(t){return e.openSubspecCommunity()}}},[e.showUnreadOnly||e.unreadCount?[e.unreadCount?[e._v(e._s(e.unreadCount)+" unread")]:e._e()]:e.commentsCount?[e._v(e._s(e.commentsCount))]:e._e()],2)]],2):e._e(),e._v(" "),s("h3",{staticClass:"name"},[e._v(e._s(e.subspec.name))]),e._v(" "),e.subspec.desc?s("div",{staticClass:"desc"},[e._v(e._s(e.subspec.desc))]):e._e()]):e._e(),e._v(" "),s("router-view",{ref:"view",attrs:{loading:e.loading,subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo}}),e._v(" "),e.enableEditing?s("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":e.specId}}):e._e()],1)};ft._withStripped=!0;var _t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:e.subspec?"Manage subspec":"Create subspec",visible:e.showing,width:e.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.closed()}}},[e.subspec?s("p",[e._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:e.subspec.created}})],1),e._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:e.subspec.updated,offset:!0}})],1)]):e._e(),e._v(" "),s("label",[e._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{maxlength:e.nameMaxLength,clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("label",[e._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}})],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Cancel")]),e._v(" "),e.subspec?s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.promptDeleteSubspec()}}},[e._v("Delete")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:function(t){return e.submit()}}},[e._v(e._s(e.subspec?"Save":"Create"))])],1)])};_t._withStripped=!0;var yt=A({components:{Moment:L},props:{specId:Number},data:()=>({name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}),computed:{disableSubmit(){return!this.name.trim()},nameMaxLength:()=>window.const.specNameMaxLength},watch:{sending(e){e?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},beforeDestroy(){this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)},methods:{showCreate(e){this.callback=e,this.showing=!0,this.$nextTick((()=>{o()("input",this.$refs.nameInput.$el).focus()}))},showEdit(e,t){this.subspec=e,this.name=e.name,this.desc=e.desc,this.callback=t,this.showing=!0,this.$nextTick((()=>{o()("input",this.$refs.nameInput.$el).focus()}))},submit(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate(){if(this.disableSubmit)return;this.sending=!0;let e=this.callback;var t,s,i;(t=this.specId,s=this.name,i=this.desc,o().post("/ajax/spec/create-subspec",{specId:t,name:s,desc:i}).fail(u)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},submitSave(){this.sending=!0;let e=this.callback;var t,s,i;(t=this.subspec.id,s=this.name,i=this.desc,o().post("/ajax/spec/save-subspec",{subspecId:t,name:s,desc:i}).fail(u)).then((t=>{e(t),this.showing=!1,this.sending=!1})).fail((()=>{this.sending=!1}))},promptDeleteSubspec(){this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((()=>{var e;this.sending=!0,(e=this.subspec.id,o().post("/ajax/spec/delete-subspec",{subspecId:e}).fail(u)).then((()=>{this.sending=!1,this.showing=!1,this.$nextTick((()=>{this.$router.push({name:"spec",params:{specId:this.specId}})}))})).fail((()=>{this.sending=!1}))})).catch((()=>{}))},closed(){this.subspec=null,this.name="",this.desc=""}}},_t,[],!1,null,null,null);yt.options.__file="src/spec/edit-subspec-modal.vue";var wt=A({components:{Moment:L,SpecView:gt,EditSubspecModal:yt.exports},inheritAttrs:!1,props:{enableEditing:Boolean},data:()=>({loading:!0,subspec:null,unreadCount:0,commentsCount:0}),computed:{specId(){return parseInt(this.$route.params.specId,10)},subspecId(){return parseInt(this.$route.params.subspecId,10)},onSubspecRoute(){return"subspec"===this.$route.name},choosingAddPosition(){return this.$store.getters.currentlyMovingBlocks},showUnreadOnly(){return this.$store.getters.userSettings.community.unreadOnly}},beforeRouteEnter(e,t,s){console.debug("beforeRouteEnter subspec",e),s((t=>{t.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name)}))},beforeRouteUpdate(e,t,s){console.debug("beforeRouteUpdate subspec",e),this.loadSubspec(e.params.specId,e.params.subspecId,"subspec"===e.name),s()},beforeRouteLeave(e,t,s){console.debug("beforeRouteLeave subspec"),this.subspec=null,this.unreadCount=0,this.commentsCount=0,m(),s()},methods:{loadSubspec(e,t,s){console.debug("load subspec"),this.loading=!0,function(e,t,s=!0){return o().get("/ajax/spec/subspec",{specId:e,subspecId:t,loadBlocks:s}).fail(u)}(e,t,s).then((e=>{console.debug("subspec loaded",e),this.subspec=e,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,m(e.name),this.loading=!1,this.$refs.view.$once("rendered",this.restoreScroll)})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},promptNavSpec(){this.$emit("prompt-nav-spec")},openSubspecCommunity(){this.$emit("open-community",y,this.subspec.id,(e=>{this.unreadCount+=e}),(e=>{this.commentsCount+=e}))},openCommunity(e,t,s,i){this.$emit("open-community",e,t,s,i)},playVideo(e){this.$emit("play-video",e)},openManageSubspec(){this.$refs.editSubspecModal.showEdit(this.subspec,(e=>{this.subspec.updated=e.updated,this.subspec.name=e.name,this.subspec.desc=e.desc,this.unreadCount=e.unreadCount||0,this.commentsCount=e.commentsCount||0,m(e.name)}))},restoreScroll(){let e=this.$store.state.savedScrollPosition;e&&this.onSubspecRoute&&(console.debug("restoreScroll subspec"),o()(window).scrollTop(e.y).scrollLeft(e.x))}}},ft,[],!1,null,null,null);wt.options.__file="src/pages/subspec.vue";const kt=wt.exports;var Ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"subspec-view-page",class:{loading:e.loading}},[e.loading?s("p",[e._v("Loading...")]):e.subspec?s("spec-view",{key:e.subspec.renderTime,attrs:{subspec:e.subspec,"enable-editing":e.enableEditing},on:{"prompt-nav-spec":e.promptNavSpec,"open-community":e.openCommunity,"play-video":e.playVideo,rendered:function(t){return e.$emit("rendered")}}}):e._e()],1)};Ct._withStripped=!0;var St=A({props:{loading:Boolean,subspec:Object,enableEditing:Boolean},components:{SpecView:gt},methods:{promptNavSpec(){this.$emit("prompt-nav-spec")},openCommunity(e,t,s,i){this.$emit("open-community",e,t,s,i)},playVideo(e){this.$emit("play-video",e)}}},Ct,[],!1,null,null,null);St.options.__file="src/pages/subspec-view.vue";const Tt=St.exports;var It=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"community-review-page"},[e._m(0),e._v(" "),s("div",{staticClass:"content-page"},[e.loading?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):[s("section",[s("h3",[e._v("Your specs")]),e._v(" "),e.specs.length?e._l(e.specs,(function(t){return s("div",{key:t.id,staticClass:"spec review"},[s("div",{staticClass:"flex-row"},[s("div",{staticClass:"flex-row nowrap fill"},[s("div",{staticClass:"expand"},[t.hasSubspecs?[e.expandedSpecs[t.id]?s("el-button",{attrs:{type:t.hasUnreadSubspec?"primary":"default",size:"mini",icon:"el-icon-arrow-up",circle:""},on:{click:function(s){return e.collapseSpec(t.id)}}}):s("el-button",{attrs:{type:t.hasUnreadSubspec?"primary":"default",size:"mini",icon:"el-icon-arrow-down",circle:""},on:{click:function(s){return e.expandSpec(t.id)}}})]:s("el-button",{staticStyle:{visibility:"hidden"},attrs:{type:"default",size:"mini",icon:"el-icon-aim",circle:""}})],2),e._v(" "),s("div",{staticClass:"name fill"},[s("router-link",{attrs:{to:{name:"spec",params:{specId:t.id}}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(t.name)+"\n\t\t\t\t\t\t\t\t\t")])],1)]),e._v(" "),s("div",[s("el-button",{attrs:{type:t.unread?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(s){return e.openSpecCommunity(t.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.unread)+" unread ("+e._s(t.total)+" total)\n\t\t\t\t\t\t\t\t")])],1),e._v(" "),s("div",[s("el-button",{attrs:{type:t.blockUnread?"primary":"default",size:"mini",icon:"el-icon-folder-opened"},on:{click:function(s){return e.gotoSpec(t.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.blockUnread)+" unread ("+e._s(t.blockTotal)+" total) on blocks\n\t\t\t\t\t\t\t\t")])],1)]),e._v(" "),e.expandedSpecs[t.id]?s("div",{staticClass:"subspecs"},[e.subspecsBySpecId[t.id]?e._l(e.subspecsBySpecId[t.id],(function(i){return s("div",{key:i.id,staticClass:"subspec review"},[s("div",{staticClass:"flex-row"},[s("div",{staticClass:"name fill"},[s("router-link",{attrs:{to:{name:"subspec",params:{specId:t.id,subspecId:i.id}}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+e._s(i.name)+"\n\t\t\t\t\t\t\t\t\t\t\t")])],1),e._v(" "),s("div",[s("el-button",{attrs:{type:i.unread?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(s){return e.openSubspecCommunity(t.id,i.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+e._s(i.unread)+" unread ("+e._s(i.total)+" total)\n\t\t\t\t\t\t\t\t\t\t\t")])],1),e._v(" "),s("div",[s("el-button",{attrs:{type:i.blockUnread?"primary":"default",size:"mini",icon:"el-icon-folder-opened"},on:{click:function(s){return e.gotoSubspec(t.id,i.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t\t\t"+e._s(i.blockUnread)+" unread ("+e._s(i.blockTotal)+" total) on blocks\n\t\t\t\t\t\t\t\t\t\t\t")])],1)])])})):s("p",[s("i",{staticClass:"el-icon-loading"})])],2):e._e()])})):s("p",[e._v("No specs")])],2),e._v(" "),s("section",[s("h3",[e._v("Your comments")]),e._v(" "),s("div",{staticClass:"flex-row wrap-reverse"},[s("div",{staticClass:"fill nowraptext",domProps:{textContent:e._s(e.formattedCommentsCount)}}),e._v(" "),s("el-checkbox",{on:{change:function(t){return e.reloadComments()}},model:{value:e.showUnreadOnly,callback:function(t){e.showUnreadOnly=t},expression:"showUnreadOnly"}},[e._v("\n\t\t\t\t\t\tShow only comments with unread replies\n\t\t\t\t\t")])],1),e._v(" "),e.comments.length?[e._l(e.comments,(function(t){return s("div",{key:t.id,staticClass:"comment review"},[s("div",{staticClass:"flex-row"},[s("div",{staticClass:"fill"},[s("username",{attrs:{username:e.$store.getters.username}}),e._v(" "),t.updated!==t.created?[e._v("\n\t\t\t\t\t\t\t\t\tupdated "),s("moment",{attrs:{datetime:t.updated,offset:!0}})]:[e._v("\n\t\t\t\t\t\t\t\t\tposted "),s("moment",{attrs:{datetime:t.created,offset:!0}})]],2),e._v(" "),s("div",[s("el-button",{attrs:{type:t.unread?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(s){return e.openCommentCommunity(t.specId,t.id)}}},[e._v("\n\t\t\t\t\t\t\t\t\t"+e._s(t.unread)+" unread ("+e._s(t.total)+" total)\n\t\t\t\t\t\t\t\t")])],1)]),e._v(" "),s("div",{staticClass:"body",domProps:{textContent:e._s(t.body)}})])})),e._v(" "),e.loadingCommentsPage?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Loading more comments...")]):e.hasMoreComments?s("el-button",{on:{click:function(t){return e.loadMoreComments()}}},[e._v("Load more")]):e._e()]:e.loadingCommentsPage?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Loading...")]):s("p",[e._v("No comments")])],2)]],2),e._v(" "),s("community-modal",{ref:"communityModal",attrs:{"spec-id":e.specId},on:{"play-video":e.playVideo}}),e._v(" "),s("play-video-modal",{ref:"playVideoModal"})],1)};function $t(e){return o().get("/ajax/community-review",e)}It._withStripped=!0;var xt=A({components:{Moment:L,CommunityModal:Fe,PlayVideoModal:ze,Username:X},data:()=>({loading:!0,showUnreadOnly:!1,specs:[],expandedSpecs:{},subspecsBySpecId:{},comments:[],totalComments:0,hasMoreComments:!1,loadingCommentsPage:!1,specId:null}),computed:{commentsPageArgs(){let e={unreadOnly:this.showUnreadOnly};return this.comments.length&&(e.updatedBefore=this.comments[this.comments.length-1].updated),e},formattedCommentsCount(){let e=this.totalComments;return e+" comment"+(1!==e?"s":"")+(this.showUnreadOnly?" with unread replies":"")}},beforeRouteEnter(e,t,s){console.debug("beforeRouteEnter community-review",e),s((e=>{e.initPage()}))},beforeRouteUpdate(e,t,s){console.debug("beforeRouteUpdate community-review",e),this.initPage(),s()},beforeRouteLeave(e,t,s){console.debug("beforeRouteLeave community-review"),this.specs=[],this.expandedSpecs={},this.subspecsBySpecId={},this.comments=[],this.totalComments=0,this.hasMoreComments=!1,this.specId=null,s()},methods:{initPage(){this.showUnreadOnly=this.$store.getters.userSettings.community.unreadOnly,this.loading=!0,$t(o().extend({request:"all"},this.commentsPageArgs)).then((e=>{this.specs=e.specs,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments,this.loading=!1})).fail((e=>{this.$router.replace({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(this.$route.fullPath)}})}))},expandSpec(e){var t=this.expandedSpecs[e];this.$set(this.expandedSpecs,e,!0),void 0===t&&$t({request:"subspecs",specId:e}).then((t=>{this.$set(this.subspecsBySpecId,e,t.subspecs)})).fail((t=>{this.$delete(this.expandedSpecs,e),u(t)}))},collapseSpec(e){this.$set(this.expandedSpecs,e,!1)},reloadComments(){this.loadingCommentsPage=!0,this.comments=[],$t(o().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=e.comments,this.totalComments=e.totalComments,this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,u(e)}))},loadMoreComments(){this.loadingCommentsPage=!0,$t(o().extend({request:"comments"},this.commentsPageArgs)).then((e=>{this.loadingCommentsPage=!1,this.comments=this.comments.concat(e.comments),this.hasMoreComments=e.hasMoreComments})).fail((e=>{this.loadingCommentsPage=!1,u(e)}))},openSpecCommunity(e){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(_,e,(t=>{for(var s=0;s<this.specs.length;s++)if(p(e,this.specs[s].id)){this.$set(this.specs[s],"unread",this.specs[s].unread+t);break}}),(t=>{for(var s=0;s<this.specs.length;s++)if(p(e,this.specs[s].id)){this.$set(this.specs[s],"total",this.specs[s].total+t);break}}))}))},gotoSpec(e){this.$router.push({name:"spec",params:{specId:e}})},openSubspecCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(y,t,(s=>{let i=this.subspecsBySpecId[e];for(var n=0;n<i.length;n++)if(p(t,i[n].id)){this.$set(i[n],"unread",i[n].unread+s);break}let o=!1;if(s>0)o=!0;else for(n=0;n<i.length;n++)if(i[n].unread>0||i[n].blockUnread>0){o=!0;break}for(n=0;n<this.specs.length;n++)if(p(e,this.specs[n].id)){this.$set(this.specs[n],"hasUnreadSubspec",o);break}}),(s=>{let i=this.subspecsBySpecId[e];for(var n=0;n<i.length;n++)if(p(t,i[n].id)){this.$set(i[n],"total",i[n].total+s);break}}))}))},gotoSubspec(e,t){this.$router.push({name:"subspec",params:{specId:e,subspecId:t}})},openCommentCommunity(e,t){this.specId=e,this.$nextTick((()=>{this.$refs.communityModal.openCommunityReview(k,t,(e=>{for(var s=0;s<this.comments.length;s++)if(p(t,this.comments[s].id)){this.$set(this.comments[s],"unread",this.comments[s].unread+e);break}}),(e=>{for(var s=0;s<this.comments.length;s++)if(p(t,this.comments[s].id)){this.$set(this.comments[s],"total",this.comments[s].total+e);break}}))}))},playVideo(e){this.$refs.playVideoModal.show(e)}}},It,[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("header",[s("h2",[e._v("Community review")])])}],!1,null,null,null);xt.options.__file="src/pages/community-review.vue";const Pt=xt.exports;var Et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"admin-page"},[e._m(0),e._v(" "),s("div",{staticClass:"content-page"},[e.loading?s("p",[e._v("Loading...")]):403===e.error?s("p",[e._v("Unauthorized")]):e.error?s("p",[e._v("Error "+e._s(e.error))]):e._e(),e._v(" "),e.signupRequests?s("section",{staticClass:"signup-requests"},[s("h3",[e._v("Signup requests")]),e._v(" "),s("div",{staticClass:"options"},[s("el-checkbox",{model:{value:e.showAllSignupRequests,callback:function(t){e.showAllSignupRequests=t},expression:"showAllSignupRequests"}},[e._v("Show all")])],1),e._v(" "),e.loadingSignupRequests?s("p",[e._v("Loading...")]):e.signupRequests.length?s("el-table",{attrs:{data:e.signupRequests,"max-height":.8*e.$store.state.windowHeight}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:"40"}}),e._v(" "),s("el-table-column",{attrs:{fixed:"",prop:"username",label:"Username",width:"150"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"Email address",width:"300"}}),e._v(" "),s("el-table-column",{attrs:{label:"Created",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("moment",{attrs:{datetime:e.row.created,offset:!0}})]}}],null,!1,2518928277)}),e._v(" "),e.showAllSignupRequests?[s("el-table-column",{attrs:{label:"Status",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reviewed?[t.row.approved?s("el-tag",{attrs:{type:"success"}},[e._v("Approved")]):s("el-tag",{attrs:{type:"warning"}},[e._v("Denied")])]:s("el-tag",[e._v("Pending")])]}}],null,!1,1722861693)}),e._v(" "),s("el-table-column",{attrs:{prop:"userId",label:"User ID",width:"120"}})]:e._e(),e._v(" "),s("el-table-column",{attrs:{label:"Actions",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.reviewed?e._e():s("el-button",{attrs:{size:"mini"},on:{click:function(s){return e.openReviewSignupRequest(t.row)}}},[e._v("\n\t\t\t\t\t\t\tReview\n\t\t\t\t\t\t")])]}}],null,!1,812736396)})],2):e.showAllSignupRequests?s("p",[e._v("No data")]):s("p",[e._v("No pending requests")])],1):e._e(),e._v(" "),s("section",{staticClass:"users"},[s("h3",[e._v("Users")]),e._v(" "),e.loadingUsers?s("p",[e._v("Loading...")]):s("el-table",{attrs:{data:e.users,"max-height":.8*e.$store.state.windowHeight}},[s("el-table-column",{attrs:{fixed:"",label:"Username",width:"190"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("username",{attrs:{username:e.row.username,highlight:e.row.highlight}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"Email address",width:"300"}}),e._v(" "),s("el-table-column",{attrs:{label:"Created",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("moment",{attrs:{datetime:e.row.created,offset:!0}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"specs",label:"Spec count",width:"100"}}),e._v(" "),s("el-table-column",{attrs:{label:"Actions",width:"200"}})],1)],1)]),e._v(" "),e.reviewingSignupRequest?s("el-dialog",{attrs:{title:"Review signup request","close-on-click-modal":!e.sendingSignupRequestReview,width:e.$store.getters.dialogTinyWidth,visible:""}},[s("table",[s("tr",[s("td",[e._v("Request ID")]),e._v(" "),s("td",[e._v(e._s(e.reviewingSignupRequest.id))])]),e._v(" "),s("tr",[s("td",[e._v("Created")]),e._v(" "),s("td",[s("moment",{attrs:{datetime:e.reviewingSignupRequest.created}})],1)]),e._v(" "),s("tr",[s("td",[e._v("Username")]),e._v(" "),s("td",[s("strong",[e._v(e._s(e.reviewingSignupRequest.username))])])]),e._v(" "),s("tr",[s("td",[e._v("Email address")]),e._v(" "),s("td",[s("strong",[e._v(e._s(e.reviewingSignupRequest.email))])])])]),e._v(" "),s("br"),s("br"),e._v(" "),s("label",[e._v("\n\t\t\tMessage\n\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2},readonly:e.sendingSignupRequestReview},model:{value:e.signupRequestResponse,callback:function(t){e.signupRequestResponse=t},expression:"signupRequestResponse"}})],1),e._v(" "),e.sendingSignupRequestReview?s("p",[s("i",{staticClass:"el-icon-loading"}),e._v(" Sending...\n\t\t")]):e._e(),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{disabled:e.sendingSignupRequestReview},on:{click:function(t){return e.cancelReviewSignupRequest()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")]),e._v(" "),s("el-button",{attrs:{type:"warning",disabled:e.sendingSignupRequestReview},on:{click:function(t){return e.submitSignupRequestReview(!1)}}},[e._v("\n\t\t\t\tDecline\n\t\t\t")]),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.sendingSignupRequestReview},on:{click:function(t){return e.submitSignupRequestReview(!0)}}},[e._v("\n\t\t\t\tApprove\n\t\t\t")])],1)]):e._e()],1)};Et._withStripped=!0;var Rt=A({components:{Moment:L,Username:X},data:()=>({loadingSignupRequests:!0,loadingUsers:!0,error:null,showAllSignupRequests:!1,signupRequests:null,reviewingSignupRequest:null,signupRequestResponse:"",sendingSignupRequestReview:!1,users:[]}),computed:{loading(){return this.loadingSignupRequests},unauthorized(){return!(this.loading||this.error||this.signupRequests)}},watch:{showAllSignupRequests(){this.loadSignupRequests()}},beforeRouteEnter(e,t,s){s((e=>{e.loadAdmin()}))},beforeRouteUpdate(e,t,s){this.loadAdmin(),s()},methods:{loadAdmin(){this.error=null,this.loadSignupRequests(),this.loadUsers()},loadSignupRequests(){this.loadingSignupRequests=!0,$.get("/ajax/admin/signup-requests",{all:this.showAllSignupRequests}).then((e=>{this.loadingSignupRequests=!1,this.signupRequests=e})).fail((e=>{this.loadingSignupRequests=!1,this.error=e.status,u(e)}))},loadUsers(){this.loadingUsers=!0,$.get("/ajax/admin/users").then((e=>{this.loadingUsers=!1,this.users=e})).fail((e=>{this.loadingUsers=!1,this.error=e.status,u(e)}))},openReviewSignupRequest(e){this.signupRequestResponse="",this.reviewingSignupRequest=e},cancelReviewSignupRequest(){this.reviewingSignupRequest=null,this.signupRequestResponse=""},submitSignupRequestReview(e){this.reviewingSignupRequest&&(this.sendingSignupRequestReview=!0,$.post("/ajax/admin/review-signup",{requestId:this.reviewingSignupRequest.id,approved:e,message:this.signupRequestResponse}).then((()=>{this.sendingSignupRequestReview=!1;for(var t=0;t<this.signupRequests.length;t++)if(p(this.signupRequests[t].id,this.reviewingSignupRequest.id)){this.showAllSignupRequests?(this.reviewingSignupRequest.reviewed=!0,this.reviewingSignupRequest.approved=e,this.signupRequests.splice(t,1,this.reviewingSignupRequest)):this.signupRequests.splice(t,1);break}this.reviewingSignupRequest=null,this.signupRequestResponse=""})).fail((e=>{this.sendingSignupRequestReview=!1,u(e)})))}}},Et,[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("header",[s("h2",[e._v("Admin panel")])])}],!1,null,null,null);Rt.options.__file="src/pages/admin.vue";const jt=Rt.exports;var Ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ajax-error-page content-page"},[0===e.statusCode?s("p",[e._v("Could not connect to server")]):503===e.statusCode?s("p",[e._v("CrowdSpec is currently offline for database upgrades")]):s("p",[e._v("Request failed with error code "+e._s(e.statusCode))]),e._v(" "),e.url?s("el-button",{on:{click:function(t){return e.retry()}}},[e._v("Retry")]):e._e()],1)};Ut._withStripped=!0;var Bt=A({computed:{url(){return decodeURIComponent(this.$route.query.url)},statusCode(){return parseInt(this.$route.params.code,10)||0}},methods:{retry(){this.$router.replace(this.url)}}},Ut,[],!1,null,null,null);Bt.options.__file="src/pages/ajax-error.vue";const Mt=Bt.exports;var Ot=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"content-page"},[e._v("\n\tNot found\n")])};Ot._withStripped=!0;var At=A({},Ot,[],!1,null,null,null);At.options.__file="src/pages/not-found.vue";const Nt=At.exports,Lt=new(B())({mode:"history",routes:[{name:"index",path:"/",component:ie},{path:"/spec/:specId",component:Ye,children:[{name:"spec",path:"",component:bt},{path:"subspec/:subspecId",component:kt,children:[{name:"subspec",path:"",component:Tt}]}]},{name:"community-review",path:"/community-review",component:Pt},{name:"admin",path:"/admin",component:jt},{name:"ajax-error",path:"/ajax-error/:code",component:Mt},{path:"*",component:Nt}],scrollBehavior:(e,t,s)=>(j.commit("setSavedScrollPosition",s),s||{x:0,y:0})});Lt.beforeEach(((e,t,s)=>{t&&(!j.getters.currentSpecId||e.params.specId&&p(e.params.specId,j.getters.currentSpecId)?"spec"===t.name&&j.commit("saveCurrentSpecScrollTop"):(j.commit("clearCurrentSpec"),j.commit("endMovingBlocks"))),s()})),Lt.afterEach(((e,t)=>{console.debug("afterEach"),j.commit("clearSavedScrollPosition")}));const Ft=Lt;var qt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"edit-profile-modal",attrs:{visible:e.showing,width:e.$store.getters.dialogTinyWidth,"close-on-click-modal":null===e.mode},on:{"update:visible":function(t){e.showing=t},closed:function(t){return e.clearMode()}}},[s("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n\t\tAccount options for\n\t\t"),s("username",{attrs:{username:e.username,highlight:e.highlight}})],1),e._v(" "),e.updateSettingsMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.settingsForm,"label-position":"top"}},[s("el-form-item",[s("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Profile")]),e._v(" "),s("div",{staticClass:"flex-input"},[s("el-color-picker",{attrs:{predefine:e.predefinedUsernameHighlights,"color-format":"rgb"},model:{value:e.settingsForm.userProfile.highlightUsername,callback:function(t){e.$set(e.settingsForm.userProfile,"highlightUsername",t)},expression:"settingsForm.userProfile.highlightUsername"}}),e._v(" "),e.settingsForm.userProfile.highlightUsername?s("el-button",{attrs:{size:"mini",icon:"el-icon-close"},on:{click:function(t){e.settingsForm.userProfile.highlightUsername=null}}}):e._e(),e._v(" "),s("username",{attrs:{username:"Username colour",highlight:e.settingsForm.userProfile.highlightUsername}})],1)]),e._v(" "),s("el-form-item",[s("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Block editing")]),e._v(" "),s("el-select",{model:{value:e.settingsForm.blockEditing.deleteButton,callback:function(t){e.$set(e.settingsForm.blockEditing,"deleteButton",t)},expression:"settingsForm.blockEditing.deleteButton"}},[s("el-option",{attrs:{label:"Show delete button only in edit block modal",value:"modal"}}),e._v(" "),s("el-option",{attrs:{label:"Show delete button on newly added blocks",value:"recent"}}),e._v(" "),s("el-option",{attrs:{label:"Show delete button on all blocks",value:"all"}})],1)],1),e._v(" "),s("el-form-item",[s("strong",{staticClass:"section-heading",attrs:{slot:"label"},slot:"label"},[e._v("Community")]),e._v(" "),s("el-checkbox",{model:{value:e.settingsForm.community.unreadOnly,callback:function(t){e.$set(e.settingsForm.community,"unreadOnly",t)},expression:"settingsForm.community.unreadOnly"}},[e._v("\n\t\t\t\tShow only unread comments by default\n\t\t\t")])],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitSettings()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):e.changePasswordMode?s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.waiting,expression:"waiting"}],ref:"changePasswordForm",attrs:{model:e.changePasswordForm,rules:e.changePasswordRules,"label-position":"top"}},[s("el-form-item",{attrs:{label:"Current password",prop:"oldPass"}},[s("el-input",{ref:"oldPass",attrs:{type:"password",name:"old_password",autocomplete:"current-password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.oldPass)}},model:{value:e.changePasswordForm.oldPass,callback:function(t){e.$set(e.changePasswordForm,"oldPass",t)},expression:"changePasswordForm.oldPass"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[s("el-input",{ref:"newPass",attrs:{type:"password",name:"new_password",autocomplete:"new-password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass)}},model:{value:e.changePasswordForm.newPass,callback:function(t){e.$set(e.changePasswordForm,"newPass",t)},expression:"changePasswordForm.newPass"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[s("el-input",{ref:"newPass2",attrs:{type:"password",name:"verify_password",autocomplete:"new-password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChangePasswordReturn(e.$refs.newPass2)}},model:{value:e.changePasswordForm.newPass2,callback:function(t){e.$set(e.changePasswordForm,"newPass2",t)},expression:"changePasswordForm.newPass2"}})],1),e._v(" "),s("el-form-item",[s("el-alert",{attrs:{type:"info",closable:!1}},[s("p",[e._v("Your password is sent through HTTPS to Google Cloud Platform in Montral and encrypted server-side using "),s("a",{attrs:{href:"https://pkg.go.dev/golang.org/x/crypto/bcrypt?tab=doc#GenerateFromPassword",target:"_blank"}},[e._v("bcrypt")]),e._v(".")]),e._v(" "),s("p",[e._v("Please use a good password so your account is less likely to be hijacked and used to cause trouble.")]),e._v(" "),s("p",[e._v("\n\t\t\t\t\tFor your security, you should not use the same passwords that you use for important services such as email and online banking on other websites.\n\t\t\t\t\tIf one website gets hacked, you can lose access to every other site where you use the same password.\n\t\t\t\t\tIs is wise to use a password manager with two-factor authentication and distinct long random passwords for every important service.\n\t\t\t\t")])])],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitChangePassword()}}},[e._v("\n\t\t\t\tUpdate\n\t\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.clearMode()}}},[e._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):s("div",{staticClass:"options"},[s("p",[e._v("Your email address on file is "),s("span",{staticClass:"email"},[e._v(e._s(e.$store.getters.emailAddress))]),e._v(".")]),e._v(" "),s("el-button",{on:{click:function(t){return e.enterUpdateSettingsMode()}}},[e._v("\n\t\t\tUpdate settings\n\t\t")]),e._v(" "),s("el-button",{on:{click:function(t){return e.enterChangePasswordMode()}}},[e._v("\n\t\t\tChange password\n\t\t")])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showing=!1}}},[e._v("Close")])],1)],1)};qt._withStripped=!0;var Dt=A({components:{Username:X},data:()=>({showing:!1,mode:null,settingsForm:{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},changePasswordForm:{oldPass:"",newPass:"",newPass2:""},waiting:!1}),computed:{username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername},updateSettingsMode(){return 1===this.mode},changePasswordMode(){return 2===this.mode},predefinedUsernameHighlights:()=>["rgb(50, 205, 50)","rgb(255, 192, 203)","rgb(240, 255, 255)","rgb(255, 255, 0)","rgb(255, 250, 250)"],changePasswordRules(){return{oldPass:[{validator:(e,t,s)=>{t.trim()?s():s(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:(e,t,s)=>{t.trim().length<window.const.passwordMinLength?s(new Error("Password minimum length is "+window.const.passwordMinLength+" digits")):(this.changePasswordForm.newPass2.trim()&&this.$refs.changePasswordForm.validateField("newPass2"),s())},trigger:"blur"}],newPass2:[{validator:(e,t,s)=>{t.trim()?t!==this.changePasswordForm.newPass?s(new Error("Passwords do not match")):s():s(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show(){this.showing=!0},enterUpdateSettingsMode(){this.mode=1,this.waiting=!0,o().get("/ajax/settings").then((e=>{this.settingsForm=o().extend(!0,{userProfile:{highlightUsername:null},blockEditing:{deleteButton:"all"},community:{unreadOnly:!1}},e),this.waiting=!1})).fail((e=>{this.waiting=!1,this.clearMode(),u(e)}))},enterChangePasswordMode(){this.mode=2,this.selectOldPassword()},submitSettings(){this.waiting=!0,o().post("/ajax/user/save-settings",{settings:JSON.stringify(this.settingsForm)}).then((e=>{this.waiting=!1,this.$message({message:"Settings updated",type:"success",showClose:!0,duration:1200}),this.clearMode(),this.$store.commit("setUserSettings",e)})).fail((e=>{this.waiting=!1,u(e)}))},handleChangePasswordReturn(){this.changePasswordForm.oldPass.trim()?this.changePasswordForm.newPass.trim()?this.changePasswordForm.newPass2.trim()&&this.changePasswordForm.newPass===this.changePasswordForm.newPass2?this.submitChangePassword():o()("input",this.$refs.newPass2.$el).focus().select():o()("input",this.$refs.newPass.$el).focus().select():o()("input",this.$refs.oldPass.$el).focus().select()},submitChangePassword(){this.$refs.changePasswordForm.validate((e=>{e&&(this.waiting=!0,o().post("/ajax/user/change-password",{old:this.changePasswordForm.oldPass,new:this.changePasswordForm.newPass,new2:this.changePasswordForm.newPass2}).then((()=>{this.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),this.clearMode()})).fail((e=>{if(e&&e.readyState)switch(e.status){case 400:this.$message({message:"New password rejected",type:"error",showClose:!0,duration:4e3});break;case 403:this.$message({message:"Current password incorrect",type:"error",showClose:!0,duration:4e3}),this.selectOldPassword();break;default:u(e)}else u(e)})).always((()=>{this.waiting=!1})))}))},selectOldPassword(){this.$nextTick((()=>{this.$refs.oldPass&&o()("input",this.$refs.oldPass.$el).focus().select()}))},clearMode(){this.mode=null,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},qt,[],!1,null,null,null);Dt.options.__file="src/widgets/edit-profile-modal.vue";const zt=Dt.exports;var Vt=A({store:j,router:Ft,components:{Username:X,EditProfileModal:zt},computed:{username(){return this.$store.getters.username},highlight(){return this.$store.getters.userSettings.userProfile.highlightUsername}},methods:{gotoIndex(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout(){window.location.href="/logout"},openEditProfile(){this.$refs.editProfileModal.show()}}},i,[],!1,null,null,null);Vt.options.__file="src/app.vue";const Yt=Vt.exports;ELEMENT.locale(ELEMENT.lang.en),new(s())(Yt).$mount("#app")})();