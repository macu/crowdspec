!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=23)}([function(t,e){t.exports=jQuery},function(t,e){t.exports=Vue},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e){t.exports=Vuex},function(t,e){t.exports=VueRouter},function(t,e){t.exports=moment},function(t,e){t.exports=dragula},function(t,e,s){t.exports=s(42)},function(t,e,s){},function(t,e,s){"use strict";var i=s(2);s.n(i).a},function(t,e,s){"use strict";var i=s(3);s.n(i).a},function(t,e,s){"use strict";var i=s(4);s.n(i).a},function(t,e,s){"use strict";var i=s(5);s.n(i).a},function(t,e,s){"use strict";var i=s(6);s.n(i).a},function(t,e,s){"use strict";var i=s(7);s.n(i).a},function(t,e,s){"use strict";var i=s(8);s.n(i).a},function(t,e,s){"use strict";var i=s(9);s.n(i).a},function(t,e,s){"use strict";var i=s(10);s.n(i).a},function(t,e,s){"use strict";var i=s(11);s.n(i).a},function(t,e,s){"use strict";var i=s(12);s.n(i).a},function(t,e,s){"use strict";var i=s(13);s.n(i).a},function(t,e,s){"use strict";var i=s(14);s.n(i).a},function(t,e,s){"use strict";var i=s(15);s.n(i).a},function(t,e,s){"use strict";var i=s(16);s.n(i).a},function(t,e,s){"use strict";var i=s(17);s.n(i).a},function(t,e,s){"use strict";var i=s(18);s.n(i).a},function(t,e,s){"use strict";s.r(e);s(24);var i=s(1),n=s.n(i),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app"},[s("header",[s("h1",{on:{click:function(e){return t.gotoIndex()}}},[t._v("CrowdSpec")]),t._v(" "),s("div",[s("span",{staticClass:"username",on:{click:function(e){return t.openEditProfile()}}},[t._v(t._s(t.username))]),t._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.logout()}}},[t._v("Log out")])],1)]),t._v(" "),s("router-view",{staticClass:"page-area"}),t._v(" "),s("edit-profile-modal",{ref:"editProfileModal"})],1)};o._withStripped=!0;var r=s(0),l=s.n(r),c=s(19),a=s.n(c);n.a.use(a.a);var u=l()(window),d=new a.a.Store({state:{currentTime:Date.now(),windowWidth:u.width(),dragging:!1,moving:null,savedScrollPosition:null,currentSpecId:null,currentSpecScrollTop:null},getters:{userID:function(t){return window.user.id},username:function(t){return window.user.username},dialogTinyWidth:function(t){return t.windowWidth<=767?"80%":t.windowWidth<=991?"50%":"30%"},dialogSmallWidth:function(t){return t.windowWidth<=767?"90%":t.windowWidth<=991?"75%":"50%"},dialogLargeWidth:function(t){return t.windowWidth<=991?"95%":"90%"}},mutations:{setWindowWidth:function(t,e){t.windowWidth=e},startDragging:function(t){t.dragging=!0},endDragging:function(t){t.dragging=!1},startMoving:function(t,e){t.moving=e},endMoving:function(t){t.moving=null},setSavedScrollPosition:function(t,e){t.savedScrollPosition=e},clearSavedScrollPosition:function(t){t.savedScrollPosition=null},saveCurrentSpecScrollTop:function(t,e){t.currentSpecId=e,t.currentSpecScrollTop=u.scrollTop()},clearCurrentSpec:function(t){t.currentSpecId=null,t.currentSpecScrollPosition=null},updateCurrentTime:function(t){t.currentTime=Date.now()}}}),p=d;u.on("resize",(function(){d.commit("setWindowWidth",u.width())}));setTimeout((function t(){d.commit("updateCurrentTime"),setTimeout(t,6e4)}),6e4);var f=s(20),h=s.n(f),m=/^VersionStamp: (.+)$/m;function b(t){console.error(t);var e=null;(t&&(0===t.readyState?e="Could not connect to server.":t.readyState&&t.status?e="Request failed with HTTP error code "+t.status+".":t.message?e=t.message:"string"==typeof t&&(e=t)),e||(e="An error occurred."),t&&t.responseText&&m.test(t.responseText))&&(m.exec(t.responseText)[1]!==window.appVersion&&(e+=" (A new version is available. Reload this page to use the latest client code.)"));n.a.prototype.$alert(e,"Error",{confirmButtonText:"Ok",type:"error"})}function v(t,e){return parseInt(t,10)===parseInt(e,10)}function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.title="CrowdSpec"+(t?" | ":"")+t}function _(t){if(window.URL)try{return new URL(t),!0}catch(t){return!1}return!(!t||!t.trim())}var w=/^https?:\/\/(?:www\.|m\.)?(?:youtube\.com\/watch\?v=|youtube\.com\/embed\/|youtu\.be\/|youtube\.googleapis\.com\/v\/|vimeo\.com\/|player\.vimeo\.com\/video\/)([a-zA-Z0-9_-]+)/;function k(t){return w.test(t)}var y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"index-page"},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.promptCreateSpec()}}},[t._v("New spec")]),t._v(" "),s("div",{staticClass:"user-specs"},[s("h2",[t._v("Your specs")]),t._v(" "),t.loading?s("p",[t._v("Loading...")]):t.userSpecs&&t.userSpecs.length?s("ul",{staticClass:"specs-list"},t._l(t.userSpecs,(function(e){return s("router-link",{key:e.id,attrs:{tag:"li",to:{name:"spec",params:{specId:e.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"status",class:{public:e.public}},[e.public?[s("i",{staticClass:"el-icon-umbrella"}),t._v(" Public")]:[s("i",{staticClass:"el-icon-lock"}),t._v(" Private")]],2)]),t._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:e.id}}}},[t._v(t._s(e.name))]),t._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[t._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:e.updated,offset:!0}})],1)])]),t._v(" "),e.desc?s("div",{staticClass:"desc"},[t._v(t._s(e.desc))]):t._e()],1)})),1):s("p",[t._v("You do not have any specs.")])]),t._v(" "),s("div",{staticClass:"public-specs",class:{"adjust-margin":!!t.userSpecs.length}},[s("h2",[t._v("Public specs")]),t._v(" "),t.loading?s("p",[t._v("Loading...")]):t.publicSpecs&&t.publicSpecs.length?s("ul",{staticClass:"specs-list"},t._l(t.publicSpecs,(function(e){return s("router-link",{key:e.id,attrs:{tag:"li",to:{name:"spec",params:{specId:e.id}}}},[s("div",{staticClass:"info"},[s("span",{staticClass:"username"},[s("i",{staticClass:"el-icon-user"},[t._v(" "+t._s(e.username))])])]),t._v(" "),s("router-link",{staticClass:"name",attrs:{to:{name:"spec",params:{specId:e.id}}}},[t._v(t._s(e.name))]),t._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"updated"},[t._v("Last modified "),s("strong",[s("moment",{attrs:{datetime:e.updated,offset:!0}})],1)])]),t._v(" "),e.desc?s("div",{staticClass:"desc"},[t._v(t._s(e.desc))]):t._e()],1)})),1):s("p",[t._v("There are no public specs......")])]),t._v(" "),s("edit-spec-modal",{ref:"editSpecModal"})],1)};y._withStripped=!0;var S=function(){var t=this.$createElement;return(this._self._c||t)("span",[this._v(this._s(this.output))])};S._withStripped=!0;var I=s(21),C=s.n(I);function $(t,e,s,i,n,o,r,l){var c,a="function"==typeof t?t.options:t;if(e&&(a.render=e,a.staticRenderFns=s,a._compiled=!0),i&&(a.functional=!0),o&&(a._scopeId="data-v-"+o),r?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},a._ssrRegister=c):n&&(c=l?function(){n.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(a.functional){a._injectStyles=c;var u=a.render;a.render=function(t,e){return c.call(e),u(t,e)}}else{var d=a.beforeCreate;a.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:a}}var T=$({props:{datetime:String,offset:Boolean},data:function(){return{timeout:null}},computed:{moment:function(){return C.a.parseZone(this.datetime)},currentTime:function(){return this.$store.state.currentTime},output:function(){return this.currentTime>0?this.offset?this.moment.fromNow():this.moment.format("YYYY-MM-DD h:mm a"):null}}},S,[],!1,null,null,null);T.options.__file="src/widgets/moment.vue";var P=T.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-spec-modal",attrs:{title:t.spec?"Manage spec":"Create spec",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.spec?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.spec.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.spec.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("label",[t._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),s("label",[t._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}})],1),t._v(" "),s("el-checkbox",{model:{value:t.isPublic,callback:function(e){t.isPublic=e},expression:"isPublic"}},[t._v("Allow public access and community features")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.spec?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDeleteSpec()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.spec?"Save":"Create"))])],1)],1)};function j(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function O(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?j(Object(s),!0).forEach((function(e){E(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):j(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function E(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function U(t){return l.a.get("/ajax/spec",{specId:t}).fail(b)}function R(t,e){return l.a.get("/ajax/spec/subspec",{specId:t,subspecId:e}).fail(b)}function B(t,e,s,i){return l.a.post("/ajax/spec/move-block",{blockId:t,subspecId:e,parentId:s,insertBeforeId:i}).fail(b)}x._withStripped=!0;var M={components:{Moment:P},data:function(){return{name:"",desc:"",isPublic:!1,spec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.callback=t,this.showing=!0,this.$nextTick((function(){l()("input",e.$refs.nameInput.$el).focus()}))},showEdit:function(t,e){var s=this;this.spec=t,this.name=t.name,this.desc=t.desc,this.isPublic=t.public,this.callback=e,this.showing=!0,this.$nextTick((function(){l()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.spec?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,i,n=this.callback;(e=this.name,s=this.desc,i=this.isPublic,l.a.post("/ajax/spec/create-spec",{name:e,desc:s,isPublic:i}).fail(b)).then((function(e){n(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;this.sending=!0;var e,s,i,n,o=this.callback;(e=this.spec.id,s=this.name,i=this.desc,n=this.isPublic,l.a.post("/ajax/spec/save-spec",{specId:e,name:s,desc:i,isPublic:n}).fail(b)).then((function(e){o(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))},promptDeleteSpec:function(){var t=this;this.$confirm("Permanently delete this spec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var e;t.sending=!0,(e=t.spec.id,l.a.post("/ajax/spec/delete-spec",{specId:e}).fail(b)).then((function(){t.sending=!1,t.showing=!1,t.$nextTick((function(){t.$router.push({name:"index"})}))})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.spec=null,this.name="",this.desc="",this.isPublic=!1}}},F=(s(25),$(M,x,[],!1,null,null,null));F.options.__file="src/spec/edit-spec-modal.vue";var D=F.exports,A={components:{Moment:P,EditSpecModal:D},data:function(){return{userSpecs:[],publicSpecs:[],loading:!0}},mounted:function(){this.reloadSpecs()},beforeRouteUpdate:function(t,e,s){this.reloadSpecs(),s()},methods:{reloadSpecs:function(){var t=this;this.loading=!0,l.a.get("/ajax/home").then((function(e){t.userSpecs=e.userSpecs,t.publicSpecs=e.publicSpecs,t.loading=!1})).fail((function(e){t.loading=!1,b(e)}))},promptCreateSpec:function(){var t=this;this.$refs.editSpecModal.showCreate((function(e){t.$router.push({name:"spec",params:{specId:e}})}))}}},L=(s(26),$(A,y,[],!1,null,null,null));L.options.__file="src/pages/index.vue";var z=L.exports,V=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.spec?s("section",{staticClass:"spec-page"},[s("header",[s("div",{staticClass:"right"},[t.currentUserOwns?s("span",[t._v("You own this")]):s("span",[t._v("\n\t\t\t\tOwned by\n\t\t\t\t"),t.spec.username?[t._v(t._s(t.spec.username))]:[t._v(t._s(t.spec.ownerType)+" "+t._s(t.spec.ownerId))]],2),t._v(" "),t.enableEditing?[t.spec.public?s("span",[t._v("\n\t\t\t\t\tPublic\n\t\t\t\t")]):s("span",[s("el-tooltip",{attrs:{content:"Unpublished",placement:"left"}},[s("i",{staticClass:"el-icon-lock"})])],1),t._v(" "),s("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(e){return t.openManageSpec()}}})]:s("span",[t._v("\n\t\t\t\tLast modified "),s("moment",{attrs:{datetime:t.spec.updated,offset:!0}})],1)],2),t._v(" "),s("h2",[t._v(t._s(t.spec.name))]),t._v(" "),t.spec.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.spec.desc))]):t._e()]),t._v(" "),s("spec-view",{key:t.spec.id,attrs:{spec:t.spec,"enable-editing":t.enableEditing}}),t._v(" "),t.enableEditing?s("edit-spec-modal",{ref:"editSpecModal"}):t._e()],1):t._e()};V._withStripped=!0;var N=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.spec||t.subspec?s("div",{staticClass:"spec-view"},[s("ul",{ref:"list",staticClass:"spec-block-list",class:{dragging:t.dragging}}),t._v(" "),t.enableEditing?[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.promptAddBlock()}}},[t._v("Add block")]),t._v(" "),s("ul",{ref:"mirrorList",staticClass:"mirror-list"}),t._v(" "),s("edit-block-modal",{ref:"editBlockModal",attrs:{"spec-id":t.specId,"subspec-id":t.subspecId},on:{"open-edit-url":t.openEditUrl,"play-video":t.playVideo}}),t._v(" "),s("edit-url-modal",{ref:"editUrlModal",attrs:{"spec-id":t.specId}})]:t._e(),t._v(" "),s("play-video-modal",{ref:"playVideoModal"})],2):t._e()};N._withStripped=!0;var W=s(22),Y=s.n(W),q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",{staticClass:"spec-block",class:t.classes,attrs:{"data-spec-block":t.block.id}},[s("div",{staticClass:"content",class:{"mobile-adjust":t.showActions}},[s("div",{staticClass:"bg"}),t._v(" "),s("div",{staticClass:"layover",on:{mouseleave:function(e){return t.mouseLeaveLayover()}}},[t.enableEditing?[s("div",{staticClass:"expand-control",class:{hide:t.showActions}},[t.unreadSubmissionsCount?s("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t\t")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-more",circle:""},on:{click:function(e){t.focusActions=!0}}})],1),t._v(" "),s("div",{staticClass:"actions",class:{show:t.showActions}},[t.choosingAddPosition?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(e){return t.cancelChooseAddPosition()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(e){return t.addBeforeThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(e){return t.addIntoThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.addAfterThis()}}})]:t.movingThis?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close"},on:{click:function(e){return t.cancelMoving()}}},[t._v("Cancel move")])]:t.movingAnother?[s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(e){return t.cancelMoving()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-top",circle:""},on:{click:function(e){return t.moveBeforeThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom-right",circle:""},on:{click:function(e){return t.moveIntoThis()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.moveAfterThis()}}})]:[s("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t\t\t")]),t._v(" "),s("el-button",{attrs:{type:"default",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.editBlock()}}}),t._v(" "),s("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.promptDeleteBlock()}}}),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.enterChooseAddPosition()}}}),t._v(" "),s("el-button",{staticClass:"move-action",attrs:{type:"default",size:"mini",icon:"el-icon-d-caret",circle:""},on:{click:function(e){return t.startMoving()}}}),t._v(" "),s("i",{staticClass:"el-icon-d-caret drag-handle",on:{click:function(e){return t.startMoving()}}})]],2)]:s("div",{staticClass:"visitor-actions"},[s("el-button",{attrs:{type:t.submissionsCount?"primary":"default",size:"mini",icon:"el-icon-chat-dot-square"},on:{click:function(e){return t.openCommunity()}}},[t._v("\n\t\t\t\t\t"+t._s(t.submissionsCount)+"\n\t\t\t\t")])],1)],2),t._v(" "),t.hasTitle?s("div",{staticClass:"title"},[t._v(t._s(t.title))]):t._e(),t._v(" "),t.hasRefItem?[t.refType===t.REF_TYPE_URL?s("ref-url",{staticClass:"ref-item",attrs:{item:t.refItem},on:{play:function(e){return t.raisePlayVideo(t.refItem)}}}):t.refType===t.REF_TYPE_SUBSPEC?s("ref-subspec",{staticClass:"ref-item",attrs:{item:t.refItem}}):t._e()]:t.refItemMissing?s("el-alert",{attrs:{title:"Content unavailable",closable:!1,type:"warning"}}):t._e(),t._v(" "),t.hasBody?s("div",{staticClass:"body"},[t._v(t._s(t.body))]):t._e()],2),t._v(" "),s("ul",{ref:"sublist",staticClass:"spec-block-list",class:{moving:t.movingThis}})])};q._withStripped=!0;var H=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-url"},[t.item.imageData?s("img",{attrs:{src:t.item.imageData}}):t._e(),t._v(" "),s("div",[t.showEdit||t.showPlay?s("div",{staticClass:"right"},[t.showEdit?s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.$emit("edit")}}}):t._e(),t._v(" "),t.showPlay?s("el-button",{staticClass:"play-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.$emit("play")}}},[t._v("Play")]):t._e()],1):t._e(),t._v(" "),s("div",{staticClass:"title"},[t._m(0),t._v(" "),s("a",{attrs:{href:t.item.url,target:"_blank"}},[t._v(t._s(t.item.title&&t.item.title.trim()||t.item.url))])]),t._v(" "),t.item.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.item.desc.trim()))]):t._e()])])};H._withStripped=!0;var X={props:{item:Object,showEdit:Boolean},computed:{showPlay:function(){return k(this.item.url)}}},Z=(s(27),$(X,H,[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i",{staticClass:"el-icon-link"}),this._v(" URL")])}],!1,null,null,null));Z.options.__file="src/spec/ref-url.vue";var Q=Z.exports,G=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-subspec"},[s("div",[s("div",{staticClass:"title"},[t._m(0),t._v(" "),s("router-link",{attrs:{to:{name:"subspec",params:{specId:t.item.specId,subspecId:t.item.id}}}},[t._v("\n\t\t\t\t"+t._s(t.item.name.trim())+"\n\t\t\t")])],1),t._v(" "),t.item.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.item.desc.trim()))]):t._e()])])};G._withStripped=!0;var J={props:{item:Object}},K=(s(28),$(J,G,[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i",{staticClass:"el-icon-s-unfold"}),this._v(" Subspec")])}],!1,null,null,null));K.options.__file="src/spec/ref-subspec.vue";var tt=K.exports;function et(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var st={components:{RefUrl:Q,RefSubspec:tt},props:{block:Object,subspecId:Number,eventBus:Object,enableEditing:Boolean},data:function(){return{updated:this.block.updated,styleType:this.block.styleType,contentType:this.block.contentType,refType:this.block.refType,refId:this.block.refId,title:this.block.title,body:this.block.body,refItem:this.block.refItem,subblocks:this.block.subblocks?this.block.subblocks.slice():[],choosingAddPosition:!1,focusActions:!1,hasSubblocks:!(!this.block.subblocks||!this.block.subblocks.length)}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},hasTitle:function(){return!(!this.title||!this.title.trim())},hasBody:function(){return!(!this.body||!this.body.trim())},hasRefItem:function(){return!(!this.refType||!this.refItem)},refItemMissing:function(){return!!this.refType&&!this.refItem},classes:function(){var t;return et(t={},this.styleType,!0),et(t,"title-only",this.hasTitle&&!this.hasBody&&!this.hasRefItem&&!this.hasSubblocks),et(t,"ref-item-only",this.hasRefItem&&!this.hasTitle&&!this.hasBody&&!this.hasSubblocks),t},movingThis:function(){return this.$store.state.moving===this.block.id},movingAnother:function(){return this.$store.state.moving&&!this.movingThis},showActions:function(){return this.focusActions||this.movingThis||this.movingAnother},unreadSubmissionsCount:function(){return 0},submissionsCount:function(){return 0}},mounted:function(){this.eventBus.$on("url-updated",this.urlUpdated),this.eventBus.$on("url-deleted",this.urlDeleted)},beforeDestroy:function(){this.eventBus.$off("url-updated",this.urlUpdated),this.eventBus.$off("url-deleted",this.urlDeleted)},methods:{getBlockId:function(){return this.block.id},getParentId:function(){var t=l()(this.$el).parent().closest("[data-spec-block]");return t.length?t.attr("data-spec-block"):null},getFollowingBlockId:function(){var t=l()(this.$el).next("[data-spec-block]");return t.length?t.attr("data-spec-block"):null},editBlock:function(){var t=this;this.raiseOpenEdit({id:this.block.id,created:this.block.created,updated:this.updated,styleType:this.styleType,contentType:this.contentType,refType:this.refType,refId:this.refId,refItem:this.refItem,title:this.title,body:this.body},(function(e){t.updated=e.updated,t.styleType=e.styleType,t.contentType=e.contentType,t.refType=e.refType,t.refId=e.refId,t.refItem=e.refItem,t.title=e.title,t.body=e.body}))},raiseOpenEdit:function(t,e){this.$emit("open-edit",t,e)},promptDeleteBlock:function(){var t=this;this.raisePromptDeleteBlock(this.block.id,(function(){l()(t.$el).remove()}))},raisePromptDeleteBlock:function(t,e){this.$emit("prompt-delete-block",t,e)},enterChooseAddPosition:function(){this.choosingAddPosition=!0},cancelChooseAddPosition:function(){this.choosingAddPosition=!1},addBeforeThis:function(){var t=this.getParentId(),e=this.block.id;this.raisePromptAddSubblock(t,e)},addIntoThis:function(){var t=this.block.id;this.raisePromptAddSubblock(t,null)},addAfterThis:function(){var t=this.getParentId(),e=this.getFollowingBlockId();this.raisePromptAddSubblock(t,e)},raisePromptAddSubblock:function(t,e){this.$emit("prompt-add-subblock",t,e)},startMoving:function(){this.$emit("start-moving",this.block.id),this.focusActions=!1},cancelMoving:function(){this.$emit("end-moving",this.block.id)},moveBeforeThis:function(){var t=this,e=this.$store.state.moving,s=this.getParentId(),i=this.block.id;B(e,this.subspecId,s,i).then((function(){var s=l()('[data-spec-block="'+e+'"]'),i=s.closest(".spec-block-list").closest("[data-spec-block]");s.insertBefore(t.$el),i.length&&i.data("vc").updateHasSubblocks(),t.$store.commit("endMoving")}))},moveIntoThis:function(){var t=this,e=this.$store.state.moving,s=this.block.id;B(e,this.subspecId,s,null).then((function(){var s=l()('[data-spec-block="'+e+'"]'),i=s.closest(".spec-block-list").closest("[data-spec-block]");s.appendTo(t.$refs.sublist),i.length&&i.data("vc").updateHasSubblocks(),t.updateHasSubblocks(),t.$store.commit("endMoving")}))},moveAfterThis:function(){var t=this,e=this.$store.state.moving,s=this.getParentId(),i=this.getFollowingBlockId();B(e,this.subspecId,s,i).then((function(){var s=l()('[data-spec-block="'+e+'"]'),i=s.closest(".spec-block-list").closest("[data-spec-block]");s.insertAfter(t.$el),i.length&&i.data("vc").updateHasSubblocks(),t.$store.commit("endMoving")}))},mouseLeaveLayover:function(){this.choosingAddPosition=!1,this.focusActions=!1},urlUpdated:function(t){"url"===this.refType&&t.id===this.refId&&(this.refItem=t)},urlDeleted:function(t){"url"===this.refType&&t===this.refId&&(this.refItem=null)},raisePlayVideo:function(t){this.$emit("play-video",t)},openCommunity:function(){this.$alert("Unimplemented")},updateHasSubblocks:function(){this.hasSubblocks=this.$refs.sublist.childElementCount>0}}},it=(s(29),$(st,q,[],!1,null,null,null));it.options.__file="src/spec/block.vue";var nt=it.exports,ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-block-modal",attrs:{title:t.block?"Edit block":"Add block",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.block?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.block.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.block.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("el-radio-group",{model:{value:t.styleType,callback:function(e){t.styleType=e},expression:"styleType"}},[s("el-radio",{attrs:{label:"bullet"}},[t._v("Bullet point")]),t._v(" "),s("el-radio",{attrs:{label:"numbered"}},[t._v("Numbered point")]),t._v(" "),s("el-radio",{attrs:{label:"none"}},[t._v("Indented block")])],1),t._v(" "),s("label",[t._v("\n\t\tTitle\n\t\t"),s("el-input",{ref:"titleInput",attrs:{clearable:""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),s("label",[t._v("\n\t\tBody\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}})],1),t._v(" "),s("el-radio-group",{model:{value:t.refType,callback:function(e){t.refType=e},expression:"refType"}},[s("el-radio",{attrs:{label:null}},[t._v("No media")]),t._v(" "),s("el-radio",{attrs:{label:t.REF_TYPE_SUBSPEC}},[t._v("Subspec")]),t._v(" "),s("el-radio",{attrs:{label:t.REF_TYPE_URL}},[t._v("URL")])],1),t._v(" "),t.refType===t.REF_TYPE_URL?s("ref-url-form",{attrs:{"spec-id":t.specId,"initial-url-object":t.existingUrlRefItem,valid:t.refFieldsValid,fields:t.refFields},on:{"update:valid":function(e){t.refFieldsValid=e},"update:fields":function(e){t.refFields=e},"open-edit-url":t.openEditUrl,"play-video":t.raisePlayVideo}}):t.refType===t.REF_TYPE_SUBSPEC?s("ref-subspec-form",{attrs:{"spec-id":t.specId,"initial-subspec":t.existingSubspecRefItem,valid:t.refFieldsValid,fields:t.refFields},on:{"update:valid":function(e){t.refFieldsValid=e},"update:fields":function(e){t.refFields=e}}}):t._e(),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v("\n\t\t\t"+t._s(t.block?"Save":"Add")+"\n\t\t")])],1)],1)};ot._withStripped=!0;var rt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-url-form"},[t.creating?s("el-card",[s("label",[t._v("\n\t\t\tNew link URL\n\t\t\t"),s("el-input",{attrs:{clearable:""},model:{value:t.newUrl,callback:function(e){t.newUrl=e},expression:"newUrl"}}),t._v(" "),t.newUrl&&!t.isValid?s("el-alert",{attrs:{title:"Invalid URL",type:"error",closable:!1}}):t.newUrlIsVideo?s("el-alert",{attrs:{title:"Embeddable video detected",type:"info",closable:!1}}):t._e()],1),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(){t.creating=!1,t.selecting=!0}}},[t._v("\n\t\t\tSelect an existing link\n\t\t")]):t._e(),t._v(" "),t.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(){t.creating=!1,t.selecting=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()],1):t.selecting?[t.loading?s("p",[t._v("Loading links...")]):t.urlObjects&&t.urlObjects.length?[s("el-select",{attrs:{filterable:"","filter-method":t.filterUrls,placeholder:"Select link"},model:{value:t.refId,callback:function(e){t.refId=e},expression:"refId"}},t._l(t.filteredUrlObjects,(function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.title||t.url}})})),1),t._v(" "),t.selectedUrlObject?s("ref-url",{attrs:{item:t.selectedUrlObject,"show-edit":""},on:{edit:function(e){return t.openEditUrl(t.selectedUrlObject)},play:function(e){return t.raisePlayVideo(t.selectedUrlObject)}}}):t._e()]:t._e(),t._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\tCreate new link\n\t\t")]),t._v(" "),t.initialUrlObject?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()]:[t.initialUrlObject?s("ref-url",{attrs:{item:t.initialUrlObject,"show-edit":""},on:{edit:function(e){return t.openEditUrl(t.initialUrlObject)},play:function(e){return t.raisePlayVideo(t.initialUrlObject)}}}):t._e(),t._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\t\tCreate new link\n\t\t\t")]),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!0}}},[t._v("\n\t\t\t\tSelect a different link\n\t\t\t")]):t._e()],1)]],2)};rt._withStripped=!0;var lt={components:{RefUrl:Q},props:{specId:Number,initialUrlObject:Object,valid:Boolean,fields:Object},data:function(){return{newUrl:"",refId:this.initialUrlObject?this.initialUrlObject.id:null,filter:"",creating:!this.initialUrlObject,selecting:!1,urlObjects:null,loading:!1}},computed:{filteredUrlObjects:function(){if(this.filter&&this.urlObjects){for(var t=this.filter.toLowerCase(),e=[],s=0;s<this.urlObjects.length;s++){var i=this.urlObjects[s];(i.url.toLowerCase().indexOf(t)>=0||i.title&&i.title.toLowerCase().indexOf(t)>=0)&&e.push(i)}return e}return this.urlObjects},selectModeAvailable:function(){return null===this.urlObjects||this.urlObjects.length>1||this.urlObjects.length&&!this.initialUrlObject||1===this.urlObjects.length&&this.urlObjects[0].id!==this.initialUrlObject.id},selectedUrlObject:function(){if(this.urlObjects&&this.refId)for(var t=0;t<this.urlObjects.length;t++)if(this.urlObjects[t].id===this.refId)return this.urlObjects[t];return null},newUrlIsVideo:function(){return _(this.newUrl)&&k(this.newUrl)},isValid:function(){return this.creating?_(this.newUrl):!!this.refId},refFields:function(){return this.creating?{refUrl:this.newUrl}:this.selecting?{refId:this.refId}:this.initialUrlObject?{refId:this.initialUrlObject.id}:null}},watch:{selecting:{immediate:!0,handler:function(t){t&&this.loadLinks()}},isValid:{immediate:!0,handler:function(t){this.$emit("update:valid",t)}},refFields:{immediate:!0,handler:function(t){this.$emit("update:fields",t)}}},methods:{loadLinks:function(){var t,e=this;this.urlObjects||this.loading||(this.loading=!0,(t=this.specId,l.a.get("/ajax/spec/urls",{specId:t}).fail(b)).then((function(t){e.urlObjects=t,t.length||(e.selecting=!1,e.initialUrlObject||(e.creating=!0)),e.loading=!1})).fail((function(){e.urlObjects=[],e.selecting=!1,e.initialUrlObject||(e.creating=!0),e.loading=!1})))},filterUrls:function(t){var e=this;t?(this.debouncedUpdateFilter||(this.debouncedUpdateFilter=function(t){var e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;function i(){e=null,t.apply(this,arguments)}return function(){return e&&clearTimeout(e),e=setTimeout(i.bind.apply(i,[this].concat(Array.prototype.slice.call(arguments))),s)}}((function(t){e.filter=t}))),this.debouncedUpdateFilter(t)):this.filter=""},openEditUrl:function(t){var e=this;this.$emit("open-edit-url",t,(function(s){if(e.urlObjects)for(var i=0;i<e.urlObjects.length;i++)if(e.urlObjects[i].id===t.id){e.urlObjects.splice(i,1,s);break}}),(function(){if(e.urlObjects)for(var s=0;s<e.urlObjects.length;s++)if(e.urlObjects[s].id===t.id){e.urlObjects.splice(s,1);break}e.refId===t.id&&(e.refId=null)}))},raisePlayVideo:function(t){this.$emit("play-video",t)}}},ct=(s(30),$(lt,rt,[],!1,null,null,null));ct.options.__file="src/spec/ref-url-form.vue";var at=ct.exports,ut=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ref-subspec-form"},[t.creating?s("el-card",[s("label",[t._v("\n\t\t\tNew subspec name\n\t\t\t"),s("el-input",{ref:"newSubspecNameInput",attrs:{clearable:""},model:{value:t.subspecName,callback:function(e){t.subspecName=e},expression:"subspecName"}})],1),t._v(" "),s("label",[t._v("\n\t\t\tDescription\n\t\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.subspecDesc,callback:function(e){t.subspecDesc=e},expression:"subspecDesc"}})],1),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!1}}},[t._v("\n\t\t\tCancel\n\t\t")]):t._e()],1):t.selecting?[t.loading?s("p",[t._v("Loading subspecs...")]):t.subspecs&&t.subspecs.length?[s("el-select",{attrs:{filterable:"",placeholder:"Select subspec"},model:{value:t.refId,callback:function(e){t.refId=e},expression:"refId"}},t._l(t.subspecs,(function(t){return s("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1),t._v(" "),t.selectedSubspec?s("ref-subspec",{attrs:{item:t.selectedSubspec}}):t._e()]:t._e(),t._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\tCreate new subspec\n\t\t")])]:[t.initialSubspec?s("ref-subspec",{attrs:{item:t.initialSubspec}}):t._e(),t._v(" "),s("div",[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.creating=!0}}},[t._v("\n\t\t\t\tCreate new subspec\n\t\t\t")]),t._v(" "),t.selectModeAvailable?s("el-button",{attrs:{size:"small"},on:{click:function(e){t.selecting=!0}}},[t._v("\n\t\t\t\tSelect a different subspec\n\t\t\t")]):t._e()],1)]],2)};ut._withStripped=!0;var dt={components:{RefSubspec:tt},props:{specId:Number,initialSubspec:Object,valid:Boolean,fields:Object},data:function(){return{subspecName:"",subspecDesc:"",refId:this.initialSubspec?this.initialSubspec.id:null,creating:!1,selecting:!this.initialSubspec,subspecs:null,loading:!1}},computed:{selectModeAvailable:function(){return null===this.subspecs||this.subspecs.length},selectedSubspec:function(){if(this.subspecs&&this.refId)for(var t=0;t<this.subspecs.length;t++)if(this.subspecs[t].id===this.refId)return this.subspecs[t];return null},isValid:function(){return this.creating?!!this.subspecName.trim():!!this.refId},refFields:function(){return this.creating?{refName:this.subspecName,refDesc:this.subspecDesc}:{refId:this.refId}}},watch:{selecting:{immediate:!0,handler:function(t){t&&this.loadSubspecs()}},isValid:{immediate:!0,handler:function(t){this.$emit("update:valid",t)}},refFields:{immediate:!0,handler:function(t){this.$emit("update:fields",t)}}},methods:{loadSubspecs:function(){var t,e=this;this.loading||(this.loading=!0,(t=this.specId,l.a.get("/ajax/spec/subspecs",{specId:t}).fail(b)).then((function(t){e.subspecs=t,t.length||(e.creating=!0),e.loading=!1})).fail((function(){e.subspecs=[],e.creating=!0,e.loading=!1})))}}},pt=(s(31),$(dt,ut,[],!1,null,null,null));pt.options.__file="src/spec/ref-subspec-form.vue";var ft={components:{Moment:P,RefUrlForm:at,RefSubspecForm:pt.exports},props:{specId:{type:Number,required:!0},subspecId:Number},data:function(){return{styleType:"bullet",title:"",body:"",refType:null,refFields:null,refFieldsValid:!1,block:null,parentId:null,insertBeforeId:null,callback:null,showing:!1,initialRefItem:null}},computed:{REF_TYPE_URL:function(){return"url"},REF_TYPE_SUBSPEC:function(){return"subspec"},disableSubmit:function(){return this.refType?!(this.refFieldsValid&&this.refFields):!(this.title.trim()||this.body.trim())},existingUrlRefItem:function(){return this.block&&"url"===this.block.refType&&this.block.refItem||null},existingSubspecRefItem:function(){return this.block&&"subspec"===this.block.refType&&this.block.refItem||null}},watch:{refType:function(t){this.refFields=null}},methods:{showAdd:function(t,e,s){this.parentId=t,this.insertBeforeId=e,this.callback=s,this.showing=!0,this.focusTitleInput()},showEdit:function(t,e){this.block=t,this.styleType=t.styleType,this.title=t.title||"",this.body=t.body||"",this.refType=t.refType,this.callback=e,this.showing=!0,this.focusTitleInput()},focusTitleInput:function(){var t=this;this.$nextTick((function(){l()("input",t.$refs.titleInput.$el).focus()}))},openEditUrl:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$emit("open-edit-url",t,(function(t){e.existingUrlRefItem&&t.id===e.existingUrlRefItem.id&&(e.block.refItem=t),s&&s(t)}),(function(t){e.existingUrlRefItem&&t===e.existingUrlRefItem.id&&(e.block.refType=null,e.block.refId=null,e.block.refItem=null),i&&i(t)}))},raisePlayVideo:function(t){this.$emit("play-video",t)},submit:function(){var t=this;if(!this.disableSubmit){var e,s,i,n,o,r,c,a,u=this.createSendingSpinner(),d=this.callback;this.block?(e=this.specId,s=this.block.id,i=this.styleType,n="plaintext",o=this.title,r=this.body,c=this.refType,a=this.refFields,a=a||{},l.a.post("/ajax/spec/save-block",O({specId:e,blockId:s,styleType:i,contentType:n,title:o,body:r,refType:c},a)).fail(b)).then((function(e){d(e),t.showing=!1,u.close()})).fail((function(){u.close()})):function(t,e,s,i,n,o,r,c,a,u){return u=u||{},l.a.post("/ajax/spec/create-block",O({specId:t,subspecId:e,parentId:s,insertBeforeId:i,styleType:n,contentType:o,title:r,body:c,refType:a},u)).fail(b)}(this.specId,this.subspecId,this.parentId,this.insertBeforeId,this.styleType,"plaintext",this.title,this.body,this.refType,this.refFields).then((function(e){d(e),t.showing=!1,u.close()})).fail((function(){u.close()}))}},createSendingSpinner:function(){return this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"})},closed:function(){this.block=null,this.parentId=null,this.insertBeforeId=null,this.callback=null,this.title="",this.body="",this.refType=null,this.refFields=null,this.refFieldsValid=!1}}},ht=(s(32),$(ft,ot,[],!1,null,null,null));ht.options.__file="src/spec/edit-block-modal.vue";var mt=ht.exports,bt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-url-modal",attrs:{title:t.urlObject?"Manage link":"Create link",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.urlObject?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.urlObject.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.urlObject.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("label",[t._v("\n\t\tURL\n\t\t"),s("el-input",{ref:"urlInput",model:{value:t.url,callback:function(e){t.url=e},expression:"url"}})],1),t._v(" "),t.urlObject?[t.url===t.urlObject.url?s("div",{staticClass:"preview"},[t.urlObject.imageData?s("img",{attrs:{src:t.urlObject.imageData}}):t._e(),t._v(" "),s("div",[t.urlObject.title?s("h3",[t._v(t._s(t.urlObject.title.trim()))]):t._e(),t._v(" "),t.urlObject.desc?s("div",[t._v(t._s(t.urlObject.desc.trim()))]):t._e(),t._v(" "),t.autoRefresh?s("p",[t._v("URL preview will be updated")]):s("el-checkbox",{model:{value:t.refresh,callback:function(e){t.refresh=e},expression:"refresh"}},[t._v("Refresh URL preview")])],1)]):s("p",[t._v("Link will be updated with new URL")])]:t._e(),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.urlObject?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDelete()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.urlObject?"Save":"Create"))])],1)],2)};bt._withStripped=!0;var vt={components:{Moment:P},props:{specId:{type:Number,required:!0}},data:function(){return{url:"",refresh:!1,urlObject:null,createdCallback:null,updatedCallback:null,deletedCallback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return window.isValidURL=_,!_(this.url)||this.urlObject&&!(this.refresh||this.autoRefresh)},autoRefresh:function(){return this.urlObject&&this.url!==this.urlObject.url}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.createdCallback=t,this.showing=!0,this.$nextTick((function(){l()("input",e.$refs.urlInput.$el).focus()}))},showEdit:function(t,e,s){var i=this;this.urlObject=t,this.url=t.url,this.refresh=!0,this.updatedCallback=e,this.deletedCallback=s,this.showing=!0,this.$nextTick((function(){l()("input",i.$refs.urlInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.urlObject?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,i=this.createdCallback;(e=this.specId,s=this.url,l.a.post("/ajax/spec/create-url",{specId:e,url:s}).fail(b)).then((function(e){i(e),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,i=this.updatedCallback;(e=this.urlObject.id,s=this.url,l.a.post("/ajax/spec/refresh-url",{id:e,url:s}).fail(b)).then((function(e){i(e),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))}},promptDelete:function(){var t=this;this.$confirm("Permanently delete this link? All references to this link within this spec will be cleared.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){t.sending=!0;var e,s=t.deletedCallback;(e=t.urlObject.id,l.a.post("/ajax/spec/delete-url",{id:e}).fail(b)).then((function(){s&&s(t.urlObject.id),t.sending=!1,t.showing=!1})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.url="",this.refresh=!1,this.urlObject=null,this.createdCallback=null,this.updatedCallback=null,this.deletedCallback=null}}},gt=(s(33),$(vt,bt,[],!1,null,null,null));gt.options.__file="src/spec/edit-url-modal.vue";var _t=gt.exports,wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"play-video-modal",attrs:{visible:t.showing,width:t.$store.getters.dialogSmallWidth},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.vid?s("div",{staticClass:"embed-responsive"},["youtube"===t.vid.type?s("iframe",{attrs:{src:"https://www.youtube.com/embed/"+t.vid.id+"?rel=0&showinfo=0&ecver=1&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):"vimeo"===t.vid.type?s("iframe",{attrs:{src:"https://player.vimeo.com/video/"+t.vid.id+"?title=0&byline=0&portrait=0&autoplay=1",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):t._e()]):t._e()])};wt._withStripped=!0;var kt={data:function(){return{vid:null,showing:!1}},methods:{show:function(t){var e,s,i=(e=t.url,(s=w.exec(e))?e.indexOf("youtube.com")||e.indexOf("youtu.be")?{type:"youtube",id:s[1]}:e.indexOf("vimeo.com")?{type:"vimeo",id:s[1]}:null:null);i&&(this.vid=i,this.showing=!0)},closed:function(){this.vid=null}}},yt=(s(34),$(kt,wt,[],!1,null,null,null));yt.options.__file="src/spec/play-video-modal.vue";var St=yt.exports,It=n.a.extend(nt),Ct={components:{EditBlockModal:mt,EditUrlModal:_t,PlayVideoModal:St},props:{spec:Object,subspec:Object,enableEditing:Boolean},data:function(){return{autoscroller:null,eventBus:new n.a}},computed:{dragging:function(){return this.$store.state.dragging},specId:function(){return this.spec?this.spec.id:this.subspec?this.subspec.specId:null},subspecId:function(){return this.subspec?this.subspec.id:null}},watch:{dragging:function(t){t?this.autoscroller=function(){var t=l()(window),e=null,s=null;function i(t){s=t.clientY}return t.on("mousemove",i),e=window.requestAnimationFrame((function i(){if(null!==s){var n=t.height(),o=0;if(s<70)o=-(8*((70-s)/70)+1);else if(s>n-70){o=8*((s-(n-70))/70)+1}0!==o&&t.scrollTop(t.scrollTop()+o)}e=window.requestAnimationFrame(i)})),{stop:function(){t.off("mousemove",i),e&&(window.cancelAnimationFrame(e),e=null)}}}():this.autoscroller&&this.autoscroller.stop()}},mounted:function(){var t,e=this;if(!this.spec&&!this.subspec)throw"spec or subspec param required";if(this.spec&&this.subspec)throw"both spec and subspec provided; exactly one required";if(this.spec)t=this.spec.blocks;else{if(!this.subspec)return;t=this.subspec.blocks}if(t)for(var s=function t(s,i){for(var n=0;n<i.length;n++){var o=i[n],r=e.insertBlock(o,!1);l()(">ul.spec-block-list",s).append(r),o.subblocks&&t(r,o.subblocks)}},i=0;i<t.length;i++){var n=t[i],o=this.insertBlock(n);n.subblocks&&s(o,n.subblocks)}this.enableEditing&&(this.drake=Y()({isContainer:function(t){return l()(t).is(".spec-block-list")},accepts:function(t,e,s,i){return!l()(e).closest(".gu-transit").length},moves:function(t,e,s,i){return l()(s).is(".drag-handle")},mirrorContainer:this.$refs.mirrorList}).on("drag",(function(t,s){e.$store.commit("startDragging"),e.transitRelativeScroll(l()(t).attr("data-spec-block"))})).on("dragend",(function(t){e.$store.commit("endDragging"),e.transitRelativeScroll(l()(t).attr("data-spec-block"))})).on("drop",(function(t,s,i,n){var o=l()(i).closest("[data-spec-block]");o.length&&o.data("vc").updateHasSubblocks();var r=null,c=l()(s).closest("[data-spec-block]");if(c.length){var a=c.data("vc");r=a.getBlockId(),a.updateHasSubblocks()}var u=n?l()(n).data("vc").getBlockId():null;B(l()(t).data("vc").getBlockId(),e.subspecId,r,u)})))},beforeDestroy:function(){this.drake&&(this.drake.destroy(),this.drake=null),this.eventBus.$destroy(),this.eventBus=null,l()("[data-spec-block]",this.$refs.list).each((function(t,e){l()(e).data("vc").$destroy()}))},methods:{transitRelativeScrollFirst:function(){var t=this,e=l()(window).scrollTop();l()("[data-spec-block]",this.$refs.list).each((function(s,i){var n=l()(i).offset();if(n.top>e){var o=n.top-e;return t.$nextTick((function(){l()(window).scrollTop(l()(i).offset().top-o)})),!1}}))},transitRelativeScroll:function(t){var e=l()(window).scrollTop(),s=l()('[data-spec-block="'+t+'"]',this.$refs.list),i=s.offset().top-e;this.$nextTick((function(){l()(window).scrollTop(s.offset().top-i)}))},insertBlock:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=new It({parent:this,store:p,router:qt,propsData:{block:t,subspecId:this.subspecId,eventBus:this.eventBus,enableEditing:this.enableEditing}}).$mount();s.$on("open-edit",this.openEdit),s.$on("prompt-add-subblock",this.promptAddSubblock),s.$on("prompt-delete-block",this.promptDeleteBlock),s.$on("start-moving",this.startMovingBlock),s.$on("end-moving",this.endMovingBlock),s.$on("play-video",this.playVideo);var i=l()(s.$el).data("vc",s);return e&&i.appendTo(this.$refs.list),i},promptAddBlock:function(){this.$refs.editBlockModal.showAdd(null,null,this.insertBlock)},openEdit:function(t,e){this.$refs.editBlockModal.showEdit(t,e)},promptAddSubblock:function(t,e){var s=this;this.$refs.editBlockModal.showAdd(t,e,(function(i){var n=s.insertBlock(i,!1);e?n.insertBefore('[data-spec-block="'+e+'"]'):t?n.appendTo('[data-spec-block="'+t+'"]>ul.spec-block-list'):n.appendTo(s.$refs.list)}))},promptDeleteBlock:function(t,e){this.$confirm("Delete block and subblocks?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){(function(t){return l.a.post("/ajax/spec/delete-block",{blockId:t}).fail(b)})(t).then(e)})).catch((function(){}))},startMovingBlock:function(t){this.$store.commit("startMoving",t),this.transitRelativeScroll(t)},endMovingBlock:function(t){this.$store.commit("endMoving"),this.transitRelativeScroll(t)},openEditUrl:function(t,e,s){var i=this;this.$refs.editUrlModal.showEdit(t,(function(t){i.eventBus.$emit("url-updated",t),e&&e(t)}),(function(t){i.eventBus.$emit("url-deleted",t),s&&s(t)}))},playVideo:function(t){this.$refs.playVideoModal.show(t)}}},$t=(s(35),$(Ct,N,[],!1,null,null,null));$t.options.__file="src/spec/view.vue";var Tt=$t.exports,Pt={components:{Moment:P,SpecView:Tt,EditSpecModal:D},data:function(){return{spec:null}},computed:{currentUserOwns:function(){return"user"===this.spec.ownerType&&this.$store.getters.userID===this.spec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(t,e,s){U(t.params.specId).then((function(t){s((function(e){e.setSpec(t)}))})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteUpdate:function(t,e,s){var i=this;U(t.params.specId).then((function(t){i.setSpec(t),s()})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteLeave:function(t,e,s){g(),s()},methods:{setSpec:function(t){this.spec=t,g(t.name),this.$nextTick(this.restoreScroll)},openManageSpec:function(){var t=this;this.$refs.editSpecModal.showEdit(this.spec,(function(e){t.spec.updated=e.updated,t.spec.name=e.name,t.spec.desc=e.desc,t.spec.public=e.public,g(e.name)}))},restoreScroll:function(){var t=this.$store.state.savedScrollPosition;t?l()(window).scrollTop(t.y).scrollLeft(t.x):v(this.$store.state.currentSpecId,this.spec.id)&&this.$store.state.currentSpecScrollTop&&l()(window).scrollTop(this.$store.state.currentSpecScrollTop)}}},xt=(s(36),$(Pt,V,[],!1,null,null,null));xt.options.__file="src/pages/spec.vue";var jt=xt.exports,Ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.subspec?s("section",{staticClass:"subspec-page"},[s("header",[s("div",{staticClass:"spec",on:{click:function(e){return t.gotoSpec()}}},[s("h2",[t._v("\n\t\t\t\t"+t._s(t.subspec.specName)+"\n\t\t\t")])]),t._v(" "),s("div",{staticClass:"subspec"},[s("div",{staticClass:"right"},[t.enableEditing?s("el-button",{attrs:{size:"mini",icon:"el-icon-setting"},on:{click:function(e){return t.openManageSubspec()}}}):s("span",[t._v("\n\t\t\t\t\tLast modified "),s("moment",{attrs:{datetime:t.subspec.updated,offset:!0}})],1)],1),t._v(" "),s("h3",[t._v(t._s(t.subspec.name))]),t._v(" "),t.subspec.desc?s("div",{staticClass:"desc"},[t._v(t._s(t.subspec.desc))]):t._e()])]),t._v(" "),s("spec-view",{key:t.subspec.id,attrs:{subspec:t.subspec,"enable-editing":t.enableEditing}}),t._v(" "),t.enableEditing?s("edit-subspec-modal",{ref:"editSubspecModal",attrs:{"spec-id":t.subspec.specId}}):t._e()],1):t._e()};Ot._withStripped=!0;var Et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"spec-edit-subspec-modal",attrs:{title:t.subspec?"Manage subspec":"Create subspec",visible:t.showing,width:t.$store.getters.dialogSmallWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.closed()}}},[t.subspec?s("p",[t._v("\n\t\tCreated "),s("strong",[s("moment",{attrs:{datetime:t.subspec.created}})],1),t._v(";\n\t\tlast modified "),s("strong",[s("moment",{attrs:{datetime:t.subspec.updated,offset:!0}})],1)]):t._e(),t._v(" "),s("label",[t._v("\n\t\tName\n\t\t"),s("el-input",{ref:"nameInput",attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),s("label",[t._v("\n\t\tDescription\n\t\t"),s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}})],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Cancel")]),t._v(" "),t.subspec?s("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.promptDeleteSubspec()}}},[t._v("Delete")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.disableSubmit},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.subspec?"Save":"Create"))])],1)])};Et._withStripped=!0;var Ut={components:{Moment:P},props:{specId:{type:Number,required:!0}},data:function(){return{name:"",desc:"",subspec:null,callback:null,showing:!1,sending:!1}},computed:{disableSubmit:function(){return!this.name.trim()}},watch:{sending:function(t){t?this.sendingSpinner=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):this.sendingSpinner&&(this.sendingSpinner.close(),this.sendingSpinner=null)}},methods:{showCreate:function(t){var e=this;this.callback=t,this.showing=!0,this.$nextTick((function(){l()("input",e.$refs.nameInput.$el).focus()}))},showEdit:function(t,e){var s=this;this.subspec=t,this.name=t.name,this.desc=t.desc,this.callback=e,this.showing=!0,this.$nextTick((function(){l()("input",s.$refs.nameInput.$el).focus()}))},submit:function(){this.disableSubmit||(this.subspec?this.submitSave():this.submitCreate())},submitCreate:function(){var t=this;if(!this.disableSubmit){this.sending=!0;var e,s,i,n=this.callback;(e=this.specId,s=this.name,i=this.desc,l.a.post("/ajax/spec/create-subspec",{specId:e,name:s,desc:i}).fail(b)).then((function(e){n(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))}},submitSave:function(){var t=this;this.sending=!0;var e,s,i,n=this.callback;(e=this.subspec.id,s=this.name,i=this.desc,l.a.post("/ajax/spec/save-subspec",{subspecId:e,name:s,desc:i}).fail(b)).then((function(e){n(e),t.showing=!1,t.sending=!1})).fail((function(){t.sending=!1}))},promptDeleteSubspec:function(){var t=this;this.$confirm("Permanently delete this subspec?",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then((function(){var e;t.sending=!0,(e=t.subspec.id,l.a.post("/ajax/spec/delete-subspec",{subspecId:e}).fail(b)).then((function(){t.sending=!1,t.showing=!1,t.$nextTick((function(){t.$router.push({name:"spec",params:{specId:t.specId}})}))})).fail((function(){t.sending=!1}))})).catch((function(){}))},closed:function(){this.subspec=null,this.name="",this.desc=""}}},Rt=(s(37),$(Ut,Et,[],!1,null,null,null));Rt.options.__file="src/spec/edit-subspec-modal.vue";var Bt={components:{Moment:P,SpecView:Tt,EditSubspecModal:Rt.exports},data:function(){return{subspec:null}},computed:{currentUserOwns:function(){return"user"===this.subspec.ownerType&&this.$store.getters.userID===this.subspec.ownerId},enableEditing:function(){return this.currentUserOwns}},beforeRouteEnter:function(t,e,s){R(t.params.specId,t.params.subspecId).then((function(t){s((function(e){e.setSubspec(t)}))})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteUpdate:function(t,e,s){var i=this;R(t.params.specId,t.params.subspecId).then((function(t){i.setSubspec(t),s(),i.$nextTick(i.restoreScroll)})).fail((function(e){s({name:"ajax-error",params:{code:e.status},query:{url:encodeURIComponent(t.fullPath)},replace:!0})}))},beforeRouteLeave:function(t,e,s){g(),s()},methods:{setSubspec:function(t){this.subspec=t,g(t.name),this.$nextTick(this.restoreScroll)},gotoSpec:function(){this.$router.push({name:"spec",params:{specId:this.subspec.specId}})},openManageSubspec:function(){var t=this;this.$refs.editSubspecModal.showEdit(this.subspec,(function(e){t.subspec.updated=e.updated,t.subspec.name=e.name,t.subspec.desc=e.desc,g(e.name)}))},restoreScroll:function(){var t=this.$store.state.savedScrollPosition;t&&l()(window).scrollTop(t.y).scrollLeft(t.x)}}},Mt=(s(38),$(Bt,Ot,[],!1,null,null,null));Mt.options.__file="src/pages/subspec.vue";var Ft=Mt.exports,Dt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ajax-error-page"},[0===parseInt(t.$route.params.code,10)?s("p",[t._v("\n\t\tCould not connect to server\n\t")]):s("p",[t._v("\n\t\tRequest failed with error code "+t._s(t.$route.params.code)+"\n\t")]),t._v(" "),t.url?s("el-button",{on:{click:function(e){return t.retry()}}},[t._v("Retry")]):t._e()],1)};Dt._withStripped=!0;var At={computed:{url:function(){return decodeURIComponent(this.$route.query.url)}},methods:{retry:function(){this.$router.replace(this.url)}}},Lt=(s(39),$(At,Dt,[],!1,null,null,null));Lt.options.__file="src/pages/ajax-error.vue";var zt=Lt.exports,Vt=function(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("\n\tNot found\n")])};Vt._withStripped=!0;var Nt=$({},Vt,[],!1,null,null,null);Nt.options.__file="src/pages/not-found.vue";var Wt=Nt.exports,Yt=new h.a({mode:"history",routes:[{name:"index",path:"/",component:z},{name:"spec",path:"/spec/:specId",component:jt},{name:"subspec",path:"/spec/:specId/subspec/:subspecId",component:Ft},{name:"ajax-error",path:"/ajax-error/:code",component:zt},{path:"*",component:Wt}],scrollBehavior:function(t,e,s){return p.commit("setSavedScrollPosition",s),t.hash?{selector:t.hash}:s||{x:0,y:0}}});Yt.beforeEach((function(t,e,s){e&&(!p.state.currentSpecId||t.params.specId&&v(t.params.specId,p.state.currentSpecId)?"spec"===e.name&&p.commit("saveCurrentSpecScrollTop",e.params.specId):p.commit("clearCurrentSpec")),s()})),Yt.afterEach((function(t,e){p.commit("clearSavedScrollPosition")}));var qt=Yt,Ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"edit-profile-modal",attrs:{title:"Edit profile",visible:t.showing,width:t.$store.getters.dialogTinyWidth,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showing=e},closed:function(e){return t.clearMode()}}},[s("p",[t._v("User ID: "+t._s(t.userID))]),t._v(" "),s("p",[t._v("Username: "+t._s(t.username))]),t._v(" "),t.changePasswordMode?s("el-form",{ref:"changePasswordForm",attrs:{model:t.changePasswordForm,rules:t.changePasswordRules,"label-position":"top"}},[s("el-form-item",{attrs:{label:"Existing password",prop:"oldPass"}},[s("el-input",{attrs:{type:"password",name:"old_password",autocomplete:"off"},model:{value:t.changePasswordForm.oldPass,callback:function(e){t.$set(t.changePasswordForm,"oldPass",e)},expression:"changePasswordForm.oldPass"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"New password",prop:"newPass"}},[s("el-input",{attrs:{type:"password",name:"new_password",autocomplete:"off"},model:{value:t.changePasswordForm.newPass,callback:function(e){t.$set(t.changePasswordForm,"newPass",e)},expression:"changePasswordForm.newPass"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"Confirm new password",prop:"newPass2"}},[s("el-input",{attrs:{type:"password",name:"verify_password",autocomplete:"off"},model:{value:t.changePasswordForm.newPass2,callback:function(e){t.$set(t.changePasswordForm,"newPass2",e)},expression:"changePasswordForm.newPass2"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitChangePassword()}}},[t._v("\n\t\t\t\tUpdate\n\t\t\t")]),t._v(" "),s("el-button",{on:{click:function(e){return t.clearMode()}}},[t._v("\n\t\t\t\tCancel\n\t\t\t")])],1)],1):s("el-button",{staticClass:"change-password",on:{click:function(e){return t.enterChangePasswordMode()}}},[t._v("\n\t\tChange password\n\t")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.showing=!1}}},[t._v("Close")])],1)],1)};Ht._withStripped=!0;var Xt={data:function(){return{showing:!1,mode:null,changePasswordFormValid:!1,changePasswordForm:{oldPass:"",newPass:"",newPass2:""}}},computed:{userID:function(){return this.$store.getters.userID},username:function(){return this.$store.getters.username},changePasswordMode:function(){return 1===this.mode},changePasswordRules:function(){var t=this;return{oldPass:[{validator:function(t,e,s){e.trim()?s():s(new Error("Enter your old password"))},trigger:"blur"}],newPass:[{validator:function(e,s,i){s.trim().length<5?i(new Error("Password minimum length is 5 digits")):(t.changePasswordForm.newPass2.trim()&&t.$refs.changePasswordForm.validateField("newPass2"),i())},trigger:"blur"}],newPass2:[{validator:function(e,s,i){s.trim()?s!==t.changePasswordForm.newPass?i(new Error("Passwords do not match")):i():i(new Error("Repeat new password"))},trigger:"blur"}]}}},methods:{show:function(){this.showing=!0},enterChangePasswordMode:function(){this.mode=1},updateChangePasswordFormValid:function(){var t=this;this.$nextTick((function(){t.$refs.changePasswordForm.validate((function(e){t.changePasswordFormValid=e}))}))},submitChangePassword:function(){var t=this;this.$refs.changePasswordForm.validate((function(e){e&&l.a.post("/ajax/user/change-password",{old:t.changePasswordForm.oldPass,new:t.changePasswordForm.newPass,new2:t.changePasswordForm.newPass2}).then((function(){t.$message({message:"Password updated successfully",type:"success",showClose:!0,duration:1200}),t.clearMode()})).fail((function(e){if(e&&e.readyState)switch(e.status){case 400:t.$alert("New password rejected",{type:"error"});break;case 403:t.$alert("Old password rejected",{type:"error"});break;default:b(e)}else b(e)}))}))},clearMode:function(){this.mode=null,this.changePasswordFormValid=!1,this.changePasswordForm={oldPass:"",newPass:"",newPass2:""}}}},Zt=(s(40),$(Xt,Ht,[],!1,null,null,null));Zt.options.__file="src/widgets/edit-profile-modal.vue";var Qt=Zt.exports,Gt={store:p,router:qt,components:{EditProfileModal:Qt},computed:{username:function(){return this.$store.getters.username}},methods:{gotoIndex:function(){"index"!==this.$route.name&&this.$router.push({name:"index"})},logout:function(){window.location.href="/logout"},openEditProfile:function(){this.$refs.editProfileModal.show()}}},Jt=(s(41),$(Gt,o,[],!1,null,null,null));Jt.options.__file="src/app.vue";var Kt=Jt.exports;ELEMENT.locale(ELEMENT.lang.en),new n.a(Kt).$mount("#app")}]);